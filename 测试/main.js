!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){this.scene=a,this.gl=a.gl,this.subrenderables=[],this.keepBuffer=!1,this.parse=this._parse.bind(this),this.onLoad=this._onLoad.bind(this),this.mats=a.matlib.createProvider(b),this.texs=a.texlib.createProvider(b),this._state=j,this._loadables=[],this._loadPromise=null,this.node=new g}var e=a("lib/net"),f=a("lib/awd"),g=a("nanogl-node"),h=a("config"),i=a("when"),j=1;d.prototype={getLoadables:function(){var a;if(this._state===j){var b=h.asset_url(this.getAwdUrl());a=e.loadBytes(b).then(this.parse),this._loadables.push(a);for(var c=this.texs.getLoadables(),d=0;d<c.length;d++)this._loadables.push(c[d]);this._state=2,this._loadPromise=i.all(this._loadables),this._loadPromise.then(this.onLoad)}return this._loadables},getAwdUrl:function(){return null},getMaterial:function(a){return this.mats.getMaterial(a)},_parse:function(a){this.loader=new f(a),this.loader.keepBuffer=this.keepBuffer,this.loader.load(this,this.node),this.meshes=this.loader.getMeshes(),this._postParse()},_postParse:function(){},_onLoad:function(){this._state=3},preRender:function(a){},render:function(a,b){if(3===this._state){for(var c=0;c<this.subrenderables.length;c++)this.subrenderables[c].render(a,b);for(var d=this.meshes,c=0;c<d.length;c++)d[c].render(this.scene,a,b)}},renderPass:function(a,b,c){if(3===this._state){for(var d=0;d<this.subrenderables.length;d++)this.subrenderables[d].renderPass(this.scene,a,b,c);for(var e=this.meshes,d=0;d<e.length;d++)e[d].renderPass(this.scene,a,b,c)}},renderDepth:function(a,b,c){if(3===this._state){for(var d=0;d<this.subrenderables.length;d++)this.subrenderables[d].renderDepth(this.scene,a,b,c);for(var e=this.meshes,d=0;d<e.length;d++)e[d].renderDepth(this.scene,a,b,void 0,c)}},renderProgram:function(a,b,c){for(var d=this.meshes,e=0;e<d.length;e++)d[e].renderProgram(this.scene,a,b,c)}},b.exports=d},{config:18,"lib/awd":99,"lib/net":110,"nanogl-node":368,when:445}],2:[function(a,b,c){function d(a){this.scene=a,this.mats=a.matlib.createProvider("common"),this.texs=a.texlib.createProvider("common"),this.makeTex("degrade1").setFilter(!0,!0,!1).mirror(),this.makeTex("degrade2").setFilter(!0,!0,!1).mirror(),this.makeTex("logo").setFilter(!0,!1,!1).mirror(),this.makeTex("green").setFilter(!0,!0,!1).mirror(),this.makeTex("blue").setFilter(!0,!0,!1).mirror(),this.makeTex("pink").setFilter(!0,!0,!1).mirror(),this.makeTex("marbre").setFilter(!0,!0,!1).mirror(),this.makeTex("shape_green").setFilter(!0,!1,!1).mirror(),this.makeTex("shape_blue").setFilter(!0,!0,!1).mirror(),this.makeTex("wood").setFilter(!0,!0,!1).mirror(),this.makeTex("dirty_metal").setFilter(!0,!0,!1).mirror(),this.makeTex("aquarelle").setFilter(!0,!0,!1).mirror(),this.makeTex("logo").setFilter(!0,!0,!1).mirror(),this.makeTex("canson").setFilter(!0,!1,!1).repeat(),this.makeTex("logo_small",!1).setFilter(!0,!1,!1).clamp()}d.prototype={getLoadables:function(){return this.texs.getLoadables()},getAssetPath:function(a){return"common/"+a},texPath:function(a){return[this.getAssetPath(a+"_L0.jpg"),this.getAssetPath(a+"_L1.jpg")]},makeTex:function(a,b){return void 0===b&&(b=!0),b?this.texs.makeTex(a,this.texPath(a)):this.texs.makeTex(a,this.getAssetPath(a+".jpg"))}},b.exports=d},{}],3:[function(a,b,c){function d(a){this.ext=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");var b=this;this.parse=function(a){return b._parse(a)}}function e(a){var b=new Int32Array(a,0,s);if(b[t]!==h)throw new Error("Invalid magic number in DDS header");if(!b[z]&j)throw new Error("Unsupported format, must contain a FourCC code");var c,d,e=b[A];switch(e){case k:c=8,d="dxt1";break;case l:c=16,d="dxt3";break;case m:c=16,d="dxt5";break;case o:d="rgba32f";break;case n:var f=new Uint32Array(a.slice(128,148));d=f[0];var C=f[1];f[2],f[3],f[4];if(C!==q||d!==r)throw new Error("Unsupported DX10 texture format "+d);d="rgba32f";break;default:throw new Error("Unsupported FourCC code: "+g(e))}var D=b[v],E=1;D&i&&(E=Math.max(1,b[y]));var F=!1;b[B]&p&&(F=!0);var G,H=b[x],I=b[w],J=b[u]+4,K=H,L=I,M=[];if(e===n&&(J+=20),F)for(var N=0;N<6;N++){var O=[];M[N]=O;H=K,I=L;for(var P=0;P<E;P++)G=Math.max(4,H)/4*Math.max(4,I)/4*c,O.push(new Uint8Array(a,J,G)),J+=G,H=Math.floor(H/2),I=Math.floor(I/2)}else{var O=[];M[0]=O;for(var P=0;P<E;P++)G=Math.max(4,H)/4*Math.max(4,I)/4*c,O.push(new Uint8Array(a,J,G)),J+=G,H=Math.max(1,Math.floor(H/2)),I=Math.max(1,Math.floor(I/2))}return{width:K,height:L,surfaces:M,format:this._getFormat(d),flags:D,cubemap:F}}function f(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function g(a){return String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)}var h=542327876,i=131072,j=4,k=f("DXT1"),l=f("DXT3"),m=f("DXT5"),n=f("DX10"),o=116,p=512,q=3,r=2,s=31,t=0,u=1,v=2,w=3,x=4,y=7,z=20,A=21,B=28;d.prototype={isSupported:function(){return!!this.ext},_getFormat:function(a){switch(a){case"dxt1":return this.ext.COMPRESSED_RGB_S3TC_DXT1_EXT;case"dxt3":return this.ext.COMPRESSED_RGBA_S3TC_DXT3_EXT;case"dxt5":return this.ext.COMPRESSED_RGBA_S3TC_DXT5_EXT;default:throw new Error("unsupported format "+a)}},_parse:e},b.exports=d},{}],4:[function(a,b,c){function d(){}var e=a("when");d.prototype={parse:function(a){var b=e.defer(),c=new Blob([a],{type:"image/jpeg"}),d=URL.createObjectURL(c),f=new Image;return f.onload=function(){URL.revokeObjectURL(d),b.resolve(f)},f.onerror=function(){URL.revokeObjectURL(d),b.reject()},f.src=d,b.promise}},b.exports=d},{when:445}],5:[function(a,b,c){function d(a){for(var b=0;b<12;b++)if(a[b]!==f[b])return!1;return!0}function e(a){this.ext=a.getExtension("WEBGL_compressed_texture_etc1")||a.getExtension("WEBKIT_WEBGL_compressed_texture_etc1");var b=this;this.parse=function(a){return b._parse(a)}}var f=new Uint8Array([171,75,84,88,32,49,49,187,13,10,26,10]);e.prototype={isSupported:function(){return!!this.ext},_parse:function(a){if(!d(new Uint8Array(a,0,12)))throw new Error("[KTXParser] Bad Magic");var a=new DataView(a),b=67305985===a.getUint32(12,!0),c=16;a.getUint32(c,b);c+=4;a.getUint32(c,b);c+=4;a.getUint32(c,b);c+=4;var e=a.getUint32(c,b);c+=4;a.getUint32(c,b);c+=4;var f=a.getUint32(c,b);c+=4;var g=a.getUint32(c,b);c+=4;a.getUint32(c,b);c+=4;var h=a.getUint32(c,b);c+=4;var i=a.getUint32(c,b);c+=4;var j=a.getUint32(c,b);c+=4;var k=a.getUint32(c,b);if(c+=4,e!==this.ext.COMPRESSED_RGB_ETC1_WEBGL)throw new Error("KTX unsupported internal format "+e+". Must be COMPRESSED_RGB_ETC1_WEBGL");c+=k;for(var l=j>0?j:1,m=h>0?h:1,n=i>0?i:1,o=[],p=0;p<n;p++)o.push([]);for(var q=0;q<l;q++){var r=a.getUint32(c,b);c+=4;for(var s=-4&r,t=0;t<m;t++)for(var p=0;p<n;p++){var u=new Uint8Array(a.buffer,c,s);c+=s,o[p].push(u)}}return{width:f,height:g,surfaces:o,format:e,cubemap:!1}},_getFormat:function(a){switch(a){case RGB_PVRTC_4BPPV1_Format:return this.ext.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case RGB_PVRTC_2BPPV1_Format:return this.ext.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case RGBA_PVRTC_4BPPV1_Format:return this.ext.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case RGBA_PVRTC_2BPPV1_Format:return this.ext.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;default:throw new Error("[PVRLoader] Unknown pixel format")}},_extract:function(a){for(var b=[],c=this._getFormat(a.format),d=(a.width,a.height,a.isCubemap,a.buffer),e=a.dataPtr,f=a.bpp,g=a.numSurfaces,h=0,i=0,j=0,k=0,l=0,m=0,n=0;n<g;n++)b.push([]);2===f?(j=8,k=4):(j=4,k=4),i=j*k*f/8;for(var o=0;o<a.numMipmaps;){var p=a.width>>o,q=a.height>>o;l=p/j,m=q/k,l<2&&(l=2),m<2&&(m=2),h=l*m*i;for(var n=0;n<g;n++){var r=new Uint8Array(d,e,h);b[n].push(r),e+=h}o++}}},b.exports=e},{}],6:[function(a,b,c){function d(){}function e(a){var b=a.gl;this.scene=a,this.gl=b,this.materials={},this.matlist=[];var c=new g(b);c.setLightSetup(this.scene.lights.setup),this.depthPass=c,this.depthCfg=a.glstate.config().enableCullface(!1).enableDepthTest(!0).depthMask(!0)}var f=a("./materials-provider"),g=a("nanogl-pbr/depthpass"),h=(a("nanogl-pbr/lib/input"),a("nanogl-sync"));e.OPAQUE=1,e.BLENDED=2,e.OCCLU=4,e.WOOD=8,e.BLURREDGLASS=16,e.BALL=32,e.STENCIL=64,e.BLOOM=128,e.prototype={dummy:function(){return{compile:d,prg:{use:d}}},dispose:function(){this.gl=null,this.scene=null,this.materials=null,this.matlist=null},createProvider:function(a){return new f(this,a)},update:function(a){this.time+=a,this.uTime.set(this.time)},registerMaterial:function(a,b){void 0===this.materials[b]&&(this.materials[b]=a,a.name=b,this.matlist.push(a))},createBaseMaterial:function(){var a=makeMaterial(this.gl);return a._precision="highp",a.setIBL(this.scene.env.ibl),a.setLightSetup(this.scene.lights.setup),a.perVertexIrrad.disable(),a},getMaterial:function(a){var b=this.materials[a];return void 0===b&&(console.log("        -> not found",a),b=this.defaultMaterial),b},setOpaque:function(a){a._mask=e.OPAQUE,a.config.enableCullface(!0),a.config.enableDepthTest(),a.config.depthMask(!0)},setBall:function(a){a._mask=e.BALL,a.config.enableCullface(!0),a.config.enableDepthTest(),a.config.depthMask(!0)},setOcclu:function(a){a._mask=e.OCCLU,a.config.enableCullface(!0),a.config.enableDepthTest(),a.config.depthMask(!0)},setBlurredGlass:function(a){a._mask=e.BLURREDGLASS,a.config.enableCullface(!0),a.config.enableDepthTest(),a.config.depthMask(!0)},setWood:function(a){a._mask=e.WOOD,a.config.enableCullface(!0),a.config.enableDepthTest(),a.config.depthMask(!0)},setBloom:function(a){a._mask=e.BLOOM,a.config.enableCullface(!0),a.config.enableDepthTest(),a.config.depthMask(!0)},setGlass:function(a,b,c,d){a._mask=e.BLENDED,a.config.enableCullface(),a.config.enableDepthTest(),a.config.depthMask(!1),a.config.enableBlend(),a.config.blendFunc(this.gl.ONE,this.gl.CONSTANT_COLOR),a.config.blendColor(b,c,d,1)},setStencil:function(a){a._mask=e.STENCIL,a.config.enableCullface(!0),a.config.enableDepthTest(),a.config.depthMask(!0)},compileAll:function(){this.matlist.forEach(function(a){a.compile(),a.prg.use()});var a=new h(this.gl);return a.insert(),a.promise}},b.exports=e},{"./materials-provider":7,"nanogl-pbr/depthpass":369,"nanogl-pbr/lib/input":393,"nanogl-sync":412}],7:[function(a,b,c){function d(a,b){this.uid=b,this.lib=a,this.matlist=[],this.materials={}}d.prototype={registerMaterial:function(a,b){void 0===this.materials[b]&&(this.materials[b]=a,this.matlist.push(a),this.lib.registerMaterial(a,this.uid+"/"+b))},getMaterial:function(a){return this.materials[a]||this.lib.getMaterial(a)},dispose:function(){}},b.exports=d},{}],8:[function(a,b,c){function d(a){this.ext=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");var b=this;this.parse=function(a){return b._parse(a)}}function e(a){var b,c,d=a.header,e=d[12],f=d[2],k=d[6],l=d[7],m=(d[9],d[10]),n=d[11];switch(f){case 0:b=2,c=h;break;case 1:b=2,c=j;break;case 2:b=4,c=g;break;case 3:b=4,c=i;break;default:throw new Error("pvrtc - unsupported PVR format "+f)}return a.dataPtr=52+e,a.bpp=b,a.format=c,a.width=l,a.height=k,a.numSurfaces=m,a.numMipmaps=n,a.isCubemap=6===m,a}function f(a){var b,c=a.header,d=c[0],e=c[1],f=c[2],k=c[3],l=c[4],m=(c[5],c[6]),n=(c[7],c[8],c[9],c[10]),o=(c[11],c[12]),p=255&l,q=n>0;if(25===p)b=q?i:g,m=4;else{if(24!==p)throw new Error("pvrtc - unknown format "+p);b=q?j:h,m=2}return a.dataPtr=d,a.bpp=m,a.format=b,a.width=f,a.height=e,a.numSurfaces=o,a.numMipmaps=k+1,a.isCubemap=6===o,a}var g=2100,h=2101,i=2102,j=2103;d.prototype={isSupported:function(){return!!this.ext},_parse:function(a){var b,c=new Uint32Array(a,0,13),d={buffer:a,header:c};if(55727696===c[0])b=e(d);else{if(559044176!==c[11])throw new Error("[PVRLoader] Unknown PVR format");b=f(d)}return this._extract(b)},_getFormat:function(a){switch(a){case g:return this.ext.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case h:return this.ext.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case i:return this.ext.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case j:return this.ext.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;default:throw new Error("[PVRLoader] Unknown pixel format")}},_extract:function(a){for(var b=[],c=this._getFormat(a.format),d={width:a.width,height:a.height,surfaces:b,format:c,cubemap:a.isCubemap},e=a.buffer,f=a.dataPtr,g=a.bpp,h=a.numSurfaces,i=0,j=0,k=0,l=0,m=0,n=0,o=0;o<h;o++)b.push([]);2===g?(k=8,l=4):(k=4,l=4),j=k*l*g/8;for(var p=0;p<a.numMipmaps;){var q=a.width>>p,r=a.height>>p;m=q/k,n=r/l,m<2&&(m=2),n<2&&(n=2),i=m*n*j;for(var o=0;o<h;o++){var s=new Uint8Array(e,f,i);b[o].push(s),f+=i}p++}return d}},b.exports=d},{}],9:[function(a,b,c){function d(a,b,c){return 9728|+a|+b<<8|+(b&&c)<<1}function e(a,b){this._uid=f++,this.gl=a,this.id=this.gl.createTexture(),this.width=0,this.height=0,this.format=b||a.RGB,this.type=a.UNSIGNED_BYTE,a.bindTexture(g,this.id),this.setFilter(!0),this.clamp()}var f=0,g=34067;e.prototype={fromImages:function(a){var b=this.gl,c=this.format,d=this.type;this.width=a[0].width,this.height=a[0].height,b.bindTexture(g,this.id),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X,0,c,c,d,a[0]),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_Y,0,c,c,d,a[1]),b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_Z,0,c,c,d,a[2]),b.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_X,0,c,c,d,a[3]),b.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,c,c,d,a[4]),b.texImage2D(b.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,c,c,d,a[5])},bind:function(a){var b=this.gl;void 0!==a&&b.activeTexture(b.TEXTURE0+(0|a)),b.bindTexture(g,this.id)},dispose:function(){this.gl.deleteTexture(this.id),this.id=null,this.gl=null},setFilter:function(a,b,c){var e=this.gl,f=d(!!a,!!b,!!c);e.texParameteri(g,e.TEXTURE_MAG_FILTER,d(!!a,!1,!1)),e.texParameteri(g,e.TEXTURE_MIN_FILTER,f)},repeat:function(){this.wrap(this.gl.REPEAT)},clamp:function(){this.wrap(this.gl.CLAMP_TO_EDGE)},mirror:function(){this.wrap(this.gl.MIRRORED_REPEAT)},wrap:function(a){var b=this.gl;b.texParameteri(g,b.TEXTURE_WRAP_S,a),b.texParameteri(g,b.TEXTURE_WRAP_T,a)}},b.exports=e},{}],10:[function(a,b,c){function d(a){this.loader=a,this.gl=a.gl,this.codec=null,this.url=null,this.baseUrl=null,this._bbc=!0,this._genMips=!1}function e(a){var b=k.defer();return k.all(a).then(b.resolve),b}function f(a,b,c){d.call(this,a),this.tex=new i(this.gl,c),this.baseUrl=Array.isArray(b)?b:[b],this.lodPromises=new Array(b.length),this.states=[];for(var e=0;e<b.length;e++)this.states[e]=m;this.pendingUpload=null,this.upload=this._upload.bind(this)}function g(a,b,c){d.call(this,a),this.tex=new l(this.gl,c),this.baseUrl=b,this.upload=this._upload.bind(this),this.parse=this._parse.bind(this)}function h(a,b){switch(b){case 0:return a.TEXTURE_CUBE_MAP_POSITIVE_X;case 1:return a.TEXTURE_CUBE_MAP_POSITIVE_Y;case 2:return a.TEXTURE_CUBE_MAP_POSITIVE_Z;case 3:return a.TEXTURE_CUBE_MAP_NEGATIVE_X;case 4:return a.TEXTURE_CUBE_MAP_NEGATIVE_Y;case 5:return a.TEXTURE_CUBE_MAP_NEGATIVE_Z;default:throw new Error("surface overflow")}}var i=a("nanogl/texture"),j=a("lib/net"),k=a("when"),l=a("./texture-cube");d.prototype={nobbc:function(a){return this._bbc=!1,this},genMipmap:function(){return this._genMips=!0,this},setFilter:function(a,b,c){return b&&this.genMipmap(),this.tex.setFilter(a,b,c),this},repeat:function(){return this.tex.repeat(),this},clamp:function(){return this.tex.clamp(),this},mirror:function(){return this.tex.mirror(),this},aniso:function(a){return this.loader.setAniso(this.tex,a),this},load:function(){},prepare:function(){this.codec=this.loader.getCodec(this._bbc),this.resolveUrl()},resolveUrl:function(){this.url=this.baseUrl},uploadBcc:function(a,b){void 0===b&&(b=0);var c=this.tex,d=this.gl;c.bind();var e=a.surfaces[0],f=a.format,g=a.width,h=a.height;c.width=g,c.height=h;for(var i=0;i<e.length;i++){var j=e[i];d.compressedTexImage2D(d.TEXTURE_2D,i+b,f,g,h,0,j),g=Math.max(1,g>>1),h=Math.max(1,h>>1)}return c},uploadCubeBcc:function(a){var b=this.tex,c=this.gl;b.bind();for(var d=0;d<a.surfaces.length;d++){var e=a.surfaces[d],f=a.format,g=a.width,i=a.height;b.width=g,b.height=i;for(var j=0;j<e.length;j++){var k=e[j];c.compressedTexImage2D(h(c,d),j,f,g,i,0,k),g=Math.max(1,g>>1),i=Math.max(1,i>>1)}}return b},uploadStd:function(a){var b=this.tex,c=this.gl;return b.bind(),b.fromImage(a),this._genMips&&c.generateMipmap(c.TEXTURE_2D),b}};var m=1;f.prototype=Object.create(d.prototype),f.prototype.constructor=f,f.prototype.resolveUrl=function(){this.url=this.loader.resolveTexUrls(this.baseUrl,this.codec)},f.prototype.load=function(){return this.loadLevel(0)},f.prototype.loadLevel=function(a){if(this.prepare(),a>this.url.length-1)return null;for(var b=[],c=0;c<=a;c++)b.push(this._loadLodData(c));return this.pendingUpload&&this.pendingUpload.reject(),this.pendingUpload=e(b),this.pendingUpload.promise.then(this.upload)},f.prototype._loadLodData=function(a){var b=this.states;if(b[a]!==m)return this.lodPromises[a];var c=j.loadBytes(this.url[a]).then(this.codec.parser.parse);return this.lodPromises[a]=c,b[a]=2,c.then(function(){b[a]=4}),c},f.prototype._upload=function(a){var b=a.length-1;if(this.codec.compressed)for(var c=0;c<a.length;c++)this.uploadBcc(a[c],b-c);else this.uploadStd(a[b])},g.prototype=Object.create(d.prototype),g.prototype.constructor=g,g.prototype.resolveUrl=function(a){this.url=this.loader.resolveCubeUrl(this.baseUrl,this.codec)},g.prototype.load=function(){return this.prepare(),k.map(this.url,j.loadBytes).then(this.parse).then(this.upload)},g.prototype._parse=function(a){return k.map(a,this.codec.parser.parse)},g.prototype._upload=function(a){this.codec.compressed?this.uploadCubeBcc(a[0]):(this.tex.fromImages(a),this._genMips&&gl.generateMipmap(gl.TEXTURE_CUBE))},b.exports={TexDef:f,CubeDef:g}},{"./texture-cube":9,"lib/net":110,"nanogl/texture":421,when:445}],11:[function(a,b,c){function d(a,b,c){this.parser=a,this.ext=c,this.compressed=b,this.transformPath=function(a){return a+c}}function e(a){var b=a.gl;this.gl=b,this._lib={},this._list=[],this.resolveUrl=this._resolveUrl.bind(this),this.bbc=!0,this.maxCubeSize=b.getParameter(b.MAX_CUBE_MAP_TEXTURE_SIZE),this.extAniso=b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||b.getExtension("EXT_texture_filter_anisotropic"),this.maxAniso=this.extAniso?b.getParameter(this.extAniso.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this.DDSCodec=new d(new h(b),!0,".dds"),this.PVRCodec=new d(new i(b),!0,".pvr"),this.KTXCodec=new d(new j(b),!0,".ktx"),this.JPGCodec=new d(new k(b),!1,""),this.texDefs=[]}function f(a){return[a+"/negx.jpg",a+"/negy.jpg",a+"/negz.jpg",a+"/posx.jpg",a+"/posy.jpg",a+"/posz.jpg"]}var g=a("config"),h=a("./dds-parser"),i=a("./pvr-parser"),j=a("./ktx-parser"),k=a("./jpeg-parser"),l=a("./textures-provider"),m=a("./texture-def");e.prototype={createProvider:function(a){return void 0===a&&(a=""),new l(this,a)},get:function(a){var b=this._lib[a];if(void 0===b)throw new Error('texture "'+a+'" not found.');return b},setAniso:function(a,b){var c=this.gl;(b=Math.min(this.maxAniso,b))>0&&c.texParameterf(c.TEXTURE_2D,this.extAniso.TEXTURE_MAX_ANISOTROPY_EXT,b)},_resolveUrl:function(a){return g.asset_url(a)},resolveTexUrls:function(a,b){return a.map(this.resolveUrl).map(b.transformPath)},resolveCubeUrl:function(a,b){var a=g.asset_url(a);return b.compressed?[b.transformPath(a+"/tex")]:f(a)},makeTex:function(a,b){var c=new m.TexDef(this,a,b);return this.texDefs.push(c),c},makeCube:function(a,b,c){a+="/"+this.getCubeSize(b);var d=new m.CubeDef(this,a,c);return this.texDefs.push(d),d},getLoadables:function(){return this.texDefs.map(function(a){return a.load()})},getGhostLoadables:function(a){void 0===a&&(a=1);for(var b=[],c=0;c<this.texDefs.length;c++)if(this.texDefs[c].loadLevel){var d=this.texDefs[c].loadLevel(a);d&&b.push(d)}return b},getCodec:function(a){return void 0===a&&(a=!0),a=a&&this.bbc,this.DDSCodec.parser.isSupported()&&a?this.DDSCodec:this.PVRCodec.parser.isSupported()&&a?this.PVRCodec:this.KTXCodec.parser.isSupported()&&a?this.KTXCodec:this.JPGCodec},getCubeSize:function(a){for(;a>this.maxCubeSize;)a>>=1;return a}},b.exports=e},{"./dds-parser":3,"./jpeg-parser":4,"./ktx-parser":5,"./pvr-parser":8,"./texture-def":10,"./textures-provider":12,config:18}],12:[function(a,b,c){function d(a,b){this.name=b,this.lib=a,this._defs=[],this._lib={},this._list=[],this._dlib={}}d.prototype={register:function(a,b){void 0===this._lib[b]&&(this._dlib[b]=a,this._lib[b]=a.tex,this._defs.push(a),this._list.push(a),this.lib._lib[this.name+"/"+b]=a.tex)},get:function(a){var b=this._lib[a];if(void 0===b)throw new Error('texture "'+a+'" not found.');return b},getDef:function(a){var b=this._dlib[a];if(void 0===b)throw new Error('texture def"'+a+'" not found.');return b},makeTex:function(a,b,c){var d=this._dlib[a];return void 0===d&&(d=this.lib.makeTex(b,c),this.register(d,a)),d},makeCube:function(a,b,c,d){var e=this._dlib[a];return void 0===e&&(e=this.lib.makeCube(b,c,d),this.register(e,a)),e},getLoadables:function(){return this._defs.map(function(a){return a.load()})},getGhostLoadables:function(a){void 0===a&&(a=1);for(var b=[],c=0;c<this._list.length;c++)if(this._list[c].loadLevel){var d=this._list[c].loadLevel(a);d&&b.push(d)}return b},dispose:function(){}},b.exports=d},{}],13:[function(a,b,c){function d(a){this.scene=a,this._current=null,this.shakeCam=0,this.shakeDamping=.9,this.cameraTmpPos=null}d.prototype={setControler:function(a){this._current&&this._current.stop(),this._current=a,a.start(this.scene.camera)},preRender:function(){this._current&&(this._current.update(this.scene.dt),this.shakeCam>0&&(this.scene.camera.x=this.cameraTmpPos[0]+Math.random()*this.shakeCam,this.scene.camera.y=this.cameraTmpPos[1]+Math.random()*this.shakeCam,this.shakeCam*=this.shakeDamping,this.shakeCam<1e-4&&(this.scene.camera.position=this.cameraTmpPos,this.shakeCam=0)))},shakeCamera:function(a,b){b=b||.9,a=a||.1,this.cameraTmpPos=this.scene.camera.position,this.shakeCam=a,this.shakeDamping=b}},b.exports=d},{}],14:[function(a,b,c){function d(a,b,c){c[0]=2*a.clientX/(b.width/window.devicePixelRatio)-1,c[1]=-(2*a.clientY/(b.height/window.devicePixelRatio)-1)}function e(a){this.el=a,this.mouse=k.fromValues(0,0,1),this.cam=null,this.orbitRadius=-3,this.mode=-1,this.onMouseMove=this._onMouseMove.bind(this)}function f(){}function g(){this.initialX=k.create(),this.initialR=l.create(),this.initialP=k.create(),this.startMouse=k.create(),this.focus=k.create()}function h(){this.initialX=k.create(),this.initialY=l.create(),this.initialP=k.create(),this.startMouse=k.create(),this.focus=k.create()}function i(){this.initialZ=k.create(),this.initialP=k.create(),this.startMouse=k.create(),this.focus=k.create()}var j=a("gl-matrix"),k=j.vec3,l=j.quat,m=j.mat4,n=l.create(),o=l.create(),p=l.create(),q=k.create(),r=k.create(),s=(m.create(),m.create());e.prototype={start:function(a){this.cam=a,this.el.addEventListener("mousemove",this.onMouseMove),this.mode=-1,this.setMode(0)},stop:function(a){this.cam=null,this.el.removeEventListener("mousemove",this.onMouseMove)},update:function(a){},setMode:function(a){if(this.mode!==a){switch(this.mode=a,a){case 0:this.action=new f;break;case 1:this.action=new g;break;case 2:this.action=new h;break;case 4:this.action=new i}this.unproject(q),this.action.start(this.cam,q,this.mouse)}},unproject:function(a){this.cam.updateMatrix(),m.invert(s,this.cam.lens._proj),k.transformMat4(q,this.mouse,s),k.scale(q,q,this.orbitRadius/q[2]),k.transformMat4(a,q,this.cam._matrix)},_onMouseMove:function(a){var b=this._getModeForEvt(a);this.setMode(b),d(a,this.el,this.mouse),this.action.update(this.mouse)},_getModeForEvt:function(a){return 2!==a.which?0:a.altKey?a.ctrlKey?4:1:2}},f.prototype={start:function(){},update:function(){}},g.prototype={start:function(a,b,c){this.cam=a,k.copy(this.initialX,this.cam._matrix),k.copy(this.startMouse,c),l.copy(this.initialR,a.rotation),k.subtract(this.initialP,a.position,b),k.copy(this.focus,b)},update:function(a){k.subtract(q,a,this.startMouse),l.setAxisAngle(p,this.initialX,5*q[1]),l.rotateY(o,n,5*-q[0]),l.multiply(o,o,p),l.multiply(this.cam.rotation,o,this.initialR),k.transformQuat(q,this.initialP,o),k.add(this.cam.position,this.focus,q),this.cam.invalidate()}},h.prototype={start:function(a,b,c){this.cam=a,k.copy(this.initialX,this.cam._matrix),k.copy(this.initialP,this.cam.position),this.initialY[0]=this.cam._matrix[4],this.initialY[1]=this.cam._matrix[5],this.initialY[2]=this.cam._matrix[6],k.copy(this.startMouse,c),k.copy(this.focus,b)},update:function(a){k.subtract(q,a,this.startMouse),k.scale(r,this.initialX,.5*-q[0]),k.scaleAndAdd(r,r,this.initialY,.5*-q[1]),k.add(this.cam.position,this.initialP,r),this.cam.invalidate()}},i.prototype={start:function(a,b,c){this.cam=a,k.copy(this.initialP,this.cam.position),k.subtract(this.initialZ,this.cam.position,b),k.copy(this.startMouse,c),k.copy(this.focus,b)},update:function(a){k.subtract(q,a,this.startMouse),k.scale(q,this.initialZ,5*q[1]),k.add(this.cam.position,this.initialP,q),this.cam.invalidate()}},b.exports=e},{"gl-matrix":352}],15:[function(a,b,c){function d(a,b,c){var d,e;a.touches&&a.touches[0]?(d=a.touches[0].clientX,e=a.touches[0].clientY):(d=a.clientX,e=a.clientY),c[0]=2*d/b.width-1,c[1]=-(2*e/b.height-1)}function e(a,b){this.scene=a,this.el=null==b?a.glview.canvas:b,this.rotateSpeed=30,this.wheelSpeed=.2,this.dragSpeed=1,this.dist=1,this.minDist=1e-5,this.maxDist=2,this.center=g.fromValues(0,0,0),this._theta=0,this._phi=1,this.ratio=window.innerWidth/window.innerHeight,this.mouseButton1=!1,this.mouseButton2=!1,this.mouse=g.fromValues(0,0,1),this.mStartDrag=g.fromValues(0,0,1),this.mDrag=g.fromValues(0,0,1),this.pan=g.fromValues(0,0,0),this.panInitialX=g.create(),this.panInitialY=h.create(),this.panInitialP=g.create(),this._drag=g.fromValues(this._theta,this._phi,1),this.cam=null,this.onMouseMove=this._onMouseMove.bind(this),this.onMouseDown=this._onMouseDown.bind(this),this.onMouseUp=this._onMouseUp.bind(this),this.onMouseWheel=this._onMouseWheel.bind(this),this.onRightClick=this._onRightClick.bind(this)}var f=a("gl-matrix"),g=f.vec3,h=f.quat,i=f.mat4,j=(i.create(),h.create(),g.create(),g.create());g.create();e.prototype={start:function(a){this.cam=a,this.el.addEventListener("mousemove",this.onMouseMove),this.el.addEventListener("touchmove",this.onMouseMove),this.el.addEventListener("touchstart",this.onMouseDown),this.el.addEventListener("mousedown",this.onMouseDown),this.el.addEventListener("mouseup",this.onMouseUp),this.el.addEventListener("touchend",this.onMouseUp),this.el.addEventListener("wheel",this.onMouseWheel),this.el.addEventListener("contextmenu",this.onRightClick),this.onMouseDown({clientX:0,clientY:0}),this.onMouseMove({clientX:0,clientY:0}),this.onMouseUp({clientX:0,clientY:0})},stop:function(){this.cam=null,this.el.removeEventListener("mousemove",this.onMouseMove),this.el.removeEventListener("touchmove",this.onMouseMove),this.el.removeEventListener("touchstart",this.onMouseDown),this.el.removeEventListener("mousedown",this.onMouseDown),this.el.removeEventListener("mouseup",this.onMouseUp),this.el.removeEventListener("touchend",this.onMouseUp),this.el.removeEventListener("wheel",this.onMouseWheel),this.el.removeEventListener("contextmenu",this.onRightClick)},_onMouseWheel:function(a){var b=a.deltaY>0?1:-1;b*=this.wheelSpeed,this.dist+=.2*b,this.dist=Math.max(this.minDist,Math.min(this.dist,this.maxDist))},_onMouseDown:function(a){this.mouseButton1=!0,d(a,this.el,this.mouse),g.copy(this.mStartDrag,this.mouse)},_onRightClick:function(a){return a.preventDefault(),this.mouseButton2=!0,d(a,this.el,this.mouse),g.copy(this.panInitialX,this.cam._matrix),g.copy(this.panInitialP,this.cam.position),this.panInitialY[0]=this.cam._matrix[4],this.panInitialY[1]=this.cam._matrix[5],this.panInitialY[2]=this.cam._matrix[6],g.copy(this.mStartDrag,this.mouse),!1},_onMouseMove:function(a){if(this.mouseButton1){if(this.mouseButton2)return void this._pan(a);d(a,this.el,this.mouse),this.mDrag[0]=this.mouse[0]-this.mStartDrag[0],this.mDrag[1]=this.mouse[1]-this.mStartDrag[1],g.copy(this.mStartDrag,this.mouse),this._drag[0]-=this.mDrag[0],this._drag[1]+=this.mDrag[1],this._drag[1]<=.001&&(this._drag[1]=.001),this._drag[1]>=Math.PI-.001&&(this._drag[1]=Math.PI-.001)}},_onMouseUp:function(a){this.mouseButton1=!1,this.mouseButton2=!1},_pan:function(a){d(a,this.el,this.mouse),this.mDrag[0]=this.mouse[0]-this.mStartDrag[0],this.mDrag[1]=this.mouse[1]-this.mStartDrag[1],g.copy(this.mStartDrag,this.mouse);var b=g.create();g.scale(b,this.panInitialX,-this.mDrag[0]*this.dragSpeed),g.scaleAndAdd(b,b,this.panInitialY,-this.mDrag[1]*this.dragSpeed),this.pan=b},update:function(a){if(this.cam){var b=this.dist;this.rotateSpeed;this.rnd=Math.floor(this._theta/(2*Math.PI)),j[0]=this.center[0]+10*Math.sin(this._phi)*Math.sin(this._theta),j[1]=this.center[1]+10*Math.cos(this._phi),j[2]=this.center[2]+10*Math.sin(this._phi)*Math.cos(this._theta),this.cam.lens.setBound(-b*this.ratio,b*this.ratio,-b,b),g.copy(this.cam.position,j),g.add(this.cam.position,this.cam.position,this.pan),g.add(this.center,this.center,this.pan),this.pan=g.create(),this.cam.lookAt(this.center),this.cam.invalidate()}}},b.exports=e},{"gl-matrix":352}],16:[function(a,b,c){function d(a,b,c){var d,e;a.touches&&a.touches[0]?(d=a.touches[0].clientX,e=a.touches[0].clientY):(d=a.clientX,e=a.clientY),c[0]=2*d/b.width-1,c[1]=-(2*e/b.height-1)}function e(a,b){this.scene=a,this.el=null==b?a.glview.canvas:b,this.rotateSpeed=30,this.wheelSpeed=.2,this.dragSpeed=1,this.dist=5,this.minDist=2,this.maxDist=10,this.center=g.fromValues(0,0,0),this._theta=0,this._phi=.4*Math.PI,this.mouseButton1=!1,this.mouseButton2=!1,this.mouse=g.fromValues(0,0,1),this.mStartDrag=g.fromValues(0,0,1),this.mDrag=g.fromValues(0,0,1),this.pan=g.fromValues(0,0,0),this.panInitialX=g.create(),this.panInitialY=h.create(),this.panInitialP=g.create(),this._drag=g.fromValues(this._theta,this._phi,1),this.cam=null,this.onMouseMove=this._onMouseMove.bind(this),this.onMouseDown=this._onMouseDown.bind(this),this.onMouseUp=this._onMouseUp.bind(this),this.onMouseWheel=this._onMouseWheel.bind(this),this.onRightClick=this._onRightClick.bind(this)}var f=a("gl-matrix"),g=f.vec3,h=f.quat,i=f.mat4,j=(i.create(),h.create(),g.create(),g.create());g.create();e.prototype={start:function(a){this.cam=a,this.el.addEventListener("mousemove",this.onMouseMove),this.el.addEventListener("touchmove",this.onMouseMove),this.el.addEventListener("touchstart",this.onMouseDown),this.el.addEventListener("mousedown",this.onMouseDown),this.el.addEventListener("mouseup",this.onMouseUp),this.el.addEventListener("touchend",this.onMouseUp),this.el.addEventListener("wheel",this.onMouseWheel),this.el.addEventListener("contextmenu",this.onRightClick),this.onMouseDown({clientX:0,clientY:0}),this.onMouseMove({clientX:0,clientY:0}),this.onMouseUp({clientX:0,clientY:0})},stop:function(){this.cam=null,this.el.removeEventListener("mousemove",this.onMouseMove),this.el.removeEventListener("touchmove",this.onMouseMove),this.el.removeEventListener("touchstart",this.onMouseDown),this.el.removeEventListener("mousedown",this.onMouseDown),this.el.removeEventListener("mouseup",this.onMouseUp),this.el.removeEventListener("touchend",this.onMouseUp),this.el.removeEventListener("wheel",this.onMouseWheel),this.el.removeEventListener("contextmenu",this.onRightClick)},_onMouseWheel:function(a){var b=a.deltaY>0?1:-1;b*=this.wheelSpeed,this.dist+=b,this.dist=Math.max(this.minDist,Math.min(this.dist,this.maxDist))},_onMouseDown:function(a){this.mouseButton1=!0,d(a,this.el,this.mouse),g.copy(this.mStartDrag,this.mouse)},_onRightClick:function(a){return a.preventDefault(),this.mouseButton2=!0,d(a,this.el,this.mouse),g.copy(this.panInitialX,this.cam._matrix),g.copy(this.panInitialP,this.cam.position),
this.panInitialY[0]=this.cam._matrix[4],this.panInitialY[1]=this.cam._matrix[5],this.panInitialY[2]=this.cam._matrix[6],g.copy(this.mStartDrag,this.mouse),!1},_onMouseMove:function(a){if(this.mouseButton1){if(this.mouseButton2)return void this._pan(a);d(a,this.el,this.mouse),this.mDrag[0]=this.mouse[0]-this.mStartDrag[0],this.mDrag[1]=this.mouse[1]-this.mStartDrag[1],g.copy(this.mStartDrag,this.mouse),this._drag[0]-=this.mDrag[0],this._drag[1]+=this.mDrag[1],this._drag[1]<=.001&&(this._drag[1]=.001),this._drag[1]>=Math.PI-.001&&(this._drag[1]=Math.PI-.001)}},_onMouseUp:function(a){this.mouseButton1=!1,this.mouseButton2=!1},_pan:function(a){d(a,this.el,this.mouse),this.mDrag[0]=this.mouse[0]-this.mStartDrag[0],this.mDrag[1]=this.mouse[1]-this.mStartDrag[1],g.copy(this.mStartDrag,this.mouse);var b=g.create();g.scale(b,this.panInitialX,-this.mDrag[0]*this.dragSpeed),g.scaleAndAdd(b,b,this.panInitialY,-this.mDrag[1]*this.dragSpeed),this.pan=b},update:function(a){if(this.cam){var b=this.dist,c=a*this.rotateSpeed;this._theta+=(this._drag[0]-this._theta)*c,this._phi+=(this._drag[1]-this._phi)*c,this.rnd=Math.floor(this._theta/(2*Math.PI)),j[0]=this.center[0]+b*Math.sin(this._phi)*Math.sin(this._theta),j[1]=this.center[1]+b*Math.cos(this._phi),j[2]=this.center[2]+b*Math.sin(this._phi)*Math.cos(this._theta),g.copy(this.cam.position,j),g.add(this.cam.position,this.cam.position,this.pan),g.add(this.center,this.center,this.pan),this.pan=g.create(),this.cam.lookAt(this.center),this.cam.invalidate()}}},b.exports=e},{"gl-matrix":352}],17:[function(a,b,c){function d(a){this.scene=a,this.cam=null,this.theta=-Math.atan(1/Math.SQRT2),this.rx=0,this.ry=0,this.unparalaxedNode=new g,(BrowserDetect.isMobile||BrowserDetect.isTablet)&&(this.beta=0,this.gamma=0,this.onDeviceOrientation=this.onDeviceOrientation.bind(this),window.addEventListener("deviceorientation",this.onDeviceOrientation))}var e=a("lib/mouse"),f=a("gl-matrix"),g=a("nanogl-node"),h=a("math"),i=f.vec3,j=f.mat4,k=f.quat,l=i.fromValues(0,0,50),m=i.create(),n=k.create(),o=k.create(),p=j.create(),q=i.fromValues(0,1,Math.SQRT2),r=i.fromValues(0,0,0);d.prototype={start:function(a){this.cam=a,a._parent.add(this.unparalaxedNode),this.unparalaxedNode.position.set(q),this.unparalaxedNode.lookAt(r),this.unparalaxedNode.invalidate()},stop:function(a){this.cam=null},unparalaxedViewProj:function(){return j.invert(p,this.unparalaxedNode._wmatrix),j.multiply(p,this.scene.mainCamera.lens.getProjection(),p),p},onDeviceOrientation:function(a){this.gamma=h.clamp(h.map(a.gamma,-25,25,-1,1),-1,1),this.beta=h.clamp(h.map(a.beta,-10,10,-1,1),-1,1)},update:function(a){var b=e.coords[0],c=e.coords[1];(BrowserDetect.isMobile||BrowserDetect.isTablet)&&(b=this.gamma,c=this.beta);var d=.08*b,f=.031*(c+1);this.rx+=(d-this.rx)*a*3,this.ry+=(f-this.ry)*a*3,k.rotateX(n,o,this.theta-this.ry),k.rotateY(n,n,this.rx),i.transformQuat(m,l,n),this.cam.position.set(m),this.cam.lookAt(r),this.cam.invalidate()}},b.exports=d},{"gl-matrix":352,"lib/mouse":109,math:114,"nanogl-node":368}],18:[function(a,b,c){var d="./assets";b.exports={asset_url:function(a){return d+"/"+a},setBaseDir:function(a){void 0!==a&&(d=a)}}},{}],19:[function(a,b,c){function d(){this.dom=document.querySelector(".cursor"),this.scale=1.2,this.smoothScale=1.2,this.rotation=0,this.smothRot=0,this.hover=!1,this.hover2=!1,this.width=window.innerWidth,this.heigth=window.innerHeight,this.onResize=this._onResize.bind(this),window.addEventListener("resize",this.onResize),this.canvas=new e(this.dom)}function e(a){this.$el=a,this.ctx=a.getContext("2d"),this.x=0,this.y=0,this.prevX=this.x,this.prevY=this.y,this.angle=0,this.progress=0,this.scale=2,this.springProgress=0,this.smoothHover=0,this.direction=h.create(),this.tutoStr="",this.tutoAngleOffset=Math.PI/2,this.tutoGlobalAlpha=1}var f=a("lib/mouse"),g=a("gl-matrix"),h=g.vec3,i=(a("dev/gui"),0),j=[{offset:.7,opacity:0},{offset:.7,opacity:0},{offset:.7,opacity:0},{offset:.7,opacity:0},{offset:.7,opacity:0}];d.prototype={update:function(){f.isDown()?this.scale=.6:this.hover?this.scale=1.4:this.scale=1,this.hover&&(this.rotation+=6);var a=this.rotation-this.smothRot;a*=.05,this.smothRot+=a;var b=this.scale-this.smoothScale;b*=.2,this.smoothScale+=b;var c=this.width*(f.coords[0]/2+.5),d=-this.heigth*(f.coords[1]/2-.5);this.dom.style.transform="translate("+c+"px,"+d+"px)",this.canvas.render(this,c,d)},_onResize:function(){this.width=window.innerWidth,this.heigth=window.innerHeight},toggleHover:function(){this.hover?this.hover=!1:this.hover=!0},disableHover:function(){this.hover=!1},enableHover:function(){this.hover=!0},disableHover2:function(){this.hover2=!1},enableHover2:function(){this.hover2=!0},showTuto:function(){TweenMax.killTweensOf(this.canvas,{tutoGlobalAlpha:!0}),TweenMax.to(this.canvas,.3,{tutoGlobalAlpha:1})},hideTuto:function(){TweenMax.killTweensOf(this.canvas,{tutoGlobalAlpha:!0}),TweenMax.to(this.canvas,.3,{tutoGlobalAlpha:0})}};h.create();e.prototype={render:function(a,b,c){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,120,120),this.prevX=this.x,this.prevY=this.y,this.direction[0]=b-this.x,this.direction[1]=c-this.y,h.normalize(this.direction,this.direction),h.scale(this.direction,this.direction,3),this.x=b-this.direction[0],this.y=c-this.direction[1];var d=Math.atan2(this.direction[1],this.direction[0]);this.angle=d,this.direction[0]=this.x-this.prevX,this.direction[1]=this.y-this.prevY;var e=h.length(this.direction),g=Math.max(0,Math.min(e/20,1)),j=g-this.springProgress;i+=.5*j*.1,i*=.9,this.springProgress+=i;var k=1;f.isDown()&&(k=.6),this.scale+=.25*(k-this.scale),this.ctx.translate(60,60),this.ctx.rotate(d),this.ctx.scale(this.scale+.5*this.springProgress,(1-.3*g)*this.scale);var l=20*Math.cos(d+1.5*Math.PI),m=20*Math.sin(d+1.5*Math.PI),n=this.ctx.createRadialGradient(l,m,25,l,m,0);n.addColorStop(0,"#F5608D"),n.addColorStop(1,"#6087CD");var o=a.hover||a.hover2?1:0;this.smoothHover+=.25*(o-this.smoothHover),this.tutoGlobalAlpha=1-this.smoothHover,this.ctx.strokeStyle=n,this.ctx.lineWidth=5+40*(1-this.smoothHover),this.ctx.beginPath();for(var p=1+39*this.smoothHover,q=0;q<=30;q++){var r=q/30;0==q?this.ctx.moveTo(Math.cos(r*Math.PI*2)*p,Math.sin(r*Math.PI*2)*p):this.ctx.lineTo(Math.cos(r*Math.PI*2)*p,Math.sin(r*Math.PI*2)*p)}this.ctx.closePath(),this.ctx.stroke(),this.drawTuto()},transitionInTuto:function(a){this.tutoStr=a,TweenMax.fromTo(this,1.3,{tutoAngleOffset:Math.PI/2},{tutoAngleOffset:0,ease:Power2.easeOut}),TweenMax.staggerFromTo(j,.6,{offset:.7,opacity:0},{offset:0,opacity:1,ease:Power2.easeOut},.1)},transitionOutTuto:function(){TweenMax.killTweensOf(j,{offset:!0,opacity:!0}),TweenMax.staggerTo(j,.6,{offset:-1,opacity:0,ease:Power2.easeIn},.1)},drawTuto:function(){var a=this.ctx,b=this.tutoStr,c=Math.PI,d=1.7*Math.PI,e=(d-c)/b.length,f=b.split("");a.save(),a.font="bold 22px Arial",a.fillStyle="#F5608D",a.rotate(-this.angle);for(var g=0,h=c;g<f.length;g++){var i="CLICK"===b&&g>=3?-.2:0,k=f[g],l=this.tutoAngleOffset+h+j[g].offset+i,m=0+33*Math.cos(l),n=0+33*Math.sin(l),o=m-0,p=n-0,l=Math.atan2(p,o)+1.6126;h+=e,a.save(),a.translate(m,n),a.rotate(l),a.globalAlpha=j[g].opacity*this.tutoGlobalAlpha,a.fillText(k,0,0),a.restore()}a.restore()},debugDirection:function(){this.ctx.setTransform(1,0,0,1,50,50),this.ctx.strokeStyle="red",this.ctx.lineWidth=5,this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(8*this.direction[0],8*this.direction[1]),this.ctx.arc(8*this.direction[0],8*this.direction[1],5,0,2*Math.PI),this.ctx.stroke(),this.ctx.setTransform(1,0,0,1,0,0)}};var k=new d;b.exports=k,window.Cursor=k.canvas},{"dev/gui":20,"gl-matrix":352,"lib/mouse":109}],20:[function(a,b,c){function d(){return f}var e=function(){},f={onChange:e,name:e},g={addFolder:function(){return g},add:d,addColor:d};b.exports=g},{}],21:[function(a,b,c){function d(a){this.scene=a,this.gl=a.gl,this.cfg=a.glstate.config(),this.cfg.enableCullface(!1),this.tex=a.texlib.get("common/canson"),this.offset=0,this.scale=.25,this.node=new e,this.scene.root.add(this.node)}var e=(a("nanogl/texture"),a("nanogl-node")),f=a("gl-matrix/src/gl-matrix/mat4"),g=f.create();d.prototype={preRender:function(){this.offset=this.scene.model.getNormalizedPosition()},render:function(){if(0!==this.tex.width){var a=this.scene.programs.gradientBG,b=this.scene.quad;a.use(),this.scene.camera.modelViewProjectionMatrix(g,this.node._wmatrix),a.uMVP(g),f.invert(g,g),a.uUnproj(g),a.tPaper(this.tex),b.attribPointer(a),this.cfg.apply(),b.render()}}},b.exports=d},{"gl-matrix/src/gl-matrix/mat4":357,"nanogl-node":368,"nanogl/texture":421}],22:[function(a,b,c){function d(a){this.node=a,this.time=0,this._mat=new Float32Array(a._matrix),this.rotationAmount=.25,this.positionAmount=.02,this.positionDir=new Float32Array([0,1,0]),this.sinxs=.7*Math.random()+.8,this.sinys=.7*Math.random()+.8,this.sinps=.7*Math.random()+.8,this.sinxo=6.3*Math.random(),this.sinyo=6.3*Math.random(),this.sinpo=6.3*Math.random()}var e=a("gl-matrix"),f=e.vec3,g=e.mat4,h=e.quat,i=f.create(),j=h.create(),k=h.create(),l=g.create();d.prototype={preRender:function(a){this.time+=a,h.rotateX(j,k,this.rotationAmount*Math.sin(this.time*this.sinxs+this.sinxo)),h.rotateY(j,j,this.rotationAmount*Math.sin(this.time*this.sinys+this.sinyo));var b=this.positionAmount*Math.sin(this.time*this.sinps+this.sinpo);f.scale(i,this.positionDir,b),g.fromRotationTranslation(l,j,i),g.multiply(l,this._mat,l),this.node.setMatrix(l)}},b.exports=d},{"gl-matrix":352}],23:[function(a,b,c){function d(a){this.scene=a;var b=a.gl;this.node=new g,this.setup=new f,this.sbounds=new j(a),this.setup.bounds.fromMinMax([-3,-.1,-3],[3,.4,3]);var c=BrowserDetect.isMobile||BrowserDetect.isTablet?"PCF2x2":"PCF4x4";this.shCatcher=new h,this.shCatcher.shadowFilter.set(c),this.shCatcher.shadowStrength=.35,this.setup._registerModel("shadow-catcher",this.shCatcher),this.sdtgi=new i,this.sdtgi.shadowFilter.set(c),this.sdtgi.shadowStrength=.35,this.setup._registerModel("stdgi",this.sdtgi),this.enableGI=!0,this.setup.stdModel.shadowFilter.set(c),this.setup.stdModel.iblShadowing.enable(),this.list=[],this.light=new e(b),this.light._shadowmapSize=BrowserDetect.isMobile||BrowserDetect.isTablet?1024:2048,this.light._shadowmapNearOffset=0,this.light.castShadows(!0),this.light.iblShadowing=.6,this.lum=3,this.light._color.set([this.lum,this.lum,this.lum]),o.set([.8,.9,-.57]),this.node.add(this.light),this.setup.add(this.light),this.list.push(this.light),this.rX=-1.4148425098036852,this.rZ=-.6381182147165259}var e=a("nanogl-pbr/lib/lights/directional-light"),f=a("nanogl-pbr/lib/lights/light-setup"),g=a("nanogl-node"),h=(a("math"),a("gl/shadow-catcher-model")),i=a("gl/standard-gi-model"),j=a("./shadow-bounds"),k=(a("dev/gui"),a("gl-matrix")),l=k.vec3,m=k.mat3,n=k.quat,o=(l.create(),l.create()),p=(l.create(),m.create());new Float32Array(p.buffer,0,3),new Float32Array(p.buffer,12,3),new Float32Array(p.buffer,24,3),l.fromValues(1,0,0);d.prototype={hasDepthShadowmap:function(){return this.light.hasDepthShadowmap()},preRender:function(){this.computeShadowmapBounds(),this.sdtgi.enableGI.set(this.enableGI),this.light._color.set([this.lum,this.lum,this.lum]),n.identity(this.light.rotation),n.rotateZ(this.light.rotation,this.light.rotation,this.rZ),n.rotateX(this.light.rotation,this.light.rotation,this.rX),this.light.invalidate()},computeShadowmapBounds:function(){this.sbounds.updateCorners(this.scene),this.sbounds.update(this.setup.bounds)}},b.exports=d},{"./shadow-bounds":26,"dev/gui":20,"gl-matrix":352,"gl/shadow-catcher-model":34,"gl/standard-gi-model":36,math:114,"nanogl-node":368,"nanogl-pbr/lib/lights/directional-light":394,"nanogl-pbr/lib/lights/light-setup":395}],24:[function(a,b,c){function d(a){this.loaded=this._loaded.bind(this),this.scene=a,this.isLoaded=!1,this.texs=a.texlib.createProvider("loading"),this.texs.makeTex("balls","common/loading.jpg").setFilter(!0,!1,!1),this.time=0,this.cfg=this.scene.glstate.config().enableDepthTest(!1).enableBlend().blendFunc(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA),this.xform=new Float32Array(4),this.screenPos=new Float32Array(3)}var e=(a("nanogl-node"),a("math")),f=a("math/ease"),g=a("when"),h=[[0,.5],[0,0],[.5,.5]],i=[0,.7,1.5];d.prototype={getLoadables:function(){var a=this.texs.getLoadables();return g.all(a).then(this.loaded),a},render:function(){if(this.isLoaded){var a=this.scene.programs.loading,b=this.scene.quad,c=this.scene.renderer.width,d=this.scene.renderer.height;a.use();var g=this.xform;g[2]=16/c,g[3]=16/d,a.tBalls(this.texs.get("balls")),b.attribPointer(a),this.cfg.apply();for(var j=0;j<3;j++){var k=this.time+.05*j;k=e.clamp01(k%1*1.5);var l=3.2+i[j]+2*Math.PI*f.easeInOutCubic(k);g[0]=80*Math.sin(l)/c+this.screenPos[0],g[1]=45*Math.cos(l)/d+this.screenPos[1],a.uXform(g);var m=h[j];a.uTexOffset(m[0],m[1]),b.render()}}},preRender:function(){this.time+=.4*this.scene.dt},_loaded:function(){this.isLoaded=!0}},b.exports=d},{math:114,"math/ease":113,"nanogl-node":368,when:445}],25:[function(a,b,c){function d(a,b){this.verts=new e(a,b).attrib("aPosition",3,a.FLOAT)}var e=a("nanogl/arraybuffer");a("nanogl/indexbuffer");d.prototype={render:function(a){this.verts.attribPointer(a),this.verts.bind(),this.verts.drawPoints()}},b.exports=d},{"nanogl/arraybuffer":415,"nanogl/indexbuffer":418}],26:[function(a,b,c){function d(a,b){a[0]=Math.min(a[0],b[0]),a[1]=Math.min(a[1],b[1]),a[2]=Math.min(a[2],b[2])}function e(a,b){a[0]=Math.max(a[0],b[0]),a[1]=Math.max(a[1],b[1]),a[2]=Math.max(a[2],b[2])}function f(a){this.scene=a,this.plane=new g,this.ray=new h,this.min=k.create(),this.max=k.create()}var g=a("math/plane"),h=a("math/ray"),i=a("math/ray-plane-intersection"),j=a("gl-matrix"),k=j.vec3,l=(j.mat3,j.mat4),m=k.create(),n=(k.create(),k.create(),l.create());k.fromValues(0,1,Math.SQRT2),k.fromValues(0,0,0);f.prototype={updateCorners:function(a){l.invert(n,this.scene.xpcam.unparalaxedViewProj());var b=this.ray.pos,c=this.ray.dir;this.min[0]=1e3,this.min[1]=1e3,this.min[2]=1e3,this.max[0]=-1e3,this.max[1]=-1e3,this.max[2]=-1e3;for(var f=0;f<4;f++)m[0]=1.1*(2*(1&f)-1),m[1]=1.1*((2&f)-1),m[2]=0,k.transformMat4(b,m,n),m[2]=1,k.transformMat4(c,m,n),k.subtract(c,c,b),k.normalize(c,c),i(m,this.ray,this.plane),d(this.min,m),e(this.max,m);this.min[1]=-.1,this.max[1]=.1},update:function(a){a.fromMinMax(this.min,this.max)}},b.exports=f},{"gl-matrix":352,"math/plane":115,"math/ray":118,"math/ray-plane-intersection":116}],27:[function(a,b,c){function d(a){h.call(this,a,r),this.setupTextures(),this.setupMaterials()}function e(a){this.onLoaded=this._onLoaded.bind(this),this.scene=a,this.awd=new d(a),this.arrows=[]}function f(a,b,c,d){this.clic=this._clic.bind(this),this.over=this._over.bind(this),this.out=this._out.bind(this),this.modIndex=d,this.cfg=c,this.moduleCtx=b,this.node_arrow=a.node_arrow.proxy(),this.node_ground=a.node_ground.proxy(),this.next_btn=a.next_btn.proxy(),this.node_holder=new l,this.node_holder.rotateX(-Math.PI/2),this.node_holder.add(this.node_arrow),this.node_holder.add(this.node_ground),this.node_arrow.add(this.next_btn),this.moduleCtx.node.add(this.node_holder),this.node_holder.x=c[0],this.node_holder.z=c[1],this.node_holder.y=.01;var e=Math.atan2(-1,-1);this.node_holder.rotateZ(e),this.node_holder.setScale(1.5),this.scale=0,this.hoverable=new i(b.scene,this.node_arrow,.05,2,!0),this.hoverable.on("clic",this.clic),this.hoverable.on("rollover",this.over),this.hoverable.on("rollout",this.out),this.activeSince=0}var g=a("when"),h=a("assets/awd-scene"),i=(a("lib/net"),a("lib/color"),a("lib/awd"),a("dev/gui"),a("config"),a("math/responsive"),a("lib/hoverable")),j=a("math"),k=a("math/ease"),l=a("nanogl-node"),m=(a("nanogl-pbr/standard"),a("gl/unlit-material")),n=a("gl/standard-gi"),o=(a("nanogl-pbr/lib/input"),a("sound/player")),p=a("cursor"),q=a("gl-matrix/src/gl-matrix/mat4"),r=(q.create(),new Float32Array(2),"ui");d.prototype=Object.create(h.prototype),d.prototype.constructor=d,d.prototype.getAssetPath=function(a){return r+"/"+a},d.prototype.getAwdUrl=function(){return r+"/scene.awd"},d.prototype.setupTextures=function(){this.texs.makeTex("objects_GI",this.getAssetPath("objects_GI.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("next",this.getAssetPath("next.jpg")).setFilter(!0,!1,!1)},d.prototype.setupMaterials=function(){var a,a,b=this.mats,c=b.lib,d=this.scene.gl,d=this.scene.gl,a=new n(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAblbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/green")),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("objects_GI")),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([0,0,0]),a.iAlbedoAtt.attachConstant([.3]),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),this.mats.lib.setOpaque(a),b.registerMaterial(a,"green");var a=new m(d);a._precision="highp",a.color=a.iColor.attachSampler("tAblbedo","vTexCoord"),a.color.set(this.texs.get("next")),this.mats.lib.setOpaque(a),a.config.enableBlend(),a.config.blendFunc(d.ZERO,d.SRC_COLOR),b.registerMaterial(a,"next");var a=new n(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([1,1,1]),a.iAlbedoAtt.attachConstant([.4]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([0,0,0]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("objects_GI")),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),c.setOpaque(a),a.config.enableBlend(),a.config.blendFunc(d.ZERO,d.SRC_COLOR),a._mask=4,b.registerMaterial(a,"ground")},e.prototype={getLoadables:function(){var a=[];return a=a.concat(this.awd.getLoadables()),g.all(a).then(this.onLoaded),a},_onLoaded:function(){this.node_arrow=this.awd.loader.getObjectByName("node_arrow"),this.node_ground=this.awd.loader.getObjectByName("node_ground"),this.node_holder=this.awd.loader.getObjectByName("node_holder"),this.next_btn=this.awd.loader.getObjectByName("next_txt"),this.node_arrow.proxiesOnly=!0,this.node_ground.proxiesOnly=!0,this.next_btn.proxiesOnly=!0;for(var a=this.scene.mods.ctxs,b=1;b<a.length-1;b++)this.makeArrow(a[b],s[b-1],b)},preRender:function(){for(var a=0;a<this.arrows.length;a++)this.arrows[a].preRender(this.scene.dt)},render:function(){this.awd.render(1),this.awd.render(4)},renderShadowPass:function(a){this.awd.renderPass(a.cam,1,a.defaultpass)},makeArrow:function(a,b,c){var d=new f(this,a,b,c);this.arrows.push(d)}};var s=[[1.5,-1.5],[1.8,-1.6],[1.5,-1.5],[1.5,-1.5]];f.prototype={_clic:function(){this.scale<1||this.moduleCtx.scene.model.setSection(this.modIndex+1)},_over:function(){this.scale<1||(p.enableHover2(),o.play("hover",!1,2),this.moduleCtx.scene.model.slide(!0))},_out:function(){this.scale<1||(p.disableHover2(),this.moduleCtx.scene.model.slide(!1))},preRender:function(){this.moduleCtx._position>0&&(this.activeSince=0);var a=this.moduleCtx.scene;this.hoverable.preRender(a.dt),this.activeSince+=a.dt,this.activeSince>5?this.scale+=a.dt/.2:this.scale-=a.dt/.2,this.scale=j.clamp01(this.scale),this.node_holder.setScale(1.5*k.easeInOutQuad(this.scale))}},b.exports=e},{"assets/awd-scene":1,config:18,cursor:19,"dev/gui":20,"gl-matrix/src/gl-matrix/mat4":357,"gl/standard-gi":38,"gl/unlit-material":39,"lib/awd":99,"lib/color":106,"lib/hoverable":108,"lib/net":110,math:114,"math/ease":113,"math/responsive":119,"nanogl-node":368,"nanogl-pbr/lib/input":393,"nanogl-pbr/standard":403,"sound/player":260,when:445}],28:[function(a,b,c){function d(a){this.scene=a;var b=a.gl;this.gl=b,this.envTex=new m(this.gl,this.gl.RGBA),this.envTex.setFilter(!1),this.envHi=new m(this.gl,this.gl.RGBA),this.envBg=new m(this.gl,this.gl.RGB),this.ibl=new e(this.envTex,this.envHi,this.envBg),this.gammaMode=new k("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.gamma=new j("gamma",1,j.ALL),this.exposure=new j("exposure",1,j.ALL),this.gammaMode.set("GAMMA_STD"),this.exposure.attachConstant(.8),this.gamma.attachConstant(1/2.2)}var e=a("./ibl"),f=a("lib/net"),g=(a("../dev/gui"),a("config")),h=a("gl-matrix"),i=a("nanogl-pbr/ibl"),j=a("nanogl-pbr/lib/input"),k=a("nanogl-pbr/lib/enum"),l=a("nanogl-texture-loader"),m=a("nanogl/texture"),n=(a("when"),h.vec2),o=n.create(),p=["desert_highway","LA_Downtown_Afternoon_Fishing","5008","MonValley","doge2","Helipad","Mans_Outside","pisa","hallstatt","parking_ext","uffizi","Brooklyn_Bridge_Planks","Ditch-River","Tropical_Beach","10-Shiodome_Stairs","Barce_Rooftop_C","Tokyo_BigSight","Factory_Catwalk","Ice_Lake","Charles-River-Esplanade-03","MIT-01","Mt-Washington-Hotel-Lookout","Tufts-Parking-Lot","studio016","studio017","studio018","studio019","studio020","studio021","studio022","studio023","studio024","abandonned","DS360_Free_001_v02_Ref","DS360_Free_002_Ref","village","Mono_Lake_B","Ridgecrest_Road"],q=[1.8,6.2,0,0,0,0,6.2,4.1,5.3,4.8,0,5,2.2,0,0,0,2.7,0,4.7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];d.prototype={setupMat:function(a){a.setIBL(this.ibl),a.iGamma.parent&&a.iGamma.parent.remove(a.iGamma),a.iExposure.parent&&a.iExposure.parent.remove(a.iExposure),a.gammaMode.parent&&a.gammaMode.parent.remove(a.gammaMode),a.inputs.add(this.gamma.createProxy()),a.inputs.add(this.gammaMode.createProxy()),a.inputs.add(this.exposure.createProxy())},dispose:function(){this.envTex.dispose(),this.envHi.dispose(),this.envBg.dispose(),this.envTex=null,this.envHi=null,this.envBg=null,this.ibl=null,this.scene=null,this.shBase=null,this.shMul=1},getLoadables:function(){return this.scene.envRotation=q[29],this.load("envs/"+p[29])},load:function(a){var b=this.ibl,c=this;return[l.load(this.envBg,g.asset_url(a+"/bg.jpg")),l.load(this.envTex,g.asset_url(a+"/env.png")),l.load(this.envHi,g.asset_url(a+"/env_hi.png")),f.loadBytes(g.asset_url(a+"/sh.bin")).then(function(a){c.shBase=new Float32Array(a,0,27),b.sh=i.convert(c.shBase,c.shMul)})]},preRender:function(a){n.sub(o,this.rrotations,this.rotations);var b=Math.min(1,15*a);n.scaleAndAdd(this.rotations,this.rotations,o,b)},_gui:void 0},b.exports=d},{"../dev/gui":20,"./ibl":30,config:18,"gl-matrix":352,"lib/net":110,"nanogl-pbr/ibl":387,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/input":393,"nanogl-texture-loader":413,"nanogl/texture":421,when:445}],29:[function(a,b,c){function d(a){this.gl=a,this.name="",this.subgeoms=[]}function e(a){this._vaoMap={},this.gl=a,this.buffers=[],this.ibuffer=null,this.indices=null,this.vertices=[],this.bounds=new g,this.vao=new f(this.gl),this.cprg=null}var f=(a("nanogl/arraybuffer"),a("nanogl/indexbuffer"),a("nanogl-vao")),g=a("nanogl-pbr/lib/bounds");d.prototype={},d.SubGeom=e,e.prototype={getVao:function(a){var b,c=a._cuid;return void 0===this._vaoMap[c]&&(b=this._vaoMap[c]=new f(this.gl),b.setup(a,this.buffers,this.ibuffer)),this._vaoMap[c]},setup:function(a){this.currentVao=this.getVao(a),this.currentVao.bind()},render:function(){this.ibuffer.drawTriangles()},unbind:function(){this.currentVao.unbind()}},b.exports=d},{"nanogl-pbr/lib/bounds":388,"nanogl-vao":414,"nanogl/arraybuffer":415,"nanogl/indexbuffer":418}],30:[function(a,b,c){function d(a,b,c){e.call(this,a),this.envHi=b,this.envBg=c}var e=a("nanogl-pbr/ibl");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setupProgram=function(a){e.prototype.setupProgram.call(this,a);a.tEnvHi&&a.tEnvHi(this.envHi)},b.exports=d},{"nanogl-pbr/ibl":387}],31:[function(a,b,c){function d(a){e.call(this),this.gl=a,this.geom=null,this.name="",this.materials=[],this.animator=null,this._proxies=[],this.proxiesOnly=!1}var e=(a("nanogl-state/config"),a("nanogl-node")),f=a("gl-matrix").mat4.create();d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setAnimator=function(a){var b=this.geom.subgeoms,c=this.materials.length;this.animator=a;for(var d=0;d<b.length;d++){var e=(b[d],this.materials[Math.min(c-1,d)]);null===e.skinSetup&&e.setSkinSetup(a.createSkinSetup())}},d.prototype.proxy=function(){var a=new e;return this._parent&&this._parent.add(a),this._proxies.push(a),a},d.prototype.removeProxy=function(a){var b=this._proxies.indexOf(a);-1!==b&&(this._proxies.splice(b,1),a._parent&&a._parent.remove(a))},d.prototype.preRender=function(a){},d.prototype.prepareSkin=function(){for(var a=this.geom.subgeoms,b=this.materials.length,c=0;c<a.length;c++){var d=this.materials[Math.min(b-1,c)];this.geom.skinned&&(d.skinNumWeight.set("SKIN"+this.geom.skinNumWeight),d.depthPass&&d.depthPass.skinNumWeight.set("SKIN"+this.geom.skinNumWeight))}},d.prototype.render=function(a,b,c){for(var d=this.geom.subgeoms,e=this.materials.length,f=a.glstate,g=0;g<d.length;g++){var h=d[g],i=this.materials[Math.min(e-1,g)];0!=(i._mask&b)&&(this.geom.skinned&&i.skinNumWeight.set("SKIN"+this.geom.skinNumWeight),i.prepare(this,a.camera),h.setup(i.prg),f.push(i.config),this.cfg&&f.push(this.cfg),c&&f.push(c),f.apply(),this.drawCall(a.camera,i.prg,h),f.pop(),this.cfg&&f.pop(),c&&f.pop())}},d.prototype.drawCall=function(a,b,c){this.proxiesOnly||c.render();for(var d=0;d<this._proxies.length;d++){var e=this._proxies[d];a.modelViewProjectionMatrix(f,e._wmatrix),b.uMVP&&b.uMVP(f),b.uWorldMatrix&&b.uWorldMatrix(e._wmatrix),c.render()}c.unbind()},d.prototype.renderDepth=function(a,b,c,d,e){for(var f=this.geom.subgeoms,g=this.materials.length,h=a.glstate,i=0;i<f.length;i++){var j=f[i],k=this.materials[Math.min(g-1,i)];0!=(k._mask&c)&&(k=k.depthPass,void 0===k&&(k=e),this.geom.skinned&&k.skinNumWeight.set("SKIN"+this.geom.skinNumWeight),k.prepare(this,b),j.setup(k.prg),k.config&&h.push(k.config),this.cfg&&h.push(this.cfg),d&&h.push(d),h.apply(),this.drawCall(b,k.prg,j),k.config&&h.pop(),this.cfg&&h.pop(),d&&h.pop())}},d.prototype.renderPass=function(a,b,c,d){for(var e=this.geom.subgeoms,f=this.materials.length,g=0;g<e.length;g++){var h=e[g];0!=(this.materials[Math.min(f-1,g)]._mask&c)&&(d.prepare(this,b),h.setup(d.prg),a.glstate.apply(),this.drawCall(b,d.prg,h))}},d.prototype.renderProgram=function(a,b,c,d){var e=this.geom.subgeoms,f=this.materials.length;d=d||-1,c.uMVP(b.getMVP(this._wmatrix));for(var g=0;g<e.length;g++){var h=e[g];0!=(this.materials[Math.min(f-1,g)]._mask&d)&&(h.setup(c),this.drawCall(b,c,h))}},b.exports=d},{"gl-matrix":352,"nanogl-node":368,"nanogl-state/config":409}],32:[function(a,b,c){function d(a){var b=a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT);return a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision>0&&b.precision>0}function e(a){var b=a.gl;this.hasHighp=d(b),this.programs=[this.gradientBG=new f(b),this.loading=new f(b),this.debugFbo=new f(b),this.debug=new f(b),this.bloom=new f(b),this.renderBloom=new f(b),this.bloomOcclu=new f(b),this.flash=new f(b),this.finalScene=new f(b)],this.compile()}var f=a("nanogl/program");f.debug=!0,e.prototype={precision:function(){return this.hasHighp?"highp":"mediump"},compile:function(){var b="\n";b+="precision "+this.precision()+" float;\n",this.gradientBG.compile(a("glsl/common/gradient-bg.vert"),a("glsl/common/gradient-bg.frag"),b),this.loading.compile(a("glsl/loading.vert"),a("glsl/loading.frag"),b),this.debugFbo.compile(a("glsl/debug-fbo.vert"),a("glsl/debug-fbo.frag"),b),this.debug.compile(a("glsl/debug.vert"),a("glsl/debug.frag"),b),this.bloom.compile(a("glsl/debug-fbo.vert"),a("glsl/eight/blur.frag"),b),this.renderBloom.compile(a("glsl/debug-fbo.vert"),a("glsl/eight/render-bloom.frag"),b),this.bloomOcclu.compile(a("glsl/eight/blur-occlu.vert"),a("glsl/eight/blur-occlu.frag"),b),this.flash.compile(a("glsl/debug-fbo.vert"),a("glsl/eight/flash.frag"),b),this.finalScene.compile(a("glsl/debug-fbo.vert"),a("glsl/eight/render-scene.frag"),b),this.process()},process:function(){for(var a=0;a<this.programs.length;a++)this.programs[a].use()},dispose:function(){for(var a=0;a<this.programs.length;a++)this.programs[a].dispose();this.programs=null}},b.exports=e},{"glsl/common/gradient-bg.frag":40,"glsl/common/gradient-bg.vert":41,"glsl/debug-fbo.frag":46,"glsl/debug-fbo.vert":47,"glsl/debug.frag":48,"glsl/debug.vert":49,"glsl/eight/blur-occlu.frag":50,"glsl/eight/blur-occlu.vert":51,"glsl/eight/blur.frag":52,"glsl/eight/flash.frag":53,"glsl/eight/render-bloom.frag":54,"glsl/eight/render-scene.frag":55,"glsl/loading.frag":60,"glsl/loading.vert":61,"nanogl/program":419}],33:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new h,this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="scatcher",this._precision="highp",this._vertSrc=a("glsl/shadow-catcher.vert")(),this._fragSrc=a("glsl/shadow-catcher.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=(a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/enum"),a("nanogl-pbr/lib/chunks-tree")),i=a("gl-matrix").mat4.create();d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("shadow-catcher"))},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),b.modelViewProjectionMatrix(i,a._wmatrix),c.uMVP(i),c.uWorldMatrix(a._wmatrix)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":352,"glsl/shadow-catcher.frag":69,"glsl/shadow-catcher.vert":70,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],34:[function(a,b,c){function d(){this._datas={},this._dataList=[],this._setup=null;var a;this.preLightsChunk=new e,this.postLightsChunk=new f,this.shadowChunk=new g(this),this.shadowStrength=.5,this.shadowFilter=new n("shadowFilter",["PCFNONE","PCF4x1","PCF4x4","PCF2x2"]),a=new j,this._datas[l.TYPE_DIR]=a,this._dataList.push(a),a=new i,this._datas[l.TYPE_SPOT]=a,this._dataList.push(a),a=new k,this._datas[l.TYPE_POINT]=a,this._dataList.push(a)}function e(){m.call(this,!0,!1)}function f(){m.call(this,!0,!1)}function g(a){m.call(this,!0,!0),this.lightModel=a,this.shadowCount=0,this.genCount=0,this._matrices=new Float32Array(16*x),this._texelBiasVector=new Float32Array(4*x),this._shadowmapSizes=new Float32Array(2*x),this._umatrices=null,this._utexelBiasVector=null,this._ushadowmapSizes=null}function h(){m.call(this,!0,!0),this.type=0,this.lights=[],this.shadowIndices=[],this.preCodeTemplate=null}function i(){h.call(this),this.type=l.TYPE_SPOT,this._directions=null,this._colors=null,this._positions=null,this._spot=null,this._falloff=null,this.preCodeTemplate=p}function j(){h.call(this),this.type=l.TYPE_DIR,this._directions=null,this._colors=null,this.preCodeTemplate=o}function k(){h.call(this),this.type=l.TYPE_POINT,this._colors=null,this._positions=null,this._falloff=null,this.preCodeTemplate=q}var l=a("nanogl-pbr/lib/lights/light"),m=a("nanogl-pbr/lib/chunk"),n=a("nanogl-pbr/lib/enum"),o=(a("nanogl-pbr/lib/flag"),a("glsl/shadow-catcher/directional-lights-pre.frag")),p=a("glsl/shadow-catcher/spot-lights-pre.frag"),q=a("glsl/shadow-catcher/point-lights-pre.frag"),r=a("glsl/shadow-catcher/directional-light.frag"),s=a("glsl/shadow-catcher/spot-light.frag"),t=a("glsl/shadow-catcher/point-light.frag"),u=a("glsl/shadow-catcher/shadow-maps-pre.frag"),v=a("glsl/shadow-catcher/pre-light-setup.frag"),w=a("glsl/shadow-catcher/post-light-setup.frag");d.prototype={add:function(a){this._datas[a._type].addLight(a)},remove:function(a){this._datas[a._type].removeLight(a)},update:function(){this.shadowChunk.shadowCount=0;for(var a=0;a<this._dataList.length;a++)this._dataList[a].update(this);this.shadowChunk.check()},getChunks:function(){var a=[];a.push(this.shadowFilter.createProxy()),a.push(this.shadowChunk.createProxy()),a.push(this.preLightsChunk.createProxy());for(var b=0;b<this._dataList.length;b++)a.push(this._dataList[b].createProxy());return a.push(this.postLightsChunk.createProxy()),a}},e.prototype=Object.create(m.prototype),
e.prototype.constructor=e,e.prototype.genCode=function(a){code=v(this),a.add("lightsf",code)},e.prototype.getHash=function(){return"0"},f.prototype=Object.create(m.prototype),f.prototype.constructor=f,f.prototype.genCode=function(a){code=w(this),a.add("lightsf",code)},f.prototype.getHash=function(){return"0"};var x=4;g.prototype=Object.create(m.prototype),g.prototype.constructor=g;var y=Math.PI/4;g.prototype.genCode=function(a){this.shadowCount>0&&a.add("pf",u(this))},g.prototype.addLight=function(a){var b=this.shadowCount;this.shadowCount++,this._matrices.set(a.getShadowProjection(this.lightModel._setup.bounds),16*b),this._texelBiasVector.set(a.getTexelBiasVector(),4*b);var c=a._shadowmapSize;if(this._shadowmapSizes[2*b+0]=c,this._shadowmapSizes[2*b+1]=1/c,0===b){var d=a.hasDepthShadowmap();this.lightModel._setup.depthFormat.set(d?"D_DEPTH":"D_RGB")}return b},g.prototype.getHash=function(){return this.shadowCount},g.prototype.check=function(){this.genCount!==this.shadowCount&&(this.genCount=this.shadowCount,this._umatrices=new Float32Array(this._matrices.buffer,0,16*this.shadowCount),this._utexelBiasVector=new Float32Array(this._texelBiasVector.buffer,0,4*this.shadowCount),this._ushadowmapSizes=new Float32Array(this._shadowmapSizes.buffer,0,2*this.shadowCount),this.invalidate()),this._invalid=!0},g.prototype.setup=function(a){this.shadowCount>0&&(a.uShadowMatrices(this._umatrices),a.uShadowTexelBiasVector(this._utexelBiasVector),a.uShadowMapSize(this._ushadowmapSizes),a.uShadowStrength(this.lightModel.shadowStrength),void 0!==a.uShadowKernelRotation&&a.uShadowKernelRotation(1*Math.cos(y),1*Math.sin(y)),this._invalid=!1)},h.prototype=Object.create(m.prototype),h.prototype.constructor=h,h.prototype.addLight=function(a){-1===this.lights.indexOf(a)&&(this.lights.push(a),this.shadowIndices.push(-1),this.invalidate())},h.prototype.removeLight=function(a){var b=this.lights.indexOf(a);b>-1&&(this.lights.splice(b,1),this.shadowIndices.splice(b,1),this.invalidate())},h.prototype.genCode=function(a){var b=this.preCodeTemplate({count:this.lights.length});a.add("pf",b),b="";for(var c=0;c<this.lights.length;c++)b+=this.genCodePerLights(this.lights[c],c,this.shadowIndices[c]);a.add("lightsf",b)},h.prototype.genCodePerLights=function(a,b,c){},h.prototype.getHash=function(){for(var a=this.type+""+this.lights.length,b=0;b<this.lights.length;b++)this.lights[b]._castShadows&&(a+=b);return a},h.prototype.setup=function(a){for(var b=0;b<this.shadowIndices.length;b++){var c=this.shadowIndices[b];if(c>-1){var d=this.lights[b].getShadowmap();a["tShadowMap"+c](d)}}},i.prototype=Object.create(h.prototype),i.prototype.constructor=i,i.prototype.genCodePerLights=function(a,b,c){return s({index:b,shadowIndex:c})},i.prototype.allocate=function(a){null!==this._colors&&this._colors.length/4===a||(this._directions=new Float32Array(3*a),this._colors=new Float32Array(4*a),this._positions=new Float32Array(3*a),this._spot=new Float32Array(2*a),this._falloff=new Float32Array(3*a))},i.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._directions.set(d._wdir,3*c),this._colors.set(d._color,4*c),this._positions.set(d._wposition,3*c),this._spot.set(d._spotData,2*c),this._falloff.set(d._falloffData,3*c),this._colors[4*c+3]=d.iblShadowing,d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},i.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),this._invalid=!1)},j.prototype=Object.create(h.prototype),j.prototype.constructor=j,j.prototype.genCodePerLights=function(a,b,c){return r({index:b,shadowIndex:c})},j.prototype.allocate=function(a){null!==this._colors&&this._colors.length/4===a||(this._directions=new Float32Array(3*a),this._colors=new Float32Array(4*a))},j.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._directions.set(d._wdir,3*c),this._colors.set(d._color,4*c),this._colors[4*c+3]=d.iblShadowing,d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},j.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),this._invalid=!1)},k.prototype=Object.create(h.prototype),k.prototype.constructor=k,k.prototype.genCodePerLights=function(a,b,c){return t({index:b,shadowIndex:c})},k.prototype.allocate=function(a){null!==this._colors&&this._colors.length/3===a||(this._colors=new Float32Array(3*a),this._positions=new Float32Array(3*a),this._falloff=new Float32Array(3*a))},k.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._colors.set(d._color,3*c),this._positions.set(d._wposition,3*c),this._falloff.set(d._falloffData,3*c),d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},k.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),this._invalid=!1)},b.exports=d},{"glsl/shadow-catcher/directional-light.frag":71,"glsl/shadow-catcher/directional-lights-pre.frag":72,"glsl/shadow-catcher/point-light.frag":73,"glsl/shadow-catcher/point-lights-pre.frag":74,"glsl/shadow-catcher/post-light-setup.frag":75,"glsl/shadow-catcher/pre-light-setup.frag":76,"glsl/shadow-catcher/shadow-maps-pre.frag":77,"glsl/shadow-catcher/spot-light.frag":78,"glsl/shadow-catcher/spot-lights-pre.frag":79,"nanogl-pbr/lib/chunk":389,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/lights/light":396}],35:[function(a,b,c){function d(b,c){this.ibl=null,this.prg=null,this._mask=1,this.scene=c,this.inputs=new j,this.iLightmap=this.inputs.add(new g("lightmap",3)),this.iAlbedoAtt=this.inputs.add(new g("albedoAttenuation",1)),this.iUVOffset=this.inputs.add(new g("uvOffset",2,g.VERTEX)),this.iUVScale=this.inputs.add(new g("uvScale",2,g.VERTEX)),this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.iAquarelleGI=this.inputs.add(new g("aquarelleGI",3)),this.iGradient=this.inputs.add(new g("gradient",3)),this.receiveShadows=this.inputs.add(new h("receiveShadows",!0)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="stdgi",this._precision="highp",this._vertSrc=a("glsl/pbr-gi-aquarelle.vert")(),this._fragSrc=a("glsl/pbr-gi-aquarelle.frag")(),this.trailProgress=0,this.trailExtent=0,this.vOffset=0,this.smoothEdge=0}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("math"),l=a("gl-matrix").mat4.create(),m=a("../modules/eight/gui").params;d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("stdgi"))},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(l,a._wmatrix),c.uMVP(l),c.uWorldMatrix(a._wmatrix),c.uCameraPosition(b._wposition);var d=(m.panel.extent,this.scene.mods.mods[4].tracks.tracks[0].getBallProgress(),this.scene.mods.mods[4].tracks.tracks[0].targetProgress),e=m.panel.minProgress,f=m.panel.maxProgress,g=3,h=k.map(this.scene.mods.mods[4].tracks.tracks[0].targetSpeed,.7,1,0,.5);h=Math.max(0,h),d>e&&d<f&&!m.panel.progress.override&&(g=k.map(d,e,f,0,1)),m.panel.progress.override&&(g=m.panel.progress.value);var i=k.map(g,0,.5,0,1.1509),j=k.map(g,.5,1,1.4,0);c.uTrailProgress(i),c.uTrailExtent(j),c.uSmoothEdge(m.panel.smoothEdge),c.uBrightness(m.panel.brightness),c.uContrast(m.panel.contrast),c.uIntensity(h)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"../modules/eight/gui":140,"gl-matrix":352,"glsl/pbr-gi-aquarelle.frag":64,"glsl/pbr-gi-aquarelle.vert":65,math:114,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],36:[function(a,b,c){function d(){this._datas={},this._dataList=[],this._setup=null;var a;this.preLightsChunk=new e,this.postLightsChunk=new f,this.shadowChunk=new g(this),this.shadowFilter=new n("shadowFilter",["PCFNONE","PCF4x1","PCF4x4","PCF2x2"]),this.iblShadowing=new o("iblShadowing",!1),this.enableGI=new o("enableGI",!0),a=new j,this._datas[l.TYPE_DIR]=a,this._dataList.push(a),a=new i,this._datas[l.TYPE_SPOT]=a,this._dataList.push(a),a=new k,this._datas[l.TYPE_POINT]=a,this._dataList.push(a)}function e(){m.call(this,!0,!1)}function f(){m.call(this,!0,!1)}function g(a){m.call(this,!0,!0),this.lightModel=a,this.shadowCount=0,this.genCount=0,this._matrices=new Float32Array(16*y),this._texelBiasVector=new Float32Array(4*y),this._shadowmapSizes=new Float32Array(2*y),this._umatrices=null,this._utexelBiasVector=null,this._ushadowmapSizes=null}function h(){m.call(this,!0,!0),this.type=0,this.lights=[],this.shadowIndices=[],this.preCodeTemplate=null}function i(){h.call(this),this.type=l.TYPE_SPOT,this._directions=null,this._colors=null,this._positions=null,this._spot=null,this._falloff=null,this.preCodeTemplate=q}function j(){h.call(this),this.type=l.TYPE_DIR,this._directions=null,this._colors=null,this.preCodeTemplate=p}function k(){h.call(this),this.type=l.TYPE_POINT,this._colors=null,this._positions=null,this._falloff=null,this.preCodeTemplate=r}var l=a("nanogl-pbr/lib/lights/light"),m=a("nanogl-pbr/lib/chunk"),n=a("nanogl-pbr/lib/enum"),o=a("nanogl-pbr/lib/flag"),p=a("glsl/standard-gi/directional-lights-pre.frag"),q=a("glsl/standard-gi/spot-lights-pre.frag"),r=a("glsl/standard-gi/point-lights-pre.frag"),s=a("glsl/standard-gi/directional-light.frag"),t=a("glsl/standard-gi/spot-light.frag"),u=a("glsl/standard-gi/point-light.frag"),v=a("glsl/standard-gi/shadow-maps-pre.frag"),w=a("glsl/standard-gi/pre-light-setup.frag"),x=a("glsl/standard-gi/post-light-setup.frag");d.prototype={add:function(a){this._datas[a._type].addLight(a)},remove:function(a){this._datas[a._type].removeLight(a)},update:function(){this.shadowChunk.shadowCount=0;for(var a=0;a<this._dataList.length;a++)this._dataList[a].update(this);this.shadowChunk.check()},getChunks:function(){var a=[];a.push(this.iblShadowing.createProxy()),a.push(this.shadowFilter.createProxy()),a.push(this.enableGI.createProxy()),a.push(this.shadowChunk.createProxy()),a.push(this.preLightsChunk.createProxy());for(var b=0;b<this._dataList.length;b++)a.push(this._dataList[b].createProxy());return a.push(this.postLightsChunk.createProxy()),a}},e.prototype=Object.create(m.prototype),e.prototype.constructor=e,e.prototype.genCode=function(a){code=w(this),a.add("lightsf",code)},e.prototype.getHash=function(){return"0"},f.prototype=Object.create(m.prototype),f.prototype.constructor=f,f.prototype.genCode=function(a){code=x(this),a.add("lightsf",code)},f.prototype.getHash=function(){return"0"};var y=4;g.prototype=Object.create(m.prototype),g.prototype.constructor=g;var z=Math.PI/4;g.prototype.genCode=function(a){this.shadowCount>0&&a.add("pf",v(this))},g.prototype.addLight=function(a){var b=this.shadowCount;this.shadowCount++,this._matrices.set(a.getShadowProjection(this.lightModel._setup.bounds),16*b),this._texelBiasVector.set(a.getTexelBiasVector(),4*b);var c=a._shadowmapSize;if(this._shadowmapSizes[2*b+0]=c,this._shadowmapSizes[2*b+1]=1/c,0===b){var d=a.hasDepthShadowmap();this.lightModel._setup.depthFormat.set(d?"D_DEPTH":"D_RGB")}return b},g.prototype.getHash=function(){return this.shadowCount},g.prototype.check=function(){this.genCount!==this.shadowCount&&(this.genCount=this.shadowCount,this._umatrices=new Float32Array(this._matrices.buffer,0,16*this.shadowCount),this._utexelBiasVector=new Float32Array(this._texelBiasVector.buffer,0,4*this.shadowCount),this._ushadowmapSizes=new Float32Array(this._shadowmapSizes.buffer,0,2*this.shadowCount),this.invalidate()),this._invalid=!0},g.prototype.setup=function(a){this.shadowCount>0&&void 0!==a.uShadowMatrices&&(a.uShadowMatrices(this._umatrices),a.uShadowTexelBiasVector(this._utexelBiasVector),a.uShadowMapSize(this._ushadowmapSizes),void 0!==a.uShadowKernelRotation&&a.uShadowKernelRotation(1*Math.cos(z),1*Math.sin(z)),this._invalid=!1)},h.prototype=Object.create(m.prototype),h.prototype.constructor=h,h.prototype.addLight=function(a){-1===this.lights.indexOf(a)&&(this.lights.push(a),this.shadowIndices.push(-1),this.invalidate())},h.prototype.removeLight=function(a){var b=this.lights.indexOf(a);b>-1&&(this.lights.splice(b,1),this.shadowIndices.splice(b,1),this.invalidate())},h.prototype.genCode=function(a){var b=this.preCodeTemplate({count:this.lights.length});a.add("pf",b),b="";for(var c=0;c<this.lights.length;c++)b+=this.genCodePerLights(this.lights[c],c,this.shadowIndices[c]);a.add("lightsf",b)},h.prototype.genCodePerLights=function(a,b,c){},h.prototype.getHash=function(){for(var a=this.type+""+this.lights.length,b=0;b<this.lights.length;b++)this.lights[b]._castShadows&&(a+=b);return a},h.prototype.setup=function(a){for(var b=0;b<this.shadowIndices.length;b++){var c=this.shadowIndices[b];if(c>-1){var d=this.lights[b].getShadowmap();a["tShadowMap"+c]&&a["tShadowMap"+c](d)}}},i.prototype=Object.create(h.prototype),i.prototype.constructor=i,i.prototype.genCodePerLights=function(a,b,c){return t({index:b,shadowIndex:c})},i.prototype.allocate=function(a){null!==this._colors&&this._colors.length/4===a||(this._directions=new Float32Array(3*a),this._colors=new Float32Array(4*a),this._positions=new Float32Array(3*a),this._spot=new Float32Array(2*a),this._falloff=new Float32Array(3*a))},i.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._directions.set(d._wdir,3*c),this._colors.set(d._color,4*c),this._positions.set(d._wposition,3*c),this._spot.set(d._spotData,2*c),this._falloff.set(d._falloffData,3*c),this._colors[4*c+3]=d.iblShadowing,d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},i.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLSpotDirections(this._directions),a.uLSpotColors(this._colors),a.uLSpotPositions(this._positions),a.uLSpotSpot(this._spot),a.uLSpotFalloff(this._falloff),this._invalid=!1)},j.prototype=Object.create(h.prototype),j.prototype.constructor=j,j.prototype.genCodePerLights=function(a,b,c){return s({index:b,shadowIndex:c})},j.prototype.allocate=function(a){null!==this._colors&&this._colors.length/4===a||(this._directions=new Float32Array(3*a),this._colors=new Float32Array(4*a))},j.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._directions.set(d._wdir,3*c),this._colors.set(d._color,4*c),this._colors[4*c+3]=d.iblShadowing,d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},j.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLDirDirections(this._directions),a.uLDirColors(this._colors),this._invalid=!1)},k.prototype=Object.create(h.prototype),k.prototype.constructor=k,k.prototype.genCodePerLights=function(a,b,c){return u({index:b,shadowIndex:c})},k.prototype.allocate=function(a){null!==this._colors&&this._colors.length/3===a||(this._colors=new Float32Array(3*a),this._positions=new Float32Array(3*a),this._falloff=new Float32Array(3*a))},k.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._colors.set(d._color,3*c),this._positions.set(d._wposition,3*c),this._falloff.set(d._falloffData,3*c),d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},k.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLPointColors(this._colors),a.uLPointPositions(this._positions),a.uLPointFalloff(this._falloff),this._invalid=!1)},b.exports=d},{"glsl/standard-gi/directional-light.frag":80,"glsl/standard-gi/directional-lights-pre.frag":81,"glsl/standard-gi/point-light.frag":82,"glsl/standard-gi/point-lights-pre.frag":83,"glsl/standard-gi/post-light-setup.frag":84,"glsl/standard-gi/pre-light-setup.frag":85,"glsl/standard-gi/shadow-maps-pre.frag":86,"glsl/standard-gi/spot-light.frag":87,"glsl/standard-gi/spot-lights-pre.frag":88,"nanogl-pbr/lib/chunk":389,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/lights/light":396}],37:[function(a,b,c){function d(b,c,d){this.ibl=null,this.prg=null,this._mask=1,this.scene=c,this.texs=d,this.inputs=new j,this.iLightmap=this.inputs.add(new g("lightmap",3)),this.iAlbedoAtt=this.inputs.add(new g("albedoAttenuation",1)),this.iUVOffset=this.inputs.add(new g("uvOffset",2,g.VERTEX)),this.iUVScale=this.inputs.add(new g("uvScale",2,g.VERTEX)),this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.iWoodGI=this.inputs.add(new g("woodGI",3)),this.iGradient=this.inputs.add(new g("gradient",3)),this.receiveShadows=this.inputs.add(new h("receiveShadows",!0)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="stdgi",this._precision="highp",this._vertSrc=a("glsl/pbr-gi.vert")(),this._fragSrc=a("glsl/pbr-gi-wood.frag")(),this.trailProgress=0,this.trailExtent=0,this.vOffset=0,this.smoothEdge=0}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("math"),l=a("gl-matrix").mat4.create(),m=a("../modules/eight/gui").params;d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("stdgi"))},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(l,a._wmatrix),c.uMVP(l),c.uWorldMatrix(a._wmatrix),c.uCameraPosition(b._wposition);var d=(this.scene.mods.mods[4].tracks.tracks[0].ball.cnode.node.position,k.map(this.scene.mods.mods[4].tracks.tracks[0].targetSpeed,.7,1,0,.2));c.uTrailExtent(d),c.uVOffset(this.scene.mods.mods[4].tracks.tracks[0].getBallProgress()-m.trails.giOffset),c.uSmoothEdge(m.tracks.smoothEdge)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"../modules/eight/gui":140,"gl-matrix":352,"glsl/pbr-gi-wood.frag":66,"glsl/pbr-gi.vert":68,math:114,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],38:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new j,this.iLightmap=this.inputs.add(new g("lightmap",3)),this.iAlbedoAtt=this.inputs.add(new g("albedoAttenuation",1)),this.iUVOffset=this.inputs.add(new g("uvOffset",2,g.VERTEX)),this.iUVScale=this.inputs.add(new g("uvScale",2,g.VERTEX)),this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.receiveShadows=this.inputs.add(new h("receiveShadows",!0)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="stdgi",this._precision="highp",this._vertSrc=a("glsl/pbr-gi.vert")(),this._fragSrc=a("glsl/pbr-gi.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4.create();d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("stdgi"))},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),c.uWorldMatrix(a._wmatrix),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":352,"glsl/pbr-gi.frag":67,"glsl/pbr-gi.vert":68,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],39:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new h,this.iColor=this.inputs.add(new g("color",4)),this.config=new e,this._prgcache=f.getCache(b),this._uid="unlit",this._precision="lowp",this._vertSrc=a("glsl/common/unlit.vert")(),this._fragSrc=a("glsl/common/unlit.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=(a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/chunks-tree")),i=a("gl-matrix").mat4.create();d.prototype={prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),b.modelViewProjectionMatrix(i,a._wmatrix),c.uMVP(i)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":352,"glsl/common/unlit.frag":44,"glsl/common/unlit.vert":45,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],40:[function(a,b,c){var d=function(a){var b="";return b+="\nvarying vec2 vTexCoord;\n\nuniform sampler2D tPaper;\n// uniform vec2 uRange; // offset, scale\n\nvoid main( void ){\n\n  // float tc = .5*(vTexCoord.x + vTexCoord.y);// diagonal\n  // tc = tc * uRange.y + uRange.x;// slide\n\n  // gl_FragColor = vec4( vec3(.99), 1.0 );\n\n  gl_FragColor = 1.1 * texture2D( tPaper , vTexCoord );\n\n\n\n}"};d.toString=d,b.exports=d},{}],41:[function(a,b,c){var d=function(a){var b="";return b+="\n\nattribute vec2 aPosition;\n\nuniform mat4 uUnproj;\nuniform mat4 uMVP;\n// attribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\nvoid main( void ){\n  \n  vec4 tmp;\n\n  tmp = uUnproj * vec4( aPosition, -1.0, 1.0 );\n  vec3 unprojPos = tmp.xyz / tmp.w;\n\n  tmp = uUnproj * vec4( aPosition, 1.0, 1.0 );\n  vec3 unprojDir = (tmp.xyz / tmp.w) - unprojPos;\n\n  float scale = unprojPos.y / -unprojDir.y;\n  vec3 planePos = (unprojDir * vec3(scale))  + unprojPos;\n\n  vTexCoord = planePos.xz;\n\n  gl_Position = uMVP * vec4( planePos, 1.0 );\n}"};d.toString=d,b.exports=d},{}],42:[function(a,b,c){var d=function(b){var c="";return c+='/* Musgrave fBm\n*\n* H: fractal increment parameter\n* lacunarity: gap between successive frequencies\n* octaves: number of frequencies in the fBm\n*\n* from "Texturing and Modelling: A procedural approach"\n*/\n\n'+a("glsl/common/noise-3d.glsl")()+"\n\nconst float MAX_ITERATIONS = 100.0;\n\nfloat noise_musgrave_fBm(vec3 p, float H, float lacunarity, float octaves) {\n\tfloat rmd;\n\tfloat value = 0.0;\n\tfloat pwr = 1.0;\n\tfloat pwHL = pow(lacunarity, -H);\n\n\tfor (float i = 0.; i < MAX_ITERATIONS; i += 1.0) {\n\t\tvalue += snoise(p) * pwr;\n\t\tpwr *= pwHL;\n\t\tp *= lacunarity;\n\t}\n\n\trmd = octaves - floor(octaves);\n\tif (rmd != 0.0)\n\t\tvalue += rmd * snoise(p) * pwr;\n\n\treturn value;\n}"};d.toString=d,b.exports=d},{"glsl/common/noise-3d.glsl":43}],43:[function(a,b,c){var d=function(a){var b="";return b+="//\n// Description : Array and textureless GLSL 2D/3D/4D simplex \n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  { \n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i); \n  vec4 p = permute( permute( permute( \n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n                                dot(p2,x2), dot(p3,x3) ) );\n  }"};d.toString=d,b.exports=d},{}],44:[function(a,b,c){var d=function(a){var b="";return b+="precision lowp float;\n\nvarying lowp vec2 vTexCoord;\n\n#pragma SLOT pf\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  gl_FragColor = color();\n\n}"};d.toString=d,b.exports=d},{}],45:[function(a,b,c){var d=function(a){var b="";return b+="precision highp float;\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\n\nvarying lowp vec2 vTexCoord;\n\n\nvoid main( void ){\n  gl_Position     = uMVP * vec4( aPosition, 1.0 );\n\n  vTexCoord = aTexCoord;\n}"};d.toString=d,b.exports=d},{}],46:[function(a,b,c){var d=function(a){var b="";return b+="\nvarying vec2 vTexCoord;\n\nuniform sampler2D tTex;\n\nvoid main(void){\n  \n  gl_FragColor.rgb = texture2D( tTex, vTexCoord ).rgb;\n  gl_FragColor.a = 1.0;\n  // gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n}\n"};d.toString=d,b.exports=d},{}],47:[function(a,b,c){var d=function(a){var b="";return b+="attribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\n\n  \nvoid main( void ){\n\n  gl_Position = vec4( aPosition, 0.0, 1.0 );\n  vTexCoord = aTexCoord;\n\n}\n"};d.toString=d,b.exports=d},{}],48:[function(a,b,c){var d=function(a){var b="";return b+="void main( void ) {\n  gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}\n"};d.toString=d,b.exports=d},{}],49:[function(a,b,c){var d=function(a){var b="";return b+="attribute vec3 aPosition;\n\nuniform mat4 uMVP;\n\nvoid main( void ) {\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n  gl_PointSize = 5.0;\n}\n"};d.toString=d,b.exports=d},{}],50:[function(a,b,c){var d=function(a){var b="";return b+="void main() {\n  gl_FragColor = vec4(1.0, 0.0, 0.0, 0.0);\n}"};d.toString=d,b.exports=d},{}],51:[function(a,b,c){var d=function(a){var b="";return b+="attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nattribute vec3 aTangent;\nattribute vec3 aBitangent;\n\nuniform mat4 uMVP;\n\nvoid main() {\n  gl_Position = uMVP * vec4(aPosition, 1.0);\n}\n"};d.toString=d,b.exports=d},{}],52:[function(a,b,c){var d=function(a){var b=""
;return b+="varying vec2 vTexCoord;\n\nuniform sampler2D tTex;\nuniform vec2 uOffset;\nuniform vec2 uResolution;\nuniform vec2 uDirection;\nuniform float uStrength;\n\nvec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3333333333333333) * direction;\n  color += texture2D(image, uv) * 0.29411764705882354;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n  return color; \n}\n\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture2D(image, uv) * 0.1964825501511404;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n\nvoid main(void) {\n  gl_FragColor = blur13( tTex, vTexCoord, uResolution, uDirection );\n}\n"};d.toString=d,b.exports=d},{}],53:[function(a,b,c){var d=function(a){var b="";return b+="uniform float uStrength;\n\nvoid main() {\n  gl_FragColor = vec4( uStrength, uStrength, uStrength, 1.0 );\n}"};d.toString=d,b.exports=d},{}],54:[function(a,b,c){var d=function(a){var b="";return b+="\nvarying vec2 vTexCoord;\n\nuniform sampler2D tTex;\nuniform float uStrength;\n\nvoid main(void){\n  gl_FragColor.rgb = texture2D( tTex, vTexCoord ).rgb * uStrength;\n  gl_FragColor.a = 1.;\n  // gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n}\n"};d.toString=d,b.exports=d},{}],55:[function(a,b,c){var d=function(a){var b="";return b+="\nvarying vec2 vTexCoord;\n\nuniform float uTime;\nuniform float uOpacity;\nuniform vec2 uCenter;\nuniform vec3 uWaveParams;\nuniform sampler2D tTex;\n\nvoid main(void){\n  // uRatio;\n  vec2 uv = vec2( vTexCoord.x, vTexCoord.y );\n  vec3 color = texture2D( tTex, uv ).rgb;\n\n  //Sawtooth function to pulse from centre.\n  float offset = (uTime- floor(uTime))/uTime;\n\tfloat currentTime = (uTime)*(offset); \n\n  vec2 center = uCenter;\n  float distToCenter = distance(uv, uCenter);\n\n  //Only distort the pixels within the parameter distance from the centre\n  if ((distToCenter <= ((currentTime) + (uWaveParams.z))) && \n    (distToCenter >= ((currentTime) - (uWaveParams.z)))) \n    {\n      //The pixel offset distance based on the input parameters\n      float diff = (distToCenter - currentTime); \n      float scaleDiff = (1.0 - pow(abs(diff * uWaveParams.x), uWaveParams.y)); \n      float DiffTime = (diff  * scaleDiff);\n          \n      //The direction of the distortion\n      vec2 DiffTexCoord = normalize(uv - center);         \n          \n      //Perform the distortion and reduce the effect over time\n      uv += ((DiffTexCoord * DiffTime) / (currentTime * distToCenter * 40.0));\n      color = texture2D( tTex, uv ).rgb;\n          \n      //Blow out the color and reduce the effect over time\n      color += (color * scaleDiff) / (currentTime * distToCenter * 60.0);\n    } \n  \n  gl_FragColor.rgb = color;\n  gl_FragColor.a = uOpacity;\n\n}\n"};d.toString=d,b.exports=d},{}],56:[function(a,b,c){var d=function(b){var c="";return c+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\nuniform float uProgress;\nuniform float uTrailExtent;\nuniform float uGapScale;\nuniform float uGapOffset;\nuniform vec3 uColor;\nuniform float uTime;\nuniform float uBrightness;\nuniform float uContrast;\nuniform float uNoiseRamp;\nuniform float uUOffset;\nuniform float uBloomMode;\n\nIN vec2 vTexCoord;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  IN mediump vec3 vWorldTangent;\n  IN mediump vec3 vWorldBitangent;\n#endif\n\n\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  IN vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  "+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n// INCLUDES\n// =========\n\n"+a("nanogl-pbr/glsl/includes/ibl.glsl")()+"\n"+a("glsl/common/musgrave.glsl")+'\n\n\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\nfloat map(float value, float inMin, float inMax, float outMin, float outMax) {\n  return outMin + (outMax - outMin) * (value - inMin) / (inMax - inMin);\n}\n\nfloat brightnessContrast(float value, float brightness, float contrast) {\n    return (value - 0.5) * contrast + 0.5 + brightness;\n}\n\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  vec2 uvProgress   = vec2( 1.0 - (vTexCoord.x + uProgress + uUOffset), vTexCoord.y );\n  float trailLenght = 1. - (uTrailExtent + (uUOffset*30.));\n  float gap         = uNoiseRamp - snoise( vec3( (vTexCoord / uGapScale) + vec2( ( uGapOffset + uTime * 2.)), 1.0 ));\n  float gapContrasted = brightnessContrast(gap, uBrightness, uContrast);\n\n  #pragma SLOT f\n\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 diffuseCoef = vIrradiance;\n  #else\n    vec3 diffuseCoef = SampleSH(worldNormal, uSHCoeffs );\n  #endif\n\n\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n\n\n  #pragma SLOT lightsf\n\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n\n  #if HAS_cavity\n    #ifndef cavityStrength\n      #define cavityStrength(k) vec2(1.0)\n    #endif\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  \n\n  FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n\n\n  // #if HAS_exposure\n  //   FragColor.xyz *= vec3( exposure() );\n  // #endif\n\n  \n  // #if gammaMode( GAMMA_STD ) && HAS_gamma\n  //   FragColor.xyz = pow( FragColor.xyz, vec3( gamma() ) );\n  // #endif\n\n  // #if gammaMode( GAMMA_2_2 )\n  //   FragColor.xyz = pow( FragColor.xyz, vec3( 1.0/2.2 ) );\n  // #endif\n\n  // #if gammaMode( GAMMA_TB )\n  //   {\n  //     vec3 c = FragColor.xyz;\n  //     vec3 sqrtc = sqrt( c );\n  //     FragColor.xyz = (sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n  //   }\n  // #endif\n\n  float p = max( 0., gradient().r - 0.2 );\n\n  // FragColor.rgb = uColor*2.;//pow(uColor, vec3(4.));\n  FragColor.rgb = uColor;\n  // FragColor.rgb *= 8.;  // Hardcoded Exposure Adjustment\n  // FragColor.rgb = pow(FragColor.rgb,vec3(1./2.2));\n\n  if ( gradient().r < 1. - uTrailExtent ) {\n    discard;\n  }\n\n  // float opacity = map( gradient().r, trailLenght, 1., 0., 1. );\n  if ( uBloomMode == 1.0 ) {\n    FragColor.a = gapContrasted;\n    // FragColor.rgb = vec3(1.,0.,0.);\n  }\n  else {\n    FragColor.a = gap ;\n    // FragColor.rgb = vec3(0.,1.,0.);\n  }\n  // FragColor.rgb = vec3( gradient().r );\n  // FragColor.a = gapContrasted;\n  // FragColor.a = 1.0;\n\n}\n'};d.toString=d,b.exports=d},{"glsl/common/musgrave.glsl":42,"nanogl-pbr/glsl/includes/ibl.glsl":373,"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],57:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\n\nOUT vec2 vTexCoord;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 pos = vec4( aPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n}\n"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],58:[function(a,b,c){var d=function(b){var c="";return c+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\nuniform sampler2D tInnerTunnelTex;\nuniform vec2 uResolution;\nuniform float uBrightness;\nuniform float uContrast;\n\nIN vec2 vTexCoord;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  IN mediump vec3 vWorldTangent;\n  IN mediump vec3 vWorldBitangent;\n#endif\n\n\n\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  IN vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  "+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n// INCLUDES\n// =========\n\n"+a("nanogl-pbr/glsl/includes/ibl.glsl")()+"\n"+a("glsl/common/noise-3d.glsl")()+'\n\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\nfloat map(float value, float inMin, float inMax, float outMin, float outMax) {\n  return outMin + (outMax - outMin) * (value - inMin) / (inMax - inMin);\n}\n\nvec3 brightnessContrast(vec3 value, float brightness, float contrast) {\n    return (value - 0.5) * contrast + 0.5 + brightness;\n}\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 diffuseCoef = vIrradiance;\n  #else\n    vec3 diffuseCoef = SampleSH(worldNormal, uSHCoeffs );\n  #endif\n\n\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n\n\n  #pragma SLOT lightsf\n\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n\n  #if HAS_cavity\n    #ifndef cavityStrength\n      #define cavityStrength(k) vec2(1.0)\n    #endif\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n  FragColor.rgb = ( texture2D( tInnerTunnelTex, gl_FragCoord.xy/uResolution).rgb  ) + specularColor;\n  FragColor.rgb = brightnessContrast( FragColor.rgb, uBrightness, uContrast );\n\n\n  #if HAS_exposure\n    FragColor.xyz *= vec3( exposure() );\n  #endif\n\n  \n  #if gammaMode( GAMMA_STD ) && HAS_gamma\n    FragColor.xyz = pow( FragColor.xyz, vec3( gamma() ) );\n  #endif\n\n  #if gammaMode( GAMMA_2_2 )\n    FragColor.xyz = pow( FragColor.xyz, vec3( 1.0/2.2 ) );\n  #endif\n\n  #if gammaMode( GAMMA_TB )\n    {\n      vec3 c = FragColor.xyz;\n      vec3 sqrtc = sqrt( c );\n      FragColor.xyz = (sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n    }\n  #endif\n\n  \n  FragColor.a = 1.0;\n\n}'};d.toString=d,b.exports=d},{"glsl/common/noise-3d.glsl":43,"nanogl-pbr/glsl/includes/ibl.glsl":373,"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],59:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform float uNormalStrength;\n\nOUT vec2 vTexCoord;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 pos = vec4( aPosition, 1.0 );\n\n  pos.rgb += aNormal * uNormalStrength;\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n}"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],60:[function(a,b,c){var d=function(a){var b="";return b+="\nprecision lowp float;\n\nuniform sampler2D tBalls;\n\nvarying vec4  vTexCoord;\n\nvoid main( void ){\n  vec3  color = texture2D( tBalls, vTexCoord.xy ).rgb;\n  float alpha = texture2D( tBalls, vTexCoord.zw ).r;\n  gl_FragColor = vec4( color, alpha );\n}\n"};d.toString=d,b.exports=d},{}],61:[function(a,b,c){var d=function(a){var b="";return b+="\n\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\n\nuniform vec4 uXform;\nuniform vec2 uTexOffset;\n\nvarying vec4 vTexCoord;\n\n\nvoid main(void){\n\n  vec2 pos = aPosition * uXform.zw + uXform.xy;\n  gl_Position = vec4( pos, 1.0, 1.0 );\n\n  vec2 tc = .5*(aTexCoord * .95 + .025);\n  vTexCoord.xy = tc + uTexOffset;\n  vTexCoord.zw = tc + vec2( .5, .0 );\n\n}"};d.toString=d,b.exports=d},{}],62:[function(a,b,c){var d=function(b){var c="";return c+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\nuniform sampler2D tProbes;\nuniform vec4 uProbeOffsets;\nuniform float uProbeMix;\n\nIN vec2 vTexCoord;\nIN vec2 vTexCoord1;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\nIN mediump vec3 vScreenNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  IN mediump vec3 vWorldTangent;\n  IN mediump vec3 vWorldBitangent;\n#endif\n\n\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  IN vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  "+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n// INCLUDES\n// =========\n\n"+a("nanogl-pbr/glsl/includes/ibl.glsl")()+'\n\n\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 diffuseCoef = vIrradiance;\n  #else\n    vec3 diffuseCoef = SampleSH(worldNormal, uSHCoeffs );\n  #endif\n\n\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n\n\n  #pragma SLOT lightsf\n\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n\n\n  vec2 puvs = normalize( vScreenNormal ).xy * .0625 + .0625;\n\n  diffuseCoef += mix( \n    texture2D( tProbes, puvs + uProbeOffsets.xy ).rgb, \n    texture2D( tProbes, puvs + uProbeOffsets.zw ).rgb, \n    uProbeMix \n  );\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n\n  #if HAS_cavity\n    #ifndef cavityStrength\n      #define cavityStrength(k) vec2(1.0)\n    #endif\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  \n\n  FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n\n\n  #if HAS_exposure\n    FragColor.xyz *= vec3( exposure() );\n  #endif\n\n  \n  #if gammaMode( GAMMA_STD ) && HAS_gamma\n    FragColor.xyz = pow( FragColor.xyz, vec3( gamma() ) );\n  #endif\n\n  #if gammaMode( GAMMA_2_2 )\n    FragColor.xyz = pow( FragColor.xyz, vec3( 1.0/2.2 ) );\n  #endif\n\n  #if gammaMode( GAMMA_TB )\n    {\n      vec3 c = FragColor.xyz;\n      vec3 sqrtc = sqrt( c );\n      FragColor.xyz = (sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n    }\n  #endif\n\n\n\n\n  FragColor.a = 1.0;\n\n}'};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/ibl.glsl":373,"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],63:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec2 aTexCoord1;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform mat4 uViewMatrix;\n\nOUT vec2 vTexCoord;\nOUT vec2 vTexCoord1;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\nOUT mediump vec3 vScreenNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 pos = vec4( aPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n  vScreenNormal   = rotate( uViewMatrix, aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n  vTexCoord1 = aTexCoord1;\n}"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],64:[function(a,b,c){var d=function(b){var c="";return c+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\nuniform float uTrailProgress;\nuniform float uTrailExtent;\nuniform float uVOffset;\nuniform float uSmoothEdge;\nuniform float uGIOpacity;\nuniform float uBrightness;\nuniform float uContrast;\nuniform float uIntensity;\n\nIN vec2 vTexCoord;\nIN vec2 vTexCoord1;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  IN mediump vec3 vWorldTangent;\n  IN mediump vec3 vWorldBitangent;\n#endif\n\n\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  IN vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  "+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n// INCLUDES\n// =========\n\n"+a("nanogl-pbr/glsl/includes/ibl.glsl")()+'\n\n\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\nvec3 brightnessContrast(vec3 value, float brightness, float contrast) {\n    return (value - 0.5) * contrast + 0.5 + brightness;\n}\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  vec2 vTexCoord2 = vec2( vTexCoord.x, vTexCoord.y );\n  // vTexCoord2 = max( vec2(0.,0.), min( vTexCoord2, vec2(1.0) ) );\n\n  #pragma SLOT f\n\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n\n\n\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n\n\n  vec3 diffuseCoef = vec3(0.0);\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 ambientCoef = vIrradiance;\n  #else\n    vec3 ambientCoef = SampleSH(worldNormal, uSHCoeffs );\n  #endif\n\n  #pragma SLOT lightsf\n\n  diffuseCoef += ambientCoef;\n\n\n\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n\n  #if HAS_cavity\n    #ifndef cavityStrength\n      #define cavityStrength(k) vec2(1.0)\n    #endif\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  \n  \n  #if HAS_lightmap && enableGI\n    #if HAS_albedoAttenuation\n      diffuseCoef *= albedoAttenuation();\n    #endif\n    diffuseCoef  += lightmap();\n  #endif\n\n  FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n\n\n  #if HAS_exposure\n    FragColor.xyz *= vec3( exposure() );\n  #endif\n\n  \n  #if gammaMode( GAMMA_STD ) && HAS_gamma\n    FragColor.xyz = pow( FragColor.xyz, vec3( gamma() ) );\n  #endif\n\n  #if gammaMode( GAMMA_2_2 )\n    FragColor.xyz = pow( FragColor.xyz, vec3( 1.0/2.2 ) );\n  #endif\n\n  #if gammaMode( GAMMA_TB )\n    {\n      vec3 c = FragColor.xyz;\n      vec3 sqrtc = sqrt( c );\n      FragColor.xyz = (sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n    }\n  #endif\n\n  vec3 trailGIColor = brightnessContrast( aquarelleGI().rgb, uBrightness, uContrast );//aquarelleGI().rgb;\n  vec3 normalPanel = FragColor.rgb;\n\n  float maskMask = 1. - step( 1.0 - uTrailExtent, gradient().r );\n\n  float headMask = smoothstep( uTrailProgress, uTrailProgress - uSmoothEdge, gradient().r ) * (1.-maskMask);\n  float tailMask = smoothstep( uTrailProgress - uTrailExtent, uTrailProgress - uTrailExtent + uSmoothEdge, gradient().r );\n  float progressMask = tailMask * headMask;\n\n  // FragColor.rgb = mix( normalPanel, trailGIColor, headMask * tailMask );\n  FragColor.rgb = mix( normalPanel, trailGIColor, progressMask * uIntensity  );\n\n  // FragColor.rgb = gradient();\n  // FragColor.rgb = trailGIColor;\n\n  FragColor.a = 1.0;\n\n}'};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/ibl.glsl":373,"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],65:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec2 aTexCoord1;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\n\nuniform float uTrailProgress;\nuniform float uTrailExtent;\nuniform float uVOffset;\nuniform float uSmoothEdge;\nuniform float uGIOpacity;\nuniform float uBrightness;\nuniform float uContrast;\nuniform float uIntensity;\n\nOUT vec2 vTexCoord;\nOUT vec2 vTexCoord1;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  float maskMask = 1. - step( 1.0 - uTrailExtent, aTexCoord.y );\n  float progress = 1.0 - uTrailProgress;\n\n  float headMask = smoothstep( progress, progress - uSmoothEdge, aTexCoord.y ) * (1.-maskMask);\n  float tailMask = smoothstep( progress - uTrailExtent, progress - uTrailExtent + uSmoothEdge, aTexCoord.y );\n  float progressMask = tailMask * headMask;\n\n  vec3 newPos = aPosition + abs(aNormal) * progressMask * .05;\n\n\n  vec4 pos = vec4( aPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n\n  #if HAS_uvScale\n    vTexCoord *= uvScale();\n  #endif\n\n  #if HAS_uvOffset\n    vTexCoord += uvOffset();\n  #endif\n\n  vTexCoord1 = aTexCoord1;\n}"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],66:[function(a,b,c){var d=function(b){var c=""
;return c+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\n// uniform float uTrailProgress;\nuniform float uTrailExtent;\nuniform float uVOffset;\nuniform float uSmoothEdge;\n\nIN vec2 vTexCoord;\nIN vec2 vTexCoord1;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  IN mediump vec3 vWorldTangent;\n  IN mediump vec3 vWorldBitangent;\n#endif\n\n\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  IN vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  "+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n// INCLUDES\n// =========\n\n"+a("nanogl-pbr/glsl/includes/ibl.glsl")()+'\n\n\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  vec2 vTexCoord2 = vec2( vTexCoord.x, vTexCoord.y + uVOffset );\n\n  #pragma SLOT f\n\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n\n\n\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n\n\n  vec3 diffuseCoef = vec3(0.0);\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 ambientCoef = vIrradiance;\n  #else\n    vec3 ambientCoef = SampleSH(worldNormal, uSHCoeffs );\n  #endif\n\n  #pragma SLOT lightsf\n\n  diffuseCoef += ambientCoef;\n\n\n\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n\n  #if HAS_cavity\n    #ifndef cavityStrength\n      #define cavityStrength(k) vec2(1.0)\n    #endif\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  \n  \n  #if HAS_lightmap && enableGI\n    #if HAS_albedoAttenuation\n      diffuseCoef *= albedoAttenuation();\n    #endif\n    diffuseCoef  += lightmap();\n  #endif\n\n  FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n\n\n  #if HAS_exposure\n    FragColor.xyz *= vec3( exposure() );\n  #endif\n\n  #if gammaMode( GAMMA_STD ) && HAS_gamma\n    FragColor.xyz = pow( FragColor.xyz, vec3( gamma() ) );\n  #endif\n\n  #if gammaMode( GAMMA_2_2 )\n    FragColor.xyz = pow( FragColor.xyz, vec3( 1.0/2.2 ) );\n  #endif\n\n  #if gammaMode( GAMMA_TB )\n    {\n      vec3 c = FragColor.xyz;\n      vec3 sqrtc = sqrt( c );\n      FragColor.xyz = (sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n    }\n  #endif\n\n  vec3 trailGIColor = woodGI().rgb;\n  vec3 normalWood = FragColor.rgb;\n\n  float maskMask = 1. - step( 1.0 - uTrailExtent, gradient().r );\n\n  float headMask = smoothstep( 1.0, 1.0 - uSmoothEdge, gradient().r ) * (1.-maskMask);\n  float tailMask = smoothstep( 1.0 - uTrailExtent, 1.0 - uTrailExtent + uSmoothEdge, gradient().r );\n  float progressMask = headMask * tailMask;\n\n  FragColor.rgb = mix( normalWood, trailGIColor, progressMask );\n  // FragColor.rgb = vec3( tailMask * headMask );\n  // FragColor.rgb = gradient().rgb;\n\n  // uTrailProgress;\n  // uTrailExtent;\n\n\n  FragColor.a = 1.0;\n\n}\n'};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/ibl.glsl":373,"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],67:[function(a,b,c){var d=function(b){var c="";return c+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\n\nIN vec2 vTexCoord;\nIN vec2 vTexCoord1;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  IN mediump vec3 vWorldTangent;\n  IN mediump vec3 vWorldBitangent;\n#endif\n\n\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  IN vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  "+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n// INCLUDES\n// =========\n\n"+a("nanogl-pbr/glsl/includes/ibl.glsl")()+'\n\n\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n\n\n\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n\n\n  vec3 diffuseCoef = vec3(0.0);\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 ambientCoef = vIrradiance;\n  #else\n    vec3 ambientCoef = SampleSH(worldNormal, uSHCoeffs );\n  #endif\n\n  #pragma SLOT lightsf\n\n  diffuseCoef += ambientCoef;\n\n\n\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n\n  #if HAS_cavity\n    #ifndef cavityStrength\n      #define cavityStrength(k) vec2(1.0)\n    #endif\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  \n  \n  #if HAS_lightmap && enableGI\n    #if HAS_albedoAttenuation\n      diffuseCoef *= albedoAttenuation();\n    #endif\n    diffuseCoef  += lightmap();\n  #endif\n\n  FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n\n\n  #if HAS_exposure\n    FragColor.xyz *= vec3( exposure() );\n  #endif\n\n  \n  #if gammaMode( GAMMA_STD ) && HAS_gamma\n    FragColor.xyz = pow( FragColor.xyz, vec3( gamma() ) );\n  #endif\n\n  #if gammaMode( GAMMA_2_2 )\n    FragColor.xyz = pow( FragColor.xyz, vec3( 1.0/2.2 ) );\n  #endif\n\n  #if gammaMode( GAMMA_TB )\n    {\n      vec3 c = FragColor.xyz;\n      vec3 sqrtc = sqrt( c );\n      FragColor.xyz = (sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n    }\n  #endif\n\n\n\n\n  FragColor.a = 1.0;\n\n}'};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/ibl.glsl":373,"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],68:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec2 aTexCoord1;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform vec3 uBallPosition;\n\nOUT vec2 vTexCoord;\nOUT vec2 vTexCoord1;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 pos = vec4( aPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n\n  #if HAS_uvScale\n    vTexCoord *= uvScale();\n  #endif\n\n  #if HAS_uvOffset\n    vTexCoord += uvOffset();\n  #endif\n\n  vTexCoord1 = aTexCoord1;\n}"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],69:[function(a,b,c){var d=function(a){var b="";return b+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\n\nIN vec2 vTexCoord;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n\n\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n\n  // -----------\n  vec3 worldNormal = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    \n  worldNormal = normalize( worldNormal );\n\n\n\n  // IBL reflexion\n  // --------------\n\n\n  float shcatcher_att = 1.0;\n\n  #pragma SLOT lightsf\n\n\n\n  #if HAS_occlusion\n    shcatcher_att *= occlusion();\n  #endif\n\n\n\n\n\n  FragColor = vec4( vec3(shcatcher_att), 1.0 );\n\n}"};d.toString=d,b.exports=d},{}],70:[function(a,b,c){var d=function(a){var b="";return b+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\n\nOUT vec2 vTexCoord;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 pos = vec4( aPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n\n\n  vTexCoord = aTexCoord;\n}"};d.toString=d,b.exports=d},{}],71:[function(a,b,c){var d=function(a){var b="";return b+="// --------- SPEC\n{\n\n\n  ",a.shadowIndex>-1&&(b+="\n  {\n    vec3 fragCoord = calcShadowPosition( uShadowTexelBiasVector["+a.shadowIndex+"], uShadowMatrices["+a.shadowIndex+"] , vWorldPosition, worldNormal, uShadowMapSize["+a.shadowIndex+"].y );\n    float shOccl = calcLightOcclusions(tShadowMap"+a.shadowIndex+",fragCoord,uShadowMapSize["+a.shadowIndex+"]);\n    shcatcher_att *= (1.0-uShadowStrength) + uShadowStrength*shOccl;\n  }\n  "),b+="\n\n\n}"};d.toString=d,b.exports=d},{}],72:[function(a,b,c){var d=function(a){var b="";return b+="#define NUM_D_LIGHTS "+a.count+"\n\n",a.count>0&&(b+="\n// uniform vec3 uLDirDirections [NUM_D_LIGHTS];\n// uniform vec4 uLDirColors     [NUM_D_LIGHTS]; // rgb + iblShadowing\n"),b+="\n\n"};d.toString=d,b.exports=d},{}],73:[function(a,b,c){var d=function(a){var b="";return b+="{\n\n  // vec3 lightDir= uLPointPositions["+a.index+"] - vWorldPosition;\n  // float invLightDist=inversesqrt(dot(lightDir,lightDir));\n  // lightDir *= invLightDist;\n\n  // // spot effect\n  // float falloff = saturate( uLPointFalloff["+a.index+"].z / invLightDist );\n  // falloff = 1.0 + falloff * ( uLPointFalloff["+a.index+"].x + uLPointFalloff["+a.index+"].y * falloff );\n\n  // vec3 lightContrib = falloff * uLPointColors["+a.index+"].rgb;\n\n\n  // // --------- SPEC\n  // vec3 H = normalize( lightDir + viewDir );\n  // float NoH = sdot( H,worldNormal );\n  // float sContrib = specularMul * pow( NoH, roughness );\n  // // -------- DIFFUSE\n  // float dContrib = (1.0/3.141592) * sdot( lightDir, worldNormal );\n\n  // diffuseCoef   += dContrib * lightContrib;\n  // LS_SPECULAR   += sContrib  * lightContrib;\n\n  // specularColor *= 0.0;\n\n}"};d.toString=d,b.exports=d},{}],74:[function(a,b,c){var d=function(a){var b="";return b+="#define NUM_P_LIGHTS "+a.count+"\n\n",a.count>0&&(b+="\n// uniform vec3 uLPointPositions  [NUM_P_LIGHTS];\n// uniform vec3 uLPointFalloff    [NUM_P_LIGHTS];\n// uniform vec3 uLPointColors     [NUM_P_LIGHTS]; // rgb\n"),b+="\n\n"};d.toString=d,b.exports=d},{}],75:[function(a,b,c){var d=function(a){var b="";return b+="\n// post light setup\n\n//specularColor += lSpecularColor * specular()*specular();"};d.toString=d,b.exports=d},{}],76:[function(a,b,c){var d=function(a){var b="";return b+="\n"};d.toString=d,b.exports=d},{}],77:[function(a,b,c){var d=function(a){var b="";b+="\n\n#define SHADOW_COUNT "+a.shadowCount+"\n\n#if __VERSION__ == 300\n  precision lowp sampler2DShadow;\n\n  #define DepthSampler sampler2DShadow\n  \n#else\n  #define DepthSampler sampler2D\n#endif\n\n\n";for(var c=0;c<a.shadowCount;c++)b+="\n  uniform DepthSampler tShadowMap"+c+";\n";return b+="\n\n\n\n\nuniform highp vec2 uShadowKernelRotation;\nuniform highp mat4 uShadowMatrices[SHADOW_COUNT];\nuniform highp vec4 uShadowTexelBiasVector[SHADOW_COUNT];\nuniform       vec2 uShadowMapSize[SHADOW_COUNT];\n\nuniform float uShadowStrength;\n\n\n// RGB depth decoding\n// ------------------\nhighp float decodeDepthRGB(highp vec3 rgb){\n  return(rgb.x+rgb.y*(1.0/255.0))+rgb.z*(1.0/65025.0);\n}\n\n\n#if __VERSION__ == 300\n  \n      \n  float textureShadow( DepthSampler t, float ref, vec2 uvs ){\n    return texture(t, vec3( uvs, ref ) );\n  }\n\n  vec2 textureShadow( DepthSampler t, float ref, vec4 uvs ){\n    \n    return vec2(\n      texture(t, vec3( uvs.xy, ref ) ),\n      texture(t, vec3( uvs.zw, ref ) )\n    );\n\n  }\n\n  vec4 textureShadow( DepthSampler t, float ref, vec4 uvs0, vec4 uvs1 ){\n    \n    return vec4(\n      texture(t, vec3( uvs0.xy, ref ) ),\n      texture(t, vec3( uvs0.zw, ref ) ),\n      texture(t, vec3( uvs1.xy, ref ) ),\n      texture(t, vec3( uvs1.zw, ref ) )\n    );\n\n  }\n\n\n\n#else\n\n\n\n  #if depthFormat( D_RGB )\n    float FETCH_DEPTH( DepthSampler t, vec2 uvs ){\n      return decodeDepthRGB( texture2D(t,uvs).xyz );\n    }\n    //define FETCH_DEPTH(t,uvs) decodeDepthRGB( texture2D(t,uvs).xyz )\n  #endif\n\n  #if depthFormat( D_DEPTH )\n    float FETCH_DEPTH( DepthSampler t, vec2 uvs ){\n      return texture2D(t,uvs).x;\n    }\n    //define FETCH_DEPTH(t,uvs) texture2D(t,uvs).x\n  #endif\n\n  \n  float textureShadow( DepthSampler t, float ref, vec2 uvs ){\n    return step( ref, FETCH_DEPTH(t,uvs));\n  }\n\n  vec2 textureShadow( DepthSampler t, float ref, vec4 uvs ){\n    \n    vec2 occl = vec2(\n      FETCH_DEPTH(t,uvs.xy),\n      FETCH_DEPTH(t,uvs.zw)\n    );\n\n    return step( vec2(ref), occl );\n  }\n\n  vec4 textureShadow( DepthSampler t, float ref, vec4 uvs0, vec4 uvs1 ){\n    \n    vec4 occl = vec4(\n      FETCH_DEPTH(t,uvs0.xy),\n      FETCH_DEPTH(t,uvs0.zw),\n      FETCH_DEPTH(t,uvs1.xy),\n      FETCH_DEPTH(t,uvs1.zw)\n    );\n\n    return step( vec4(ref), occl );\n  }\n\n#endif\n\n\n\n\n\n\n\nfloat resolveShadowNoFiltering(highp float fragZ, DepthSampler depth,highp vec2 uv ){\n    return textureShadow( depth, fragZ, uv );\n}\n\n\n#if __VERSION__ == 300\n  // Bilinear is natively supported in ES3\n  // Shadowmap filtering must be set by sampler2DShadow filter parameter\n\n  float resolveShadow2x1(highp float fragZ, DepthSampler depth,highp vec2 uv, vec2 mapSize ){\n    return textureShadow( depth, fragZ, uv );\n  }\n\n  float resolveShadow2x2(highp float fragZ, DepthSampler depth,highp vec2 uv, vec2 mapSize ){\n    return textureShadow( depth, fragZ, uv );\n  }\n\n#else\n\n  float resolveShadow2x1(highp float fragZ, DepthSampler depth,highp vec2 uv, vec2 mapSize ){\n\n    highp float coordsPx = uv.x*mapSize.x;\n    highp float uvMin = floor( coordsPx ) * mapSize.y;\n    highp float uvMax = ceil(  coordsPx ) * mapSize.y;\n\n    vec2 occl = textureShadow( depth, fragZ, vec4(\n      uvMin,uv.y,\n      uvMax,uv.y\n    ));\n\n    highp float ratio = coordsPx - uvMin*mapSize.x;\n    return ( ratio * occl.y + occl.x ) - ratio * occl.x;\n\n  }\n\n  float resolveShadow2x2(highp float fragZ, DepthSampler depth,highp vec2 uv, vec2 mapSize ){\n\n    highp vec2 coordsPx = uv*mapSize.x;\n    highp vec2 uvMin=floor( coordsPx ) *mapSize.y;\n    highp vec2 uvMax=ceil(  coordsPx ) *mapSize.y;\n\n    vec4 occl = textureShadow( depth, fragZ, \n      vec4(\n        uvMin,\n        vec2(uvMax.x,uvMin.y)\n      ),\n      vec4(\n        vec2(uvMin.x,uvMax.y),\n        uvMax\n      )\n    );\n\n    highp vec2 ratio = coordsPx - uvMin*mapSize.x;\n    vec2  t = ( ratio.y * occl.zw + occl.xy ) - ratio.y * occl.xy;\n\n    return(ratio.x*t.y+t.x)-ratio.x*t.x;\n  }\n\n#endif\n\n\nfloat calcLightOcclusions(DepthSampler depth, highp vec3 fragCoord, vec2 mapSize ){\n  float s;\n\n  highp vec2 kernelOffset = uShadowKernelRotation * mapSize.y;\n\n  // NO FILTER\n  #if shadowFilter( PCFNONE )\n\n    s = resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy );\n  #endif\n\n  // PCF4x1\n  #if shadowFilter( PCF4x1 )\n\n    s = resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy + kernelOffset                    );\n    s+= resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy - kernelOffset                    );\n    s+= resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy + vec2(-kernelOffset.y,kernelOffset.x)  );\n    s+= resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy + vec2(kernelOffset.y,-kernelOffset.x)  );\n    s /= 4.0;\n  #endif\n\n  // PCF4x4\n  #if shadowFilter( PCF4x4 )\n\n    s = resolveShadow2x2( fragCoord.z, depth, fragCoord.xy + kernelOffset                         , mapSize );\n    s+= resolveShadow2x2( fragCoord.z, depth, fragCoord.xy - kernelOffset                         , mapSize );\n    s+= resolveShadow2x2( fragCoord.z, depth, fragCoord.xy + vec2(-kernelOffset.y,kernelOffset.x) , mapSize );\n    s+= resolveShadow2x2( fragCoord.z, depth, fragCoord.xy + vec2(kernelOffset.y,-kernelOffset.x) , mapSize );\n    s /= 4.0;\n  #endif\n\n  // PCF2x2\n  #if shadowFilter( PCF2x2 )\n\n    s = resolveShadow2x1( fragCoord.z, depth, fragCoord.xy + kernelOffset , mapSize);\n    s+= resolveShadow2x1( fragCoord.z, depth, fragCoord.xy - kernelOffset , mapSize);\n    s /= 2.0;\n  #endif\n\n\n  return s;\n\n}\n\n\n\nvec3 calcShadowPosition( vec4 texelBiasVector, mat4 shadowProjection, vec3 worldPos, vec3 worldNormal, float invMapSize )\n{\n  float WoP = dot( texelBiasVector, vec4( worldPos, 1.0 ) );\n\n  WoP *= .0005+2.0*invMapSize;\n\n  highp vec4 fragCoord = shadowProjection * vec4( worldPos + WoP * worldNormal, 1.0);\n  return fragCoord.xyz / fragCoord.w;\n}\n\n\n"};d.toString=d,b.exports=d},{}],78:[function(a,b,c){var d=function(a){var b="";return b+="{\n\n  ",a.shadowIndex>-1&&(b+="\n  {\n    vec3 fragCoord = calcShadowPosition( uShadowTexelBiasVector["+a.shadowIndex+"], uShadowMatrices["+a.shadowIndex+"] , vWorldPosition, worldNormal, uShadowMapSize["+a.shadowIndex+"].y );\n    float shOccl = calcLightOcclusions(tShadowMap"+a.shadowIndex+",fragCoord,uShadowMapSize["+a.shadowIndex+"]);\n    shcatcher_att *= .5 + .5*shOccl;\n  }\n  "),b+="\n\n}"};d.toString=d,b.exports=d},{}],79:[function(a,b,c){var d=function(a){var b="";return b+="#define NUM_S_LIGHTS "+a.count+"\n\n",a.count>0&&(b+="\n// uniform vec3 uLSpotPositions  [NUM_S_LIGHTS];\n// uniform vec3 uLSpotFalloff    [NUM_S_LIGHTS];\n// uniform vec2 uLSpotSpot       [NUM_S_LIGHTS];\n// uniform vec3 uLSpotDirections [NUM_S_LIGHTS];\n// uniform vec4 uLSpotColors     [NUM_S_LIGHTS]; // rgb + iblShadowing\n"),b+="\n\n"};d.toString=d,b.exports=d},{}],80:[function(a,b,c){var d=function(a){var b="";return b+="// --------- SPEC\n{\n\n  vec3 H = normalize( uLDirDirections["+a.index+"] + viewDir );\n  float NoH = sdot( H,worldNormal );\n  float sContib = specularMul * pow( NoH, roughness );\n  // -------- DIFFUSE\n  float dContrib = (1.0/3.141592) * sdot( uLDirDirections["+a.index+"] ,worldNormal );\n\n  #if receiveShadows\n  ",a.shadowIndex>-1&&(b+="\n  {\n    vec3 fragCoord = calcShadowPosition( uShadowTexelBiasVector["+a.shadowIndex+"], uShadowMatrices["+a.shadowIndex+"] , vWorldPosition, worldNormal, uShadowMapSize["+a.shadowIndex+"].y );\n    float shOccl = calcLightOcclusions(tShadowMap"+a.shadowIndex+",fragCoord,uShadowMapSize["+a.shadowIndex+"]);\n    dContrib *= shOccl;\n    sContib  *= shOccl;\n\n    #if enableGI\n      ambientCoef *= shOccl;\n    #endif\n    \n    #if iblShadowing\n      float sDamp = uLDirColors["+a.index+"].a;\n      specularColor *= mix( sDamp, 1.0, shOccl );\n    #endif\n  }\n  "),b+="\n  #endif\n\n\n  diffuseCoef   += dContrib * uLDirColors["+a.index+"].rgb;\n  LS_SPECULAR   += sContib  * uLDirColors["+a.index+"].rgb;\n\n}"};d.toString=d,b.exports=d},{}],81:[function(a,b,c){var d=function(a){var b="";return b+="#define NUM_D_LIGHTS "+a.count+"\n\n",a.count>0&&(b+="\nuniform vec3 uLDirDirections [NUM_D_LIGHTS];\nuniform vec4 uLDirColors     [NUM_D_LIGHTS]; // rgb + iblShadowing\n"),b+="\n\n"};d.toString=d,b.exports=d},{}],82:[function(a,b,c){var d=function(a){var b="";return b+="{\n\n  vec3 lightDir= uLPointPositions["+a.index+"] - vWorldPosition;\n  float invLightDist=inversesqrt(dot(lightDir,lightDir));\n  lightDir *= invLightDist;\n\n  // spot effect\n  float falloff = saturate( uLPointFalloff["+a.index+"].z / invLightDist );\n  falloff = 1.0 + falloff * ( uLPointFalloff["+a.index+"].x + uLPointFalloff["+a.index+"].y * falloff );\n\n  vec3 lightContrib = falloff * uLPointColors["+a.index+"].rgb;\n\n\n  // --------- SPEC\n  vec3 H = normalize( lightDir + viewDir );\n  float NoH = sdot( H,worldNormal );\n  float sContrib = specularMul * pow( NoH, roughness );\n  // -------- DIFFUSE\n  float dContrib = (1.0/3.141592) * sdot( lightDir, worldNormal );\n\n  diffuseCoef   += dContrib * lightContrib;\n  LS_SPECULAR   += sContrib  * lightContrib;\n\n  // specularColor *= 0.0;\n\n}"};d.toString=d,b.exports=d},{}],83:[function(a,b,c){var d=function(a){var b="";return b+="#define NUM_P_LIGHTS "+a.count+"\n\n",a.count>0&&(b+="\nuniform vec3 uLPointPositions  [NUM_P_LIGHTS];\nuniform vec3 uLPointFalloff    [NUM_P_LIGHTS];\nuniform vec3 uLPointColors     [NUM_P_LIGHTS]; // rgb\n"),b+="\n\n"};d.toString=d,b.exports=d},{}],84:[function(a,b,c){var d=function(a){var b="";return b+="\n// post light setup\n\nspecularColor += lSpecularColor * specular()*specular();"};d.toString=d,b.exports=d},{}],85:[function(a,b,c){var d=function(a){var b="";return b+="\nhighp float roughness = -10.0 / log2( gloss()*0.968+0.03 );\nroughness *= roughness;\nfloat specularMul = roughness * (0.125/3.141592) + 0.5/3.141592;\n\n\nvec3 lSpecularColor = vec3(0.0);\n#define LS_SPECULAR lSpecularColor"};d.toString=d,b.exports=d},{}],86:[function(a,b,c){var d=function(a){var b="";b+="\n\n#define SHADOW_COUNT "+a.shadowCount+"\n\n#if __VERSION__ == 300\n  precision lowp sampler2DShadow;\n\n  #define DepthSampler sampler2DShadow\n  \n#else\n  #define DepthSampler sampler2D\n#endif\n\n\n";for(var c=0;c<a.shadowCount;c++)b+="\n  uniform DepthSampler tShadowMap"+c+";\n";return b+="\n\n\n\n\nuniform highp vec2 uShadowKernelRotation;\nuniform highp mat4 uShadowMatrices[SHADOW_COUNT];\nuniform highp vec4 uShadowTexelBiasVector[SHADOW_COUNT];\nuniform       vec2 uShadowMapSize[SHADOW_COUNT];\n\n\n// RGB depth decoding\n// ------------------\nhighp float decodeDepthRGB(highp vec3 rgb){\n  return(rgb.x+rgb.y*(1.0/255.0))+rgb.z*(1.0/65025.0);\n}\n\n\n#if __VERSION__ == 300\n  \n      \n  float textureShadow( DepthSampler t, float ref, vec2 uvs ){\n    return texture(t, vec3( uvs, ref ) );\n  }\n\n  vec2 textureShadow( DepthSampler t, float ref, vec4 uvs ){\n    \n    return vec2(\n      texture(t, vec3( uvs.xy, ref ) ),\n      texture(t, vec3( uvs.zw, ref ) )\n    );\n\n  }\n\n  vec4 textureShadow( DepthSampler t, float ref, vec4 uvs0, vec4 uvs1 ){\n    \n    return vec4(\n      texture(t, vec3( uvs0.xy, ref ) ),\n      texture(t, vec3( uvs0.zw, ref ) ),\n      texture(t, vec3( uvs1.xy, ref ) ),\n      texture(t, vec3( uvs1.zw, ref ) )\n    );\n\n  }\n\n\n\n#else\n\n\n\n  #if depthFormat( D_RGB )\n    float FETCH_DEPTH( DepthSampler t, vec2 uvs ){\n      return decodeDepthRGB( texture2D(t,uvs).xyz );\n    }\n    //define FETCH_DEPTH(t,uvs) decodeDepthRGB( texture2D(t,uvs).xyz )\n  #endif\n\n  #if depthFormat( D_DEPTH )\n    float FETCH_DEPTH( DepthSampler t, vec2 uvs ){\n      return texture2D(t,uvs).x;\n    }\n    //define FETCH_DEPTH(t,uvs) texture2D(t,uvs).x\n  #endif\n\n  \n  float textureShadow( DepthSampler t, float ref, vec2 uvs ){\n    return step( ref, FETCH_DEPTH(t,uvs));\n  }\n\n  vec2 textureShadow( DepthSampler t, float ref, vec4 uvs ){\n    \n    vec2 occl = vec2(\n      FETCH_DEPTH(t,uvs.xy),\n      FETCH_DEPTH(t,uvs.zw)\n    );\n\n    return step( vec2(ref), occl );\n  }\n\n  vec4 textureShadow( DepthSampler t, float ref, vec4 uvs0, vec4 uvs1 ){\n    \n    vec4 occl = vec4(\n      FETCH_DEPTH(t,uvs0.xy),\n      FETCH_DEPTH(t,uvs0.zw),\n      FETCH_DEPTH(t,uvs1.xy),\n      FETCH_DEPTH(t,uvs1.zw)\n    );\n\n    return step( vec4(ref), occl );\n  }\n\n#endif\n\n\n\n\n\n\n\nfloat resolveShadowNoFiltering(highp float fragZ, DepthSampler depth,highp vec2 uv ){\n    return textureShadow( depth, fragZ, uv );\n}\n\n\n#if __VERSION__ == 300\n  // Bilinear is natively supported in ES3\n  // Shadowmap filtering must be set by sampler2DShadow filter parameter\n\n  float resolveShadow2x1(highp float fragZ, DepthSampler depth,highp vec2 uv, vec2 mapSize ){\n    return textureShadow( depth, fragZ, uv );\n  }\n\n  float resolveShadow2x2(highp float fragZ, DepthSampler depth,highp vec2 uv, vec2 mapSize ){\n    return textureShadow( depth, fragZ, uv );\n  }\n\n#else\n\n  float resolveShadow2x1(highp float fragZ, DepthSampler depth,highp vec2 uv, vec2 mapSize ){\n\n    highp float coordsPx = uv.x*mapSize.x;\n    highp float uvMin = floor( coordsPx ) * mapSize.y;\n    highp float uvMax = ceil(  coordsPx ) * mapSize.y;\n\n    vec2 occl = textureShadow( depth, fragZ, vec4(\n      uvMin,uv.y,\n      uvMax,uv.y\n    ));\n\n    highp float ratio = coordsPx - uvMin*mapSize.x;\n    return ( ratio * occl.y + occl.x ) - ratio * occl.x;\n\n  }\n\n  float resolveShadow2x2(highp float fragZ, DepthSampler depth,highp vec2 uv, vec2 mapSize ){\n\n    highp vec2 coordsPx = uv*mapSize.x;\n    highp vec2 uvMin=floor( coordsPx ) *mapSize.y;\n    highp vec2 uvMax=ceil(  coordsPx ) *mapSize.y;\n\n    vec4 occl = textureShadow( depth, fragZ, \n      vec4(\n        uvMin,\n        vec2(uvMax.x,uvMin.y)\n      ),\n      vec4(\n        vec2(uvMin.x,uvMax.y),\n        uvMax\n      )\n    );\n\n    highp vec2 ratio = coordsPx - uvMin*mapSize.x;\n    vec2  t = ( ratio.y * occl.zw + occl.xy ) - ratio.y * occl.xy;\n\n    return(ratio.x*t.y+t.x)-ratio.x*t.x;\n  }\n\n#endif\n\n\nfloat calcLightOcclusions(DepthSampler depth, highp vec3 fragCoord, vec2 mapSize ){\n  float s;\n\n  highp vec2 kernelOffset = uShadowKernelRotation * mapSize.y;\n\n  // NO FILTER\n  #if shadowFilter( PCFNONE )\n\n    s = resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy );\n  #endif\n\n  // PCF4x1\n  #if shadowFilter( PCF4x1 )\n\n    s = resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy + kernelOffset                    );\n    s+= resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy - kernelOffset                    );\n    s+= resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy + vec2(-kernelOffset.y,kernelOffset.x)  );\n    s+= resolveShadowNoFiltering( fragCoord.z, depth, fragCoord.xy + vec2(kernelOffset.y,-kernelOffset.x)  );\n    s /= 4.0;\n  #endif\n\n  // PCF4x4\n  #if shadowFilter( PCF4x4 )\n\n    s = resolveShadow2x2( fragCoord.z, depth, fragCoord.xy + kernelOffset                         , mapSize );\n    s+= resolveShadow2x2( fragCoord.z, depth, fragCoord.xy - kernelOffset                         , mapSize );\n    s+= resolveShadow2x2( fragCoord.z, depth, fragCoord.xy + vec2(-kernelOffset.y,kernelOffset.x) , mapSize );\n    s+= resolveShadow2x2( fragCoord.z, depth, fragCoord.xy + vec2(kernelOffset.y,-kernelOffset.x) , mapSize );\n    s /= 4.0;\n  #endif\n\n  // PCF2x2\n  #if shadowFilter( PCF2x2 )\n\n    s = resolveShadow2x1( fragCoord.z, depth, fragCoord.xy + kernelOffset , mapSize);\n    s+= resolveShadow2x1( fragCoord.z, depth, fragCoord.xy - kernelOffset , mapSize);\n    s /= 2.0;\n  #endif\n\n\n  return s;\n\n}\n\n\n\nvec3 calcShadowPosition( vec4 texelBiasVector, mat4 shadowProjection, vec3 worldPos, vec3 worldNormal, float invMapSize )\n{\n  float WoP = dot( texelBiasVector, vec4( worldPos, 1.0 ) );\n\n  WoP *= .0005+2.0*invMapSize;\n\n  highp vec4 fragCoord = shadowProjection * vec4( worldPos + WoP * worldNormal, 1.0);\n  return fragCoord.xyz / fragCoord.w;\n}\n\n\n"};d.toString=d,b.exports=d},{}],87:[function(a,b,c){var d=function(a){var b=""
;return b+="{\n\n  vec3 lightDir= uLSpotPositions["+a.index+"] - vWorldPosition;\n  float invLightDist=inversesqrt(dot(lightDir,lightDir));\n  lightDir *= invLightDist;\n\n  // spot effect\n  float falloff = saturate( uLSpotFalloff["+a.index+"].z / invLightDist );\n  falloff = 1.0 + falloff * ( uLSpotFalloff["+a.index+"].x + uLSpotFalloff["+a.index+"].y * falloff );\n\n  float s = saturate( dot( lightDir, uLSpotDirections["+a.index+"] ) );\n  s = saturate( uLSpotSpot["+a.index+"].x-uLSpotSpot["+a.index+"].y * (1.0-s*s) );\n\n  vec3 lightContrib = (falloff *s ) * uLSpotColors["+a.index+"].rgb;\n\n\n  // --------- SPEC\n  vec3 H = normalize( lightDir + viewDir );\n  float NoH = sdot( H,worldNormal );\n  float sContrib = specularMul * pow( NoH, roughness );\n  // -------- DIFFUSE\n  float dContrib = (1.0/3.141592) * sdot( lightDir, worldNormal );\n\n  ",a.shadowIndex>-1&&(b+="\n  {\n    vec3 fragCoord = calcShadowPosition( uShadowTexelBiasVector["+a.shadowIndex+"], uShadowMatrices["+a.shadowIndex+"] , vWorldPosition, worldNormal, uShadowMapSize["+a.shadowIndex+"].y );\n    float shOccl = calcLightOcclusions(tShadowMap"+a.shadowIndex+",fragCoord,uShadowMapSize["+a.shadowIndex+"]);\n    dContrib *= shOccl;\n    sContrib  *= shOccl;\n\n    #if iblShadowing\n      float sDamp = uLSpotColors["+a.index+"].a;\n      specularColor *= mix( sDamp, 1.0, shOccl );\n    #endif\n\n    // sContrib = sin( decodeDepthRGB(texture2D(tShadowMap"+a.shadowIndex+",fragCoord.xy).xyz)*200.0);\n    // dContrib = sin( decodeDepthRGB(texture2D(tShadowMap"+a.shadowIndex+",fragCoord.xy).xyz)*200.0);\n\n    // diffuseCoef = vec3( decodeDepthRGB(texture2D(tShadowMap"+a.shadowIndex+",fragCoord.xy).xyz ) );\n  }\n  "),b+="\n\n\n  diffuseCoef   += dContrib * lightContrib;\n  LS_SPECULAR   += sContrib  * lightContrib;\n\n  // specularColor *= 0.0;\n\n}"};d.toString=d,b.exports=d},{}],88:[function(a,b,c){var d=function(a){var b="";return b+="#define NUM_S_LIGHTS "+a.count+"\n\n",a.count>0&&(b+="\nuniform vec3 uLSpotPositions  [NUM_S_LIGHTS];\nuniform vec3 uLSpotFalloff    [NUM_S_LIGHTS];\nuniform vec2 uLSpotSpot       [NUM_S_LIGHTS];\nuniform vec3 uLSpotDirections [NUM_S_LIGHTS];\nuniform vec4 uLSpotColors     [NUM_S_LIGHTS]; // rgb + iblShadowing\n"),b+="\n\n"};d.toString=d,b.exports=d},{}],89:[function(a,b,c){var d=function(a){var b="";return b+="#pragma SLOT pv\n\nattribute vec3 aPosition;\n\nuniform mat4 uMVP;\nuniform float uTime;\n\n\n\n#if depthFormat( D_RGB )\n  varying vec2 fragZW;\n#endif\n\n\nvoid main(void){\n\n  float offsetAngle = 2.2;\n\n  float angle = uTime;\n  float cAngle = aPosition.z * 1.5 + offsetAngle; // Circle angle\n  float radius = .7;\n\n\n  vec3 vx = vec3( cos(cAngle), 0., sin(cAngle) ); // Circle in XZ plan\n  vec3 transVx = vec3( cos(offsetAngle), 0., .5 - sin(offsetAngle) );\n  \n  vec3 vT = vx * radius;\n\n  vec3 vz = vx.zyx; // Tangent vector of the circle\n  vz.z *= -1.;\n\n  vx = vx * cos(angle) + vec3(0., sin(angle), 0); // Rotate on Z axis\n  vec3 vy = cross( vx, vz );\n\n  mat3 rotation = mat3(vx, vy, vz);\n  vec4 pos = vec4( rotation * vec3( aPosition.xy, 0. ) + vT, 1.0 );\n  pos.xyz -= transVx;\n\n  gl_Position = uMVP * pos;\n\n  #if depthFormat( D_RGB )\n    fragZW=gl_Position.zw;\n  #endif\n}\n"};d.toString=d,b.exports=d},{}],90:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec2 aTexCoord1;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform float uTime;\n\nOUT vec2 vTexCoord;\nOUT vec2 vTexCoord1;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  // vec3 nPos = aPosition;\n\n  // AXIS : Z\n\n  float offsetAngle = 2.2;\n\n  float angle = uTime;\n  float cAngle = aPosition.z * 1.5 + offsetAngle; // Circle angle\n  float radius = .7;\n\n\n  vec3 vx = vec3( cos(cAngle), 0., sin(cAngle) ); // Circle in XZ plan\n  vec3 transVx = vec3( cos(offsetAngle), 0., .5 - sin(offsetAngle) );\n  \n  vec3 vT = vx * radius;\n\n  vec3 vz = vx.zyx; // Tangent vector of the circle\n  vz.z *= -1.;\n\n  vx = vx * cos(angle) + vec3(0., sin(angle), 0); // Rotate on Z axis\n  vec3 vy = cross( vx, vz );\n\n  mat3 rotation = mat3(vx, vy, vz);\n  vec4 pos = vec4( rotation * vec3( aPosition.xy, 0. ) + vT, 1.0 );\n  pos.xyz -= transVx;\n\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n  \n  vWorldNormal    = rotate( uWorldMatrix, rotation * aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n\n  #if HAS_uvScale\n    vTexCoord *= uvScale();\n  #endif\n\n  #if HAS_uvOffset\n    vTexCoord += uvOffset();\n  #endif\n\n  // vTexCoord.x += uTime * -.1;\n  vTexCoord.y += uTime * -.15;\n\n  vTexCoord1 = aTexCoord1;\n}"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],91:[function(a,b,c){arguments[4][89][0].apply(c,arguments)},{dup:89}],92:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec2 aTexCoord1;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform float uTime;\n\nOUT vec2 vTexCoord;\nOUT vec2 vTexCoord1;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  // vec3 nPos = aPosition;\n\n  // AXIS : Z\n\n  float offsetAngle = 2.2;\n\n  float angle = -uTime;\n  float cAngle = aPosition.z * 1.2 + offsetAngle; // Circle angle\n  float radius = .9;\n\n\n  vec3 vx = vec3( cos(cAngle), 0., sin(cAngle) ); // Circle in XZ plan\n  vec3 transVx = vec3( cos(offsetAngle), 0., .5 - sin(offsetAngle) );\n  \n  vec3 vT = vx * radius;\n\n  vec3 vz = vx.zyx; // Tangent vector of the circle\n  vz.z *= -1.;\n\n  vx = vx * cos(angle) + vec3(0., sin(angle), 0); // Rotate on Z axis\n  vec3 vy = cross( vx, vz );\n\n  mat3 rotation = mat3(vx, vy, vz);\n  vec4 pos = vec4( rotation * vec3( aPosition.xy, 0. ) + vT, 1.0 );\n  pos.xyz -= transVx;\n\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n  \n  vWorldNormal    = rotate( uWorldMatrix, rotation * aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n\n  #if HAS_uvScale\n    vTexCoord *= uvScale();\n  #endif\n\n  #if HAS_uvOffset\n    vTexCoord += uvOffset();\n  #endif\n\n  // vTexCoord.x += uTime * -.1;\n  vTexCoord.y += uTime * .16;\n\n  vTexCoord1 = aTexCoord1;\n}"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],93:[function(a,b,c){var d=function(b){var c="";return c+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\n\nIN vec2 vTexCoord;\nIN vec2 vTexCoord1;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\n\nuniform float uTime;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  IN mediump vec3 vWorldTangent;\n  IN mediump vec3 vWorldBitangent;\n#endif\n\n\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  IN vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  "+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n// INCLUDES\n// =========\n\n"+a("nanogl-pbr/glsl/includes/ibl.glsl")()+'\n\n\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  uTime;\n\n  #pragma SLOT f\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n\n\n\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n\n\n  vec3 diffuseCoef = vec3(0.0);\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 ambientCoef = vIrradiance;\n  #else\n    vec3 ambientCoef = SampleSH(worldNormal, uSHCoeffs );\n  #endif\n\n  #pragma SLOT lightsf\n\n  diffuseCoef += ambientCoef;\n\n\n\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n\n  #if HAS_cavity\n    #ifndef cavityStrength\n      #define cavityStrength(k) vec2(1.0)\n    #endif\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  \n  \n  #if HAS_lightmap && enableGI\n    #if HAS_albedoAttenuation\n      diffuseCoef *= albedoAttenuation();\n    #endif\n    diffuseCoef  += lightmap();\n  #endif\n\n  FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n\n\n  #if HAS_exposure\n    FragColor.xyz *= vec3( exposure() );\n  #endif\n\n  \n  #if gammaMode( GAMMA_STD ) && HAS_gamma\n    FragColor.xyz = pow( FragColor.xyz, vec3( gamma() ) );\n  #endif\n\n  #if gammaMode( GAMMA_2_2 )\n    FragColor.xyz = pow( FragColor.xyz, vec3( 1.0/2.2 ) );\n  #endif\n\n  #if gammaMode( GAMMA_TB )\n    {\n      vec3 c = FragColor.xyz;\n      vec3 sqrtc = sqrt( c );\n      FragColor.xyz = (sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n    }\n  #endif\n\n\n\n\n  FragColor.a = 1.0;\n\n}'};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/ibl.glsl":373,"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],94:[function(a,b,c){var d=function(b){var c="";return c+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\n\nIN vec2 vTexCoord;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\nIN lowp vec3 vColorRand;\nIN float vOpacity;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  IN mediump vec3 vWorldTangent;\n  IN mediump vec3 vWorldBitangent;\n#endif\n\n#define specular(k) vColorRand\n\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  IN vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  "+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n// INCLUDES\n// =========\n\n"+a("nanogl-pbr/glsl/includes/ibl.glsl")()+'\n\n\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 diffuseCoef = vIrradiance;\n  #else\n    vec3 diffuseCoef = SampleSH(worldNormal, uSHCoeffs );\n  #endif\n\n\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n\n\n  #pragma SLOT lightsf\n\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n  #if HAS_cavity\n    #ifndef cavityStrength\n      #define cavityStrength(k) vec2(1.0)\n    #endif\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  \n\n  FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n\n\n  #if HAS_exposure\n    FragColor.xyz *= vec3( exposure() );\n  #endif\n\n  \n  #if gammaMode( GAMMA_STD ) && HAS_gamma\n    FragColor.xyz = pow( FragColor.xyz, vec3( gamma() ) );\n  #endif\n\n  #if gammaMode( GAMMA_2_2 )\n    FragColor.xyz = pow( FragColor.xyz, vec3( 1.0/2.2 ) );\n  #endif\n\n  #if gammaMode( GAMMA_TB )\n    {\n      vec3 c = FragColor.xyz;\n      vec3 sqrtc = sqrt( c );\n      FragColor.xyz = (sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n    }\n  #endif\n\n\n  // float refl = length(FragColor);\n  // FragColor *= 0.00001;\n  // FragColor.rgb = specular();\n\n\n\n  FragColor.a = 1.0 * vOpacity;\n\n}'};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/ibl.glsl":373,"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],95:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\n// IN vec2 aTexCoord;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\nIN vec3 aColors;\nIN float aSeed1;\nIN float aSeed2;\nIN float aSeed3;\nIN float aSeed4;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform float uTime;\nuniform float uHeigth;\nuniform vec3  uWind; \nuniform float uSize;\nuniform float uSpeed;\nuniform float uSpread;\nuniform float uSpreadHeigth;\nuniform float uInitAngle;\n\n\nOUT vec2 vTexCoord;\nOUT vec3 vWorldPosition;\nOUT float vOpacity;\n\nOUT mediump vec3 vWorldNormal;\nOUT lowp vec3 vColorRand;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nconst float PI = 3.14159265358979323846;\n\nmat3 rotationMatrix(vec3 axis, float angle)\n{\n    axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1.0 - c;\n    \n    return mat3(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c);\n}\n\nfloat when_eq(float x, float y) {\n  return 1.0 - abs(sign(x - y));\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec3 animatedPos = aPosition;\n\n  // Parabole \n  // y = -(t*2 - 1) + 1\n  // x = cos(a) * t\n  // z = sin(a) * t\n\n  float seed = aSeed1;\n\n  vec3 scale = vec3(aSeed1 * 4000. * uSpread, (aSeed2 * 1000. + 1000.) * uSpreadHeigth, aSeed3 * 4000. * uSpread );\n  float t = max(uTime - aSeed1 * .01, 0.) * (1. + seed * .6) * 1.5 * uSpeed;\n\n  float angle = PI * 2. * aSeed4;\n\n  // Rotation\n  mat3 rotRand = rotationMatrix(vec3(aSeed1, aSeed2, aSeed3), t * 10. * (.6 + aSeed4));\n  // vec4 applyedRot = vec4(animatedPos, 1.) * rotRand;\n  if(animatedPos.y + (((t*2. - 1.)*(t*2. - 1.)) - 1.) * - scale.y > -uHeigth * 4999.){\n    animatedPos = rotRand * animatedPos;\n  }\n\n  // Scale random\n  // animatedPos *= (.5 + aSeed1) * .2 * pow(max(min((2.5 * aSeed3) - t,1.5), 0.), 2.);\n  animatedPos *= ((.3 + aSeed1 * .2) * uSize * .8);\n  animatedPos *= max(min((.5 + aSeed1 * .2) - (t - 1. ), .5 + aSeed1 * .2), 0.) * 2.;\n\n  // Position parabol\n  animatedPos.y += (((t*2. - 1.)*(t*2. - 1.)) - 1.) * - scale.y;\n  animatedPos.x += cos(angle) * t * scale.x * max(1.5 * aSeed2 - t, .49);\n  animatedPos.z += sin(angle) * t * scale.z * max(1.5 * aSeed3 - t, .49);\n  animatedPos.y = max(animatedPos.y, -uHeigth * 4999.);\n\n  // Wind Stuff\n  vec3 wind = vec3(1000. * t, 1000. * t, 1000. * t);\n  wind *= uWind;\n  wind = wind * rotationMatrix(vec3(0., 1., 0.), -uInitAngle);\n  animatedPos += wind;\n  \n  // Color \n  vColorRand = aColors;\n  vOpacity = max(min((.5 + aSeed1 * .2) - (t - 1. ), .5 + aSeed1 * .2), 0.) * 2.;\n\n\n  vec4 pos = vec4( animatedPos, 1.0 );\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n  vWorldNormal    = rotate( uWorldMatrix, rotRand * aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  // vTexCoord = aTexCoord;\n  vTexCoord = vec2(0.);\n\n}"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],96:[function(a,b,c){var d=function(a){var b="";return b+="#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\n#pragma SLOT pv\nIN vec3 aPosition;\nIN vec3 aColors;\nIN float aSeed1;\nIN float aSeed2;\nIN float aSeed3;\nIN float aSeed4;\n\nuniform mat4 uMVP;\nuniform float uTime;\nuniform float uHeigth;\n// uniform mat4 uWorldMatrix;\nuniform vec3  uWind; \nuniform float uSize;\nuniform float uSpeed;\nuniform float uSpread;\nuniform float uSpreadHeigth;\nuniform float uInitAngle;\n\n#if depthFormat( D_RGB )\n  varying vec2 fragZW;\n#endif\n\nconst float PI = 3.14159265358979323846;\n\nmat3 rotationMatrix(vec3 axis, float angle)\n{\n    axis = normalize(axis);\n    float s = sin(angle);\n    float c = cos(angle);\n    float oc = 1.0 - c;\n    \n    return mat3(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c);\n}\n\nvoid main(void){\n\n  // transfrom\n  // uTime;\n  // uHeigth;\n  // uWorldMatrix;\n\n  vec3 animatedPos = aPosition;\n\n  // Parabole \n  // y = -(t*2 - 1) + 1\n  // x = cos(a) * t\n  // z = sin(a) * t\n\n  float seed = aSeed1;\n\n  vec3 scale = vec3(aSeed1 * 4000. * uSpread, (aSeed2 * 1000. + 1000.) * uSpreadHeigth, aSeed3 * 4000. * uSpread );\n  float t = max(uTime - aSeed1 * .01, 0.) * (1. + seed * .6) * 1.5 * uSpeed;\n  float angle = PI * 2. * aSeed4;\n\n  // Rotation\n  mat3 rotRand = rotationMatrix(vec3(aSeed1, aSeed2, aSeed3), t * 10. * (.6 + aSeed4));\n  // vec4 applyedRot = vec4(animatedPos, 1.) * rotRand;\n  if(animatedPos.y + (((t*2. - 1.)*(t*2. - 1.)) - 1.) * - scale.y > -uHeigth * 4999.){\n    animatedPos = rotRand * animatedPos;\n  }\n\n  // Scale random\n  // animatedPos *= (.5 + aSeed1) * .2 * pow(max(min((2.5 * aSeed3) - t,1.5), 0.), 2.);\n  animatedPos *= ((.3 + aSeed1 * .2) * uSize * .8);\n  animatedPos *= max(min((.5 + aSeed1 * .2) - (t - 1. ), .5 + aSeed1 * .2), 0.) * 2.;\n\n  // Position parabol\n  animatedPos.y += (((t*2. - 1.)*(t*2. - 1.)) - 1.) * - scale.y;\n  animatedPos.x += cos(angle) * t * scale.x * max(1.5 * aSeed2 - t, .49);\n  animatedPos.z += sin(angle) * t * scale.z * max(1.5 * aSeed3 - t, .49);\n  animatedPos.y = max(animatedPos.y, -uHeigth * 4999.);\n\n  // Wind Stuff\n  vec3 wind = vec3(1000. * t, 1000. * t, 1000. * t);\n  wind *= uWind;\n  wind = wind * rotationMatrix(vec3(0., 1., 0.), -uInitAngle);\n  animatedPos += wind;\n\n  gl_Position = uMVP * vec4( animatedPos, 1.0 );\n\n  #if depthFormat( D_RGB )\n    fragZW=gl_Position.zw;\n  #endif\n}\n"};d.toString=d,b.exports=d},{}],97:[function(a,b,c){var d=a("nanogl-node"),e=a("./utils").setupObj3D;b.exports=function(){return function(a,b,c,f){var g=(f.gl,new d);return e(g,a,b,f),g}}},{"./utils":102,"nanogl-node":368}],98:[function(a,b,c){var d=a("gl/geometry"),e=a("nanogl/arraybuffer"),f=a("nanogl/indexbuffer");a("awdlib/readonly/consts");b.exports=function(){function a(a,b){var c=a.attributes[0].gltype,d=new f(b,c);return d.data(a.data),d}function b(a,b){var c=new e(b);c.data(a.data);for(var d=a.attributes,f=0;f<d.length;f++){var g=d[f];c.attrib(g.name,g.numcomps,g.gltype,g.normalize)}return c}return function(c,e,f,g){var h=g.gl,i=e.keepBuffer,j=new d(h);j.name=c.name;for(var k=c.subGeoms,l=0;l<k.length;l++){var m=k[l],n=new d.SubGeom(h);j.subgeoms.push(n);var o=m.props;n.bounds.fromMinMax([o.get(10),o.get(11),o.get(12)],[o.get(13),o.get(14),o.get(15)]);for(var p=m.buffers,q=0;q<p.length;q++){var r=p[q];34963===r.buffertype?(n.ibuffer=a(r,h),i&&(n.indices=r.data)):(n.buffers.push(b(r,h)),i&&n.vertices.push(r.data))}}return j}}},{"awdlib/readonly/consts":270,"gl/geometry":29,"nanogl/arraybuffer":415,"nanogl/indexbuffer":418}],99:[function(a,b,c){function d(a,b){var c=i;if(b==c.URI)switch(a){case c.INTERLEAVED_GEOM:return f.handleGeometry}else switch(a){case l.MESH:return f.handleMesh;case l.CONTAINER:return f.handleContainer;case l.MATERIAL:return f.handleMaterial}return null}function e(a){this.buffer=a,this.basedir="./",this.awd=null,this.keepBuffer=!1;var b={};b.resolve=function(a){return a&&b[a.id]?b[a.id]:null},this._lib=b,this._lib.lights=[],this._lib.meshes=[],this._byName={},this._objects=[]}var f,g=a("awdlib/readonly/std/ext"),h=a("awdlib/readonly/pil/ext"),i=a("awdlib/readonly/pil/extInfos"),j=a("awdlib/readonly/pil/InterleavedGeometry"),k=a("awdlib/readonly/awd"),l=a("awdlib/readonly/consts"),m=j.prototype.subGeomFactory;j.prototype.subGeomFactory=function(){var a=m.call(this);return a.props.expected[10]=7,a.props.expected[11]=7,a.props.expected[12]=7,a.props.expected[13]=7,a.props.expected[14]=7,a.props.expected[15]=7,a},e.prototype={load:function(a,b){this.awd=new k,this.awd.addExtension(h.getExtension()),this.awd.addExtension(g.getExtension()),this.awd.parse(this.buffer);var c=this.awd._elements;this.container=b,b.gl=a.gl,this._lib.keepBuffer=this.keepBuffer;for(var e=0;e<c.length;e++){var f=c[e],i=d(f.type,f.nsUri);if(i){var j=i(f,this._lib,b,a);this._lib[f.id]=j,this._byName[f.name]=j,this._objects.push(j)}}},getObjectByName:function(a){return this._byName[a]},getObjects:function(){return this._objects},getMeshes:function(){return this._lib.meshes}},function(){f={handleGeometry:a("./geometry")(),handleMesh:a("./mesh")(),handleContainer:a("./container")(),handleMaterial:a("./material")()}}(),b.exports=e},{"./container":97,"./geometry":98,"./material":100,"./mesh":101,"awdlib/readonly/awd":266,"awdlib/readonly/consts":270,"awdlib/readonly/pil/InterleavedGeometry":274,"awdlib/readonly/pil/ext":275,"awdlib/readonly/pil/extInfos":276,"awdlib/readonly/std/ext":288}],100:[function(a,b,c){a("./utils").hexToRGB;b.exports=function(a){return function(a,b,c,d){var e=(a.fileData,a.name);a.uri;return d.getMaterial(e)}}},{"./utils":102}],101:[function(a,b,c){var d=a("./utils").setupObj3D,e=a("gl/mesh");b.exports=function(a){return function(a,b,c,f){var g=f.gl,h=new e(g),i=b.resolve(a.geometry);d(h,a,b,f),h.geom=i;for(var j=a.materials,k=0;k<j.length;++k){var l=j[k],m=b.resolve(l);h.materials.push(m)}return b.meshes.push(h),h}}},{"./utils":102,"gl/mesh":31}],102:[function(a,b,c){b.exports={hexToRGB:function(a){return[(a>>>16&255)/255,(a>>>8&255)/255,(a>>>0&255)/255]},setupObj3D:function(a,b,c,d){if(a.setMatrix(b.matrix.data),a.name=b.name,b.parent){c.resolve(b.parent).add(a)}else d.node.add(a)}}},{}],103:[function(a,b,c){var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};window.Device=function(){function a(){this._handleOrientation=f(this._handleOrientation,this),this._handleResize=f(this._handleResize,this),this.onDOMloaded=f(this.onDOMloaded,this),this.previousDevice=window.device,window.device={},this._doc_element=null,this._user_agent=window.navigator.userAgent.toLowerCase()}return a.prototype.osx=function(){return this._find("mac os x")},a.prototype.ios=function(){return this.iphone()||this.ipod()||this.ipad()},a.prototype.iphone=function(){return this._find("iphone")},a.prototype.ipod=function(){return this._find("ipod")},a.prototype.ipad=function(){return this._find("ipad")},a.prototype.android=function(){return this._find("android")},a.prototype.chrome=function(){return this._find("chrome")&&!this.edge()},a.prototype.firefox=function(){return this._find("firefox")},a.prototype.ie=function(){return null!==new RegExp("trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(this._user_agent)||null!==new RegExp("msie").exec(this._user_agent)},a.prototype.ie12=function(){return this._find("msie 12.0")},a.prototype.ie11=function(){return this._find("msie 11.0")},a.prototype.ie10=function(){return this._find("msie 10.0")},a.prototype.ie9=function(){return this._find("msie 9.0")},a.prototype.ie8=function(){return this._find("msie 8.0")},a.prototype.ie7=function(){return this._find("msie 7.0")},a.prototype.ie6=function(){return this._find("msie 6.0")},a.prototype.safari=function(){return this._find("safari")},a.prototype.androidPhone=function(){return this.android()&&this._find("mobile")},a.prototype.androidTablet=function(){return window.innerWidth,this.android()&&!this._find("mobile")},a.prototype.blackberry=function(){return this._find("blackberry")||this._find("bb10")||this._find("rim")},a.prototype.blackberryPhone=function(){return this.blackberry()&&!this._find("tablet")},a.prototype.blackberryTablet=function(){return this.blackberry()&&this._find("tablet")},a.prototype.windows=function(){return this._find("windows")},a.prototype.windowsPhone=function(){return this.windows()&&this._find("phone")},a.prototype.windowsTablet=function(){return this.windows()&&this._find("touch")&&!this.windowsPhone()},a.prototype.fxos=function(){return(this._find("(mobile;")||this._find("(tablet;"))&&this._find("; rv:")},a.prototype.fxosPhone=function(){return this.fxos()&&this._find("mobile")},a.prototype.fxosTablet=function(){return this.fxos()&&this._find("tablet")},a.prototype.meego=function(){return this._find("meego")},a.prototype.edge=function(){return this._find("edge")},a.prototype.cordova=function(){return window.cordova&&"file:"===location.protocol},a.prototype.nodeWebkit=function(){return"object"==typeof window.process},a.prototype.mobile=function(){return this.androidPhone()||this.iphone()||this.ipod()||this.windowsPhone()||this.blackberryPhone()||this.fxosPhone()||this.meego()},a.prototype.tablet=function(){return this.ipad()||this.androidTablet()||this.blackberryTablet()||this.windowsTablet()||this.fxosTablet()},a.prototype.desktop=function(){return!this.tablet()&&!this.mobile()},a.prototype.nexus5=function(){return this._find("nexus 5")},a.prototype.portrait=function(){return window.innerHeight/window.innerWidth>1},a.prototype.landscape=function(){return window.innerHeight/window.innerWidth<1},a.prototype.noConflict=function(){return window.device=this.previousDevice,this},a.prototype.browserVersion=function(){var a,b,c,d;return d=navigator.userAgent,c=void 0,b=d.match(/(edge(?=\/))\/?\s*(\d+)/i)||[],b.length?{name:b[1],version:b[2]}:(a=d.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(a[1])?(c=/\brv[ :]+(\d+)/g.exec(d)||[],{name:"IE ",version:c[1]||""}):"Chrome"===a[1]&&null!==(c=d.match(/\bOPR\/(\d+)/))?{name:"Opera",version:c[1]}:(a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(c=d.match(/version\/(\d+)/i))&&a.splice(1,1,c[1]),{name:a[0],version:a[1]}))},a.prototype._find=function(a){return-1!==this._user_agent.indexOf(a)},a.prototype._hasClass=function(a){var b;return b=new RegExp(a,"i"),this._doc_element.className.match(b)},a.prototype._addClass=function(a){if(!this._hasClass(a))return this._doc_element.className+=" "+a},a.prototype._removeClass=function(a){if(this._hasClass(a))return this._doc_element.className=this._doc_element.className.replace(a,"")},a.prototype.onDOMloaded=function(){return this._doc_element=window.document.body,
this.ios()?this.ipad()?this._addClass("ios ipad tablet"):this.iphone()?this._addClass("ios iphone mobile"):this.ipod()&&this._addClass("ios ipod mobile"):this.android()?this.desktop()?this._addClass("android desktop error-android-resolution"):this.androidTablet()?this._addClass("android tablet"):this._addClass("android mobile"):this.blackberry()?this.blackberryTablet()?this._addClass("blackberry tablet"):this._addClass("blackberry mobile"):this.windows()?this.windowsTablet()?this._addClass("windows tablet"):this.windowsPhone()?this._addClass("windows mobile"):this.windows()&&this._addClass("windows desktop"):this.fxos()?this.fxosTablet()?this._addClass("fxos tablet"):this._addClass("fxos mobile"):this.meego()?this._addClass("meego mobile"):this.nodeWebkit()?this._addClass("node-webkit"):this.osx()?this._addClass("osx desktop"):this._addClass("desktop"),this.desktop()&&this._addClass("desktop"),this.cordova()&&this._addClass("cordova"),this.chrome()&&this._addClass("chrome"),this.edge()&&this._addClass("msedge"),this.firefox()&&this._addClass("firefox"),this.ie()&&(this._addClass("ie"),this.ie6()?this._addClass("ie6"):this.ie7()?this._addClass("ie7"):this.ie8()?this._addClass("ie8"):this.ie9()?this._addClass("ie9"):this.ie10()?this._addClass("ie10"):this._addClass("ie11")),this._supports_orientation="onorientationchange"in window,this._orientation_event=(this._supports_orientation,"orientationchange"),window.addEventListener?window.addEventListener("resize",this._handleResize,!1):document.attachEvent("resize",this._handleResize),this._handleResize()},a.prototype.orientationCallback=null,a.prototype._handleResize=function(){var a;a="portrait",this.landscape()?(this._removeClass("portrait"),this._addClass("landscape"),a="landscape"):(this._removeClass("landscape"),this._addClass("portrait")),"function"==typeof this.orientationCallback&&this.orientationCallback(a)},a.prototype._handleOrientation=function(a){var b;b="portrait",this.landscape()?(this._removeClass("portrait"),this._addClass("landscape"),b="landscape"):(this._removeClass("landscape"),this._addClass("portrait")),"function"==typeof this.orientationCallback&&this.orientationCallback(b)},a}(),d=function(){function a(){}var b,c;return c=null,a.get=function(){return null!=c?c:c=new b},b=function(){function a(){this.onChangeOrientation=f(this.onChangeOrientation,this),this.device=new window.Device,this.browserVersion=this.device.browserVersion(),this.isOSX=this.device.osx(),this.isIpad=this.device.ios()&&this.device.ipad(),this.isIphone=this.device.ios()&&(this.device.iphone()||this.device.ipod),this.isIos=this.device.ios(),this.isAndroidTablet=this.device.android()&&this.device.androidTablet(),this.device.android()&&!this.device.androidTablet()&&(this.isAndroidPhone=!0),this.isAndroid=this.device.android(),this.isTablet=this.device.tablet(),this.isMobile=this.device.mobile(),this.isDesktop=this.device.desktop(),this.isNexus5=this.device.nexus5(),this.isWindow=this.device.windows(),this.isWindowsPhone=this.device.windowsPhone(),this.isWindowsTablet=this.device.windowsTablet(),this.isChrome=this.device.chrome(),this.isFirefox=this.device.firefox(),this.isMSEdge=this.device.edge(),this.isIE=this.device.ie(),this.isIE6=this.device.ie6(),this.isIE7=this.device.ie7(),this.isIE8=this.device.ie8(),this.isIE9=this.device.ie9(),this.isIE10=this.device.ie10(),this.isIE11=this.device.ie11(),this.isIE12=this.device.ie12(),this.isIEDesktop=this.device.ie()&&!this.device.windowsPhone()&&!this.device.windowsTablet(),this.isltIE10=this.device.ie9()||this.device.ie8()||this.device.ie7()||this.device.ie6(),this.islteIE10=this.device.ie10()||this.device.ie9()||this.device.ie8()||this.device.ie7()||this.device.ie6(),this.isltIE9=this.device.ie8()||this.device.ie7()||this.device.ie6(),this.islteIE9=this.device.ie9()||this.device.ie8()||this.device.ie7()||this.device.ie6(),this.isSafari=!this.device.chrome()&&this.device.safari(),this.isLandscape=this.device.landscape(),this.isPortrait=this.device.portrait(),this.isGalaxyTab10inches=this.device.android()&&e("(min-device-width: 1280px) and (max-device-width: 1281px) and (orientation: landscape), (min-device-width: 800px) and (max-device-width: 801px) and (orientation: portrait)"),this.isGalaxyTab7inches=this.device.android()&&e("(min-device-width: 1024px) and (max-device-width: 1025px) and (orientation: landscape), (min-device-width: 600px) and (max-device-width: 601px) and (orientation: portrait)"),this.isGalaxyTab=this.isGalaxyTab7inches||this.isGalaxyTab10inches,this.isAndroid&&this.isGalaxyTab&&this.forceGalaxyTab()}return a.prototype.forceGalaxyTab=function(){return this.device.desktop=function(){return!0},this.device.tablet=function(){return!1},this.device.mobile=function(){return!1},this.isDesktop=this.device.desktop(),this.isTablet=this.device.tablet(),this.isMobile=this.device.mobile()},a.prototype.bindEvents=function(){return this.device.onDOMloaded()},a.prototype.onChangeOrientation=function(a){if(null==a&&(a=null),null!=a)return this.device.orientationCallback=a},a}(),a}(),e=function(a){var b,c,d;if(null!=window.matchMedia)switch(b="(min-device-width: 1024px)",d="(min-device-width: 768px) and (max-device-width: 1023px)",c="(min-device-width: 320px) and (max-device-width: 767px)",a){case"mobile":return window.matchMedia(c).matches;case"tablet":return window.matchMedia(d).matches;case"desktop":return window.matchMedia(b).matches;default:return window.matchMedia(a).matches}},window.BrowserDetect=d.get(),window.BrowserDetect.bindEvents(),b.exports=window.BrowserDetect},{}],104:[function(a,b,c){function d(a,b){o[0]=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),o[1]=Math.sqrt(b[4]*b[4]+b[5]*b[5]+b[6]*b[6]),o[2]=Math.sqrt(b[8]*b[8]+b[9]*b[9]+b[10]*b[10]),j[0]=b[0]/o[0],j[1]=b[1]/o[0],j[2]=b[2]/o[0],j[3]=b[4]/o[1],j[4]=b[5]/o[1],j[5]=b[6]/o[1],j[6]=b[8]/o[2],j[7]=b[9]/o[2],j[8]=b[10]/o[2],h.fromMat3(a,j)}function e(a,b){this.node=a,this.body=b}var f=a("gl-matrix/src/gl-matrix/mat3"),g=a("gl-matrix/src/gl-matrix/mat4"),h=a("gl-matrix/src/gl-matrix/quat"),i=a("gl-matrix/src/gl-matrix/vec3"),j=f.create(),k=g.create(),l=h.create(),m=i.create(),n=g.create(),o=i.create();e.MatrixToBody=function(a,b){b.position.set(a[12],a[13],a[14]),d(l,a),b.quaternion.set(l[0],l[1],l[2],l[3])},e.BodyToMatrix=function(a,b){var c=b.quaternion;l[0]=c.x,l[1]=c.y,l[2]=c.z,l[3]=c.w;var d=b.position;m[0]=d.x,m[1]=d.y,m[2]=d.z,g.fromRotationTranslation(a,l,m)},e.prototype={syncBody:function(){e.MatrixToBody(this.node._wmatrix,this.body)},syncNode:function(){if(e.BodyToMatrix(k,this.body),this.node._parent){var a=this.node._parent._wmatrix;g.invert(n,a),g.multiply(k,n,k)}this.node.setMatrix(k)}},b.exports=e},{"gl-matrix/src/gl-matrix/mat3":356,"gl-matrix/src/gl-matrix/mat4":357,"gl-matrix/src/gl-matrix/quat":358,"gl-matrix/src/gl-matrix/vec3":360}],105:[function(a,b,c){function d(a){this._anchors=a,this.numAnchors=a.length/3,this.numSegs=this.numAnchors-3,this._factors=new Float64Array(12*this.numSegs),this._lengths=new Float64Array(this.numSegs),this._lengthsSums=new Float64Array(this.numSegs),this._lengthsSumsInvalid=!0,this.updateFactors(),this.computeLenghtSums(),this.size=this.getSize()}var e=a("gl-matrix"),f=e.vec3;e.quat,e.mat4;d.prototype={updateFactors:function(){for(var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=0,t=this._anchors,u=this._factors,v=this.numSegs,w=0;w<v;w++){var x=3*w,y=x+3,z=x+6,A=x+9;u[s++]=g=a=t[y],u[s++]=h=.5*(-t[x]+t[z]),u[s++]=i=1*t[x]+-2.5*t[y]+2*t[z]-.5*t[A],u[s++]=j=-.5*t[x++]+1.5*t[y++]-1.5*t[z++]+.5*t[A++],u[s++]=k=b=t[y],u[s++]=l=.5*(-t[x]+t[z]),u[s++]=m=1*t[x]+-2.5*t[y]+2*t[z]-.5*t[A],u[s++]=n=-.5*t[x++]+1.5*t[y++]-1.5*t[z++]+.5*t[A++],u[s++]=o=c=t[y],u[s++]=p=.5*(-t[x]+t[z]),u[s++]=q=1*t[x]+-2.5*t[y]+2*t[z]-.5*t[A],u[s++]=r=-.5*t[x]+1.5*t[y]-1.5*t[z]+.5*t[A],a-=d=g+.25*(h+.25*(i+.25*j)),b-=e=k+.25*(l+.25*(m+.25*n)),c-=f=o+.25*(p+.25*(q+.25*r));var B=Math.sqrt(a*a+b*b+c*c);d-=a=g+.5*(h+.5*(i+.5*j)),e-=b=k+.5*(l+.5*(m+.5*n)),f-=c=o+.5*(p+.5*(q+.5*r)),B+=Math.sqrt(d*d+e*e+f*f),a-=d=g+.75*(h+.75*(i+.75*j)),b-=e=k+.75*(l+.75*(m+.75*n)),c-=f=o+.75*(p+.75*(q+.75*r)),B+=Math.sqrt(a*a+b*b+c*c),z=3*w+6,d-=t[z],e-=t[z+1],f-=t[z+2],B+=Math.sqrt(d*d+e*e+f*f),this._lengths[w]=B}},getPositionAt:function(a,b){var c=Math.floor(b);b-=c,c*=12;var d=this._factors;return a[0]=d[c+0]+b*(d[c+1]+b*(d[c+2]+b*d[c+3])),a[1]=d[c+4]+b*(d[c+5]+b*(d[c+6]+b*d[c+7])),a[2]=d[c+8]+b*(d[c+9]+b*(d[c+10]+b*d[c+11])),a},getPositionAndTangentAt:function(a,b,c){var d=Math.floor(c),e=c-d,g=12*d,h=this._factors;a[0]=h[g+0]+e*(h[g+1]+e*(h[g+2]+e*h[g+3])),a[1]=h[g+4]+e*(h[g+5]+e*(h[g+6]+e*h[g+7])),a[2]=h[g+8]+e*(h[g+9]+e*(h[g+10]+e*h[g+11])),e+=1e-4,b[0]=h[g+0]+e*(h[g+1]+e*(h[g+2]+e*h[g+3]))-a[0],b[1]=h[g+4]+e*(h[g+5]+e*(h[g+6]+e*h[g+7]))-a[1],b[2]=h[g+8]+e*(h[g+9]+e*(h[g+10]+e*h[g+11]))-a[2],f.normalize(b,b)},getPositionsAndTangentsAt:function(a,b){for(var c=this._factors,d=0;d<b.length;d++){var e,f,g,h=6*d,i=b[d],j=Math.floor(i),k=i-j,l=12*j;a[h+0]=c[l+0]+k*(c[l+1]+k*(c[l+2]+k*c[l+3])),a[h+1]=c[l+4]+k*(c[l+5]+k*(c[l+6]+k*c[l+7])),a[h+2]=c[l+8]+k*(c[l+9]+k*(c[l+10]+k*c[l+11])),k+=.001,e=c[l+0]+k*(c[l+1]+k*(c[l+2]+k*c[l+3]))-a[h+0],f=c[l+4]+k*(c[l+5]+k*(c[l+6]+k*c[l+7]))-a[h+1],g=c[l+8]+k*(c[l+9]+k*(c[l+10]+k*c[l+11]))-a[h+2];var m=Math.sqrt(e*e+f*f+g*g);a[h+3]=e/m,a[h+4]=f/m,a[h+5]=g/m}},posToTime:function(a){for(var b=this._lengthsSums,c=0,d=b,e=d.length,f=0;f<e;f++)if(c=d[f],a<c)return f+1-(c-a)/this._lengths[f];return-1},timeToPos:function(a){var b=this._lengthsSums,c=Math.floor(a),d=a-c,e=this._lengths;return 0==c?d*e[c]:b[c-1]+d*e[c]},computeLenghtSums:function(){if(this._lengthsSumsInvalid){for(var a=this._lengths,b=this._lengthsSums,c=a.length,d=0,e=0;e<c;e++)b[e]=d+=a[e];this._lengthsSumsInvalid=!1}},getSize:function(){var a=this._lengthsSums;return a[a.length-1]}},b.exports=d},{"gl-matrix":352}],106:[function(a,b,c){function d(a,b){return b[0]=(a>>16&255)/255,b[1]=(a>>8&255)/255,b[2]=(255&a)/255,b}function e(a){return i[0]=(a>>16&255)/255,i[1]=(a>>8&255)/255,i[2]=(255&a)/255,i}function f(a){return Math.round(255*a[0])<<16|Math.round(255*a[1])<<8|Math.round(255*a[2])}function g(a){return d(a,new Float32Array(3))}function h(a,b){d(b,i),a.set(i[0],i[1],i[2])}var i=new Float32Array(3);b.exports={HexToVec:d,TmpHexToVec:e,VecToHex:f,MakeFromHex:g,HexInput:h}},{}],107:[function(a,b,c){b.exports=function(a,b){var c,d;return void 0===b&&(b=""),d=new RegExp("&?"+a+"=([^&]+)","g"),c=d.exec(location.search),c?c[1].replace(/%20|\+/g," "):b}},{}],108:[function(a,b,c){function d(a,b,c,d,e){void 0===e&&(e=!1),void 0===d&&(d=1),this.axe=d,this.jump=e,this.scene=a,this.node=b,this.initialPos=new Float32Array(b.position),this.initialRot=new Float32Array(b.rotation);var f=new Float32Array(b.rotation);this.hoverRot=f,n.rotateX(f,f,.8*(Math.random()-.5)),n.rotateY(f,f,.8*(Math.random()-.5)),n.rotateZ(f,f,.5*(Math.random()-.5)),this.hoverSin=n.create(),this.time=0,this.last=0,this.sinxs=.7*Math.random()+.8,this.sinys=.7*Math.random()+.8,this.sinps=.7*Math.random()+.8,this.sinxo=6.3*Math.random(),this.sinyo=6.3*Math.random(),this.sinpo=6.3*Math.random(),this.hoverPos=new Float32Array(b.position),this.hoff=c,this.legacyOff=c,this.baseHeight=this.hoverPos[d]+c,this.hoverPos[d]+=c,this.hover=!1,this.mousedown=!1,this.mouseWasDown=!1,this.forceHover=!1,this.konamiOn=!1,this.hoverDest=0,this.hoverVal=0,this.hoverFrc=0,this.refDist=.3,this.lastJump=0,this.isFlipping=!1}var e=a("event-emitter"),f=(a("nanogl-node"),a("math/ray-point-dist")),g=a("math/ease"),h=a("math"),i=a("lib/mouse"),j=a("gsap/TweenMax"),k=a("gl-matrix"),l=k.vec3,m=k.mat4,n=k.quat,o=l.create(),p=l.create(),q=n.create(),r=n.create(),s=m.create();d.prototype={preRender:function(a){this.time+=a,this.jump&&(this.lastJump+=a,this.lastJump>5&&(this.hoverFrc=1,!1===this.isFlipping&&(this.flip(),this.isFlipping=!0)),this.lastJump>5.3&&(this.lastJump=0)),o[0]=this.node._wposition[0],o[2]=this.node._wposition[2];var b=f(this.scene.getMouseRay(),o),c=b<this.refDist;this.hover!==c&&(this.emit(c?"rollover":"rollout"),this.hover=c),i.isDown()&&c&&(this.mousedown=!0),i.isDown()&&(this.forceHover=!1),i.isDown()?this.mouseWasDown=!0:(c&&this.mousedown&&this.emit("clic",this),this.mouseWasDown&&(this.last=this.time,this.mouseWasDown=!1),this.mousedown=!1),this.hoverFrc+=(BrowserDetect.isMobile||BrowserDetect.isTablet?i.isDown()&&c||this.forceHover:c)?a/.01:-a/.5,this.hoverFrc=h.clamp(this.hoverFrc,-.3,.6),this.hoverVal+=this.hoverFrc*a*8,this.hoverVal+=this.konamiOn?.05:0,this.hoverVal=h.clamp01(this.hoverVal),1===this.hoverVal&&this.hoverFrc>0&&(this.hoverFrc=0);var d=g.easeInOutQuad(this.hoverVal);!1===this.isFlipping&&(n.rotateX(q,r,.15*Math.sin(this.time*this.sinxs+this.sinxo)),n.rotateY(q,q,.15*Math.sin(this.time*this.sinys+this.sinyo)),n.multiply(q,q,this.hoverRot));var e=.1*this.hoff*(Math.sin(this.time*this.sinps+this.sinpo)+1);this.hoverPos[this.axe]=this.baseHeight+e,!1===this.isFlipping&&n.slerp(q,this.initialRot,q,d),l.lerp(p,this.initialPos,this.hoverPos,d),m.fromRotationTranslation(s,q,p),this.node.setMatrix(s)},animate:function(a){var b=.06*a,c=(this.forceHover?3:4)+b;this.time-this.last>=c&&!i.isDown()&&(this.last=this.time-b,this.forceHover=!this.forceHover)},flip:function(){function a(){var a=n.create();n.rotateZ(a,a,.6*Math.sin(e.value*Math.PI*4)),n.rotateY(a,a,.3*Math.sin(e.value*Math.PI*2)),n.rotateX(q,a,.2*Math.sin(e.value*Math.PI*2))}function b(){d.hoff=5*d.legacyOff}function c(){d.isFlipping=!1,d.hoff=d.legacyOff}if(!0!==this.hover){var d=this,e={value:0};j.to(e,1.5,{value:1,ease:Power2.easeOut,onUpdate:a,onComplete:c,onStart:b})}}},e(d.prototype),b.exports=d},{"event-emitter":351,"gl-matrix":352,"gsap/TweenMax":362,"lib/mouse":109,math:114,"math/ease":113,"math/ray-point-dist":117,"nanogl-node":368}],109:[function(a,b,c){function d(a,b,c){var d,e;if(void 0!==a.touches){var f;if(a.touches.length>0?f=a.touches:a.changedTouches&&a.changedTouches.length>0&&(f=a.changedTouches),f){for(var d=0,e=0,g=0;g<f.length;g++)d+=f[g].clientX,e+=f[g].clientY;d/=f.length,e/=f.length}}else d=a.clientX,e=a.clientY;b[0]=2*d/window.innerWidth-1,b[1]=-(2*e/window.innerHeight-1),c[0]=2*d/window.innerWidth-1,c[1]=-(2*e/window.innerWidth-1)}function e(a){z=!0,d(a,u,v),B.emit("move",u)}function f(a){z=!0,y=!0,d(a,u,v),w.set(u),x.set(v),B.emit("down",u,a)}function g(a){z=!0,y=!1,d(a,u,v),B.emit("up",u,a)}function h(){A=Date.now()}function i(){return Date.now()-A>5e3}function j(a){i()&&e(a)}function k(a){z=!1,y=!1,B.emit("leave",a)}function l(a){i()&&f(a)}function m(a){i()&&g(a)}function n(a){h(),e(a)}function o(a){h(),f(a),B.emit("touchdown",a)}function p(a){h(),g(a),B.emit("touchup",a)}function q(a){t=a,s=a.renderer.canvas,s.addEventListener("mousemove",j),s.addEventListener("mouseleave",k),s.addEventListener("mousedown",l),s.addEventListener("mouseup",m),s.addEventListener("touchmove",n),s.addEventListener("touchstart",o),s.addEventListener("touchend",p)}var r=a("event-emitter"),s=null,t=null,u=new Float32Array(2),v=new Float32Array(2),w=new Float32Array(2),x=new Float32Array(2),y=!1,z=!0,A=0,B={getEl:function(){return s},coords:u,ncoords:v,dcoords:w,ndcoords:x,init:q,isDown:function(){return y},isOver:function(){return z}};r(B),b.exports=B},{"event-emitter":351}],110:[function(a,b,c){function d(a){function b(){d--,c.notify(1-d/a.length),0===d&&c.resolve(!0)}for(var c=m.defer(),d=a.length,e=0;e<a.length;e++)a[e].then(b,c.reject);return c.promise}function e(a){return i(a,"").then(function(a){return JSON.parse(a)})}function f(a){return i(a,"arraybuffer")}function g(a){var b=m.defer(),c=new Image;return c.onload=function(){b.resolve(c)},c.onerror=function(){b.reject()},c.crossOrigin="anonymous",c.src=a,b.promise}function h(){for(var a=0;a<n.length;a++)n[a].xhr.abort(),n[a].defer.reject();o={},n.length=0}function i(a,b){return k(a,b).defer.promise.then(j)}function j(a){return a.xhr.response}function k(a,b){var c,d;c=m.defer(),d=new XMLHttpRequest;var e={xhr:d,id:p++,defer:c};return d.open("GET",a,!0),"arraybuffer"===b&&d.setRequestHeader("Accept","application/octet-stream"),d.responseType=b,d.onload=function(){return c.resolve(e)},d.error=function(a){return c.reject(e)},d.send(),n.push(e),o[e.id]=e,c.promise.then(l),e}function l(a){delete o[a.id];var b=n.indexOf(a);b>-1&&n.splice(b,1)}var m=a("when"),n=[],o={},p=0;b.exports={loadJson:e,loadBytes:f,loadImage:g,whenAll:d,releaseAll:h}},{when:445}],111:[function(a,b,c){function d(a,b){this.datas=a,this.doubleSided=!!b,this.pos=new Float32Array(3)}var e=a("gl-matrix"),f=e.vec3,g=f.create(),h=f.create(),i=f.create(),j=f.create(),k=f.create();d.prototype={run:function(a,b){for(var c,d,e,l,m=a.pos,n=a.dir,o=this.datas.faces,p=this.datas.verts,q=0;q<o.length;q+=3){c=3*o[q+0],d=3*o[q+1],e=3*o[q+2],g[0]=p[d+0]-p[c+0],g[1]=p[d+1]-p[c+1],g[2]=p[d+2]-p[c+2],h[0]=p[e+0]-p[c+0],h[1]=p[e+1]-p[c+1],h[2]=p[e+2]-p[c+2],f.cross(i,g,h);var r=f.dot(n,i);if(r>0){if(!this.doubleSided)continue;l=1}else{if(!(r<0))continue;l=-1,r=-r}j[0]=m[0]-p[c+0],j[1]=m[1]-p[c+1],j[2]=m[2]-p[c+2],f.cross(k,j,h);var s=l*f.dot(n,k);if(!(s<0)){f.cross(k,g,j);var t=l*f.dot(n,k);if(!(t<0||s+t>r)){var u=-l*f.dot(j,i);if(!(u<0))return f.scaleAndAdd(k,m,n,u/r),b[0]=k[0],b[1]=k[1],b[2]=k[2],this.pos[0]=k[0],this.pos[1]=k[1],this.pos[2]=k[2],l}}}return 0},getPos:function(){return this.pos}},b.exports=d},{"gl-matrix":352}],112:[function(a,b,c){function d(){document.addEventListener("touchmove",function(a){a.preventDefault()},!1);var a=document.getElementById("gl-canvas");this.onLoaded=this._onLoaded.bind(this),this.onLoadProgress=this._onLoadProgress.bind(this),this.model=new g,this.renderer=new e(a),this.scene=new f,this.renderer.scene=this.scene,this.scene.init(this.renderer,this.model),this.load(),this.renderer.play()}a("lib/browser-detect"),a("promise-decode-audio-data");a("./polyfils");console.log("%cMade with  by makemepulse","color: #FFFFFF; font-size: 20px; padding: 20px 20px 30px 20px; font-fmaily: sans-serif; text-shadow: 1px 1px #7FF7AD, 2px 2px #357FE7, 3px 3px #542EE9, 4px 4px #D32DAF");var e=a("./renderer"),f=a("./scene"),g=a("./model");d.prototype={load:function(){this.scene.preload().then(this.scene.load).then(this.onLoaded,null,this.onLoadProgress)},_onLoaded:function(){this.scene.loaded(),(BrowserDetect.isMobile||BrowserDetect.isTablet)&&(TweenMax.staggerTo([".mobile-logo",".mobile-ui__text"],4,{autoAlpha:1,delay:1.8,ease:Expo.easeOut},.2),TweenMax.staggerTo(["#fb_link","#twitter_link","#insta_link"],5,{autoAlpha:1,delay:2.2,ease:Expo.easeOut},.15))},_onLoadProgress:function(a){}},window.App=d},{"./model":120,"./polyfils":256,"./renderer":257,"./scene":258,"lib/browser-detect":103,"promise-decode-audio-data":424}],113:[function(a,b,c){b.exports={linear:function(a){return a},easeInQuad:function(a){return a*a},easeOutQuad:function(a){return a*(2-a)},easeInOutQuad:function(a){return a<.5?2*a*a:(4-2*a)*a-1},easeInCubic:function(a){return a*a*a},easeOutCubic:function(a){return--a*a*a+1},easeInOutCubic:function(a){return a<.5?4*a*a*a:(a-1)*(2*a-2)*(2*a-2)+1},easeInQuart:function(a){return a*a*a*a},easeOutQuart:function(a){return 1- --a*a*a*a},easeInOutQuart:function(a){return a<.5?8*a*a*a*a:1-8*--a*a*a*a},easeInQuint:function(a){return a*a*a*a*a},easeOutQuint:function(a){return 1+--a*a*a*a*a},easeInOutQuint:function(a){return a<.5?16*a*a*a*a*a:1+16*--a*a*a*a*a},easeInExpo:function(a){return Math.pow(2,10*(a-1))},easeOutExpo:function(a){return 1-Math.pow(2,-10*a)},easeInOutExpo:function(a){return a*=2,a<1?.5*Math.pow(2,10*(a-1)):.5*(2-Math.pow(2,-10*--a))}}},{}],114:[function(a,b,c){function d(a){return Math.min(1,Math.max(0,a))}function e(a,b,c){return Math.min(c,Math.max(b,a))}function f(a){return a<0?-1:1}function g(a,b,c,d,e){return(a-b)/(c-b)*(e-d)+d}function h(a,b){return Math.min(a+Math.random()*(b-a),b)}function i(a){for(;a>=t;)a-=t;for(;a<0;)a+=t;return a}function j(a,b){var c=b-a,d=c-t,e=c+t;return Math.abs(d)<Math.abs(c)&&(c=d),Math.abs(e)<Math.abs(c)&&(c=e),a+c}function k(a,b){o.normalize(s,b),o.cross(q,VUP,s),o.normalize(q,q),o.cross(r,s,q),a.set(p)}function l(a,b,c,d,e){var f,g,h,i,j,k=b[c+0],l=b[c+1],m=b[c+2],n=b[c+3],o=b[d+0],p=b[d+1],q=b[d+2],r=b[d+3];return g=k*o+l*p+m*q+n*r,g<0&&(g=-g,o=-o,p=-p,q=-q,r=-r),1-g>1e-6?(f=Math.acos(g),h=Math.sin(f),i=Math.sin((1-e)*f)/h,j=Math.sin(e*f)/h):(i=1-e,j=e),a[0]=i*k+j*o,a[1]=i*l+j*p,a[2]=i*m+j*q,a[3]=i*n+j*r,a}var m=a("gl-matrix"),n=(m.mat4,m.mat3),o=m.vec3,p=(m.quat,n.create()),q=new Float32Array(p.buffer,0,3),r=new Float32Array(p.buffer,12,3),s=new Float32Array(p.buffer,24,3);VUP=o.fromValues(0,1,0);var t=2*Math.PI;b.exports={clamp:e,clamp01:d,sign:f,map:g,randomFloat:h,normalizeAngle:i,normalizeDeltaAngle:j,mat3Lookat:k,quatSlerp:l}},{"gl-matrix":352}],115:[function(a,b,c){function d(){this.origin=new Float32Array(3),this.normal=new Float32Array(3),this.normal[1]=1}b.exports=d},{}],116:[function(a,b,c){var d=a("gl-matrix/src/gl-matrix/vec3"),e=d.create();b.exports=function(a,b,c){var f=d.dot(c.normal,b.dir);if(Math.abs(f)>1e-6){d.sub(e,c.origin,b.pos);var g=d.dot(e,c.normal)/f;return d.scaleAndAdd(a,b.pos,b.dir,g),!0}return!1}},{"gl-matrix/src/gl-matrix/vec3":360}],117:[function(a,b,c){var d=a("gl-matrix/src/gl-matrix/vec3"),e=d.create();b.exports=function(a,b){return d.sub(e,b,a.pos),d.cross(e,a.dir,e),d.length(e)}},{"gl-matrix/src/gl-matrix/vec3":360}],118:[function(a,b,c){function d(){this.pos=new Float32Array(3),this.dir=new Float32Array(3),this._invalid=!0}var e=a("gl-matrix"),f=a("lib/mouse"),g=e.vec3,h=e.mat3,i=e.mat4,j=g.create(),k=i.create();h.create();d.prototype={update:function(a){this._invalid&&(this.unproject(f.coords,a),this._invalid=!1)},unproject:function(a,b){i.invert(k,b._viewProj),j[0]=a[0],j[1]=a[1],j[2]=-1,g.transformMat4(this.pos,j,k),j[2]=1,g.transformMat4(this.dir,j,k),g.subtract(this.dir,this.dir,this.pos),g.normalize(this.dir,this.dir)},invalidate:function(){this._invalid=!0}},b.exports=d},{"gl-matrix":352,"lib/mouse":109}],119:[function(a,b,c){var d=a("./plane"),e=a("./ray"),f=a("./ray-plane-intersection"),g=new d,h=new e,i=a("gl-matrix/src/gl-matrix/vec3"),j=new Float32Array(3);b.exports=function(a,b,c,d){h.unproject(a,b),f(j,h,g),i.transformMat4(j,j,d),c.position.set(j),c.invalidate()}},{"./plane":115,"./ray":118,"./ray-plane-intersection":116,"gl-matrix/src/gl-matrix/vec3":360}],120:[function(a,b,c){function d(){this._section=0,this._position=0;var a=parseInt(f("section",0));this.setSection(a)}var e=a("event-emitter"),f=a("lib/getQuery"),g=a("sections"),h=g.length,i=["SECTION_CHANGE","POS_CHANGE"];d.prototype={slide:function(a){this._slide=a},setSection:function(a){this._section!==a&&(this._section=a,this.emit(d.SECTION_CHANGE))},getSection:function(){return this._section},setPosition:function(a){a=Math.max(0,Math.min(h-1,a)),this._position!==a&&(this._position=a,this.emit(d.POS_CHANGE))},getPosition:function(){return this._position},getNormalizedPosition:function(){return this._position/h},hasNext:function(){return this._section<h-1},hasPrev:function(){return this._section>0},next:function(){this.hasNext&&this.setSection(this._section+1)},prev:function(){this.hasPrev&&this.setSection(this._section-1)}},i.forEach(function(a){d[a]=a,d.prototype[a]=a}),e(d.prototype),b.exports=d},{"event-emitter":351,"lib/getQuery":107,sections:259}],121:[function(a,b,c){function d(a){this.onSectionChange=this._onSectionChange.bind(this),this.model=a.model,this.scene=a,this.stwTimeStart=0,this.stwStartPos=0,this.stwProgress=1,this.navSlide=0;var b=this.model;b.on(b.SECTION_CHANGE,this.onSectionChange),this.dragProgress=0,this.slideValue=0}var e=a("math/ease"),f=a("math");d.prototype={preRender:function(){var a=this.scene.dt;if(this.scene.model._slide?this.slideValue+=a/.8:this.slideValue-=a/.8,this.slideValue=f.clamp01(this.slideValue),this.stwProgress<1){this.stwProgress+=a/2,this.stwProgress=f.clamp01(this.stwProgress);var b=this.scene.model.getSection()-this.stwStartPos;mp=this.stwStartPos+b*e.easeInOutCubic(this.stwProgress)}else mp=this.scene.model.getSection();this.model.setPosition(mp+.1*this.dragProgress)},_onSectionChange:function(){this.scene.model.getSection();this.dragProgress=0,this.stwTimeStart=this.scene.time,this.stwProgress=0,this.stwStartPos=this.model.getPosition()-.1*this.dragProgress}},b.exports=d},{math:114,"math/ease":113}],122:[function(a,b,c){function d(a){this.gl=a,this.vertices=new Float32Array(g),this.indices=new Uint16Array(h),this.drawingBuffer=null,this.drawingMethod="drawTriangles",this.setup()}var e=a("nanogl/arraybuffer"),f=a("nanogl/indexbuffer"),g=[-1,1,-1,0,0,0,1,0,-1,1,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,1,-1,1,0,0,1,0,-1,1,1,0,0,-1,0,0,-1,-1,1,1,0,-1,0,0,-1,-1,-1,1,1,-1,0,0,-1,1,-1,0,1,-1,0,0,1,1,1,1,1,1,0,0,1,-1,1,0,1,1,0,0,1,-1,-1,0,0,1,0,0,1,1,-1,1,0,1,0,0,1,1,1,1,1,0,0,1,1,-1,1,1,0,0,0,1,-1,-1,1,0,0,0,0,1,-1,1,1,0,1,0,0,1,1,1,-1,0,0,0,0,-1,1,-1,-1,0,1,0,0,-1,-1,-1,-1,1,1,0,0,-1,-1,1,-1,1,0,0,0,-1,-1,-1,-1,1,1,0,-1,0,-1,-1,1,1,0,0,-1,0,1,-1,1,0,0,0,-1,0,1,-1,-1,0,1,0,-1,0],h=[0,1,2,0,2,3,5,4,6,6,4,7,8,9,10,8,10,11,13,12,14,15,14,12,16,17,18,16,18,19,21,20,22,22,20,23];d.prototype.setup=function(){var a=this.gl;this.buffer=new e(a),this.buffer.data(this.vertices),this.buffer.attrib("aPosition",3,a.FLOAT),this.buffer.attrib("aNormal",3,a.FLOAT),this.buffer.attrib("aTexCoord",2,a.FLOAT),this.ibuffer=new f(a,a.UNSIGNED_SHORT),this.ibuffer.data(this.indices),this.drawingBuffer=this.ibuffer},d.prototype.bind=function(a){this.gl;this.buffer.attribPointer(a),this.ibuffer.bind()},d.prototype.render=function(){this.drawingBuffer[this.drawingMethod]()},b.exports=d},{"nanogl/arraybuffer":415,"nanogl/indexbuffer":418}],123:[function(a,b,c){function d(a,b){g.call(this),this.gl=a,this.mod=b,this.setup()}var e=a("./box-geom"),f=a("./debug-material"),g=a("nanogl-node");d.prototype=Object.create(g.prototype),d.prototype.constructor=d,d.prototype.setup=function(){this.geom=new e(this.gl),this.material=new f(this.mod)},d.prototype.preRender=function(){},d.prototype.render=function(){this.material.prepare(this),this.geom.bind(this.mod.scene.programs.debug),this.geom.render()},b.exports=d},{"./box-geom":122,"./debug-material":127,"nanogl-node":368}],124:[function(a,b,c){function d(a,b){return this.node=a,this.nodes=[],this.options=b||{},this.count=this.options.count||60,this.size=this.options.size||1,this.spreadScale=this.options.spread||1,this.spreadHeigth=this.options.heigth||1,this.speed=this.options.speed||1,this.lifeTime=this.options.lifeTime||1.5,this.bind(),this}function e(a){this.scene=a,this.geomData=null,this.gl=this.scene.gl,this.ready=!1,this.camera=this.scene.camera,this.veticesPerConf=void 0,this.config=this.scene.glstate.config(),this.factories=[],f=this,this.bind()}var f,g=a("../utils/binaryMeshLoader"),h=a("config"),i=a("nanogl/arraybuffer"),j=a("nanogl/indexbuffer"),k=a("./confetiMaterial"),l=a("./confetiDepthMaterial"),m=a("nanogl-node");a("nanogl/program");d.prototype={bind:function(){this.create=this._create.bind(this)},_create:function(a,b){b=b||[0,0,0];var c=new m,d=Math.random()*Math.PI*2;c.position.set(a),c.setScale(2e-4),c.rotateY(d),c.initRot=d,c.wind=b,c.time=0,this.nodes.push(c),this.node.add(c)},removeConfeti:function(a){this.node.remove(this.nodes[a]),this.nodes.splice(a,1)}},e.prototype={bind:function(){this.onLoaded=this._onLoaded.bind(this)},getLoadable:function(){return new g(h.asset_url("common/confeti.json"),h.asset_url("common/confeti.bin")).then(this.onLoaded)},createFactory:function(a,b){var c=new d(a,b);return this.factories.push(c),c},_onLoaded:function(a){this.geomData=a,this.allocate(),this.createPrograms(),this.ready=!0},allocate:function(){var a=this.geomData[0];this.veticesPerConf=a.infos.numVert,this.positions=new i(this.gl,a.vertices),this.normals=new i(this.gl,a.normal),this.seeds1=new i(this.gl,a.seed1),this.seeds2=new i(this.gl,a.seed2),this.seeds3=new i(this.gl,a.seed3),this.seeds4=new i(this.gl,a.seed4),this.colors=new i(this.gl,a.colors),this.positions.attrib("aPosition",3,this.gl.FLOAT),this.normals.attrib("aNormal",3,this.gl.FLOAT),this.colors.attrib("aColors",3,this.gl.FLOAT),this.seeds1.attrib("aSeed1",1,this.gl.FLOAT),this.seeds2.attrib("aSeed2",1,this.gl.FLOAT),this.seeds3.attrib("aSeed3",1,this.gl.FLOAT),this.seeds4.attrib("aSeed4",1,this.gl.FLOAT),this.iBuffer=new j(this.gl,this.gl.UNSIGNED_SHORT),this.iBuffer.data(a.indices)},createPrograms:function(){var a=new k(this.gl);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([0,0,0]),a.iGloss.attachConstant(.1),a.conserveEnergy.set(!1),this.config.enableCullface(!1),this.config.enableDepthTest(!0),this.config.enableBlend(!0),this.config.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),a._mask=1,this.material=a;var b=new l(this.gl,this.options);b._precision="highp",b.setLightSetup(this.scene.lights.setup),this.shadowsMat=b},removeConfeti:function(a){this.mod.awd.node.remove(this.nodes[a]),this.nodes.splice(a,1)},renderShadow:function(a){this.ready&&this.drawCall(a,this.shadowsMat)},drawCall:function(a,b){b.prepare(a),this.positions.attribPointer(b.prg),this.normals.attribPointer(b.prg),this.colors.attribPointer(b.prg),this.seeds1.attribPointer(b.prg),this.seeds2.attribPointer(b.prg),this.seeds3.attribPointer(b.prg),this.seeds4.attribPointer(b.prg),this.iBuffer.bind(),this.config.apply();for(var c=0;c<this.factories.length;c++)for(var d=this.factories[c],e=0;e<d.nodes.length;e++)b.prg.uHeigth(d.nodes[e].y),b.prg.uTime(d.nodes[e].time),b.prg.uInitAngle(d.nodes[e].initRot),b.prg.uWind(d.nodes[e].wind),b.prg.uSize(d.size),b.prg.uSpread(d.spreadScale),b.prg.uSpreadHeigth(d.spreadHeigth),b.prg.uSpeed(d.speed),b.setupNode(a,d.nodes[e]),this.iBuffer.drawTriangles(this.veticesPerConf*d.count)},render:function(){if(this.ready){this.drawCall(this.scene.camera,this.material);for(var a=0;a<this.factories.length;a++)for(var b=this.factories[a],c=0;c<b.nodes.length;c++)b.nodes[c].time<b.lifeTime?b.nodes[c].time+=.01:b.removeConfeti(c)}}},b.exports=e},{"../utils/binaryMeshLoader":128,"./confetiDepthMaterial":125,"./confetiMaterial":126,config:18,"nanogl-node":368,"nanogl/arraybuffer":415,"nanogl/indexbuffer":418,"nanogl/program":419}],125:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this.inputs=new h,this.depthFormat=new g("depthFormat",["D_RGB","D_DEPTH"]),this.inputs.add(this.depthFormat),this.config=new e,this._prgcache=f.getCache(b),this._uid="confetidepth",this._precision="highp",this._vertSrc=a("glsl/zero/confetiDepth.vert")(),this._fragSrc=a("nanogl-pbr/glsl/depthpass.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=(a("nanogl-pbr/lib/input"),a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/enum")),h=a("nanogl-pbr/lib/chunks-tree"),i=a("gl-matrix").mat4.create();d.prototype={setLightSetup:function(a){this.inputs.remove(this.depthFormat),this.depthFormat=a.depthFormat.createProxy(),this.inputs.add(this.depthFormat)},prepare:function(a){this._isDirty()&&this.compile();var b=this.prg;b.use(),b.setupInputs(this)},setupNode:function(a,b){a.modelViewProjectionMatrix(i,b._wmatrix),this.prg.uMVP(i)},_isDirty:function(){return null===this.prg||this.inputs._isDirty},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":352,"glsl/zero/confetiDepth.vert":96,"nanogl-pbr/glsl/depthpass.frag":370,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],126:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new j,this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),
this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="confeti",this._precision="highp",this._vertSrc=a("glsl/zero/confeti.vert")(),this._fragSrc=a("glsl/zero/confeti.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4.create();d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a){this._isDirty()&&this.compile();var b=this.prg;b.use(),b.setupInputs(this),this.ibl.setupProgram(b),b.uCameraPosition(a._wposition)},setupNode:function(a,b){a.modelViewProjectionMatrix(k,b._wmatrix),this.prg.uMVP(k),this.prg.uWorldMatrix(b._wmatrix)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":352,"glsl/zero/confeti.frag":94,"glsl/zero/confeti.vert":95,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],127:[function(a,b,c){function d(a){this.mod=a,this.prg=a.scene.programs.debug;var b=a.scene.gl;this.cfg=a.scene.glstate.config().enableDepthTest(!0).enableBlend().blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA)}var e=a("gl-matrix").mat4,f=e.create();d.prototype.prepare=function(a){var b=this.prg;b.bind(),this.cfg.apply(),this.mod.scene.camera.modelViewProjectionMatrix(f,a._wmatrix),b.uMVP(f)},b.exports=d},{"gl-matrix":352}],128:[function(a,b,c){function d(a,b){this.json=a,this.bin=b,this.itemLoaded=0,this.defer=e.defer();var c=this;return"string"==typeof this.json?this.loadJson().then(function(a){c.json=a,c.itemLoaded++,c.checkIfItemIsloaded()}):this.itemLoaded++,"string"==typeof this.bin?this.loadBin().then(function(a){c.bin=a,c.itemLoaded++,c.checkIfItemIsloaded()}):this.itemLoaded++,2===this.itemLoaded&&this.init(),this.getPromise()}var e=a("when");d.prototype={init:function(){for(var a=this.json.meshes,b=["vertices","normal","uvs","indices","name","type","translate","scale","infos"],c=0;c<a.length;c++){var d=a[c];if(null!=d.vertices){var e=d.vertices;d.vertices=new Float32Array(this.bin.slice(4*e.offset,4*e.offset+4*e.length))}if(null!=d.normal){var e=d.normal;d.normal=new Float32Array(this.bin.slice(4*e.offset,4*e.offset+4*e.length))}if(null!=d.uvs){var e=d.uvs;d.uvs=new Float32Array(this.bin.slice(4*e.offset,4*e.offset+4*e.length))}if(null!=d.indices){for(var e=d.indices,f=new Float32Array(this.bin.slice(4*e.offset,4*e.offset+4*e.length)),g=[],h=0;h<f.length;h++)g.push(f[h]);d.indices=new Uint16Array(g)}for(var i in d)if(d.hasOwnProperty(i)&&-1===b.indexOf(i)&&null!=d[i]){var e=d[i];d[i]=new Float32Array(this.bin.slice(4*e.offset,4*e.offset+4*e.length))}}this.defer.resolve(a)},getPromise:function(){return this.defer.promise},loadJson:function(){var a=e.defer(),b=new XMLHttpRequest;return b.open("GET",this.json,!0),b.responseType="json",b.onload=function(c){a.resolve(b.response)},b.send(),a.promise},loadBin:function(){var a=e.defer(),b=new XMLHttpRequest;return b.open("GET",this.bin,!0),b.responseType="arraybuffer",b.onload=function(c){a.resolve(b.response)},b.send(),a.promise},checkIfItemIsloaded:function(){2===this.itemLoaded&&this.init()}},b.exports=d},{when:445}],129:[function(a,b,c){function d(a,b,c){this.track=a,this.mod=b,this.scene=b.scene,this.size=.01;var d=i.map(this.size,.03,1.03,.032,.096);this.nodeScale=i.map(this.size,.03,1.03,1,3),this.defaultPosition=new e.Vec3(-.6,.2,-.85),this.prevPosition=new e.Vec3,this.body=new e.Body({mass:.01,position:this.defaultPosition,shape:new e.Sphere(d),material:this.mod.physics.materials.ball}),this.body.track=this.track,this.mod.physics.world.addBody(this.body),this.cnode=new f(new g,this.body),this.cnode.node.setScale(this.nodeScale),this.proxy=c,this.confeti1=this.scene.confeti.createFactory(this.mod.awd.node),this.confeti2=this.scene.confeti.createFactory(this.mod.awd.node)}var e=a("cannon"),f=a("lib/cannon-node"),g=a("nanogl-node"),h=a("./consts"),i=a("math"),j=new e.Vec3;new e.Quaternion;GUIParams=a("./gui").params;var k=a("gl-matrix").vec3,l=k.create();d.prototype={move:function(a,b){var c=a[0]-this.body.position.x,d=a[1]-this.body.position.y,e=a[2]-this.body.position.z,f=Math.sqrt(c*c+d*d+e*e);Math.abs(f);f<.75&&(b=i.map(f,0,.75,0,b)),this.body.position.x+=(a[0]-this.body.position.x)*h.ball.damping*b,this.body.position.y+=(a[1]-this.body.position.y)*h.ball.damping*b,this.body.position.z+=(a[2]-this.body.position.z)*h.ball.damping*b,j.copy(this.body.position),this.direction=j.vsub(this.prevPosition),this.prevPosition.set(this.body.position.x,this.body.position.y,this.body.position.z)},explode:function(){this.direction.scale(20,j),this.hide(),this.confeti1.create([this.body.position.x,this.body.position.y,this.body.position.z],[j.x,j.y,j.z]),this.confeti2.create([this.body.position.x,this.body.position.y,this.body.position.z],[j.x,j.y,j.z]),this.scene.shakeCamera(.18,.96),k.transformMat4(l,this.cnode.node.position,this.scene.camera._viewProj),GUIParams.shockwave.enabled=!0,GUIParams.shockwave.time=0,GUIParams.shockwave.centerX=(l[0]+1)/2,GUIParams.shockwave.centerY=-(l[1]-1)/2,TweenLite.to(GUIParams.shockwave,2,{time:.5,onUpdate:function(){GUIParams.shockwave.opacity=i.map(GUIParams.shockwave.time,0,.5,1,0)},onComplete:function(){GUIParams.shockwave.enabled=!1}})},initialImpulse:function(){this.body.applyLocalForce(new e.Vec3(-.7,0,.3),new e.Vec3(0,0,0))},show:function(){this.proxy=this.mod.ballMesh.proxy(),this.body.wakeUp(),this.reset()},hide:function(){this.mod.ballMesh.removeProxy(this.proxy),this.proxy=null,this.body.sleep()},reset:function(){this.body.position.copy(this.defaultPosition)},resetAll:function(){this.body.velocity.copy(j),this.body.angularVelocity.copy(j),this.reset()},preRender:function(){this.cnode.syncNode(),this.cnode.node.setScale(this.nodeScale),this.cnode.node.invalidate(),this.cnode.node.updateMatrix(),this.proxy&&this.proxy.setMatrix(this.cnode.node._matrix)}},b.exports=d},{"./consts":130,"./gui":140,cannon:296,"gl-matrix":352,"lib/cannon-node":104,math:114,"nanogl-node":368}],130:[function(a,b,c){var d=a("cannon");b.exports={physics:{gravity:new d.Vec3(0,-5.892,0),iterations:100,fixedTimeStep:1/60,maxSubSteps:50},ball:{mass:.1,radius:.032,damping:.5},spline:{step:.5},trails:{colors:[[127/255,247/255,173/255],[53/255,127/255,231/255],[211/255,45/255,175/255]]}}},{cannon:296}],131:[function(a,b,c){function d(a){this.mod=a,this.time=0,this.randX=.5*Math.random()+.5,this.randY=.5*Math.random()+.5,this.randOffset=2*Math.random(),this.cone=this.mod.awd.loader.getObjectByName("cone"),this.ring=this.mod.awd.loader.getObjectByName("ring")}var e=a("gl-matrix"),f=e.quat,g=f.create(),h=f.create(),i=f.create();d.prototype={preRender:function(){this.time+=.5*this.mod.scene.dt,f.rotateX(g,i,this.randX+this.time),f.rotateY(g,g,this.randY+this.time),this.cone.rotation=g,this.cone.invalidate(),f.rotateX(h,i,this.randX+this.randOffset+.6*this.time),f.rotateY(h,h,this.randY+this.randOffset+.6*this.time),this.ring.rotation=h,this.ring.invalidate()}},b.exports=d},{"gl-matrix":352}],132:[function(a,b,c){function d(a){this.mod=a,this.scene=a.scene,this.awd=a.awd,this.objs={},this.materials={},this.tls={},this.createMaterials()}var e=(a("math"),a("../../materials/activable")),f=[{name:"circle",nb:3,scale:!0,textures:["common/green","common/green","common/green"],startAt:.11,offset:.01},{name:"arc",nb:4,scale:!1,textures:["common/aquarelle","common/blue","common/green","common/pink"],startAt:.84,offset:.01}];d.prototype={createMaterials:function(){for(var a=this.mod.awd.mats,b=a.lib,c=this.awd.texs,d=this.scene.gl,g=0,h=f.length;g<h;g++)for(var i=f[g],j=0;j<i.nb;j++){var k=i.textures[j],l=new e(this.scene,d,c,k),m=i.name+"_"+(j+1);this.materials[m]=l,b.setOcclu(l),a.registerMaterial(l,i.name+"_"+(j+1))}},init:function(){this.createTls()},createTls:function(){for(var a=0,b=f.length;a<b;a++)for(var c=f[a],d=0;d<c.nb;d++){var e=c.name+"_"+(d+1),g=this.mod.awd.loader.getObjectByName("track_"+c.name+"_"+(d+1));g._activated=!1,this.objs[e]=g;var h=this.materials[e],i=new TimelineMax({paused:!0});c.scale&&(g._scale=1,i.to(g,.2,{_scale:1.2,delay:.02*d,ease:Back.easeOut.config(4)}),i.to(g,.2,{_scale:1,delay:.02*d,ease:Back.easeOut.config(4)})),i.to(h,.3,{activation:8,delay:.02*d,ease:Expo.easeOut},0),i.to(h,.5,{activation:1,delay:.02*d,ease:Expo.easeOut}),this.tls[e]=i}},preRender:function(){for(var a=this.mod.tracks.tracks[0],b=a.spline.getNearestPoint(a.ball.body),c=a.spline.getProgressAtPoint(b),d=0,e=f.length;d<e;d++)for(var g=f[d],h=0;h<g.nb;h++){var i=g.name+"_"+(h+1),j=this.objs[i],k=g.startAt+g.offset*h,l=k+.05;g.scale&&j.setScale(j._scale),c>k&&c<l&&!j._activated&&(j._activated=!0,this.tls[i].kill(),this.tls[i].play(0)),c>=l&&j._activated&&(j._activated=!1)}}},b.exports=d},{"../../materials/activable":142,math:114}],133:[function(a,b,c){var d=function(b){var c="";return c+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\nuniform float uActivation;\n\nIN vec2 vTexCoord;\nIN vec2 vTexCoord1;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  IN mediump vec3 vWorldTangent;\n  IN mediump vec3 vWorldBitangent;\n#endif\n\n\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  IN vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  "+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n// INCLUDES\n// =========\n\n"+a("nanogl-pbr/glsl/includes/ibl.glsl")()+'\n\n\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n\n\n\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n\n\n  vec3 diffuseCoef = vec3(0.0);\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 ambientCoef = vIrradiance;\n  #else\n    vec3 ambientCoef = SampleSH(worldNormal, uSHCoeffs );\n  #endif\n\n  #pragma SLOT lightsf\n\n  diffuseCoef += ambientCoef;\n\n\n\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n\n  #if HAS_cavity\n    #ifndef cavityStrength\n      #define cavityStrength(k) vec2(1.0)\n    #endif\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  \n  \n  #if HAS_lightmap && enableGI\n    #if HAS_albedoAttenuation\n      diffuseCoef *= albedoAttenuation();\n    #endif\n    diffuseCoef  += lightmap();\n  #endif\n\n  FragColor.xyz = (diffuseCoef*albedoSq + specularColor) * uActivation;\n\n\n  #if HAS_exposure\n    FragColor.xyz *= vec3( exposure() );\n  #endif\n\n  \n  #if gammaMode( GAMMA_STD ) && HAS_gamma\n    FragColor.xyz = pow( FragColor.xyz, vec3( gamma() ) );\n  #endif\n\n  #if gammaMode( GAMMA_2_2 )\n    FragColor.xyz = pow( FragColor.xyz, vec3( 1.0/2.2 ) );\n  #endif\n\n  #if gammaMode( GAMMA_TB )\n    {\n      vec3 c = FragColor.xyz;\n      vec3 sqrtc = sqrt( c );\n      FragColor.xyz = (sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n    }\n  #endif\n\n\n\n\n  FragColor.a = 1.0;\n\n}\n'};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/ibl.glsl":373,"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],134:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new j,this.iLightmap=this.inputs.add(new g("lightmap",3)),this.iAlbedoAtt=this.inputs.add(new g("albedoAttenuation",1)),this.iUVOffset=this.inputs.add(new g("uvOffset",2,g.VERTEX)),this.iUVScale=this.inputs.add(new g("uvScale",2,g.VERTEX)),this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.conserveEnergy=this.inputs.add(new h("receiveShadows",!0)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.activation=1,this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="wave_stdgi",this._precision="highp",this._vertSrc=a("glsl/pbr-gi.vert")(),this._fragSrc=a("./activable.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4.create();d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("stdgi"))},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),c.uWorldMatrix(a._wmatrix),c.uActivation(this.activation),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"./activable.frag":133,"gl-matrix":352,"glsl/pbr-gi.vert":68,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],135:[function(a,b,c){function d(b,c){this.ibl=null,this.prg=null,this.mat=c,this.inputs=new h,this.depthFormat=new g("depthFormat",["D_RGB","D_DEPTH"]),this.inputs.add(this.depthFormat),this.config=new e,this._prgcache=f.getCache(b),this._uid="wave_depth",this._precision="highp",this._vertSrc=a("./wave-depth.vert")(),this._fragSrc=a("nanogl-pbr/glsl/depthpass.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=(a("nanogl-pbr/lib/input"),a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/enum")),h=a("nanogl-pbr/lib/chunks-tree"),i=a("gl-matrix").mat4.create();d.prototype={setLightSetup:function(a){this.inputs.remove(this.depthFormat),this.depthFormat=a.depthFormat.createProxy(),this.inputs.add(this.depthFormat)},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),b.modelViewProjectionMatrix(i,a._wmatrix),this.prg.uMVP(i),c.setupInputs(this),c.uWaveFrequency(this.mat.uWaveFrequency),c.uWaveAmplitude(this.mat.uWaveAmplitude),c.uWaveSpeed(this.mat.uTime*this.mat.uWaveSpeed)},_isDirty:function(){return null===this.prg||this.inputs._isDirty},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"./wave-depth.vert":136,"gl-matrix":352,"nanogl-pbr/glsl/depthpass.frag":370,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],136:[function(a,b,c){var d=function(a){var b="";return b+="#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\nuniform float uTime;\n\nuniform float uWaveFrequency;\nuniform float uWaveAmplitude;\nuniform float uWaveSpeed;\n\n#if depthFormat( D_RGB )\n  varying vec2 fragZW;\n#endif\n\n\nvec3 GetNewVertPosition( vec3 p ) {\n  p.y += cos( aTexCoord.y * uWaveFrequency + uWaveSpeed ) * uWaveAmplitude * (0.7 + ((1.0 - aTexCoord.y) * 0.3));\n  return p;\n}\n\nvoid main(void){\n\n  vec4 pos = vec4( GetNewVertPosition( aPosition ), 1.0 );\n\n  gl_Position = uMVP * pos;\n\n  #if depthFormat( D_RGB )\n    fragZW=gl_Position.zw;\n  #endif\n}\n"};d.toString=d,b.exports=d},{}],137:[function(a,b,c){function d(a){this.section=a,this.material=a.awd.getMaterial("wave")}a("../../utils");d.prototype={constructor:d,preRender:function(){this.material.uTime+=this.section.scene.dt}},b.exports=d},{"../../utils":163}],138:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.depthPass=new l(b,this),this.inputs=new j,this.iLightmap=this.inputs.add(new g("lightmap",3)),this.iAlbedoAtt=this.inputs.add(new g("albedoAttenuation",1)),this.iUVOffset=this.inputs.add(new g("uvOffset",2,g.VERTEX)),this.iUVScale=this.inputs.add(new g("uvScale",2,g.VERTEX)),this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.conserveEnergy=this.inputs.add(new h("receiveShadows",!0)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.uWaveFrequency=3*Math.PI,this.uWaveAmplitude=.03,this.uWaveSpeed=-3,this.uTime=0,this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="wave_stdgi",this._precision="highp",this._vertSrc=a("./wave.vert")(),this._fragSrc=a("glsl/pbr-gi.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4.create(),l=a("../depth");d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("stdgi"))},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),c.uWorldMatrix(a._wmatrix),c.uWaveFrequency(this.uWaveFrequency),c.uWaveAmplitude(this.uWaveAmplitude),c.uWaveSpeed(this.uTime*this.uWaveSpeed),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"../depth":135,"./wave.vert":139,"gl-matrix":352,"glsl/pbr-gi.frag":67,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],139:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec2 aTexCoord1;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\nIN vec3 yolo;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\n\nuniform float uWaveFrequency;\nuniform float uWaveAmplitude;\nuniform float uWaveSpeed;\n\nOUT vec2 vTexCoord;\nOUT vec2 vTexCoord1;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n\n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n#define PI 3.141592654\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvec3 GetNewVertPosition( vec3 p ) {\n  p.y += cos( aTexCoord.y * uWaveFrequency + uWaveSpeed ) * uWaveAmplitude * (0.7 + ((1.0 - aTexCoord.y) * 0.3));\n  return p;\n}\n\nvec3 GetNewVertNormal( vec3 p ) {\n  p.x += sin( aTexCoord.y * uWaveFrequency + uWaveSpeed );\n  return p;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec3 newPosition = GetNewVertPosition( aPosition );\n\n  vec3 newNormal = GetNewVertNormal( aNormal );\n\n  vec4 pos = vec4( newPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n  vWorldNormal    = rotate( uWorldMatrix, normalize(newNormal) );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n\n  #if HAS_uvScale\n    vTexCoord *= uvScale();\n  #endif\n\n  #if HAS_uvOffset\n    vTexCoord += uvOffset();\n  #endif\n\n  vTexCoord1 = aTexCoord1;\n}\n"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],140:[function(a,b,c){function d(){var a=e.addFolder("8"),b=a.addFolder("tracks");b.add(f.tracks,"render"),b.add(f.tracks,"trailProgress",0,1),b.add(f.tracks,"trailExtent",0,2),b.add(f.tracks,"vOffset",0,3),b.add(f.tracks,"smoothEdge",0,.5);var c=a.addFolder("trails"),d=c.addFolder("progress");d.add(f.trails.progress,"override"),d.add(f.trails.progress,"value",0,1);var g=c.addFolder("extent");g.add(f.trails.extent,"override"),g.add(f.trails.extent,"value",0,1);var h=c.addFolder("gap");h.add(f.trails.gap,"scale",0,.5),h.add(f.trails.gap,"offset",0,30),h.add(f.trails.gap,"brightness",0,10),h.add(f.trails.gap,"contrast",0,20),h.add(f.trails.gap,"noiseRamp",0,1),c.addFolder("bloom").add(f.trails.bloom,"strength",0,3),c.add(f.trails,"uoffset",0,1),c.add(f.trails,"giOffset",-1,1);var i=a.addFolder("panel"),j=i.addFolder("progress");j.add(f.panel.progress,"override"),j.add(f.panel.progress,"value",0,1),i.add(f.panel,"minProgress",0,1),i.add(f.panel,"maxProgress",0,1),i.add(f.panel,"extent",0,2),i.add(f.panel,"smoothEdge",0,1),i.add(f.panel,"brightness",0,10),i.add(f.panel,"contrast",0,20),i.add(f.panel,"vOffset",0,3);var k=a.addFolder("tunnel");k.add(f.tunnel,"brightness",-2,2),k.add(f.tunnel,"contrast",-2,2);var l=a.addFolder("shockwave");l.add(f.shockwave,"enabled").listen(),l.add(f.shockwave,"opacity",0,1).listen(),l.add(f.shockwave,"time",-5,5).listen(),l.add(f.shockwave,"x",0,30),l.add(f.shockwave,"y",-2,5),l.add(f.shockwave,"z",0,1)}var e=a("dev/gui"),f={tracks:{render:!1,trailProgress:.5,trailExtent:.2,vOffset:1,smoothEdge:.0168},trails:{uoffset:.59,giOffset:-.8622,progress:{value:.01,override:!1},extent:{value:.9999,override:!1},gap:{scale:.19,offset:20,brightness:10,contrast:16,noiseRamp:.22},bloom:{strength:.5}},panel:{progress:{value:.001,override:!1},minProgress:.70001,maxProgress:.94,extent:1.0001,smoothEdge:.5001,brightness:.30101,contrast:2.11,vOffset:1e-4},tunnel:{brightness:-.1001,contrast:1.3001},shockwave:{enabled:!1,opacity:1,time:-.501,x:11.01,y:.7,z:.091,centerX:.5,centerY:.5}};b.exports={init:d,params:f}},{"dev/gui":20}],141:[function(a,b,c){function d(a){var b=a.scene;this.gl=b.gl,this.scene=b;var c=this.gl;this.awd=new k(b,this),this.physics=new l(this),this.tracks=new m(this),this.trackCollider=new n(this),this.wave=new o(this),this.activables=new r(this),this.active=!1,this.quad=new f(this.gl),this.initSceneFbo(),this.initBlurFbos(),this.initTunnelFbos(),a.node.add(this.awd.node),a.node.add(this.tracks.trail.node),this.enableStencilMaskCfg=this.scene.glstate.config().enableStencil(!0).colorMask(!0,!0,!0,!0).depthMask(!0).stencilMask(255),this.occluConfig=this.scene.glstate.config().enableCullface(!0).enableDepthTest(!0).colorMask(!1,!1,!1,!1),this.stencilMaskCfg=this.scene.glstate.config().enableStencil(!0).stencilFunc(c.ALWAYS,1,255).stencilOp(c.KEEP,c.KEEP,c.REPLACE).stencilMask(255).colorMask(!1,!1,!1,!1).depthMask(!1),this.stencilTestCfg=this.scene.glstate.config().enableStencil(!0).stencilFunc(c.EQUAL,1,255),this.debugFboCfg=this.scene.glstate.config().enableCullface(!1).enableDepthTest(!1),this.flashCfg=this.scene.glstate.config().enableBlend().blendFunc(c.ONE,c.ONE),this.finalSceneCfg=this.scene.glstate.config().enableBlend().blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA)}function e(a){return new d(a)}var f=(a("nanogl-node"),a("nanogl-primitives-2d/rect")),g=a("nanogl-pf"),h=a("nanogl/fbo"),i=a("when"),j=a("gl-matrix").vec2,k=a("./scene"),l=a("./physics"),m=(a("./spline"),a("./tracks")),n=a("./track-collider"),o=a("./entities/wave"),p=a("sound/player"),q=a("./entities/abstract-forms"),r=a("./entities/activables"),s=a("./gui"),t=(a("nanogl-state/config"),a("nanogl/renderbuffer")),u=a("math"),v=a("sound/player"),w=a("sound/sequencer2"),x=a("cursor"),y=!0,z=j.create();d.prototype={initSceneFbo:function(){var a=this.gl,b=g.getInstance(a);this.pff=b.getRenderableFormat([b.RGBA8]);var c=new h(a);c.bind(),c.attachColor(this.pff.format,this.pff.type),c.getColor().setFilter(!1,!1,!1),c.getColor().clamp(),c.attachDepth(!0,!0,!1),this.sceneFbo=c},initBlurFbos:function(){var a=this.gl,b=g.getInstance(a);this.pff=b.getRenderableFormat([b.RGBA8]),this.blurFbos=[];for(var c=new t(this.gl,36168),d=0;d<3;d++){var e=0===d?1:4,f=new h(a);f.bind(),f.attachColor(this.pff.format,this.pff.type),f.getColor().setFilter(2===d,!1,!1),f.getColor().clamp(),f.resize(1024/e,1024/e),d<1?f.attachDepth(!0,!0,!1):f.attach(36128,c),this.blurFbos.push(f)}this.mainFbo=this.blurFbos[0],this.bloomHFbo=this.blurFbos[1],this.bloomVFbo=this.blurFbos[2],this.fboConfig=this.scene.glstate.config().enableCullface(!1).enableDepthTest(!1).enableBlend().blendFunc(a.ONE,a.ONE)},initTunnelFbos:function(){var a=this.gl,b=g.getInstance(a);this.pff=b.getRenderableFormat([b.RGB8]);var c=new t(this.gl,36168);this.tunnelFbos=[];for(var d=0;d<3;d++){var e=0===d?1:4,f=new h(a);f.bind(),f.attachColor(this.pff.format,this.pff.type,this.pff.internal),f.getColor().setFilter(!0,!1,!1),f.getColor().clamp(),f.resize(1024/e,1024/e),d<1?f.attachDepth(!0,!0,!1):f.attach(36128,c),this.tunnelFbos.push(f)}this.mainTunnelFbo=this.tunnelFbos[0],this.tunnelHFbo=this.tunnelFbos[1],this.tunnelVFbo=this.tunnelFbos[2],this.tunnelConfig=this.scene.glstate.config().enableCullface(!1).enableDepthTest(!1)},setPosition:function(a){a<-1e-4&&(p.setVolume("eigth_loop",1+a),this.hasLeft||(this.hasLeft=!0,this.onLeaving()))},onLeaving:function(){p.play("transition",!1,.9),w.sequencer.removeSound("HUIT"),ga("send","event","wishes-end")},getLoadables:function(){var a=[];return a=a.concat(this.awd.getLoadables()),a=a.concat(this.tracks.getLoadables()),a=a.concat(this.trackCollider.getLoadables()),this.onLoaded=this.onLoaded.bind(this),i.all(a).then(this.onLoaded),a},start:function(){function a(){window.removeEventListener("mouseup",a),x.canvas.transitionOutTuto()}this.active=!0;var b=this;setTimeout(function(){b.tracks.tracks[0].initBall()},400),TweenMax.delayedCall(2,function(){window.addEventListener("mouseup",a),x.canvas.transitionInTuto("HOLD")})},stop:function(){this.active=!1},preRender:function(){y=!y,this.physics.preRender(),this.tracks.preRender(),this.wave.preRender(),this.abstractForms.preRender(),this.activables.preRender()},rttPass:function(){y&&(this.rttTrails(),this.rttTunnel(),s.params.shockwave.enabled&&this.rttScene())},drawTunnelStencil:function(){this.scene.glstate.push(this.stencilMaskCfg),this.awd.render(16),this.scene.glstate.pop()},drawTrailsStencil:function(){this.scene.glstate.push(this.stencilMaskCfg),this.awd.render(8),this.scene.glstate.pop()},applyStencilTest:function(){this.stencilTestCfg.apply()},rttScene:function(){var a=this.gl;this.sceneFbo.bind(),0===this.sceneFbo.width&&this.sceneFbo.resize(this.scene.renderer.width,this.scene.renderer.height),this.sceneFbo.clear(),a.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this.sceneFbo.defaultViewport(),this.renderScene()},rttTrails:function(){var a=this.gl,b=this.scene.camera,c=this.scene.programs.bloomOcclu;c.use(),this.mainFbo.bind(),this.mainFbo.clear(),a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this.mainFbo.defaultViewport(),this.occluConfig.apply(),this.awd.renderProgram(b,c,4),this.awd.renderProgram(b,c,16),this.awd.render(128),this.tracks.render(!0,8,!0)},rttTunnel:function(){var a=this.gl;this.scene.camera;this.scene.glstate.apply(),this.mainTunnelFbo.bind(),this.mainTunnelFbo.clear(),a.clearColor(.6,.6,.6,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this.mainTunnelFbo.defaultViewport(),this.awd.render(8),this.awd.render(32),this.tracks.render(!1,8,!1),this.renderBlurTunnelTex()},render:function(){this.gl;this.scene.glstate.apply(),s.params.shockwave.enabled?this.renderScene():this.renderScene(!0)},renderScene:function(a){this.awd.render(189),a&&this.tracks.render(!1,1,!1)},renderShadowPass:function(a){this.awd.renderDepth(a.cam,1,a.defaultpass),this.awd.renderDepth(a.cam,4,a.defaultpass),this.awd.renderDepth(a.cam,8,a.defaultpass),
this.awd.renderDepth(a.cam,32,a.defaultpass)},postRender:function(){this.gl;s.params.shockwave.enabled&&this.renderFSScene(),this.renderBloom(),this.renderFlash()},renderFSScene:function(){var a=this.gl;this.scene.glstate.apply(),a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.scene.renderer.width,this.scene.renderer.height);var b=this.scene.programs.finalScene;b.use(),z[0]=s.params.shockwave.centerX,z[1]=s.params.shockwave.centerY;var c=s.params.shockwave;b.uTime(s.params.shockwave.time),b.uWaveParams([c.x,c.y,c.z]),b.tTex(this.sceneFbo.getColor()),b.uOpacity(s.params.shockwave.opacity),b.uCenter(z),this.finalSceneCfg.apply(),this.quad.attribPointer(b),this.quad.render()},renderBloom:function(){var a=this.gl;this.scene.glstate.apply();var b=this.scene.programs.bloom;this.bloomHFbo.bind(),this.bloomHFbo.defaultViewport(),a.clearStencil(0),a.clear(a.STENCIL_BUFFER_BIT),this.drawTrailsStencil(),b.use(),b.uResolution([1024,1024]),b.uDirection([1,0]),b.tTex(this.mainFbo.getColor()),this.applyStencilTest(),this.quad.attribPointer(b),this.quad.render(),this.bloomVFbo.bind(),b.uResolution([256,256]),b.uDirection([0,1]),b.tTex(this.bloomHFbo.getColor()),this.quad.render(),a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.scene.renderer.width,this.scene.renderer.height);var b=this.scene.programs.renderBloom;b.use(),b.uStrength(u.map(this.tracks.tracks[0].targetSpeed,.9,1,0,s.params.trails.bloom.strength)),b.tTex(this.bloomVFbo.getColor()),this.fboConfig.apply(),this.quad.attribPointer(b),this.quad.render()},renderBlurTunnelTex:function(){var a=this.gl;this.scene.glstate.apply();var b=this.scene.programs.bloom;this.enableStencilMaskCfg.apply(),this.tunnelHFbo.bind(),this.tunnelHFbo.defaultViewport(),a.clearColor(.6,.6,.6,1),a.clearStencil(0),a.clear(a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this.drawTunnelStencil(),b.use(),b.uResolution([128,128]),b.uDirection([.3,0]),b.tTex(this.mainTunnelFbo.getColor()),this.applyStencilTest(),this.quad.attribPointer(b),this.quad.render(),this.tunnelVFbo.bind(),a.clear(a.COLOR_BUFFER_BIT),b.uResolution([128,128]),b.uDirection([0,.3]),b.tTex(this.tunnelHFbo.getColor()),this.quad.render()},renderFlash:function(){var a=v.getAvancement("SFX_HUIT_climax")||0;a>1.3&&(a=0);var b=u.map(a,.3,1,0,.2);a>1&&(b=u.map(a,1,1.3,.2,0)),b=u.clamp(b,0,.2),this.flashCfg.apply();var c=this.scene.programs.flash;c.use(),c.uStrength(b),this.quad.attribPointer(c),this.quad.render()},debugFbo:function(a){var b=this.gl;b.bindFramebuffer(b.FRAMEBUFFER,null),b.viewport(0,0,this.scene.renderer.width,this.scene.renderer.height);var c=this.scene.programs.debugFbo;c.use(),c.tTex(a.getColor()),this.debugFboCfg.apply(),this.quad.attribPointer(c),this.quad.render()},getCameraPosition:function(a,b){},onLoaded:function(){this.ballMesh=this.awd.loader.getObjectByName("ball"),this.ballMesh.proxiesOnly=!0,this.tracks.init(),this.abstractForms=new q(this),this.activables.init(),this.volume=0}},b.exports=e},{"./entities/abstract-forms":131,"./entities/activables":132,"./entities/wave":137,"./gui":140,"./physics":155,"./scene":156,"./spline":158,"./track-collider":159,"./tracks":161,cursor:19,"gl-matrix":352,math:114,"nanogl-node":368,"nanogl-pf":404,"nanogl-primitives-2d/rect":407,"nanogl-state/config":409,"nanogl/fbo":417,"nanogl/renderbuffer":420,"sound/player":260,"sound/sequencer2":261,when:445}],142:[function(a,b,c){function d(a,b,c,d){return this.scene=a,this.gl=b,this.texs=c,this.texture=d,this.init()}var e=a("../entities/activables/material");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get(this.texture)),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iAlbedoAtt.attachConstant([.3]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Shapes")),a._mask=1,a.perVertexIrrad.set(!0),a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"../entities/activables/material":134}],143:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi-aquarelle");a("nanogl-pbr/lib/input");d.prototype={init:function(){var a=new e(this.gl,this.scene);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/aquarelle")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iAlbedoAtt.attachConstant([.55]),a.aquarelleGI=a.iAquarelleGI.attachSampler("tAquarelleGI","vTexCoord"),a.aquarelleGI.set(this.texs.get("GI-aquarelle")),a.gradient=a.iGradient.attachSampler("tGradient","vTexCoord2"),a.gradient.set(this.texs.get("trail_gradient-y")),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Shapes")),a.perVertexIrrad.set(!0),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi-aquarelle":35,"nanogl-pbr/lib/input":393}],144:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("nanogl-pbr/standard");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([1,1,1]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([.15,.15,.15]),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),a._mask=1,a}},b.exports=d},{"nanogl-pbr/standard":403}],145:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.texs.get("blue_plastic")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.1,.1,.1]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Shapes")),a._mask=1,a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],146:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("nanogl-pbr/standard");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([.7,.7,.7]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([.35,.35,.35]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"nanogl-pbr/standard":403}],147:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([1,1,1]),a.iAlbedoAtt.attachConstant([.5]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([0,0,0]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord"),a.lm.set(this.texs.get("GI-Ground")),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),a.config.enableBlend(),a.config.blendFunc(this.gl.ZERO,this.gl.SRC_COLOR),a}},b.exports=d},{"gl/standard-gi":38}],148:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAblbedo","vTexCoord"),a.albedo.set(this.texs.get("logo")),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Shapes")),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([0,0,0]),a.iAlbedoAtt.attachConstant([.5]),a._mask=1,a.perVertexIrrad.set(!0),a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],149:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi"),f=a("lib/color");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([0,0,0]),a.iGloss.attachConstant(.7),a.specular=a.iSpecular.attachUniform("uSpec"),f.HexInput(a.specular,16702166),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),a._mask=1,a}},b.exports=d},{"gl/standard-gi":38,"lib/color":106}],150:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new j,this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.iGradient=this.inputs.add(new g("gradient",3)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="std",this._precision="highp",this._vertSrc=a("glsl/eight/trails.vert")(),this._fragSrc=a("glsl/eight/trails.frag")(),this.trailProgress=0,this.trailExtent=.3,this.color=[1,1,1],this.time=0,this.uoffset=0,this.bloomMode=0}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4.create(),l=a("../../gui").params;d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),l.trails.progress.override?c.uProgress(l.trails.progress.value):c.uProgress(this.trailProgress),l.trails.extent.override?c.uTrailExtent(l.trails.extent.value):c.uTrailExtent(this.trailExtent),c.uGapScale(l.trails.gap.scale),c.uGapOffset(l.trails.gap.offset*this.gapOffset),c.uColor(this.color),c.uTime(this.time),c.uBrightness(l.trails.gap.brightness),c.uContrast(l.trails.gap.contrast),c.uNoiseRamp(l.trails.gap.noiseRamp),c.uUOffset(l.trails.uoffset),c.uBloomMode(this.bloomMode?1:0)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"../../gui":140,"gl-matrix":352,"glsl/eight/trails.frag":56,"glsl/eight/trails.vert":57,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],151:[function(a,b,c){function d(b,c){this.ibl=null,this.prg=null,this._mask=1,this.scene=c,this.inputs=new j,this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.iGradient=this.inputs.add(new g("gradient",3)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="std",this._precision="highp",this._vertSrc=a("glsl/eight/tunnel.vert")(),this._fragSrc=a("glsl/eight/tunnel.frag")(),this.trailProgress=0,this.trailExtent=.3,this.color=[1,1,1],this.time=0}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4.create(),l=a("../gui").params;d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),c.uWorldMatrix(a._wmatrix),c.uCameraPosition(b._wposition),c.tInnerTunnelTex(this.scene.mods.mods[4].tunnelVFbo.getColor()),c.uResolution([this.scene.renderer.width,this.scene.renderer.height]),c.uBrightness(l.tunnel.brightness),c.uContrast(l.tunnel.contrast)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"../gui":140,"gl-matrix":352,"glsl/eight/tunnel.frag":58,"glsl/eight/tunnel.vert":59,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],152:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi"),f=a("lib/color");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iGloss.attachConstant(.85),a.albedo=a.iAlbedo.attachUniform("uColor"),a.specular=a.iSpecular.attachUniform("uSpecular"),a.fresnel=a.iFresnel.attachUniform("uFresnel"),f.HexInput(a.albedo,0),f.HexInput(a.specular,3158064),f.HexInput(a.fresnel,12566463),a.config.enableBlend(),a.config.blendFunc(this.gl.ONE,this.gl.CONSTANT_COLOR),a.config.blendColor(.95,.95,.95,1),a.config.enableCullface(),a.config.enableDepthTest(),a.config.depthMask(!1),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),a.glossNearest.set(!0),a._mask=2,a}},b.exports=d},{"gl/standard-gi":38,"lib/color":106}],153:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("../entities/wave/material");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/degrade2")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iAlbedoAtt.attachConstant([.3]),a._mask=1,a.perVertexIrrad.set(!0),a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"../entities/wave/material":138}],154:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi-wood");a("nanogl-pbr/lib/input");d.prototype={init:function(){var a=new e(this.gl,this.scene,this.texs);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.texs.get("wood")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iAlbedoAtt.attachConstant([.55]),a.woodGI=a.iWoodGI.attachSampler("tWoodGI","vTexCoord"),a.woodGI.set(this.texs.get("yolood")),a.gradient=a.iGradient.attachSampler("tGradient","vTexCoord2"),a.gradient.set(this.texs.get("trail_gradient-y")),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Shapes")),a.perVertexIrrad.set(!0),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi-wood":37,"nanogl-pbr/lib/input":393}],155:[function(a,b,c){function d(a){this.mod=a,this.scene=a.scene,this.world=null,this.materials={},this.createWorld(),this.createContactMaterials(),this.createBodies()}var e=a("cannon"),f=a("./consts");d.prototype={createWorld:function(){this.world=new e.World,this.world.gravity.copy(f.physics.gravity),this.world.solver.iterations=f.physics.iterations,this.world.allowSleep=!0},createBodies:function(){this.groundBody=new e.Body({mass:0,position:new e.Vec3(0,0,0),shape:new e.Plane,material:this.materials.ground}),this.groundBody.quaternion.setFromEuler(-Math.PI/2,0,0,"XYZ"),this.world.addBody(this.groundBody)},createContactMaterials:function(){var a=new e.Material("ball"),b=new e.Material("ground"),c=new e.Material("track"),d=new e.ContactMaterial(b,a,{friction:2,restitution:.3}),f=new e.ContactMaterial(a,a,{friction:.5,restitution:1}),g=new e.ContactMaterial(a,c,{friction:.01,restitution:.3});this.world.addContactMaterial(d),this.world.addContactMaterial(f),this.world.addContactMaterial(g),this.materials={ball:a,ground:b,track:c}},preRender:function(){var a=this.scene.dt;this.world.step(f.physics.fixedTimeStep,a,f.physics.maxSubSteps)}},b.exports=d},{"./consts":130,cannon:296}],156:[function(a,b,c){function d(a,b){e.call(this,a,q),this.mod=b,this.setupTextures(),this.setupMaterials()}var e=(a("when"),a("assets/awd-scene")),f=(a("lib/net"),a("lib/color"),a("lib/awd"),a("dev/gui"),a("config"),a("gl/unlit-material"),a("gl/shadow-catcher-material"),a("gl/standard-gi")),g=(a("nanogl-pbr/standard"),a("nanogl-pbr/lib/input"),a("./materials/default")),h=a("./materials/ground"),i=a("./materials/ball"),j=a("./materials/wood"),k=a("./materials/metal"),l=a("./materials/blue_plastic"),m=(a("./materials/tunnel_glass"),a("./materials/wave")),n=a("./materials/tunnel-material"),o=a("./materials/logo"),p=a("./materials/aquarelle"),q="eight";d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.getAssetPath=function(a){return q+"/"+a},d.prototype.texPath=function(a){return[this.getAssetPath(a+"_L0.jpg"),this.getAssetPath(a+"_L1.jpg")]},d.prototype.getAwdUrl=function(){return q+"/scene.awd"},d.prototype.setupTextures=function(){this.texs.makeTex("GI-Ground",this.getAssetPath("GI-Ground.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("GI-Shapes",this.getAssetPath("GI-Shapes.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("blue_plastic",this.getAssetPath("blue_plastic.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("wood",this.getAssetPath("wood.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("yolood",this.getAssetPath("yolood.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("trail_gradient-y",this.getAssetPath("bw-gradient-y.jpg")).setFilter(!0,!1,!1).nobbc(),this.texs.makeTex("trail_gradient",this.getAssetPath("bw-gradient.jpg")).setFilter(!0,!1,!1).nobbc(),this.texs.makeTex("logo",this.getAssetPath("logo.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("GI-aquarelle",this.getAssetPath("GI-aquarelle.jpg")).setFilter(!0,!1,!1)},d.prototype.makeBasicMaterial=function(a,b){b=void 0===b||b;var c=this.scene.gl,d=new f(c);return d._precision="highp",this.scene.env.setupMat(d),d.setLightSetup(this.scene.lights.setup),d.albedo=d.iAlbedo.attachSampler("tAblbedo","vTexCoord"),d.albedo.set(this.scene.texlib.get(a)),b&&(d.lm=d.iLightmap.attachSampler("tLM","vTexCoord1"),d.lm.set(this.texs.get("GI-Shapes"))),d.iGloss.attachConstant(.05),d.iSpecular.attachConstant([0,0,0]),d.iAlbedoAtt.attachConstant([.5]),d.conserveEnergy.set(!1),d.perVertexIrrad.set(!0),d._mask=1,this.mats.lib.setOpaque(d),d},d.prototype.makeTunnelMaterial=function(){var a=this.scene.gl,b=new n(a,this.scene);return b._precision="highp",this.scene.env.setupMat(b),b.setLightSetup(this.scene.lights.setup),b.iAlbedo.attachConstant([0,0,0]),b.iGloss.attachConstant(.3),b.iSpecular.attachConstant([.4,.4,.4]),b.conserveEnergy.set(!1),b.perVertexIrrad.set(!0),b._mask=1,this.mats.lib.setOpaque(b),b},d.prototype.setupMaterials=function(){var a=this.mats,b=a.lib,c=this.scene.gl,d=new g(this.scene,c,this.texs);b.setOpaque(d),a.registerMaterial(d,"default");var d=this.makeBasicMaterial("common/degrade1");b.setOcclu(d),a.registerMaterial(d,"degrade1");var d=this.makeBasicMaterial("common/green");b.setOcclu(d),a.registerMaterial(d,"green");var d=this.makeBasicMaterial("common/marbre");a.registerMaterial(d,"marbre");var d=new j(this.scene,c,this.texs);b.setWood(d),a.registerMaterial(d,"wood");var d=new p(this.scene,c,this.texs);b.setOcclu(d),a.registerMaterial(d,"aquarelle");var d=new k(this.scene,c,this.texs);b.setOpaque(d),a.registerMaterial(d,"metal");var d=new o(this.scene,c,this.texs);b.setOpaque(d),a.registerMaterial(d,"logo");var d=new m(this.scene,c,this.texs);b.setOpaque(d),a.registerMaterial(d,"wave");var d=new l(this.scene,c,this.texs);b.setOpaque(d),a.registerMaterial(d,"blue_plastic");var d=this.makeTunnelMaterial();b.setBlurredGlass(d),a.registerMaterial(d,"tunnel_glass");var d=new i(this.scene,c,this.texs);b.setBall(d),a.registerMaterial(d,"ball");var d=new h(this.scene,c,this.texs);b.setOpaque(d),a.registerMaterial(d,"ground")},b.exports=d},{"./materials/aquarelle":143,"./materials/ball":144,"./materials/blue_plastic":145,"./materials/default":146,"./materials/ground":147,"./materials/logo":148,"./materials/metal":149,"./materials/tunnel-material":151,"./materials/tunnel_glass":152,"./materials/wave":153,"./materials/wood":154,"assets/awd-scene":1,config:18,"dev/gui":20,"gl/shadow-catcher-material":33,"gl/standard-gi":38,"gl/unlit-material":39,"lib/awd":99,"lib/color":106,"lib/net":110,"nanogl-pbr/lib/input":393,"nanogl-pbr/standard":403,when:445}],157:[function(a,b,c){function d(a,b){this.mod=a,this.catmull=b,this.gl=a.gl,this.scene=this.mod.scene,this.points=[],this.debugMaterial=new g(a);var c=this.getCatmullPoints(h.spline.step);this.points=new f(this.gl,new Float32Array(c))}var e=a("gl-matrix"),f=a("entities/primitives/points"),g=a("modules/common/debug-material"),h=a("./consts"),i=e.vec3,j=i.create();d.prototype={getCatmullPoints:function(a){for(var b=[],c=this.catmull.numSegs,d=0;d<c;d+=a){var e=d;this.catmull.getPositionAt(j,e),b.push(j[0],j[1],j[2])}return b},render:function(){this.debugMaterial.prepare(this.mod.awd.node),this.points.render(this.debugMaterial.prg)}},b.exports=d},{"./consts":130,"entities/primitives/points":25,"gl-matrix":352,"modules/common/debug-material":127}],158:[function(a,b,c){function d(a,b){this.mod=a,this.points=b,this.catmullPoints=[],this.gl=a.gl,this.catmull=null,this.createSpline()}var e=a("cannon"),f=a("lib/catmull"),g=(a("./spline-debug"),a("gl-matrix")),h=(g.vec3,new e.Vec3),i=new e.Vec3;d.prototype={createSpline:function(){this.catmull=new f(this.points);for(var a=[],b=0;b<=1;b+=.005){var c=Math.floor(this.catmull.numSegs*b);this.catmull.getPositionAt(a,c),this.catmullPoints.push(a[0],a[1],a[2])}},getPositionAt:function(a,b){return this.catmull.getPositionAt(a,b*this.catmull.numSegs)},getNearestPoint:function(a){for(var b=1/0,c=null,d=0;d<this.points.length;d+=3){var e=h.set(this.points[d],this.points[d+1],this.points[d+2]),f=a.position.distanceTo(e);b>f&&(b=f,c=i.copy(e))}return c},getNearestPointFromPosition:function(a){for(var b=1/0,c=null,d=0;d<this.catmullPoints.length;d+=3){var e=h.set(this.catmullPoints[d],this.catmullPoints[d+1],this.catmullPoints[d+2]),f=a.distanceTo(e);b>f&&(b=f,c=i.copy(e))}return c},getProgressAtPoint:function(a){if(!a)return 0;for(var b=0;b<this.points.length;b+=3){var c=h.set(this.points[b],this.points[b+1],this.points[b+2]);if(c.x===a.x&&c.y===a.y&&c.z===a.z)return b/this.points.length}},preRender:function(){this.ball.preRender()},render:function(){}},b.exports=d},{"./spline-debug":157,cannon:296,"gl-matrix":352,"lib/catmull":105}],159:[function(a,b,c){function d(a){this.mod=a,this.onLoaded=this.onLoaded.bind(this)}var e=a("config"),f=a("lib/net"),g=a("cannon"),h=a("./utils");d.prototype={getLoadables:function(){var a=e.asset_url("eight/track.bin");return f.loadBytes(a).then(this.onLoaded)},createBodies:function(a){var b=h.parseBin(a),c=new g.Trimesh(b.vertices,b.indices),d=new g.Body({mass:0,shape:c,material:this.mod.physics.materials.track});this.mod.physics.world.addBody(d)},onLoaded:function(a){this.createBodies(a)}},b.exports=d},{"./utils":163,cannon:296,config:18,"lib/net":110}],160:[function(a,b,c){function d(a,b){this.mod=a,this.gl=a.gl,this.scene=a.scene,this.mousedown=!1,this.ballOutside=!1,this.climax=!1,this.wasDown=!1,this.targetSpeed=0,this.targetProgress=0,this.targetSplinePoint=l.create(),this.spline=new f(a,b),this.ball=new g(this,a,a.ballMesh.proxy()),this.trail=new m(a.scene)}var e=a("cannon"),f=a("./spline"),g=a("./ball"),h=a("modules/common/box-mesh"),i=a("math/ease"),j=a("sound/player"),k=(a("lib/mouse"),a("gl-matrix")),l=(a("./gui").params,k.vec3),m=(l.create(),a("./trail"));d.prototype={createTargetDebug:function(){this.targetDebug=new h(this.gl,this.mod),this.targetDebug.setScale(.03),this.targetDebug.updateWorldMatrix(),this.mod.awd.node.add(this.targetDebug)},updateTargetProgress:function(a){if(!(this.targetSpeed>.1)||a){var b=this.spline.getNearestPoint(this.ball.body),c=this.spline.getProgressAtPoint(b);this.targetProgress=c}},getBallProgress:function(){var a=new e.Vec3(this.ball.cnode.node.position[0],this.ball.cnode.node.position[1],this.ball.cnode.node.position[2]),b=this.spline.getNearestPointFromPosition(a);return this.spline.getProgressAtPoint(b)},initBall:function(){this.updateTargetProgress(!0),TweenMax.to(this,1,{targetSpeed:this.targetSpeed+.4})},preRender:function(){var a=this.scene.dt;if(this.ball.preRender(),!this.ballOutside){this.mousedown?(this.targetSpeed+=.6*a,this.ball.body.sleep()):(this.targetSpeed-=.3*a,this.ball.body.wakeUp()),this.targetSpeed=Math.max(0,Math.min(this.targetSpeed,1));var b=1.6*i.easeInQuad(this.targetSpeed);this.targetProgress+=a*b,this.targetProgress%=1,this.spline.getPositionAt(this.targetSplinePoint,this.targetProgress),this.ball.move(this.targetSplinePoint,b),j.getAvancement("SFX_HUIT_propulsion_UP")>6&&!1===this.climax&&j.isPlaying("SFX_HUIT_propulsion_UP")&&this.onClimax()}},onClimax:function(){this.climax=!0,j.stop("SFX_HUIT_climax"),j.play("SFX_HUIT_climax",!1);var a=this;setTimeout(function(){a.mousedown?a.wasDown=!0:a.wasDown=!1,a.ball.explode(),a.mousedown=!1,TweenMax.to(a,.8,{targetSpeed:0}),j.stop("SFX_HUIT_propulsion_UP"),setTimeout(function(){a.ball.show(),a.initBall(),a.climax=!1},2e3)},1100)},render:function(){this.spline.render()}},b.exports=d},{"./ball":129,"./gui":140,"./spline":158,"./trail":162,cannon:296,"gl-matrix":352,"lib/mouse":109,"math/ease":113,"modules/common/box-mesh":123,"sound/player":260}],161:[function(a,b,c){function d(a){this.mod=a,this.tracks=[],this.splinePoints=[],this.gravityScale=1,this.trail=new k(a.scene),this.bind()}var e=a("when"),f=a("config"),g=a("lib/net"),h=a("lib/mouse"),i=a("math"),j=a("./track"),k=a("./trail"),l=a("./utils"),m=a("./consts"),n=a("sound/player"),o=a("./gui").params,p=[[0,0,0],[-.015,-.045,-.015],[.015,.045,.015]],q=!1,r=0,s=0;d.prototype={getLoadables:function(){var a=f.asset_url("eight/spline.bin"),b=[];return b=b.concat(g.loadBytes(a)),b=b.concat(this.trail.getLoadables()),this.onLoaded=this.onLoaded.bind(this),e.all(b).then(this.onLoaded),b},onLoaded:function(a){var b=a[0],c=l.parseBin(b);this.splinePoints=Array.prototype.slice.call(c.vertices);for(var d=[].concat(this.splinePoints),e=60;e--;)d.push(d.shift());this.splinePoints=d;for(var f=this.splinePoints.slice(0,3),g=0;g<3;g++)this.splinePoints.push(f[0],f[1],f[2])},bind:function(){this.onLoaded=this.onLoaded.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onGroundCollide=this.onGroundCollide.bind(this),h.on("down",this.onMouseDown),h.on("up",this.onMouseUp),this.mod.physics.groundBody.addEventListener("collide",this.onGroundCollide)},onMouseDown:function(a,b){if(!(this.tracks.length&&this.tracks[0].ballOutside||!this.mod.active)){r=Date.now();for(var c=0,d=this.tracks.length;c<d&&0===b.button;c++){var e=this.tracks[c];e.mousedown=!0,e.wasDown=!1,e.updateTargetProgress()}n.stop("SFX_HUIT_propulsion_UP"),n.stop("SFX_HUIT_propulsion_DOWN");n.getAvancement("SFX_HUIT_propulsion_DOWN");n.play("SFX_HUIT_propulsion_UP",!1,1,2*this.tracks[0].targetSpeed)}},onMouseUp:function(a,b){if(!(this.tracks.length&&this.tracks[0].ballOutside||!this.mod.active)){var c=Date.now();s=c-r,s<110&&(q=!0);var d=n.getAvancement("SFX_HUIT_propulsion_UP");n.stop("SFX_HUIT_propulsion_UP"),n.stop("SFX_HUIT_propulsion_DOWN"),!1!==this.tracks[0].climax||this.tracks[0].wasDown||n.play("SFX_HUIT_propulsion_DOWN",!1,1,7.184-d);for(var e=0,f=this.tracks.length;e<f&&0===b.button;e++){var g=this.tracks[e];g.mousedown=!1,g.climax=!1}}},onGroundCollide:function(a){var b=a.body.track;b.ballOutside=!0,b.ball.hide(),b.ball.show(),b.ballOutside=!1},init:function(){this.createTrack()},createTrack:function(){var a=new j(this.mod,this.splinePoints);this.tracks.push(a)},preRender:function(){var a=this.mod.scene.dt;this.tracks[0].mousedown?this.gravityScale-=a:this.gravityScale+=a,this.gravityScale=Math.max(0,Math.min(this.gravityScale,1)),this.mod.physics.world.gravity.y=m.physics.gravity.y*this.gravityScale;for(var b=0,c=this.tracks.length;b<c;b++){this.tracks[b].preRender()}this.trail.preRender()},renderDepth:function(a,b,c){for(var d=0,e=this.tracks.length;d<e;d++){var f=this.tracks[d];o.tracks.render&&f.render();var g=f.targetProgress,h=i.map(f.targetSpeed,0,1,0,.2);this.trail.renderDepth(a,b,c,{progress:g,extent:h})}},render:function(a,b,c){for(var d=0,e=this.tracks.length;d<e;d++){var f=this.tracks[d];o.tracks.render&&f.render();var g=f.targetProgress,h=i.map(f.targetSpeed,.6,1,0,.4),j=n.getAvancement("SFX_HUIT_climax")||0;j>1.3&&(j=0);var k=i.map(j,0,.2,2,6);j>1&&(k=i.map(j,1,1.3,6,0)),k=i.clamp(k,2,6);for(var l=0;l<p.length;l++){var q=(i.map(f.targetSpeed,.7,1,2,5),[m.trails.colors[l][0]*k,m.trails.colors[l][1]*k,m.trails.colors[l][2]*k]);this.trail.node.position[0]=p[l][0],this.trail.node.position[1]=p[l][1],this.trail.node.position[2]=p[l][2],this.trail.node.invalidate(),this.trail.node.updateWorldMatrix(),this.trail.preRender(),this.trail.render(b,{progress:g,extent:h,gapOffset:p[l][0],color:a?m.trails.colors[l]:q,time:this.mod.scene.time,materialName:8===b?"Bloom_Trail_Gradient":"Trail_Gradient",bloomMode:c})}}}},b.exports=d},{"./consts":130,"./gui":140,"./track":160,"./trail":162,"./utils":163,config:18,"lib/mouse":109,"lib/net":110,math:114,"sound/player":260,when:445}],162:[function(a,b,c){function d(a){e.call(this,a,"eight"),this.setupTextures(),this.setupMaterials()}var e=(a("when"),a("assets/awd-scene")),f=(a("lib/net"),a("lib/color"),a("lib/awd"),a("dev/gui"),a("config"),a("gl/unlit-material"),a("gl/shadow-catcher-material")),g=a("./materials/trail/trail-material");a("nanogl-pbr/lib/input");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.getAssetPath=function(a){return"eight/"+a},d.prototype.texPath=function(a){return[this.getAssetPath(a+"_L0.jpg"),this.getAssetPath(a+"_L1.jpg")]},d.prototype.getAwdUrl=function(){return"eight/trails.awd"},d.prototype.setupTextures=function(){this.texs.makeTex("trail_gradient","eight/bw-gradient.jpg").setFilter(!0,!1,!1).nobbc()},d.prototype.setupMaterials=function(){var a=this.mats,b=a.lib,c=this.scene.gl,d=new g(c);d._precision="highp",this.scene.env.setupMat(d),d.iAlbedo.attachConstant([1,0,0]),d.iGloss.attachConstant(.05),d.iSpecular.attachConstant([.35,.35,.35]),d.gradient=d.iGradient.attachSampler("tGradient","uvProgress"),d.gradient.set(this.texs.get("trail_gradient")),
d.conserveEnergy.set(!1),b.setOpaque(d),d.config.enableDepthTest(!0).depthMask(!0).enableBlend(!0).blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),a.registerMaterial(d,"Trail_Gradient");var d=new g(c);d._precision="highp",this.scene.env.setupMat(d),d.iAlbedo.attachConstant([1,0,0]),d.iGloss.attachConstant(.05),d.iSpecular.attachConstant([.35,.35,.35]),d.gradient=d.iGradient.attachSampler("tGradient","uvProgress"),d.gradient.set(this.texs.get("trail_gradient")),d.conserveEnergy.set(!1),d._mask=8,d.config.enableDepthTest(!0).depthMask(!0).enableBlend(!0).blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),a.registerMaterial(d,"Bloom_Trail_Gradient");var d=new f(c);d._precision="highp",d.setLightSetup(this.scene.lights.setup)},d.prototype.renderDepth=function(a,b,c,d){var f=this.mats.getMaterial("Trail_Gradient");f.trailProgress=d.progress,f.trailExtent=d.extent,f.gapOffset=d.gapOffset,e.prototype.renderDepth.call(this,a,b,c)},d.prototype.render=function(a,b){var c=this.mats.getMaterial(b.materialName);c.trailProgress=b.progress,c.trailExtent=b.extent,c.color=b.color,c.gapOffset=b.gapOffset,c.time=b.time,c.bloomMode=b.bloomMode,e.prototype.render.call(this,a,c.config)},b.exports=d},{"./materials/trail/trail-material":150,"assets/awd-scene":1,config:18,"dev/gui":20,"gl/shadow-catcher-material":33,"gl/unlit-material":39,"lib/awd":99,"lib/color":106,"lib/net":110,"nanogl-pbr/lib/input":393,when:445}],163:[function(a,b,c){b.exports={parseBin:function(a){var b=new Int32Array(a,0,8);return{indices:new Uint32Array(a,8,b[0]),vertices:new Float32Array(a,8+4*b[0],b[1])}}}},{}],164:[function(a,b,c){function d(a){this.active=!1,this.konami=!1,this.lastKonamiTrigger=0,this.onLoaded=this._onLoaded.bind(this),this.onBtnClic=this._onBtnClic.bind(this),this.onBtnOver=this._onBtnOver.bind(this),this.onBtnOut=this._onBtnOut.bind(this);var b=a.scene;this.scene=b,this.awd=new k(b),a.node.add(this.awd.node),this.awd.node.rotateY(3*-Math.PI/4),BrowserDetect.isDesktop&&this.awd.node.setScale(1.2),this.hoverables=[],this.floatings=[],this.confeti=null,this.onClick=this._onClick.bind(this),i.on("down",this.onClick)}function e(a){return new d(a)}var f=(a("nanogl/program"),a("nanogl-node"),a("when")),g=a("entities/floating"),h=(a("math/responsive"),a("lib/hoverable")),i=(a("sound/sequencer2"),a("lib/mouse")),j=a("sound/player"),k=a("./scene"),l=a("cursor"),m=a("gl-matrix/src/gl-matrix/mat4"),n=m.create();new Float32Array(2);d.prototype={setPosition:function(a){},getLoadables:function(){var a=[];return a=a.concat(this.awd.getLoadables()),f.all(a).then(this.onLoaded),a},start:function(){this.active=!0;var a=this;setTimeout(function(){a.active},100)},stop:function(){this.active=!1},_onClick:function(){},createConfetis:function(){if(null!==this.confeti){var a=Math.random()*Math.PI*2,b=Math.random(),c=Math.cos(a)*(1+2*b),d=Math.sin(a)*(1+2*b);this.confeti.create([c,0,d])}},preRender:function(){if(this.konami){this.scene.time-this.lastKonamiTrigger>.25&&(this.createConfetis(),this.lastKonamiTrigger=this.scene.time-.5*Math.random())}this.scene.renderer.width,this.scene.renderer.height;m.invert(n,this.awd.node._matrix),this.awd.node.position[2]=BrowserDetect.device.landscape()&&!BrowserDetect.isDesktop?-.45:0,this.awd.node.invalidate();for(var a=this.scene.dt,b=0;b<this.hoverables.length;b++){var c=this.hoverables[b];c.preRender(a),(BrowserDetect.isMobile||BrowserDetect.isTablet)&&c.animate(b)}for(var b=0;b<this.floatings.length;b++)this.floatings[b].preRender(a);this.awd.preRender(a)},rttPass:function(){},render:function(){this.awd.render(1),this.awd.render(2)},renderShadowPass:function(a){this.awd.renderPass(a.cam,1,a.defaultpass)},postRender:function(){},getCameraPosition:function(a,b){},onKonami:function(){this.konami=!0;for(var a=0;a<this.hoverables.length;a++)this.hoverables[a].konamiOn=!0},getMesh:function(a){return this.awd.loader.getObjectByName(a)},_onLoaded:function(){if(this.logo=this.getMesh("logo_group"),this.btns=this.getMesh("btns_group"),BrowserDetect.isMobile||BrowserDetect.isTablet){for(var a=0,b=this.btns._children.length;a<b;a++){var c=this.btns._children[a],d=this.awd.meshes.indexOf(c);this.awd.meshes.splice(d,1)}for(var a=0,b=this.logo._children.length;a<b;a++){var c=this.logo._children[a],d=this.awd.meshes.indexOf(c);this.awd.meshes.splice(d,1)}}for(var a=0;a<this.awd.meshes.length;a++){var e=this.awd.meshes[a];if(0===e.name.indexOf("hover"))this.addHoverable(e);else if(0===e.name.indexOf("btn_")&&BrowserDetect.isDesktop)this.addBtn(e);else if(0===e.name.indexOf("floating_")){var f=new g(e);f.rotationAmount=.1,f.positionAmount=.01,this.floatings.push(f)}}this.confeti=this.scene.confeti.createFactory(this.awd.node,{count:30,spread:1.5,size:1.05,heigth:1.5,speed:1,lifeTime:.8})},_onBtnClic:function(a){var b=a.node.name;"btn_twitter"===b?document.getElementById("twitter_link").click():"btn_insta"===b?document.getElementById("insta_link").click():"btn_fb"===b?document.getElementById("fb_link").click():"btn_restart"===b&&document.location.reload(!1)},_onBtnOver:function(){l.enableHover(),j.play("hover_social")},_onBtnOut:function(){l.disableHover()},addHoverable:function(a){var b=new h(this.scene,a,.15);this.hoverables.push(b)},addBtn:function(a){var b=new h(this.scene,a,.05);b.refDist=.1,this.hoverables.push(b),b.on("clic",this.onBtnClic),b.on("rollover",this.onBtnOver),b.on("rollout",this.onBtnOut)}},b.exports=e},{"./scene":165,cursor:19,"entities/floating":22,"gl-matrix/src/gl-matrix/mat4":357,"lib/hoverable":108,"lib/mouse":109,"math/responsive":119,"nanogl-node":368,"nanogl/program":419,"sound/player":260,"sound/sequencer2":261,when:445}],165:[function(a,b,c){function d(a){e.call(this,a,i),this.setupTextures(),this.setupMaterials()}var e=(a("when"),a("assets/awd-scene")),f=(a("lib/net"),a("lib/color")),g=(a("lib/awd"),a("dev/gui"),a("config"),a("gl/unlit-material"),a("gl/shadow-catcher-material"),a("nanogl-pbr/standard")),h=a("gl/standard-gi"),i=(a("nanogl-pbr/lib/input"),"end");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.getAssetPath=function(a){return i+"/"+a},d.prototype.texPath=function(a){return[this.getAssetPath(a+"_L0.jpg"),this.getAssetPath(a+"_L1.jpg")]},d.prototype.getAwdUrl=function(){return i+"/scene.awd"},d.prototype.preRender=function(a){},d.prototype.setupTextures=function(){this.texs.makeTex("ground_GI",this.getAssetPath("ground_GI.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("objects_GI",this.getAssetPath("objects_GI.jpg")).setFilter(!0,!1,!1)},d.prototype.makeBasicMaterial=function(a){var b=this.scene.gl,c=new h(b);return c._precision="highp",this.scene.env.setupMat(c),c.setLightSetup(this.scene.lights.setup),c.albedo=c.iAlbedo.attachSampler("tAblbedo","vTexCoord"),c.albedo.set(this.scene.texlib.get(a)),c.lm=c.iLightmap.attachSampler("tLM","vTexCoord1"),c.lm.set(this.texs.get("objects_GI")),c.iGloss.attachConstant(.05),c.iSpecular.attachConstant([0,0,0]),c.iAlbedoAtt.attachConstant([.3]),c.conserveEnergy.set(!1),c.perVertexIrrad.set(!0),this.mats.lib.setOpaque(c),c},d.prototype.setupMaterials=function(){var a,a,b=this.mats,c=b.lib,d=this.scene.gl;a=this.makeBasicMaterial("common/wood"),b.registerMaterial(a,"wood"),a=this.makeBasicMaterial("common/marbre"),b.registerMaterial(a,"marble"),a=this.makeBasicMaterial("common/blue"),b.registerMaterial(a,"blue"),a=this.makeBasicMaterial("common/green"),b.registerMaterial(a,"green"),a=this.makeBasicMaterial("common/aquarelle"),b.registerMaterial(a,"aquarelle"),a=this.makeBasicMaterial("common/pink"),b.registerMaterial(a,"pink"),a=this.makeBasicMaterial("common/logo_small"),b.registerMaterial(a,"logo");var a=new g(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([0,0,0]),a.iGloss.attachConstant(.7),a.specular=a.iSpecular.attachUniform("uSpec"),f.HexInput(a.specular,16702166),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),c.setOpaque(a),b.registerMaterial(a,"metal");var a=new h(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachUniform("uAblbedo"),f.HexInput(a.albedo,2115965),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("objects_GI")),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([0,0,0]),a.iAlbedoAtt.attachConstant([.3]),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),this.mats.lib.setOpaque(a),b.registerMaterial(a,"solid_blue");var a=new h(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([1,1,1]),a.iAlbedoAtt.attachConstant([.4]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([0,0,0]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("ground_GI")),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),c.setOpaque(a),a._mask=2,a.config.enableBlend(),a.config.blendFunc(d.ZERO,d.SRC_COLOR),b.registerMaterial(a,"ground")},b.exports=d},{"assets/awd-scene":1,config:18,"dev/gui":20,"gl/shadow-catcher-material":33,"gl/standard-gi":38,"gl/unlit-material":39,"lib/awd":99,"lib/color":106,"lib/net":110,"nanogl-pbr/lib/input":393,"nanogl-pbr/standard":403,when:445}],166:[function(a,b,c){function d(a){this.onModelPosChange=this._onModelPosChange.bind(this),this.scene=a,this.mods=[],this.ctxs=[],this.actives=[],this._loaded=!1;for(var b=0;b<j.length;b++){var c=this.makeContext(),d=j[b][1](c);c.setModule(d),c.index=b,this.mods.push(d),this.ctxs.push(c),this.actives.push(!1),c._needMasterLoading=b>0}this._activeCtxs=[],this._pcache=-.123;var e=this.scene.model;e.on(e.POS_CHANGE,this.onModelPosChange),this.updateLifecycle()}function e(){this.onloaded=this._onloaded.bind(this),this.index=0,this.scene=null,this.mod=null,this.node=new f,this._loaded=!1,this._needMasterLoading=!0}var f=a("nanogl-node"),g=a("when"),h=a("gl-matrix"),j=(a("dev/gui"),a("config"),a("lib/net"),a("sections")),k=h.vec3,l=(k.fromValues(0,0,0),k.create(),k.create(),{});d.prototype={_onModelPosChange:function(){this.updateLifecycle()},updateLifecycle:function(){var a,b=this.scene.model._position;for(a=0;a<this.ctxs.length;a++){var c=this.mods[a],d=this.ctxs[a],e=a-b;e=Math.min(1,Math.max(-1,e));var f=d._loaded&&Math.abs(e)<1;this.actives[a]!==f?(c.setPosition(e),d._position=e,f?c.start():c.stop(),this.actives[a]=f):this.actives[a]&&(c.setPosition(e),d._position=e)}},_proxiedCall:function(a,b){for(this._updateActives(),i=0;i<this._activeCtxs.length;i++){var c=this._activeCtxs[i];!c._loaded||c._needMasterLoading&&!this._loaded||c.mod[a](b)}},preRender:function(){var a,b=this.scene.section_sep;for(a=0;a<this.ctxs.length;a++)this.ctxs[a].node.x=j[a][0][0]*b,this.ctxs[a].node.z=-j[a][0][1]*b;this._proxiedCall("preRender",l)},rttPass:function(){this._proxiedCall("rttPass",l)},render:function(){this._proxiedCall("render",l)},renderShadowPass:function(a){this._proxiedCall("renderShadowPass",a)},postRender:function(){this._proxiedCall("postRender",l)},_updateActives:function(){var a=this.scene.model._position;if(a<0&&(a=0),this._pcache!==a){this._activeCtxs.length=0,this._pcache=a;var b=Math.floor(a),c=Math.ceil(a);this._activeCtxs[0]=this.ctxs[b],b!==c&&(this._activeCtxs[1]=this.ctxs[c])}},makeContext:function(){var a=new e;return a.setScene(this.scene),this.scene.root.add(a.node),a},getLoadables:function(){return this.ctxs.reduce(function(a,b){return a.concat(b._getLoadables())},[])},getCurrent:function(){var a=this.scene.model._position,b=0|Math.round(a);return this.mods[b]},step:function(){this._updateActives()},_gui:void 0},e.prototype={setScene:function(a){this.scene=a},setModule:function(a){this.mod=a},_getLoadables:function(){var a=this.mod.getLoadables();return g.all(a).then(this.onloaded),a},_onloaded:function(){this._loaded=!0}},b.exports=d},{config:18,"dev/gui":20,"gl-matrix":352,"lib/net":110,"nanogl-node":368,sections:259,when:445}],167:[function(a,b,c){function d(a){var b=a.scene;this.context=a,this.scene=b}function e(a){return new d(a)}var f=(a("nanogl-node"),a("gl-matrix")),g=(f.mat4,f.vec3);d.prototype={setPosition:function(a){},getLoadables:function(){return[]},start:function(){},stop:function(){},preRender:function(){g.transformMat4(this.scene.loading.screenPos,this.context.node._wposition,this.scene.camera._viewProj)},rttPass:function(){},render:function(){this.scene.loading.render()},renderShadowPass:function(a){},postRender:function(){},getCameraPosition:function(a,b){}},b.exports=e},{"gl-matrix":352,"nanogl-node":368}],168:[function(a,b,c){function d(){this.onLoaded=this._onLoaded.bind(this),this.timelines=[];for(var a=0;a<1;a++)this.timelines[a]=new e}function e(a){this.xforms=a,this.timescale=1}var f=a("config"),g=a("lib/net"),h=a("math"),i=a("gl-matrix"),j=i.quat,k=i.mat4,l=i.vec3,m=j.create(),n=l.create(),o=j.create();j.rotateX(o,o,-Math.PI/2);var p=a("./scale");d.prototype={getLoadables:function(){var a=f.asset_url("one/bar_anim.bin");return g.loadBytes(a).then(this.onLoaded)},_onLoaded:function(a){var b=new Uint16Array(a,0,2),c=b[0],d=b[1],e=1/d;c*=d;for(var f=0;f<1;f++){var g=new Float32Array(a,4+f*(28*c),7*c);this.timelines[f].xforms=g,this.timelines[f].timescale=e}},getTransformAt:function(a,b){this.timelines[0].getTransformAt(a,b)},numFrames:function(){return this.timelines[0].xforms.length/7}},e.prototype={getTransformAt:function(a,b){var c=this.xforms;b/=this.timescale;var d=Math.floor(b),e=b-d,f=1-e,g=7*d;h.quatSlerp(m,this.xforms,g+3,g+10,e),j.multiply(m,m,o),n[0]=p*(c[g+0]*f+c[g+7]*e),n[1]=p*(c[g+1]*f+c[g+8]*e),n[2]=p*(c[g+2]*f+c[g+9]*e),k.fromRotationTranslation(a,m,n)}},b.exports=d},{"./scale":176,config:18,"gl-matrix":352,"lib/net":110,math:114}],169:[function(a,b,c){function d(a){this.mod=a,this.path=new e,this.bars=[],this.time=0}var e=a("./bars-path"),f=new Float32Array(16);d.prototype={getLoadables:function(){return this.path.getLoadables()},init:function(){var a=this.mod.getMesh("bar_anim_baked");a.proxiesOnly=!0;for(var b=0;b<20;b++)this.bars.push(a.proxy())},preRender:function(){var a=this.path.numFrames();this.time+=this.mod.scene.dt;for(var b=this.time*a/4.9,c=a/20,d=0;d<this.bars.length;d++){var e=this.bars[d],g=(b+d*c)%a;this.path.getTransformAt(f,g),e.setMatrix(f)}}},b.exports=d},{"./bars-path":168}],170:[function(a,b,c){function d(a){this.SCALE=.03,this.onLoaded=this._onLoaded.bind(this);var b=a.scene;this.scene=b,this.volume=0,this.smoothVol=0,this.active=!1,this.hasLeft=!1,this.awd=new h(b),this.path=new j,this.letters=new o(this),this.physics=new i(this),this.triggerCtrl=new l(this),this.bars=new k(this),this.confettis=b.confeti.createFactory(b.sroot),this.floatings=[],a.node.add(this.awd.node),this.awd.node.rotateY(3*-Math.PI/4),this.awd.node.z+=.3,this.awd.node.x+=.2,this.physics.rootNode.setMatrix(this.awd.node._matrix),this.trigger=null,this.triggerHandle=null}function e(a){return new d(a)}var f=(a("nanogl/program"),a("nanogl-node"),a("when")),g=a("entities/floating"),h=a("./scene"),i=a("./physics"),j=a("./path"),k=a("./bars"),l=a("./trigger"),m=a("sound/sequencer2"),n=a("sound/player"),o=a("./letters"),p=a("cursor");d.prototype={setPosition:function(a){a<-1e-4&&(n.setVolume("one_loop",1+a),n.setVolume("eigth_loop",Math.abs(a)),this.hasLeft||(this.hasLeft=!0,this.onLeaving()))},getLoadables:function(){var a=[];return a=a.concat(this.awd.getLoadables()),a=a.concat(this.path.getLoadables()),a=a.concat(this.bars.getLoadables()),f.all(a).then(this.onLoaded),a},start:function(){function a(){window.removeEventListener("mouseup",a),p.canvas.transitionOutTuto()}this.active=!0;var b=this;setTimeout(function(){b.active&&(b.scene.volume=.5,b.volume=1)},100),TweenMax.delayedCall(2,function(){window.addEventListener("mouseup",a),p.canvas.transitionInTuto("PULL")})},onLeaving:function(){n.play("transition",!1,.9),m.sequencer.removeSound("ONE"),m.sequencer.addSound("HUIT",!0),ga("send","event","wishes-8")},stop:function(){this.active=!1},triggerConfettis:function(a){this.confettis._create(a),n.play("ONE_cotillons_cible01",!1,.9)},preRender:function(){var a=this.scene.dt;this.awd.preRender(a),this.triggerCtrl.preRender(),this.physics.triggerNode.setMatrix(this.trigger._matrix),this.physics.preRender(),this.letters.preRender(),this.bars.preRender();for(var b=0;b<this.floatings.length;b++)this.floatings[b].preRender(a)},rttPass:function(){},render:function(){this.awd.render(1)},renderShadowPass:function(a){this.awd.renderPass(a.cam,1,a.defaultpass)},postRender:function(){this.physics.postRender()},getCameraPosition:function(a,b){},getMesh:function(a){return this.awd.loader.getObjectByName(a)},_onLoaded:function(){this.trigger=this.awd.loader.getObjectByName("lanceur"),this.triggerHandle=this.awd.loader.getObjectByName("trigger_handle"),this.triggerPusher=this.awd.loader.getObjectByName("trigger_pusher_group"),this.ballMesh=this.awd.loader.getObjectByName("ball"),this.spring=this.awd.loader.getObjectByName("spring"),this.pathDummy=this.awd.loader.getObjectByName("path_dummy");for(var a=0;a<this.awd.meshes.length;a++){var b=this.awd.meshes[a];0===b.name.indexOf("floating")&&this.floatings.push(new g(b))}this.volume=0,this.ballMesh.proxiesOnly=!0,this.physics.setTriggerNode(this.trigger),this.triggerCtrl.init(),this.letters.init(),this.bars.init()}},b.exports=e},{"./bars":169,"./letters":172,"./path":173,"./physics":175,"./scene":177,"./trigger":178,cursor:19,"entities/floating":22,"nanogl-node":368,"nanogl/program":419,"sound/player":260,"sound/sequencer2":261,when:445}],171:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.probes=null,this.inputs=new j,this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="olet",this._precision="highp",this._vertSrc=a("glsl/one/letter.vert")(),this._fragSrc=a("glsl/one/letter.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4,l=k.create();d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),c.tProbes(this.probes),b.modelViewProjectionMatrix(l,a._wmatrix),c.uMVP(l),c.uWorldMatrix(a._wmatrix),k.multiply(l,b._view,a._wmatrix),c.uViewMatrix(l),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":352,"glsl/one/letter.frag":62,"glsl/one/letter.vert":63,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],172:[function(a,b,c){function d(a,b,c){this.collide=this._collide.bind(this),this.mesh=b,this.mod=a,this.path=a.path,this.node=b.proxy(),this.offset=c,this.node.pathProgress=0,this.setupPhysic(),this.scheduleRemove=!1,this.animprogress=1}function e(a,b,c){this.proxiesOnly||c.render();for(var d=0;d<this._proxies.length;d++){var e=this._proxies[d];if(a.modelViewProjectionMatrix(p,e._wmatrix),b.uMVP&&b.uMVP(p),b.uWorldMatrix&&b.uWorldMatrix(e._wmatrix),b.uViewMatrix&&(o.multiply(p,a._view,e._wmatrix),b.uViewMatrix(p)),void 0!==b.uProbeOffsets){var f=63*e.pathProgress,g=Math.floor(f),h=Math.ceil(f),i=f-g;b.uProbeOffsets(1/8*(g%8),7/8-1/8*Math.floor(g/8),1/8*(h%8),7/8-1/8*Math.floor(h/8)),b.uProbeMix(i)}c.render()}c.unbind()}function f(a){this.mod=a,this.letters=[],this.frame=0}var g=(a("cannon/src/world/World"),a("cannon/src/math/Vec3")),h=a("cannon/src/math/Quaternion"),i=a("cannon/src/objects/Body"),j=(a("cannon/src/shapes/Box"),a("cannon/src/shapes/Plane"),a("cannon/src/shapes/Sphere"),a("cannon/src/shapes/Shape"),a("cannon/src/shapes/Cylinder")),k=a("sound/player");Hinge=a("cannon/src/constraints/HingeConstraint"),Lock=a("cannon/src/constraints/LockConstraint"),CMaterial=a("cannon/src/material/Material");var l=a("lib/cannon-node"),m=a("math"),n=a("math/ease"),o=a("gl-matrix/src/gl-matrix/mat4"),p=o.create(),q=new h;q.setFromEuler(Math.PI/2,0,-Math.PI/2,"XYZ");var r=new j(.1,.1,.02,10);d.prototype={introAnim:function(){this.animprogress=0},setupPhysic:function(){this.pCylinder=new i({mass:.1,position:new g(0,0,0),shape:r}),this.pCylinder.angularDamping=.9,this.pCylinder.material=this.mod.physics.defaultMaterial,this.pCylinder.type=i.KINEMATIC;var a=this.offset%(this.path.numFrames()-1);this.path.getTransformAt(p,a),l.MatrixToBody(p,this.pCylinder),body.quaternion.mult(q,this.pCylinder.quaternion),this.mod.physics.world.addBody(this.pCylinder),this.pCylinder.addEventListener("collide",this.collide)},_collide:function(a){this.mod.physics.handleLetterCollision(a)&&(this.scheduleRemove=!0,this.mesh.removeProxy(this.node),this.confetti())},confetti:function(){this.mod.triggerConfettis(this.node._wposition)},remove:function(){this.mod.physics.world.removeBody(this.pCylinder),this.pCylinder.removeEventListener("collide",this.collide)},update:function(a){this.animprogress+=this.mod.scene.dt/.6,this.animprogress>1&&(this.animprogress=1);var b=(a+this.offset)%(this.path.numFrames()-1);this.node.pathProgress=b/400;var c=this.pCylinder;if(this.path.getTransformAt(p,b),l.MatrixToBody(p,c),c.quaternion.mult(q,c.quaternion),this.node.setMatrix(p),this.node.rotateY(-Math.PI/2),this.node.rotateZ(-Math.PI/2),this.animprogress<1){var d=this.animprogress;d=2*d-1,d*=d,this.node.y+=.1*(1-d),this.node.rotateY(this.animprogress*Math.PI*2)}}},f.prototype={init:function(){this.disc=this.mod.getMesh("tournedisc"),this.createLetters(0,0,!1)},confettis:function(){for(var a=0;a<this.letters.length;a++)this.letters[a].confetti()},removeall:function(){for(var a=0;a<this.letters.length;a++){var b=this.letters[a];b.scheduleRemove=!0,b.mesh.removeProxy(b.node)}},createLetters:function(a,b,c){for(var d="makemepulse".split("").reverse().join(""),e=0;e<d.length;e++){var f=d[e];setTimeout(this._createLetter(f,e,c),a+b*e)}},_createLetter:function(a,b,c){var f=this;return function(){var g=f.mod.getMesh("letter_"+a);g.proxiesOnly=!0,g.drawCall=e;var h=9*b*4,i=new d(f.mod,g,h);f.letters.push(i),c&&i.introAnim()}},preRender:function(){var a=this.mod.path.numFrames()-1;this.frame=(this.frame+5*this.mod.scene.dt*4)%a;for(var b=0;b<this.letters.length;b++){var c=this.letters[b];c.scheduleRemove?(this.letters.splice(b,1),c.remove(),b--,0===this.letters.length&&(console.log("end"),k.play("SFX_UN_cible_WIN_8bits",!1,1.1),k.play("ONE_cotillons_cible01",!1,.9),this.createLetters(1e3,200,!0))):c.update(this.frame)}var d=this.frame/400;d=11*d%1,d=m.clamp01(1.3*d),d=n.easeInOutQuad(d),this.disc.rotation.set([0,0,0,1]),this.disc.rotateY(d*Math.PI*2)}},b.exports=f},{"cannon/src/constraints/HingeConstraint":304,"cannon/src/constraints/LockConstraint":305,"cannon/src/material/Material":313,"cannon/src/math/Quaternion":316,"cannon/src/math/Vec3":318,"cannon/src/objects/Body":319,"cannon/src/shapes/Box":320,"cannon/src/shapes/Cylinder":322,"cannon/src/shapes/Plane":323,"cannon/src/shapes/Shape":324,"cannon/src/shapes/Sphere":325,"cannon/src/world/World":334,"gl-matrix/src/gl-matrix/mat4":357,"lib/cannon-node":104,math:114,"math/ease":113,"sound/player":260}],173:[function(a,b,c){function d(){this.onLoaded=this._onLoaded.bind(this),this.timelines=[];for(var a=0;a<1;a++)this.timelines[a]=new e}function e(a){this.xforms=a,this.timescale=1}var f=a("config"),g=a("lib/net"),h=a("math"),i=a("gl-matrix"),j=i.quat,k=i.mat4,l=i.vec3,m=j.create(),n=l.create(),o=j.create();j.rotateX(o,o,-Math.PI/2),j.rotateZ(o,o,Math.PI/2);var p=a("./scale");d.prototype={getLoadables:function(){var a=f.asset_url("one/anims.bin");return g.loadBytes(a).then(this.onLoaded)},_onLoaded:function(a){var b=new Uint16Array(a,0,2),c=b[0],d=b[1],e=1/d;c*=d;for(var f=0;f<1;f++){var g=new Float32Array(a,4+f*(28*c),7*c);this.timelines[f].xforms=g,this.timelines[f].timescale=e}},getTransformAt:function(a,b){this.timelines[0].getTransformAt(a,b)},numFrames:function(){return this.timelines[0].xforms.length/7}},e.prototype={getTransformAt:function(a,b){var c=this.xforms;b/=this.timescale;var d=Math.floor(b),e=b-d,f=1-e,g=7*d;h.quatSlerp(m,this.xforms,g+3,g+10,e),j.multiply(m,m,o),n[0]=p*(c[g+0]*f+c[g+7]*e),n[1]=p*(c[g+1]*f+c[g+8]*e),n[2]=p*(c[g+2]*f+c[g+9]*e),k.fromRotationTranslation(a,m,n)}},b.exports=d},{"./scale":176,config:18,"gl-matrix":352,"lib/net":110,math:114}],174:[function(a,b,c){b.exports=[{type:"Box",dim:[11.0797,2.40489,38.5641],pos:[6.30033,27.3957,-2.61399],name:"mat01_00",rot:[0,0,0,1]},{type:"Box",dim:[13.3294,3.76442,31.866],pos:[7.3921,-27.7544,-2.12485],name:"mat02_01",rot:[0,0,0,1]},{type:"Box",dim:[9.52916,1.22032,36.3001],pos:[-7.14405,30.6027,5.43559],name:"mat04_00",rot:[-.130526,0,0,.991445]},{type:"Box",dim:[12.0554,1.75092,5.22301],pos:[-9.37619,-38.5171,1.10504],name:"mat03_00",rot:[0,0,0,1]},{type:"Box",dim:[12.0554,5.07767,5.53639],pos:[-9.37619,-33.252,1.10504],name:"mat03_01",rot:[0,0,0,1]},{type:"Box",dim:[12.0554,8.42894,5.59977],pos:[-9.37619,-28.0205,1.10504],name:"mat03_02",rot:[0,0,0,1]},{type:"Cylinder",dim:[11.5178,3.91486,10],pos:[.0604099,55.2358,-1.15463],name:"mat06_00",rot:[0,0,0,1]},{type:"Cylinder",dim:[8.17767,3.81073,10],pos:[8.12103,-2.75088,-2.85569],name:"Cylinder002",rot:[0,0,0,1]},{type:"Cylinder",dim:[1.55376,12.6135,10],pos:[-14.3213,8.28754,10.7949],name:"mat05_07",rot:[0,.707107,0,.707107]},{type:"Cylinder",dim:[1.55376,12.6135,10],pos:[-14.3213,4.28754,10.7949],name:"mat05_06",rot:[0,.707107,0,.707107]},{type:"Cylinder",dim:[1.55376,12.6135,10],pos:[-14.3213,.287539,10.7949],name:"mat05_05",rot:[0,.707107,0,.707107]},{type:"Cylinder",dim:[1.55376,12.6135,10],pos:[-14.3213,-3.71246,10.7949],name:"mat05_04",rot:[0,.707107,0,.707107]},{type:"Cylinder",dim:[1.55376,12.6135,10],pos:[-14.3213,-7.71246,10.7949],name:"mat05_03",rot:[0,.707107,0,.707107]},{type:"Cylinder",dim:[1.55376,12.6135,10],pos:[-14.3213,-11.7125,10.7949],name:"mat05_02",rot:[0,.707107,0,.707107]},{type:"Cylinder",dim:[1.55376,12.6135,10],pos:[-14.3213,-15.7125,10.7949],name:"mat05_01",rot:[0,.707107,0,.707107]},{type:"Cylinder",dim:[1.55376,12.6135,10],pos:[-14.3213,-19.7125,10.7949],name:"mat05_00",rot:[0,.707107,0,.707107]},{type:"Box",dim:[7.86914,5.28217,4.07972],pos:[43.7927,-22.8887,4.10643],name:"lanceur_pusher",rot:[0,.0726103,0,.99736]},{type:"Box",dim:[21.8587,5.28217,4.07972],pos:[38.6694,-27.0933,5.50854],name:"lanceur00",rot:[0,.0436194,0,.999048]},{type:"Box",dim:[21.8587,2.27133,4.07972],pos:[37.0738,-22.9016,4.11661],name:"lanceur01",rot:[0,.0726103,0,.99736]},{type:"Box",dim:[21.8587,5.28217,4.07972],pos:[38.6694,-18.6365,5.50854],name:"lanceur02",rot:[0,.0436194,0,.999048]},{type:"Cylinder",dim:[15.7794,3.91486,10],pos:[-1.22944,-46.1353,-2.22974],name:"mat02_00",rot:[0,0,0,1]}]},{}],175:[function(a,b,c){function d(a,b,c){return new i(a*r,b*r,c*r)}function e(a,b){this.cnode=new v(new u,b),this.proxy=a,this.body=b}function f(a,b){this.ballCollide=this._ballCollide.bind(this),this.mod=a,this.scene=a.scene,this.rootNode=new u,this.triggerNode=new u,this.rootNode.add(this.triggerNode),this.cnodes=[],this.cnodesbyname={},this.currentBall=null,this.balls=[],this.ballsToRemove=[],this.ballInFrames=-1,this.world=new h,this.world.gravity.set(0,-4.91,0),this.world.solver.iterations=100,this.world.solver.tolerance=1e-7,this.slideMaterial=new p({friction:0,restitution:.1}),this.defaultMaterial=new p({friction:.1,restitution:.7}),this.ballMaterial=new p({friction:0,restitution:.9}),this.setupBodies()}var g=a("./phys-export"),h=a("cannon/src/world/World"),i=a("cannon/src/math/Vec3"),j=a("cannon/src/math/Quaternion"),k=a("cannon/src/objects/Body"),l=a("cannon/src/shapes/Box"),m=a("cannon/src/shapes/Plane"),n=a("cannon/src/shapes/Sphere"),o=(a("cannon/src/shapes/Shape"),a("cannon/src/shapes/Cylinder")),p=a("cannon/src/material/Material"),q=a("sound/player"),r=a("./scale"),s=a("gl-matrix/src/gl-matrix/vec3"),t=s.create(),u=a("nanogl-node"),v=a("lib/cannon-node"),w=new j;w.setFromEuler(Math.PI/2,0,0,"XYZ");var x=s.fromValues(-.1,.2,0);e.prototype={update:function(){this.cnode.syncNode(),this.proxy.setMatrix(this.cnode.node._matrix)}},f.prototype={setupBodies:function(){var a=this.world,b=this.groundBody=new k({mass:0,position:d(0,-2.995,0),material:this.defaultMaterial}),c=new m;b.addShape(c),b.quaternion.setFromEuler(-Math.PI/2,0,0,"XYZ"),a.addBody(b);for(var e=0;e<g.length;e++){switch(g[e].type){case"Cylinder":body=this.createCylindre(g[e]);break;case"Box":body=this.createBox(g[e])}this.handleBody(body,g[e])}},handleLetterCollision:function(a){for(var b=0;b<this.balls.length;b++){var c=this.balls[b];if(c.body===a.body)return this.ballsToRemove.push(c),q.play("ONE_load_hit"),!0}return!1},removeBall:function(a){var b=this.balls.indexOf(a);-1!==b&&(this.balls.splice(b,1),this.world.removeBody(a.body),this.mod.ballMesh.removeProxy(a.proxy),a.body.removeEventListener("collide",this.ballCollide))},addBall:function(){s.transformMat4(t,x,this.triggerNode._wmatrix);var a=new k({mass:.1,position:new i(t[0],t[1],t[2]),shape:new n(.048)});a.material=this.ballMaterial,this.world.addBody(a),a.addEventListener("collide",this.ballCollide);var b=new e(this.mod.ballMesh.proxy(),a);if(this.balls.push(b),this.currentBall=b,this.balls.length>10){var c=this.balls.shift();this.world.removeBody(c.body),this.mod.ballMesh.removeProxy(c.proxy)}},_ballCollide:function(a){var b=a.body.name,c=null;if(a.body===this.groundBody&&(c="FLOOR_drop"),void 0!==b&&0===b.indexOf("mat")&&(c="MAT-"+b.substr(3,2)+"_drop"),null!==c){var d=.7*a.contact.ni.dot(a.target.velocity);d<.1||q.play(c,!1,d)}},ballInTrigger:function(a){return.5>s.distance(a.proxy._wposition,this.mod.triggerPusher._wposition)},scheduleBall:function(){this.ballInFrames=20},handleBody:function(a,b){if(a.name=b.name,0===b.name.indexOf("lanceur")){a.material=this.slideMaterial,a.type=k.KINEMATIC;var c=new v(new u,a);this.triggerNode.add(c.node),this.cnodes.push(c),this.cnodesbyname[b.name]=c}else a.material=this.defaultMaterial},initCnodes:function(){this.rootNode.updateWorldMatrix();for(var a=0;a<this.cnodes.length;a++)this.cnodes[a].syncNode()},setTriggerNode:function(a){a.updateWorldMatrix(),this.triggerNode.setMatrix(a._matrix),this.initCnodes(),this.scheduleBall()},createCylindre:function(a){var b=new o(a.dim[0]*r,a.dim[0]*r,a.dim[1]*r,10),c=new k({mass:0,position:d(a.pos[0],a.pos[2],-a.pos[1]),shape:b});c.quaternion.x=a.rot[0],c.quaternion.y=a.rot[2],c.quaternion.z=-a.rot[1],c.quaternion.w=a.rot[3],c.quaternion.mult(w,c.quaternion);var e=c.quaternion.vmult(d(0,0,-a.dim[1]/2));return c.position.vadd(e,c.position),this.world.addBody(c),c},createBox:function(a){var b=new k({mass:0,position:d(a.pos[0],a.pos[2]+a.dim[1]/2,-a.pos[1]),shape:new l(d(a.dim[0]/2,a.dim[1]/2,a.dim[2]/2))});return b.quaternion.x=a.rot[0],b.quaternion.y=a.rot[2],b.quaternion.z=-a.rot[1],b.quaternion.w=a.rot[3],
this.world.addBody(b),b},preRender:function(a){for(var b=0;b<this.ballsToRemove.length;b++)this.removeBall(this.ballsToRemove[b]);this.ballsToRemove.length=0,this.ballInFrames--,0===this.ballInFrames&&this.addBall(),this.rootNode.updateWorldMatrix();for(var b=0;b<this.cnodes.length;b++)this.cnodes[b].syncBody();for(var b=0;b<this.balls.length;b++)this.balls[b].update();var a=this.scene.dt;this.world.step(1/60,a,50)},postRender:function(a){this.currentBall&&this.ballInFrames<0&&!this.ballInTrigger(this.currentBall)&&this.scheduleBall()}},b.exports=f},{"./phys-export":174,"./scale":176,"cannon/src/material/Material":313,"cannon/src/math/Quaternion":316,"cannon/src/math/Vec3":318,"cannon/src/objects/Body":319,"cannon/src/shapes/Box":320,"cannon/src/shapes/Cylinder":322,"cannon/src/shapes/Plane":323,"cannon/src/shapes/Shape":324,"cannon/src/shapes/Sphere":325,"cannon/src/world/World":334,"gl-matrix/src/gl-matrix/vec3":360,"lib/cannon-node":104,"nanogl-node":368,"sound/player":260}],176:[function(a,b,c){b.exports=.038},{}],177:[function(a,b,c){function d(a){e.call(this,a,"one"),this.setupTextures(),this.setupMaterials(),this.greenUVOffset=0,this.rollerUVOffset=0}var e=(a("when"),a("assets/awd-scene")),f=(a("lib/net"),a("lib/color")),g=(a("lib/awd"),a("dev/gui"),a("config"),a("gl/unlit-material"),a("./letter-material")),h=(a("gl/shadow-catcher-material"),a("nanogl-pbr/standard")),i=a("gl/standard-gi");a("nanogl-pbr/lib/input");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.getAssetPath=function(a){return"one/"+a},d.prototype.texPath=function(a){return[this.getAssetPath(a+"_L0.jpg"),this.getAssetPath(a+"_L1.jpg")]},d.prototype.getAwdUrl=function(){return"one/scene.awd"},d.prototype.preRender=function(a){this.greenUVOffset=(this.greenUVOffset-.25*a)%2,this.rollerUVOffset=(this.rollerUVOffset-.35*a)%2,this.shapeGreenMaterial.uvOffset.set(this.greenUVOffset,0),this.rollersMaterial.uvOffset.set(this.rollerUVOffset,0)},d.prototype.setupTextures=function(){this.texs.makeTex("ground_GI",this.getAssetPath("ground_GI.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("objects_GI",this.getAssetPath("objects_GI.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("letters_OCCLU",this.getAssetPath("letters_OCCLU.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("letters_COLOR",this.getAssetPath("letters_COLOR.jpg")).setFilter(!0,!1,!1).clamp(),this.texs.makeTex("probes",this.getAssetPath("probes.jpg")).setFilter(!0,!1,!1).clamp()},d.prototype.makeBasicMaterial=function(a){var b=this.scene.gl,c=new i(b);return c._precision="highp",this.scene.env.setupMat(c),c.setLightSetup(this.scene.lights.setup),c.albedo=c.iAlbedo.attachSampler("tAblbedo","vTexCoord"),c.albedo.set(this.scene.texlib.get(a)),c.lm=c.iLightmap.attachSampler("tLM","vTexCoord1"),c.lm.set(this.texs.get("objects_GI")),c.iGloss.attachConstant(.05),c.iSpecular.attachConstant([0,0,0]),c.iAlbedoAtt.attachConstant([.3]),c.conserveEnergy.set(!1),c.perVertexIrrad.set(!0),this.mats.lib.setOpaque(c),c},d.prototype.setupMaterials=function(){var a,a,b=this.mats,c=b.lib,d=this.scene.gl;a=this.makeBasicMaterial("common/degrade1"),b.registerMaterial(a,"degrade1"),a=this.makeBasicMaterial("common/degrade2"),b.registerMaterial(a,"degrade2"),a=this.makeBasicMaterial("common/shape_blue"),b.registerMaterial(a,"shape-blue"),a=this.makeBasicMaterial("common/green"),b.registerMaterial(a,"green"),a=this.makeBasicMaterial("common/marbre"),b.registerMaterial(a,"marble"),a=this.makeBasicMaterial("common/wood"),b.registerMaterial(a,"wood"),a=this.makeBasicMaterial("common/wood"),b.registerMaterial(a,"wood_rollers"),a.uvOffset=a.iUVOffset.attachUniform("uUVOffset"),this.rollersMaterial=a,a=this.makeBasicMaterial("common/shape_green"),a.uvOffset=a.iUVOffset.attachUniform("uUVOffset"),this.shapeGreenMaterial=a,b.registerMaterial(a,"shape-green");var a=new h(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([0,0,0]),a.iGloss.attachConstant(.7),a.specular=a.iSpecular.attachUniform("uSpec"),f.HexInput(a.specular,16702166),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),c.setOpaque(a),b.registerMaterial(a,"metal");var a=new g(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.texs.get("letters_COLOR")),a.probes=this.texs.get("probes"),a.cavity=a.iCavity.attachSampler("tCavity","vTexCoord1"),a.cavity.set(this.texs.get("letters_OCCLU")),a.iCavityStrength.attachConstant([1,1]),a.iGloss.attachConstant(0),a.iSpecular.attachConstant([0,0,0]),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),this.mats.lib.setOpaque(a),b.registerMaterial(a,"letter");var a=new i(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([1,1,1]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("objects_GI")),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([0,0,0]),a.iAlbedoAtt.attachConstant([.2]),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),this.mats.lib.setOpaque(a),b.registerMaterial(a,"sol");var a=new h(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([.95,.95,.95]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([.2,.2,.2]),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),c.setOpaque(a),b.registerMaterial(a,"lambert1");var a=new i(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([1,1,1]),a.iAlbedoAtt.attachConstant([.4]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([0,0,0]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("ground_GI")),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),c.setOpaque(a),a.config.enableBlend(),a.config.blendFunc(d.ZERO,d.SRC_COLOR),b.registerMaterial(a,"ground")},b.exports=d},{"./letter-material":171,"assets/awd-scene":1,config:18,"dev/gui":20,"gl/shadow-catcher-material":33,"gl/standard-gi":38,"gl/unlit-material":39,"lib/awd":99,"lib/color":106,"lib/net":110,"nanogl-pbr/lib/input":393,"nanogl-pbr/standard":403,when:445}],178:[function(a,b,c){function d(a){this.mod=a,this.plane=new i,this.tension=0,this.angle=0,this.isDown=!1,this.isGrab=!1,this.downAngle=0,this.downMAngle=0,this.downDist=0,this.dragDist=0,this.dragAmp=.2}var e=a("math/ray-point-dist"),f=a("math/ray-plane-intersection"),g=a("cannon/src/math/Vec3"),h=a("math"),i=a("math/plane"),j=a("cursor"),k=a("lib/mouse"),l=a("sound/player"),m=a("gl-matrix/src/gl-matrix/vec3"),n=a("gl-matrix/src/gl-matrix/quat"),o=m.create(),p=n.create(),q=m.fromValues(0,1,0);d.prototype={init:function(){this.initialQuat=n.create(),this.initialQuat.set(this.mod.trigger.rotation),this.pusher=this.mod.physics.cnodesbyname.lanceur_pusher,this.initPusherZ=this.mod.triggerPusher.position[0];var a=this.mod.triggerHandle.position;this.steadyDist=Math.sqrt(a[0]*a[0]+a[2]*a[2]),this.tensionV=0},preRender:function(){var a=this.isGrab,b=this.mod.scene.getMouseRay(),c=this.mod.triggerHandle._wposition;this.plane.origin.set(c),f(o,b,this.plane),m.sub(o,o,this.mod.trigger._wposition);var d=Math.atan2(o[2],o[0]),i=Math.sqrt(o[0]*o[0]+o[2]*o[2]),r=e(b,c);r<.3?j.enableHover():j.disableHover();var s=k.isDown();if(!this.isDown&&s){var r=e(b,c);r<.3&&(this.isGrab=!0),this.downAngle=this.angle,this.downMAngle=d,this.downTension=this.tension,this.downDist=i}if(this.isGrab){var t=d-this.downMAngle;this.angle=this.downAngle-t;var u=i-this.downDist;this.tension=this.downTension+u,this.tensionV=0}else this.tensionV+=this.mod.scene.dt*this.tension*3;this.tension;this.tension-=this.tensionV,this.tension=h.clamp(this.tension,0,.2),0===this.tension&&(this.tensionV=0),this.isDown=s,this.isGrab=this.isGrab&&s,n.setAxisAngle(p,q,this.angle),n.multiply(this.mod.trigger.rotation,p,this.initialQuat),this.mod.trigger.invalidate(),this.mod.triggerPusher.position[0]=this.initPusherZ+this.tension,this.mod.triggerPusher.invalidate(),this.pusher.node.position[0]=this.initPusherZ+this.tension+.1,this.pusher.node.invalidate(),this.mod.spring.scale[0]=1-3.5*this.tension,this.mod.spring.invalidate();var v=this.mod.physics;if(this.tensionV>0&&!this.isGrab&&v.currentBall&&v.ballInTrigger(v.currentBall)){var w=new g(-1,0,0);this.pusher.body.quaternion.vmult(w,w),w.mult(1.2*this.tensionV,w),v.currentBall.body.applyImpulse(w,v.currentBall.body.position)}!0===a&&!1===this.isGrab&&l.play("ONE_launch01")}},b.exports=d},{"cannon/src/math/Vec3":318,cursor:19,"gl-matrix/src/gl-matrix/quat":358,"gl-matrix/src/gl-matrix/vec3":360,"lib/mouse":109,math:114,"math/plane":115,"math/ray-plane-intersection":116,"math/ray-point-dist":117,"sound/player":260}],179:[function(a,b,c){"use strict";function d(a){f.call(this,a,"two"),this.setupTextures(),this.setupMaterials()}var e=a("lib/color"),f=a("assets/awd-scene"),g=a("nanogl-pbr/standard"),h=(a("gl/shadow-catcher-material"),a("gl/standard-gi")),i=a("./materials/default"),j=a("./materials/marbre"),k=a("./materials/aquarelle"),l=(a("./materials/wood"),a("./materials/wood-carpet")),m=a("./materials/gradient"),n=a("./materials/platform"),o=a("./materials/pink-marble"),p=a("./materials/green"),q=a("./materials/flag"),r=a("./materials/marble-sponge");d.prototype=Object.assign(Object.create(f.prototype),{constructor:d,getAssetPath:function(a){return"two/"+a},getAwdUrl:function(){return"two/scene.awd"},setupTextures:function(){this.texs.makeTex("GI-Ground",this.getAssetPath("GI-Ground.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("GI-Shapes",this.getAssetPath("GI-Shapes.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("pink-marble",this.getAssetPath("pink-marble.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("gradient",this.getAssetPath("degrade3.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("green",this.getAssetPath("green.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("blue-gradient",this.getAssetPath("blue-gradient.jpg")).setFilter(!0,!1,!1)},setupMaterials:function(){var a,b=this.mats,c=b.lib,d=this.scene,f=d.gl,s=d.env,t=d.lights;a=new g(f),a._precision="highp",a._mask=1,s.setupMat(a),a.setLightSetup(t.setup),a.iAlbedo.attachConstant([.5,.5,.5]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([.35,.35,.35]),a.conserveEnergy.set(!1),c.setOpaque(a),a=new i(this.scene,f,this.texs),c.setOpaque(a),b.registerMaterial(a,"White"),a=new j(this.scene,f,this.texs),c.setOpaque(a),b.registerMaterial(a,"Marble"),a=new r(this.scene,f,this.texs),c.setOpaque(a),b.registerMaterial(a,"Sponge"),a=new k(this.scene,f,this.texs),c.setOpaque(a),b.registerMaterial(a,"Aquarelle"),a=new l(this.scene,f,this.texs),c.setOpaque(a),b.registerMaterial(a,"Wood"),a=new o(this.scene,f,this.texs),c.setOpaque(a),b.registerMaterial(a,"PinkMarble"),a=new m(this.scene,f,this.texs),c.setOpaque(a),b.registerMaterial(a,"Gradient"),a=new n(this.scene,f,this.texs),c.setOpaque(a),b.registerMaterial(a,"Platform"),a=new p(this.scene,f,this.texs),c.setOpaque(a),b.registerMaterial(a,"Green"),a=new q(this.scene,f,this.texs),c.setOpaque(a),b.registerMaterial(a,"Flag");var a=new h(this.gl);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([0,0,0]),a.iGloss.attachConstant(.7),a.specular=a.iSpecular.attachUniform("uSpec"),e.HexInput(a.specular,16702166),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),a._mask=1,c.setOpaque(a),b.registerMaterial(a,"Steel"),a=new h(f),a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([1,1,1]),a.iAlbedoAtt.attachConstant([.4]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([0,0,0]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Ground")),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),c.setOpaque(a),a.config.enableBlend(),a.config.blendFunc(f.ZERO,f.SRC_COLOR),b.registerMaterial(a,"Ground")}}),b.exports=d},{"./materials/aquarelle":215,"./materials/default":216,"./materials/flag":217,"./materials/gradient":218,"./materials/green":219,"./materials/marble-sponge":220,"./materials/marbre":221,"./materials/pink-marble":222,"./materials/platform":223,"./materials/wood":225,"./materials/wood-carpet":224,"assets/awd-scene":1,"gl/shadow-catcher-material":33,"gl/standard-gi":38,"lib/color":106,"nanogl-pbr/standard":403}],180:[function(a,b,c){"use strict";var d=a("../utils"),e={FLOOR:1,_index:1,add:function(a){e._index=2*e._index,e[a]=e._index},addMask:function(a,b){d.cannon.addCollisionMask(a,b)},removeMask:function(a,b){d.cannon.removeCollisionMask(a,b)}};e.add("BALL"),e.add("PLATFORM"),e.add("CARPET"),e.add("SPONGE"),e.add("UNDERGROUND"),b.exports=e},{"../utils":230}],181:[function(a,b,c){b.exports={BALL_COUNT:1,SCALE:1.33}},{}],182:[function(a,b,c){function d(a){g.function.bind(this,"_onEntityCollide"),this.manager=a,this.balls=[],this.entityBody=null,this.isColliding=!1,this.collisionGroup=null}var e=a("../constants/collision-group"),f=a("cannon"),g=a("../utils");d.prototype={constructor:d,setEntity:function(a){this.entityBody=a.physic.body,this.entityBody.addEventListener("collide",this._onEntityCollide)},_onEntityCollide:function(a){this.hasBallBody(a.body)&&this.getBall(a.body).play(this.collisionGroup)},addBall:function(a,b){e.addMask(a.physic.body,b),d.addContactMaterial(a.physic.body.material,this.entityBody.material,this.manager.section.physic.world),this.collisionGroup=b,this.balls.push(a)},removeBall:function(a,b){e.removeMask(a,b);var c=this.balls.indexOf(this.getBall(a));a&&this.getBall(a)&&this.getBall(a).stop(),this.balls.splice(c,1)},hasBallBody:function(a){for(var b=0;b<this.balls.length;b++){if(this.balls[b].physic.body===a)return!0}return!1},getBall:function(a){for(var b=0;b<this.balls.length;b++){const c=this.balls[b];if(c.physic.body===a)return c}return null}},d._contactMaterial=null,d.addContactMaterial=function(a,b,c,e){return e=Object.assign({friction:2,restitution:.15},e||{}),d._contactMaterial||(d._contactMaterial=new f.ContactMaterial(b,a,e),c.addContactMaterial(d._contactMaterial)),d._contactMaterial},b.exports=d},{"../constants/collision-group":180,"../utils":230,cannon:296}],183:[function(a,b,c){"use strict";function d(a){f.constructor.call(this,a),h.function.bind(this,"_onSoundCollideIn","_onSoundCollideOut"),this.soundColliderIn=null,this.soundColliderOut=null,this.enabled=!1}var e=a("./ball-basic-contact"),f=e.prototype,g=a("../constants/collision-group"),h=(a("cannon"),a("../utils"));d.prototype=Object.assign(Object.create(f),{constructor:d,setEntity:function(a){f.setEntity.call(this,a),this.soundColliderIn=a.physic.soundIn,this.soundColliderIn.addEventListener("collide",this._onSoundCollideIn),this.soundColliderOut=a.physic.soundOut,this.soundColliderOut.addEventListener("collide",this._onSoundCollideOut)},_onEntityCollide:function(a){this.enabled&&(f._onEntityCollide.call(this,a),this.hasBallBody(a.body)&&(this.getBall(a.body).currentSurface="carpet"))},_onSoundCollideIn:function(a){this.hasBallBody(a.body)&&(this.enabled=!0,this.getBall(a.body).resetSound(this.collisionGroup))},_onSoundCollideOut:function(a){if(this.hasBallBody(a.body)){this.enabled=!1;var b=this.getBall(a.body);b.currentSurface=null,b.stop()}},addBall:function(a,b){g.addMask(a.physic.body,b),e.addContactMaterial(a.physic.body.material,this.entityBody.material,this.manager.section.physic.world,{friction:0,restitution:.15}),this.collisionGroup=b,this.balls.push(a)}}),b.exports=d},{"../constants/collision-group":180,"../utils":230,"./ball-basic-contact":182,cannon:296}],184:[function(a,b,c){"use strict";function d(a){f.constructor.call(this,a),this.deadZoneBody=null,this.soundBody=null,this.contactMaterial=null}var e=a("./ball-basic-contact"),f=e.prototype,g=(a("../utils"),a("../../../sound/player")),h=a("../constants/collision-group"),i=a("cannon");d.prototype=Object.assign(Object.create(f),{constructor:d,setEntity:function(a){this.entityBody=a,this.entityBody.addEventListener("collide",this._onEntityCollide)},_onEntityCollide:function(a){if(this.hasBallBody(a.body)){this.getBall(a.body).stop();var b=.7*a.contact.ni.dot(a.body.velocity);if(b<.1)return;g.play("FLOOR_drop",!1,b)}},addBall:function(a,b){h.addMask(a.physic.body,b),this.contactMaterial||(this.contactMaterial=new i.ContactMaterial(this.entityBody.material,a.physic.body.material,{friction:.1,restitution:.7}),this.manager.section.physic.world.addContactMaterial(this.contactMaterial)),this.collisionGroup=b,this.balls.push(a)}}),b.exports=d},{"../../../sound/player":260,"../constants/collision-group":180,"../utils":230,"./ball-basic-contact":182,cannon:296}],185:[function(a,b,c){"use strict";function d(a){f.constructor.call(this,a),h.function.bind(this,"_onDeadZoneCollide","_onSoundCollide"),this.deadZoneBody=null,this.soundBody=null}var e=a("./ball-basic-contact"),f=e.prototype,g=a("../constants/collision-group"),h=a("../utils");d.prototype=Object.assign(Object.create(f),{constructor:d,setEntity:function(a){f.setEntity.call(this,a),this.deadZoneBody=a.physic.deadzone,this.deadZoneBody.addEventListener("collide",this._onDeadZoneCollide),this.soundBody=a.physic.sound,this.soundBody.addEventListener("collide",this._onSoundCollide)},_onEntityCollide:function(a){f._onEntityCollide.call(this,a),this.hasBallBody(a.body)&&(this.getBall(a.body).currentSurface="platform")},_onSoundCollide:function(a){this.hasBallBody(a.body)&&(this.getBall(a.body).currentSurface=null,this.getBall(a.body).stop())},_onDeadZoneCollide:function(a){this.hasBallBody(a.body)&&(this.getBall(a.body).currentSurface=null,this.removeBall(a.body,g.PLATFORM))}}),b.exports=d},{"../constants/collision-group":180,"../utils":230,"./ball-basic-contact":182}],186:[function(a,b,c){"use strict";function d(a){f.constructor.call(this,a),i.function.bind(this,"_onDeadZoneCollide","_onSoundCollide"),this.deadZoneBody=null,this.soundBody=null}var e=a("./ball-basic-contact"),f=e.prototype,g=a("../constants/collision-group"),h=a("cannon"),i=a("../utils"),j=a("../../../sound/player");d.prototype=Object.assign(Object.create(f),{constructor:d,setEntity:function(a){f.setEntity.call(this,a),this.deadZoneBody=a.physic.deadzone,this.deadZoneBody.addEventListener("collide",this._onDeadZoneCollide),this.soundBody=a.physic.sound,this.soundBody.addEventListener("collide",this._onSoundCollide)},_onEntityCollide:function(a){f._onEntityCollide.call(this,a),this.hasBallBody(a.body)&&(a.body.velocity.scale(.075,a.body.velocity),a.body.angularVelocity.scale(.075,a.body.angularVelocity),this.getBall(a.body).currentSurface="sponge")},_onDeadZoneCollide:function(a){this.hasBallBody(a.body)&&(this.getBall(a.body).currentSurface=null,this.removeBall(a.body,g.SPONGE),j.play("TWO_Ball_hole",!1,2))},_onSoundCollide:function(a){this.hasBallBody(a.body)&&(this.getBall(a.body).currentSurface="sponge",this.getBall(a.body).stop(!1),this.getBall(a.body).play(g.SPONGE),this.getBall(a.body).play(g.SPONGE))},addBall:function(a,b){g.addMask(a.physic.body,b),this.contactMaterial||(this.contactMaterial=new h.ContactMaterial(this.entityBody.material,a.physic.body.material,{friction:0,restitution:0}),this.manager.section.physic.world.addContactMaterial(this.contactMaterial)),this.collisionGroup=b,this.balls.push(a)},removeBall:function(a){f.removeBall.call(this,a),g.removeMask(a,g.SPONGE|g.FLOOR)}}),b.exports=d},{"../../../sound/player":260,"../constants/collision-group":180,"../utils":230,"./ball-basic-contact":182,cannon:296}],187:[function(a,b,c){"use strict";function d(a){f.constructor.call(this,a),this.deadZoneBody=null,this.soundBody=null}var e=a("./ball-basic-contact"),f=e.prototype,g=(a("../utils"),a("../../../sound/player"));d.prototype=Object.assign(Object.create(f),{constructor:d,setEntity:function(a){this.entityBody=a,this.entityBody.addEventListener("collide",this._onEntityCollide)},_onEntityCollide:function(a){this.hasBallBody(a.body)&&(this.manager.section.confeti.create([a.body.position.x,.2,a.body.position.z]),this.manager.section.ballManager.killBall(this.getBall(a.body)),this.manager.section.flag.launch(!0),this.manager.section.scene.shakeCamera(.02),this.removeBall(a.body),g.play("TWO_sprakles",!1,2))}}),b.exports=d},{"../../../sound/player":260,"../utils":230,"./ball-basic-contact":182}],188:[function(a,b,c){"use strict";function d(a){this.contacts={},this.section=a,this.addContact("Ball-Platform",new e(this)),this.addContact("Ball-Carpet",new f(this)),this.addContact("Ball-Sponge",new g(this)),this.addContact("Ball-Underground",new h(this)),this.addContact("Ball-Floor",new i(this))}var e=a("../contacts/ball-platform"),f=a("../contacts/ball-carpet"),g=a("../contacts/ball-sponge"),h=a("../contacts/ball-underground"),i=a("../contacts/ball-floor");d.prototype={constructor:d,addContact:function(a,b){this.getKey(a)||(this.contacts[a]=b)},getContact:function(a){return this.contacts[this.getKey(a)]},removeContact:function(a){delete this.contacts[this.getKey(a)]},getKey:function(a){var b=this.contacts[a];if(!b){var c=a.split("-");a=c[1]+"-"+c[0],b=this.contacts[a]}return b?a:void 0},update:function(){}},b.exports=d},{"../contacts/ball-carpet":183,"../contacts/ball-floor":184,"../contacts/ball-platform":185,"../contacts/ball-sponge":186,"../contacts/ball-underground":187}],189:[function(a,b,c){"use strict";function d(a){this.scene=a,this.gl=a.gl,this.enabled=!0}var e=a("dev/gui"),f=e.addFolder("two");d.prototype={constructor:d,enable:function(){this.enabled||(this.enabled=!0,this.physic&&(this.physic.body.collisionResponse=!0))},disable:function(){this.enabled&&(this.enabled=!1,this.physic&&(this.physic.body.collisionResponse=!1))},GUI:function(a){return f.addFolder(a)},preRender:function(){this.enabled&&this.physic&&this.physic.update(this)},render:function(){this.enabled&&(this.material.prepare(this.node,this.scene.camera),this.geometry.bind(this.material.program),this.geometry.render(this.material.program))}},b.exports=d},{"dev/gui":20}],190:[function(a,b,c){"use strict";function d(a,b){f.constructor.call(this,a.scene),this.section=a,this.manager=a.ballManager,this.physic=new g(a),this.launchOps={enabled:!1,progress:0,progressScale:1,tweenScale:.15,speed:.035},this.currentSurface=null,this.mesh=null,this.node=b,this.isFirstCollide=!0,this.currentSound="",this.dead=!1,this.soundMultiplier=1}var e=a("../../core/nmesh"),f=e.prototype,g=a("./physic"),h=a("math/ease"),i=a("gl-matrix"),j=i.vec3,k=a("../../../../sound/player"),l=a("../../constants/collision-group"),m=[0,0,0];d.prototype=Object.assign(Object.create(f),{constructor:d,preRender:function(){this.physic.update(this.node);var a=this.physic.body.velocity;if(a=20*Math.abs((a.x+a.z)/2)*this.soundMultiplier,this.currentSound&&-1!==this.currentSound.indexOf("_roll")&&!this.isFirstCollide&&k.setVolume(this.currentSound,a),this.launchOps.enabled){if(this.launchOps.progress+=this.launchOps.speed,this.launchOps.progress=Math.max(0,Math.min(this.launchOps.progress,1)),this.launchOps.progress>=1)return void this.launch(!1);var b=this.launchOps.progress-Number.EPSILON;b=h.easeOutCubic(b*this.launchOps.tweenScale),b*=this.launchOps.progressScale,this.manager.spline.getPositionAt(m,b),this.physic.body.position.x=m[0],this.physic.body.position.y=m[1],this.physic.body.position.z=m[2]}},launch:function(a){a?(this.launchOps.enabled=!0,this.launchOps.progress=0,this.physic.body.velocity.set(0,0,0),this.physic.body.sleep()):(this.launchOps.enabled=!1,this.launchOps.progress=0,this.manager.spline.getPositionAt(m,.6),j.sub(m,m,this.node.position),j.scale(m,m,2),this.physic.body.wakeUp(),this.physic.body.velocity.set(m[0],m[1],m[2]))},reset:function(){this.physic.reset(),this.physic.setPosition(this.mesh),this.resetSound()},play:function(a){this.dead||(this.isFirstCollide?(this.isFirstCollide=!1,this._playDrop(a)):a!=l.FLOOR&&this._playRoll(a))},stop:function(a){k.stop(this.currentSound),this.dead=a,this.isFirstCollide=!0,this.soundMultiplier=1},resetSound:function(){this.soundMultiplier=1,k.stop(this.currentSound),k.stop("MAT-01_drop"),k.stop("MAT-01_roll"),k.stop("MAT-02_drop"),k.stop("MAT-02_roll"),k.stop("MAT-03_drop"),k.stop("MAT-03_roll"),k.stop("FLOOR_drop"),k.stop("FLOOR_roll"),k.stop("TWO_sprakles"),k.stop("TWO_Ball_hole"),this.dead||(this.isFirstCollide=!0)},_playDrop:function(a){var b=this._getSoundName(a,"_drop");b&&(this.currentSound=b,k.play(this.currentSound,!1,1))},_playRoll:function(a){var b=this._getSoundName(a,"_roll");b&&b!=this.currentSound&&(this.currentSound=b,k.play(this.currentSound,!0,1))},_getSoundName:function(a,b){var c="";switch(a){case l.PLATFORM:c="MAT-01";break;case l.CARPET:c="MAT-02";break;case l.SPONGE:c="MAT-03";break;case l.FLOOR:c="FLOOR";break;default:c=""}return c&&(c+=b),c}}),d.getPhysicMaterial=function(){return g.getMaterial()},b.exports=d},{"../../../../sound/player":260,"../../constants/collision-group":180,"../../core/nmesh":189,"./physic":192,"gl-matrix":352,"math/ease":113}],191:[function(a,b,c){"use strict";function d(a){g.function.bind(this,"onMouseDown","onMouseUp","_onLoaded"),this.section=a,this.balls=[],this.activeBalls=[],this.pendingBalls=[],this.first=!0,this.spline=null}var e=a("./index"),f=a("../../../../lib/mouse"),g=a("../../utils"),h=a("config"),i=a("lib/net"),j=a("../../../eight/utils"),k=a("../../../eight/spline"),l=a("../../constants"),m=a("../../constants/collision-group"),n=a("../../../../sound/player");d.prototype={activate:function(){f.on("down",this.onMouseDown),f.on("up",this.onMouseUp)},desactivate:function(){f.off("down",this.onMouseDown),f.off("up",this.onMouseUp)},init:function(){for(var a=0;a<l.BALL_COUNT;a++)this.instanciate()},getLoadables:function(){var a=h.asset_url("two/launch_spline.bin");return i.loadBytes(a).then(this._onLoaded)},_onLoaded:function(a){var b=j.parseBin(a);this.spline=new k(this.section,b.vertices)},onMouseDown:function(a,b){},onMouseUp:function(a,b){0===b.button&&this.launchBall()},setMesh:function(a){this.mesh=a,this.mesh.proxiesOnly=!0,this.init()},getBallPhysicMaterial:function(){return e.getPhysicMaterial()},getBall:function(){var a=this.pendingBalls.shift();return!a&&this.activeBalls[0]?(a=this.activeBalls[0],this.section.confeti.create([a.physic.body.position.x,a.physic.body.position.y,a.physic.body.position.z]),this.killBall(this.activeBalls[0]),this.getBall()):(this.activeBalls.push(a),a)},instanciate:function(){var a=new e(this.section,this.mesh.proxy());a.mesh=this.mesh,this.balls.push(a),this.pendingBalls.push(a)},launchBall:function(){var a=this.getBall();a&&(n.play("SFX_popup_bille",!1),this.section.contact.getContact("Ball-Platform").addBall(a,m.PLATFORM),this.section.contact.getContact("Ball-Carpet").addBall(a,m.CARPET),this.section.contact.getContact("Ball-Sponge").addBall(a,m.SPONGE),this.section.contact.getContact("Ball-Underground").addBall(a,m.UNDERGROUND),this.section.contact.getContact("Ball-Floor").addBall(a,m.FLOOR),a.launch(!0))},killBall:function(a){this.resetBall(a);var b=this.activeBalls.indexOf(a);this.activeBalls.splice(b,1),this.pendingBalls.push(a)},resetBall:function(a){this.section.contact.getContact("Ball-Platform").removeBall(a.physic.body,m.PLATFORM),this.section.contact.getContact("Ball-Carpet").removeBall(a.physic.body,m.CARPET),this.section.contact.getContact("Ball-Sponge").removeBall(a.physic.body,m.SPONGE),this.section.contact.getContact("Ball-Underground").removeBall(a.physic.body,m.UNDERGROUND),this.section.contact.getContact("Ball-Floor").removeBall(a.physic.body,m.FLOOR),a.reset()},preRender:function(){for(var a=0;a<this.balls.length;a++)this.balls[a].preRender()},stop:function(){for(var a=0;a<this.balls.length;a++)this.balls[a].stop(!0);for(var a=0;a<this.activeBalls.length;a++)this.activeBalls[a].stop(!0);for(var a=0;a<this.pendingBalls.length;a++)this.pendingBalls[a].stop(!0)}},b.exports=d},{"../../../../lib/mouse":109,"../../../../sound/player":260,"../../../eight/spline":158,"../../../eight/utils":163,"../../constants":181,"../../constants/collision-group":180,"../../utils":230,"./index":190,config:18,"lib/net":110}],192:[function(a,b,c){"use strict";function d(a){this.section=a,this.body=new e.Body,this.body.type=e.Body.DYNAMIC,this.body.mass=h,this.body.allowSleep=!0,this.reset(),this.syncNode=!0,this.body.addShape(f.cannon.SphereSphere(i)),this.body.material=d.getMaterial(),this.section.physic.world.addBody(this.body)}var e=a("cannon"),f=a("../../utils"),g=a("../../constants/collision-group"),h=1e-4,i=.0384;d.prototype={constructor:d,setPosition:function(a){this.body.position.x=a.x,this.body.position.y=a.y,this.body.position.z=a.z},update:function(a){this.syncNode&&(a.rotation[0]=this.body.quaternion.x,a.rotation[1]=this.body.quaternion.y,a.rotation[2]=this.body.quaternion.z,a.rotation[3]=this.body.quaternion.w,a.position[0]=this.body.position.x,a.position[1]=this.body.position.y,a.position[2]=this.body.position.z,a.invalidate())},reset:function(){this.syncNode=!0,this.body.sleep(),this.body.collisionFilterGroup=g.BALL,this.body.collisionFilterMask=g.BALL|g.FLOOR|g.GROUND}},d._material=null,d.getMaterial=function(){return d._material||(d._material=new e.Material),d._material},b.exports=d},{"../../constants/collision-group":180,"../../utils":230,cannon:296}],193:[function(a,b,c){var d=function(a){var b="";return b+="#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\nuniform float uTime;\n\nuniform float uCarpetFrequency;\nuniform float uCarpetAmplitude;\nuniform float uCarpetSpeed;\nuniform vec2 uCarpetAmpProgress;\n\n#if depthFormat( D_RGB )\n  varying vec2 fragZW;\n#endif\n\n\nvec3 GetNewVertPosition( vec3 p ) {\n  p.z += cos( aTexCoord.y * uCarpetFrequency + uCarpetSpeed ) * uCarpetAmplitude * (uCarpetAmpProgress.x + ((1.0 - aTexCoord.y) * uCarpetAmpProgress.y));\n  return p;\n}\n\nvoid main(void){\n\n  vec4 pos = vec4( GetNewVertPosition( aPosition ), 1.0 );\n\n  gl_Position = uMVP * pos;\n\n  #if depthFormat( D_RGB )\n    fragZW=gl_Position.zw;\n  #endif\n}\n"};d.toString=d,b.exports=d},{}],194:[function(a,b,c){function d(b,c){this.ibl=null,this.prg=null,this.mat=c,this.inputs=new h,this.depthFormat=new g("depthFormat",["D_RGB","D_DEPTH"]),this.inputs.add(this.depthFormat),this.config=new e,this._prgcache=f.getCache(b),this._uid="carpet_depth",this._precision="highp",this._vertSrc=a("./carpet-depth.vert")(),this._fragSrc=a("nanogl-pbr/glsl/depthpass.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=(a("nanogl-pbr/lib/input"),a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/enum")),h=a("nanogl-pbr/lib/chunks-tree"),i=a("gl-matrix").mat4.create();d.prototype={setLightSetup:function(a){this.inputs.remove(this.depthFormat),this.depthFormat=a.depthFormat.createProxy(),this.inputs.add(this.depthFormat)},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),b.modelViewProjectionMatrix(i,a._wmatrix),this.prg.uMVP(i),c.setupInputs(this),c.uCarpetFrequency(this.mat.uCarpetFrequency),c.uCarpetAmplitude(this.mat.uCarpetAmplitude),c.uCarpetSpeed(this.mat.uTime*this.mat.uCarpetSpeed),c.uCarpetAmpProgress(this.mat.uCarpetAmpProgress)},_isDirty:function(){return null===this.prg||this.inputs._isDirty},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"./carpet-depth.vert":193,"gl-matrix":352,"nanogl-pbr/glsl/depthpass.frag":370,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],195:[function(a,b,c){"use strict";function d(a){this.gl=a}var e=a("nanogl/arraybuffer"),f=a("nanogl/indexbuffer");d.prototype={constructor:d,bind:function(a){this.buffer.attribPointer(a),this.indices.bind()},allocate:function(){var a=this.gl,b=d.generate(50),c=new Float32Array(b.vertices),g=new Uint8Array(b.indices);this.buffer=new e(a),this.buffer.data(c),this.buffer.attrib("aPosition",3,a.FLOAT),
this.buffer.attrib("aTexCoord",2,a.FLOAT),this.buffer.attrib("aNormal",3,a.FLOAT),this.indices=new f(a,a.UNSIGNED_BYTE),this.indices.data(g)},render:function(){this.indices.drawTriangles()}},d.generate=function(a){var b=[],c=[],d=0,e=0;for(d=0;d<a;d++)e=d/(a-1),b.push(-1,2*e-1,-1,0,e,0,0,1),b.push(-1,2*e-1,1,0,e,0,0,-1),b.push(1,2*e-1,-1,0,e,0,0,1),b.push(1,2*e-1,1,0,e,0,0,-1);for(d=0;d<a-1;d++)e=4*d,c.push(e+4,e+2,e+0),c.push(e+6,e+2,e+4),c.push(e+1,e+3,e+5),c.push(e+5,e+3,e+7),c.push(e+0,e+1,e+4),c.push(e+4,e+1,e+5),c.push(e+6,e+3,e+2),c.push(e+7,e+3,e+6);return e=4*(a-1),c.push(2,1,0),c.push(3,1,2),c.push(e+0,e+1,e+2),c.push(e+2,e+1,e+3),{vertices:b,indices:c}},b.exports=d},{"nanogl/arraybuffer":415,"nanogl/indexbuffer":418}],196:[function(a,b,c){"use strict";function d(a){f.constructor.call(this,a.scene),this.section=a,this.material=a.awd.getMaterial("Wood"),this.geometry=new h(a.scene.gl),this.geometry.allocate(),this.physic=new g(a),this.section.contact.getContact("Ball-Carpet").setEntity(this),this.GUI()}var e=a("../../core/nmesh"),f=e.prototype,g=a("./physic"),h=a("./geometry");a("cannon"),a("../../utils");d.prototype=Object.assign(Object.create(f),{constructor:d,GUI:function(){var a=f.GUI.call(this,"two-carpet");a.add(this.material,"uCarpetFrequency"),a.add(this.material,"uCarpetAmplitude"),a.add(this.material,"uCarpetSpeed"),a.add(this.material.uCarpetAmpProgress,"0",0,1).name("amplitude progress x"),a.add(this.material.uCarpetAmpProgress,"1",0,1).name("amplitude progress y")},setMesh:function(a){this.mesh=a,this.physic.setPosition(this.mesh)},preRender:function(){this.material.uTime+=this.section.scene.dt,this.physic.update(this)}}),b.exports=d},{"../../core/nmesh":189,"../../utils":230,"./geometry":195,"./physic":199,cannon:296}],197:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec2 aTexCoord1;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\n\nuniform float uCarpetFrequency;\nuniform float uCarpetAmplitude;\nuniform float uCarpetSpeed;\nuniform vec2 uCarpetAmpProgress;\n\nOUT vec2 vTexCoord;\nOUT vec2 vTexCoord1;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n\n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvec3 GetNewVertPosition( vec3 p ) {\n  p.z += cos( aTexCoord.y * uCarpetFrequency + uCarpetSpeed ) * uCarpetAmplitude * (uCarpetAmpProgress.x + ((1.0 - aTexCoord.y) * uCarpetAmpProgress.y));\n  return p;\n}\n\nvec3 GetNewVertNormal( vec3 p ) {\n  p.x += sin( aTexCoord.y * uCarpetFrequency + uCarpetSpeed );\n  return p;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec3 newPosition = GetNewVertPosition( aPosition );\n  vec3 newNormal   = GetNewVertNormal( aNormal );\n\n  vec4 pos = vec4( newPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n  vWorldNormal    = rotate( uWorldMatrix, normalize(newNormal) );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n\n  #if HAS_uvScale\n    vTexCoord *= uvScale();\n  #endif\n\n  #if HAS_uvOffset\n    vTexCoord += uvOffset();\n  #endif\n\n  vTexCoord1 = aTexCoord1;\n}"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],198:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.depthPass=new l(b,this),this.inputs=new j,this.iLightmap=this.inputs.add(new g("lightmap",3)),this.iAlbedoAtt=this.inputs.add(new g("albedoAttenuation",1)),this.iUVOffset=this.inputs.add(new g("uvOffset",2,g.VERTEX)),this.iUVScale=this.inputs.add(new g("uvScale",2,g.VERTEX)),this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.conserveEnergy=this.inputs.add(new h("receiveShadows",!0)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.uCarpetFrequency=3.2*Math.PI,this.uCarpetAmplitude=.06,this.uCarpetSpeed=2,this.uTime=0,this.uCarpetAmpProgress=[.2,.8],this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="carpet_stdgi",this._precision="highp",this._vertSrc=a("./carpet.vert")(),this._fragSrc=a("glsl/pbr-gi.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("gl-matrix").mat4.create(),l=a("../depth");d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("stdgi"))},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),c.uWorldMatrix(a._wmatrix),c.uCarpetFrequency(this.uCarpetFrequency),c.uCarpetAmplitude(this.uCarpetAmplitude),c.uCarpetSpeed(this.uTime*this.uCarpetSpeed),c.uCarpetAmpProgress(this.uCarpetAmpProgress),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"../depth":194,"./carpet.vert":197,"gl-matrix":352,"glsl/pbr-gi.frag":67,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],199:[function(a,b,c){"use strict";function d(a){this.section=a,this.body=new e.Body,this.body.mass=0,this.body.type=e.Body.KINEMATIC,this.body.collisionFilterGroup=f.CARPET,this.body.collisionFilterMask=f.BALL,this.body.material=new e.Material,this.walls=new e.Body,this.walls.type=e.Body.STATIC,this.walls.collisionFilterGroup=f.CARPET,this.walls.collisionFilterMask=f.BALL,this.walls.material=new e.Material,this.section.physic.world.addContactMaterial(new e.ContactMaterial(this.section.ballManager.getBallPhysicMaterial(),this.walls.material,{friction:0,restitution:0})),this.soundIn=new e.Body,this.soundIn.type=e.Body.STATIC,this.soundIn.collisionFilterGroup=f.CARPET,this.soundIn.collisionFilterMask=f.BALL,this.soundIn.collisionResponse=!1,this.soundOut=new e.Body,this.soundOut.type=e.Body.STATIC,this.soundOut.collisionFilterGroup=f.CARPET,this.soundOut.collisionFilterMask=f.BALL,this.soundOut.collisionResponse=!1,this.spline=null,this.init(),a.physic.world.addBody(this.body),a.physic.world.addBody(this.walls),a.physic.world.addBody(this.soundIn),a.physic.world.addBody(this.soundOut)}var e=a("cannon"),f=a("../../constants/collision-group"),g=a("../../../eight/spline"),h=a("../../utils"),i=a("gl-matrix"),j=i.vec3,k=a("../../constants"),l=new e.Vec3,m=j.create();d.prototype={constructor:d,setPosition:function(a){this.body.position.x=a.x,this.body.position.y=a.y,this.body.position.z=a.z,this.body.quaternion.x=a.rotation[0],this.body.quaternion.y=a.rotation[1],this.body.quaternion.z=a.rotation[2],this.body.quaternion.w=a.rotation[3],this.walls.position.x=a.x,this.walls.position.y=a.y,this.walls.position.z=a.z,this.walls.quaternion.x=a.rotation[0],this.walls.quaternion.y=a.rotation[1],this.walls.quaternion.z=a.rotation[2],this.walls.quaternion.w=a.rotation[3],this.soundIn.position.x=this.soundOut.position.x=a.x,this.soundIn.position.y=this.soundOut.position.y=a.y,this.soundIn.position.z=this.soundOut.position.z=a.z,this.soundIn.quaternion.x=this.soundOut.quaternion.x=a.rotation[0],this.soundIn.quaternion.y=this.soundOut.quaternion.y=a.rotation[1],this.soundIn.quaternion.z=this.soundOut.quaternion.z=a.rotation[2],this.soundIn.quaternion.w=this.soundOut.quaternion.w=a.rotation[3],this.setupSpline(a)},setupSpline:function(a){for(var b=[],c=0,d=j.create(),e=0;e<20;e++)c=e/19,c*=1.4,c*=k.SCALE,j.set(d,0,c,0),j.transformQuat(d,d,a.rotation),j.add(d,a.position,d),b.push.apply(b,d);this.spline=new g(this.section,b)},init:function(){this.initTrimesh(),this.initWalls(),this.initSound()},initWalls:function(){var a=.01*k.SCALE,b=.025*k.SCALE,c=.21*k.SCALE,d=.7*k.SCALE,f=.05*k.SCALE,g=.7*k.SCALE;this.walls.addShape(new e.Box(new e.Vec3(a,g,b)),new e.Vec3(c,d,f)),this.walls.addShape(new e.Box(new e.Vec3(a,g,b)),new e.Vec3(-c,d,f))},initSound:function(){this.soundIn.addShape(new e.Box(new e.Vec3(.3,.01,.2)),new e.Vec3(0,0,.2)),this.soundOut.addShape(new e.Box(new e.Vec3(.3,.01,.2)),new e.Vec3(0,1.42*k.SCALE,0))},initSlices:function(){var a=0,b=0,c=Number.EPSILON;for(a=0;a<35;a++)b=a/34,b*=1.4,this.body.addShape(new e.Box(new e.Vec3(.2,.035,c)),new e.Vec3(0,b,-c))},initTrimesh:function(){var a=[],b=0,c=0;for(c=0;c<10;c++)b=c/9,b*=1.425*k.SCALE,a.push(.4*k.SCALE*-.5,b,0),a.push(.4*k.SCALE*.5,b,0);var d=[];for(c=0;c<18;c+=2)d.push(c+0,c+1,c+2),d.push(c+2,c+1,c+3);this.trimesh=h.cannon.TrimeshShape(a),this.trimesh.updateViewerBuffer=!0,this.body.addShape(this.trimesh)},initTrimeshSlices:function(){var a,b=0,c=0,d=Number.EPSILON;for(b=0;b<35;b++)c=b/34,c*=1.4,a=new e.Trimesh([.2,-.035,d,-.2,-.035,d,.2,0,d,-.2,0,d],[0,1,2,2,1,3]),this.body.addShape(a,new e.Vec3(0,c,-d))},update:function(a){this.updateTrimesh(a)},updateSlices:function(a){var b,c=0,d=0,e=0,f=a.material.uTime*a.material.uCarpetSpeed,g=a.material.uCarpetFrequency,h=a.material.uCarpetAmplitude,i=a.material.uCarpetAmpProgress,j=0;for(d=0,e=this.body.shapes.length;d<e;d++)b=1-d/(e-1),c=b*g+f,j=i[0]+(1-b)*i[1],this.body.shapeOffsets[d].z=Math.cos(c)*h*j,this.body.shapeOrientations[d].setFromEuler(.5*Math.sin(c)*j,0,0,"XYZ")},updateTrimesh:function(a){var b,c=0,d=0,e=0,f=a.material.uTime*a.material.uCarpetSpeed,g=a.material.uCarpetFrequency,h=a.material.uCarpetAmplitude,i=a.material.uCarpetAmpProgress,j=0;for(d=0,e=this.trimesh.vertices.length/3;d<e;d++)b=1-d/(e-1),c=b*g+f,j=i[0]+(1-b)*i[1],this.trimesh.vertices[3*d+2]=Math.cos(c)*h*j+.0075;this.trimesh.updateEdges(),this.trimesh.updateNormals(),this.trimesh.updateAABB(),this.trimesh.updateBoundingSphereRadius(),this.trimesh.updateTree()},updateAttraction:function(){for(var a,b,c,d,e,f=0,g=this.section.ballManager.balls.length;f<g;f++)a=this.section.ballManager.balls[f],"carpet"==a.currentSurface&&(b=this.spline.getNearestPoint(a.physic.body),e=this.spline.getProgressAtPoint(b),e=Math.min(e+.2,1)-Number.EPSILON,b=this.spline.getPositionAt(b,e),b.vsub(a.physic.body.position,m),c=l.normalize(),d=Math.max(0,Math.min(c/.2,1)),c<.2&&l.mult(25e-5*c*d,a.physic.body.force))}},b.exports=d},{"../../../eight/spline":158,"../../constants":181,"../../constants/collision-group":180,"../../utils":230,cannon:296,"gl-matrix":352}],200:[function(a,b,c){var d=function(a){var b="";return b+="#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\nuniform float uTime;\n\nuniform float uFlagFrequency;\nuniform float uFlagAmplitude;\nuniform float uFlagSpeed;\nuniform float uFlagSize;\n\n#if depthFormat( D_RGB )\n  varying vec2 fragZW;\n#endif\n\n\nvec3 GetNewVertPosition( vec3 p ) {\n  p.x += cos( aTexCoord.x * uFlagFrequency + uFlagSpeed ) * uFlagAmplitude * aTexCoord.x;\n  p.y -= aTexCoord.x * 0.2 * uFlagSize;\n\n  p.y = clamp(p.y, 0.0, 1.0);\n\n  return p;\n}\n\nvoid main(void){\n\n  vec4 pos = vec4( GetNewVertPosition( aPosition ), 1.0 );\n\n  gl_Position = uMVP * pos;\n\n  #if depthFormat( D_RGB )\n    fragZW=gl_Position.zw;\n  #endif\n}\n"};d.toString=d,b.exports=d},{}],201:[function(a,b,c){function d(b,c){this.ibl=null,this.prg=null,this.mat=c,this.inputs=new h,this.depthFormat=new g("depthFormat",["D_RGB","D_DEPTH"]),this.inputs.add(this.depthFormat),this.config=new e,this._prgcache=f.getCache(b),this._uid="flag_depth",this._precision="highp",this._vertSrc=a("./flag-depth.vert")(),this._fragSrc=a("nanogl-pbr/glsl/depthpass.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=(a("nanogl-pbr/lib/input"),a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/enum")),h=a("nanogl-pbr/lib/chunks-tree"),i=a("gl-matrix").mat4.create();d.prototype={setLightSetup:function(a){this.inputs.remove(this.depthFormat),this.depthFormat=a.depthFormat.createProxy(),this.inputs.add(this.depthFormat)},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),b.modelViewProjectionMatrix(i,a._wmatrix),this.prg.uMVP(i),c.setupInputs(this),c.uFlagFrequency(this.mat.uFlagFrequency),c.uFlagAmplitude(this.mat.uFlagAmplitude),c.uFlagSpeed(this.mat.uTime*this.mat.uFlagSpeed),c.uFlagSize(this.mat.uFlagSize)},_isDirty:function(){return null===this.prg||this.inputs._isDirty},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"./flag-depth.vert":200,"gl-matrix":352,"nanogl-pbr/glsl/depthpass.frag":370,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],202:[function(a,b,c){"use strict";function d(a){f.constructor.call(this,a.scene),this.section=a,this.mesh=null,this.material=a.awd.getMaterial("Flag"),this.launchOps={enabled:!1,progress:0,speed:.1},window.F=this,this.GUI()}var e=a("../../core/nmesh"),f=e.prototype,g=a("gl-matrix"),h=(g.vec3,g.quat);d.prototype=Object.assign(Object.create(f),{constructor:d,GUI:function(){var a=f.GUI.call(this,"two-flag");a.add(this.material,"uFlagFrequency"),a.add(this.material,"uFlagAmplitude"),a.add(this.material,"uFlagSpeed")},setMesh:function(a){this.mesh=a},preRender:function(){this.material.uTime+=this.section.scene.dt,this.material.uFlagSize=this.launchOps.speed,this.launchOps.speed*=.87;var a=.15*this.launchOps.speed*Math.cos(40*this.material.uTime);h.identity(this.mesh.rotation),h.rotateX(this.mesh.rotation,this.mesh.rotation,-.5*Math.PI+a),this.mesh.invalidate()},launch:function(){this.launchOps.enabled=!0,this.launchOps.speed=10}}),b.exports=d},{"../../core/nmesh":189,"gl-matrix":352}],203:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec2 aTexCoord1;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform mat4 uViewProjectionMatrix;\n\nuniform float uFlagFrequency;\nuniform float uFlagAmplitude;\nuniform float uFlagSpeed;\nuniform float uFlagSize;\n\nOUT vec2 vTexCoord;\nOUT vec2 vTexCoord1;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n\n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n#define PI 3.141592654\n#define EPSILON 0.0000001\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvec3 GetNewVertPosition( vec3 p ) {\n  p.x += cos( aTexCoord.x * uFlagFrequency + uFlagSpeed ) * uFlagAmplitude * aTexCoord.x;\n  p.y -= aTexCoord.x * 0.2 * uFlagSize;\n\n  p.y = clamp(p.y, 0.0, 1.0);\n\n  return p;\n}\n\nvec3 GetNewVertNormal( vec3 p ) {\n  p.y += sin( aTexCoord.y * uFlagFrequency + uFlagSpeed ) * uFlagAmplitude * aTexCoord.x;\n  return p;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec3 newPosition = GetNewVertPosition( aPosition );\n  vec3 newNormal   = GetNewVertNormal( aNormal );\n\n  vWorldPosition = (uWorldMatrix * vec4( newPosition, 1.0 )).xyz;\n  vWorldNormal = rotate( uWorldMatrix, newNormal );\n\n  gl_Position = uViewProjectionMatrix * vec4(vWorldPosition, 1.0);\n\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n\n  #if HAS_uvScale\n    vTexCoord *= uvScale();\n  #endif\n\n  #if HAS_uvOffset\n    vTexCoord += uvOffset();\n  #endif\n\n  vTexCoord1 = aTexCoord1;\n}"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],204:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.depthPass=new l(b,this),this.uFlagFrequency=1.59*Math.PI,this.uFlagAmplitude=.025,this.uFlagSpeed=-25,this.uFlagSize=0,this.uTime=0,this.inputs=new j,this.iLightmap=this.inputs.add(new g("lightmap",3)),this.iAlbedoAtt=this.inputs.add(new g("albedoAttenuation",1)),this.iUVOffset=this.inputs.add(new g("uvOffset",2,g.VERTEX)),this.iUVScale=this.inputs.add(new g("uvScale",2,g.VERTEX)),this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.conserveEnergy=this.inputs.add(new h("receiveShadows",!0)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="flag_stdgi",this._precision="highp",this._vertSrc=a("./flag.vert")(),this._fragSrc=a("glsl/pbr-gi.frag")(),this._vertSrc="#define NUM_BALL "+k.BALL_COUNT+"\n\n"+this._vertSrc}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("../../../constants"),l=(a("gl-matrix").mat4.create(),a("../depth"));d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("stdgi"))},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),c.uWorldMatrix(a._wmatrix),c.uViewProjectionMatrix(b._viewProj),c.uFlagFrequency(this.uFlagFrequency),c.uFlagAmplitude(this.uFlagAmplitude),c.uFlagSpeed(this.uTime*this.uFlagSpeed),c.uFlagSize(this.uFlagSize),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"../../../constants":181,"../depth":201,"./flag.vert":203,"gl-matrix":352,"glsl/pbr-gi.frag":67,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],205:[function(a,b,c){"use-strict";function d(a,b){this.section=a,this.node=b,this.initialPos=new Float32Array(b.position),this.initialRot=new Float32Array(b.rotation);var c=new Float32Array(b.rotation);this.hoverRot=c,h.rotateX(c,c,2*(Math.random()-.5)),h.rotateY(c,c,2*(Math.random()-.5)),h.rotateZ(c,c,2*(Math.random()-.5)),this.hoverSin=h.create(),this.time=0,this.sinxs=.5*Math.random()+.5,this.sinys=.5*Math.random()+.5,this.sinxo=6.3*Math.random(),this.sinyo=6.3*Math.random()}var e=(a("nanogl-node"),a("math"),a("gl-matrix")),f=e.vec3,g=e.mat4,h=e.quat,i=(f.create(),f.create()),j=h.create(),k=h.create(),l=g.create();d.prototype={constructor:d,preRender:function(a){this.time+=a,h.rotateX(j,k,.1*Math.sin(this.time*this.sinxs+this.sinxo)),h.rotateY(j,j,.1*Math.sin(this.time*this.sinys+this.sinyo)),h.multiply(j,j,this.hoverRot),f.set(i,this.initialPos[0],this.initialPos[1]+.05*Math.cos(this.time*this.sinxs+this.sinxo),this.initialPos[2]),g.fromRotationTranslation(l,j,i),this.node.setMatrix(l)}},b.exports=d},{"gl-matrix":352,math:114,"nanogl-node":368}],206:[function(a,b,c){"use strict";function d(a){f.constructor.call(this,a.scene),this.section=a,this.physic=new g(a),this.section.contact.getContact("Ball-Platform").setEntity(this);var b=this;Object.defineProperty(this,"node",{get:function(){return b.mesh}})}var e=a("../../core/nmesh"),f=e.prototype,g=a("./physic");d.prototype=Object.assign(Object.create(f),{constructor:d,setMesh:function(a){this.mesh=a,this.physic.setPosition(this.mesh)},preRender:function(){this.physic.update(this.node)}}),b.exports=d},{"../../core/nmesh":189,"./physic":207}],207:[function(a,b,c){"use strict";function d(a){this.section=a,this.spline=null,this.body=new e.Body,this.body.mass=0,this.body.type=e.Body.KINEMATIC,this.body.collisionFilterGroup=h.PLATFORM,this.body.collisionFilterMask=h.BALL,this.body.material=new e.Material,this.section.physic.world.addBody(this.body),this.walls=new e.Body,this.walls.mass=0,this.walls.type=e.Body.KINEMATIC,this.walls.collisionFilterGroup=h.PLATFORM,this.walls.collisionFilterMask=h.BALL,this.walls.material=new e.Material,this.section.physic.world.addContactMaterial(new e.ContactMaterial(this.section.ballManager.getBallPhysicMaterial(),this.walls.material,{friction:0,restitution:0})),this.section.physic.world.addBody(this.walls),this.deadzone=new e.Body,this.deadzone.mass=0,this.deadzone.collisionResponse=!1,this.deadzone.type=e.Body.KINEMATIC,this.deadzone.collisionFilterGroup=h.PLATFORM,this.deadzone.collisionFilterMask=h.BALL,this.section.physic.world.addBody(this.deadzone),this.setupShapes(),this.fixRotation()}var e=a("cannon"),f=a("lib/mouse"),g=a("../../utils"),h=a("../../constants/collision-group"),i=a("../../../eight/spline"),j=a("../../constants"),k=new e.Vec3,l=new e.Vec3,m=new e.Quaternion;d.prototype={constructor:d,setupShapes:function(){var a=new e.Quaternion;g.cannon.appendRotation(a,-.025*Math.PI,0,0,1),this.body.addShape(g.cannon.BoxShape(.8*j.SCALE,.42*j.SCALE,.2*j.SCALE),new e.Vec3(0,-.38*j.SCALE,-.18*j.SCALE),a);for(var b=20,c=0,d=Math.PI,f=.79*j.SCALE,i=0;i<=b;i++)c=i/b,g.cannon.setRotation(a,-d*c,0,0,1),this.walls.addShape(g.cannon.BoxShape(.01*j.SCALE,.05*j.SCALE,.05*j.SCALE),g.cannon.Vec3(Math.cos(d*c)*f,Math.sin(-d*c)*f,.02*j.SCALE),a);for(this.deadzone.addShape(g.cannon.CylinderShape(.27*j.SCALE,.27*j.SCALE,.1*j.SCALE,5*j.SCALE)),b=10,c=0,d=Math.PI,f=.81*j.SCALE,i=0;i<=b;i++)c=i/b,g.cannon.setRotation(a,-d*c,0,0,1),this.deadzone.addShape(g.cannon.BoxShape(.01*j.SCALE,.1*j.SCALE,.1*j.SCALE),g.cannon.Vec3(Math.cos(d*c)*f,Math.sin(-d*c)*f,.1*j.SCALE),a);this.section.physic.world.addBody(this.deadzone),this.sound=new e.Body,this.sound.mass=0,this.sound.type=e.Body.KINEMATIC,this.sound.collisionFilterGroup=h.PLATFORM,this.sound.collisionFilterMask=h.BALL,this.sound.collisionResponse=!1,c=1.05,f=.52*j.SCALE,g.cannon.setRotation(a,-d*c,0,0,1);var k=g.cannon.BoxShape(.35,.01,.2);k.soundId=j.ID_PLATFORM_OUT,this.sound.addShape(k,g.cannon.Vec3(Math.cos(d*c)*f,Math.sin(-d*c)*f,.1*j.SCALE),a),this.section.physic.world.addBody(this.sound)},setPosition:function(a){this.body.position.x=a.x,this.body.position.y=a.y,this.body.position.z=a.z,this.deadzone.position.copy(this.body.position),this.walls.position.copy(this.body.position),this.sound.position.copy(this.body.position),this.setupSpline(a)},setupSpline:function(a){for(var b=[],c=0,d=.9*Math.PI,e=0,f=0;e<=60;e+=3,f++)c=f/20,b[e+0]=a.x+.56*Math.cos(.15*Math.PI+d*c)*j.SCALE,b[e+1]=a.y,b[e+2]=a.z+.56*Math.sin(.15*Math.PI+d*c)*j.SCALE;this.spline=new i(this.section,b)},fixRotation:function(){this.baseQuaternion=new e.Quaternion,g.cannon.appendRotation(this.baseQuaternion,.5*Math.PI,1,0,0),g.cannon.appendRotation(this.baseQuaternion,1*Math.PI,0,1,0),g.cannon.appendRotation(this.baseQuaternion,.9*Math.PI,0,0,1),this.body.quaternion.copy(this.baseQuaternion)},update:function(a){this.updatePlatformRotation(),this.updateAttraction(),a.position[0]=this.body.position.x,a.position[1]=this.body.position.y,a.position[2]=this.body.position.z,a.rotation[0]=this.body.quaternion.x,a.rotation[1]=this.body.quaternion.y,a.rotation[2]=this.body.quaternion.z,a.rotation[3]=this.body.quaternion.w,a.invalidate()},updatePlatformRotation:function(){k.x=2*g.math.clamp(f.coords[1]/.5,-1,1),k.z=0,k.y=-2*g.math.clamp(f.coords[0]/.5,-1,1),l.x+=.1*(k.x-l.x),l.y+=.1*(k.y-l.y),l.z+=.1*(k.z-l.z),m.setFromAxisAngle(l,.025*Math.PI),this.baseQuaternion.mult(m,this.body.quaternion),this.baseQuaternion.mult(m,this.deadzone.quaternion),this.baseQuaternion.mult(m,this.walls.quaternion),this.baseQuaternion.mult(m,this.sound.quaternion)},updateAttraction:function(){for(var a,b,c,d,e=0,f=0,g=this.section.ballManager.activeBalls.length;f<g;f++)a=this.section.ballManager.activeBalls[f],"platform"==a.currentSurface&&(b=this.spline.getNearestPoint(a.physic.body),e=this.spline.getProgressAtPoint(b),e=Math.min(e+.1,1)-Number.EPSILON,b=this.spline.getPositionAt(b,e),b.vsub(a.physic.body.position,k),c=k.normalize(),d=Math.max(0,Math.min(c/.2,1)),c<.2&&k.mult(5e-4*c*d,a.physic.body.force))}},b.exports=d},{"../../../eight/spline":158,"../../constants":181,"../../constants/collision-group":180,"../../utils":230,cannon:296,"lib/mouse":109}],208:[function(a,b,c){function d(b,c){this.ibl=null,this.prg=null,this.mat=c,this.inputs=new h,this.depthFormat=new g("depthFormat",["D_RGB","D_DEPTH"]),this.inputs.add(this.depthFormat),this.config=new e,this._prgcache=f.getCache(b),this._uid="sponge_depth",this._precision="highp",this._vertSrc=a("./sponge-depth.vert")(),this._fragSrc=a("nanogl-pbr/glsl/depthpass.frag")(),this._vertSrc="#define NUM_BALL "+i.BALL_COUNT+"\n\n"+this._vertSrc}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=(a("nanogl-pbr/lib/input"),a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/enum")),h=a("nanogl-pbr/lib/chunks-tree"),i=a("../../../constants");a("gl-matrix").mat4.create();d.prototype={setLightSetup:function(a){this.inputs.remove(this.depthFormat),this.depthFormat=a.depthFormat.createProxy(),this.inputs.add(this.depthFormat)},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),c.uViewProjectionMatrix(b._viewProj),c.uWorldMatrix(a._wmatrix),c.uSpongeCurvature(this.mat.uSpongeCurvature),c.uSpongeRadius(this.mat.uSpongeRadius),c.uBallPosition(this.mat.uBallPosition)},_isDirty:function(){return null===this.prg||this.inputs._isDirty},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"../../../constants":181,"./sponge-depth.vert":209,"gl-matrix":352,"nanogl-pbr/glsl/depthpass.frag":370,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],209:[function(a,b,c){var d=function(a){var b="";return b+="#pragma SLOT pv\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform mat4 uViewProjectionMatrix;\n\nuniform float uSpongeRadius;\nuniform float uSpongeCurvature;\nuniform vec3 uBallPosition[NUM_BALL];\n\n#if depthFormat( D_RGB )\n  varying vec2 fragZW;\n#endif\n\n#define PI 3.141592654\n#define EPSILON 0.0000001\n\nvoid GetNewVertex( in vec3 ballPosition, in vec3 worldPosition, out vec3 newWorldPosition ) {\n  // Use the Witch of Agnesi function [ y = (8a^3) / (x^2 + 4a^2) ] to determine the surface displacement\n  vec3 dir   = worldPosition - ballPosition;\n  float diam = uSpongeCurvature; // Circle diameter\n  float dist = length( dir ) / max(uSpongeRadius, EPSILON); // Distance between ball and vertex position\n\n  newWorldPosition    = worldPosition;\n  newWorldPosition.y -= (8.0 * diam*diam*diam) / (dist*dist + 4.0 * diam*diam); // Agnesi's equation\n}\n\nvoid main(void){\n\n  vec3 worldPosition = (uWorldMatrix * vec4( aPosition, 1.0 )).xyz;\n\n  for (int i = 0; i < NUM_BALL; i++) {\n    GetNewVertex( uBallPosition[i], worldPosition, worldPosition );\n  }\n\n  gl_Position = uViewProjectionMatrix * vec4(worldPosition, 1.0);\n\n  #if depthFormat( D_RGB )\n    fragZW=gl_Position.zw;\n  #endif\n}\n"};d.toString=d,b.exports=d},{}],210:[function(a,b,c){"use strict";function d(a){f.constructor.call(this,a.scene),this.mesh=null,this.section=a,this.physic=new g(a),this.material=a.awd.getMaterial("Sponge"),this.section.contact.getContact("Ball-Sponge").setEntity(this),this.GUI()}var e=a("../../core/nmesh"),f=e.prototype,g=a("./physic"),h=a("gl-matrix"),i=h.vec3,j=a("../../constants"),k=i.create();d.prototype=Object.assign(Object.create(f),{constructor:d,GUI:function(){var a=f.GUI.call(this,"two-sponge");a.add(this.material,"uSpongeRadius",0),a.add(this.material,"uSpongeCurvature",0)},setMesh:function(a){this.mesh=a,this.physic.setPosition(this.mesh)},preRender:function(){for(var a=0,b=this.section.ballManager.balls.length;a<b;a++)i.copy(k,this.section.ballManager.balls[a].node._wposition),k[1]-=.0135*j.SCALE,this.material.uBallPosition.set(k,3*a);this.physic.update(this.mesh)}}),b.exports=d},{"../../constants":181,"../../core/nmesh":189,"./physic":213,"gl-matrix":352}],211:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.depthPass=new l(b,this),this.inputs=new j,this.iLightmap=this.inputs.add(new g("lightmap",3)),this.iAlbedoAtt=this.inputs.add(new g("albedoAttenuation",1)),this.iUVOffset=this.inputs.add(new g("uvOffset",2,g.VERTEX)),this.iUVScale=this.inputs.add(new g("uvScale",2,g.VERTEX)),this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.conserveEnergy=this.inputs.add(new h("receiveShadows",!0)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),
this.iExposure=this.inputs.add(new g("exposure",1)),this.uBallPosition=new Float32Array(3*k.BALL_COUNT),this.uSpongeRadius=.3,this.uSpongeCurvature=.15,this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="sponge_stdgi",this._precision="highp",this._vertSrc=a("./sponge.vert")(),this._fragSrc=a("glsl/pbr-gi.frag")(),this._vertSrc="#define NUM_BALL "+k.BALL_COUNT+"\n\n"+this._vertSrc}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=a("nanogl-pbr/lib/input"),h=a("nanogl-pbr/lib/flag"),i=a("nanogl-pbr/lib/enum"),j=a("nanogl-pbr/lib/chunks-tree"),k=a("../../../constants"),l=(a("gl-matrix").mat4.create(),a("../depth"));d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("stdgi"))},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),c.uWorldMatrix(a._wmatrix),c.uViewProjectionMatrix(b._viewProj),c.uSpongeCurvature(this.uSpongeCurvature),c.uSpongeRadius(this.uSpongeRadius),c.uBallPosition(this.uBallPosition),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"../../../constants":181,"../depth":208,"./sponge.vert":212,"gl-matrix":352,"glsl/pbr-gi.frag":67,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],212:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec2 aTexCoord1;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform mat4 uViewProjectionMatrix;\n\nuniform float uSpongeRadius;\nuniform float uSpongeCurvature;\nuniform vec3 uBallPosition[NUM_BALL];\n\nOUT vec2 vTexCoord;\nOUT vec2 vTexCoord1;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n\n"+a("nanogl-pbr/glsl/includes/spherical-harmonics.glsl")()+"\n#endif\n\n#define PI 3.141592654\n#define EPSILON 0.0000001\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid GetNewVertex( in vec3 ballPosition, in vec3 worldPosition, in vec3 worldNormal, out vec3 newWorldPosition, out vec3 newWorldNormal ) {\n  // Use the Witch of Agnesi function [ y = (8a^3) / (x^2 + 4a^2) ] to determine the surface displacement\n  vec3 dir   = worldPosition - ballPosition;\n  float diam = uSpongeCurvature; // Circle diameter\n  float dist = length( dir ) / max(uSpongeRadius, EPSILON); // Distance between ball and vertex position\n\n  newWorldPosition    = worldPosition;\n  newWorldPosition.y -= (8.0 * diam*diam*diam) / (dist*dist + 4.0 * diam*diam); // Agnesi's equation\n\n  // Compute new normal\n  float w = pow(max(uSpongeRadius, EPSILON), 2.0);\n\n  vec3 n1       = vec3(1.0);\n  n1.x = (-16.0 * diam*diam*diam * dir.x / w) / pow(dist/w + 8.0 * diam*diam, 2.0);\n  n1.z = (-16.0 * diam*diam*diam * dir.z / w) / pow(dist/w + 8.0 * diam*diam, 2.0);\n  n1   = normalize( n1 );\n\n  newWorldNormal = n1;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vWorldPosition = (uWorldMatrix * vec4( aPosition, 1.0 )).xyz;\n  vWorldNormal = rotate( uWorldMatrix, aNormal );\n\n  for (int i = 0; i < NUM_BALL; i++) {\n    GetNewVertex( uBallPosition[i], vWorldPosition, vWorldNormal, vWorldPosition, vWorldNormal );\n  }\n\n  gl_Position = uViewProjectionMatrix * vec4(vWorldPosition, 1.0);\n\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n\n  #if HAS_uvScale\n    vTexCoord *= uvScale();\n  #endif\n\n  #if HAS_uvOffset\n    vTexCoord += uvOffset();\n  #endif\n\n  vTexCoord1 = aTexCoord1;\n}"};d.toString=d,b.exports=d},{"nanogl-pbr/glsl/includes/spherical-harmonics.glsl":375}],213:[function(a,b,c){"use strict";function d(a){this.section=a,this.body=new e.Body,this.body.type=e.Body.KINEMATIC,this.body.collisionFilterGroup=g.SPONGE,this.body.collisionFilterMask=g.BALL,this.body.material=new e.Material,this.body.allowSleep=!1,this.deadzone=new e.Body,this.deadzone.type=e.Body.STATIC,this.deadzone.collisionResponse=!0,this.deadzone.collisionFilterGroup=g.SPONGE,this.deadzone.collisionFilterMask=g.BALL,this.sound=new e.Body,this.sound.type=e.Body.KINEMATIC,this.sound.collisionFilterGroup=g.SPONGE,this.sound.collisionFilterMask=g.BALL,this.sound.collisionResponse=!1,this.section.physic.world.addBody(this.body),this.section.physic.world.addBody(this.deadzone),this.section.physic.world.addBody(this.sound),this.spline=null,this.init()}var e=a("cannon"),f=a("../../utils"),g=a("../../constants/collision-group"),h=a("../../../eight/spline"),i=a("gl-matrix"),j=i.vec3,k=i.quat,l=a("../../constants"),m=new e.Vec3;d.prototype={setPosition:function(a){this.body.position.x=a.x,this.body.position.y=a.y,this.body.position.z=a.z,this.body.quaternion.x=a.rotation[0],this.body.quaternion.y=a.rotation[1],this.body.quaternion.z=a.rotation[2],this.body.quaternion.w=a.rotation[3],this.deadzone.position.x=a.x,this.deadzone.position.y=a.y,this.deadzone.position.z=a.z,this.deadzone.quaternion.x=a.rotation[0],this.deadzone.quaternion.y=a.rotation[1],this.deadzone.quaternion.z=a.rotation[2],this.deadzone.quaternion.w=a.rotation[3],this.sound.position.x=a.x,this.sound.position.y=a.y,this.sound.position.z=a.z,this.sound.quaternion.x=a.rotation[0],this.sound.quaternion.y=a.rotation[1],this.sound.quaternion.z=a.rotation[2],this.sound.quaternion.w=a.rotation[3],this.setupSpline(a)},setupSpline:function(a){for(var b=[],c=0,d=j.create(),e=j.create(),f=k.create(),g=0;g<20;g++)c=g/19,j.set(d,.85,0,.25),j.set(e,.75*Math.cos(Math.PI*c),.05*Math.sin(5*Math.PI*c),0),j.add(d,d,e),j.set(e,-.8125,0,-.2),j.add(d,d,e),k.identity(f),k.rotateY(f,f,-.0275*Math.PI),j.transformQuat(d,d,f),j.transformQuat(d,d,a.rotation),j.add(d,a.position,d),b.push.apply(b,d);this.spline=new h(this.section,b)},init:function(){this.initBoxes(),this.initSound()},initBoxes:function(){var a=-.04*l.SCALE,b=f.cannon.QuatFromAxisAngle(-.0375*Math.PI,0,1,0);f.cannon.appendRotation(b,.002*Math.PI,0,0,1);var c=f.cannon.Quat();c.copy(b),f.cannon.appendRotation(c,.001*Math.PI,1,0,0),this.body.addShape(f.cannon.BoxShape(.85*l.SCALE,.18*l.SCALE,.025*l.SCALE),f.cannon.Vec3(.1*l.SCALE,0,a),c),c.copy(b),f.cannon.appendRotation(c,.03*Math.PI,0,0,1),c.copy(b),f.cannon.appendRotation(c,-.05*Math.PI,0,0,1),this.body.addShape(f.cannon.BoxShape(.4*l.SCALE,.005*l.SCALE,.12*l.SCALE),f.cannon.Vec3(-.1*l.SCALE,-.12*l.SCALE,a),c),c.copy(b),f.cannon.appendRotation(c,.05*Math.PI,0,0,1),this.body.addShape(f.cannon.BoxShape(.4*l.SCALE,.005*l.SCALE,.12*l.SCALE),f.cannon.Vec3(-.1*l.SCALE,.12*l.SCALE,a),c),this.body.addShape(f.cannon.BoxShape(.05*l.SCALE,.125*l.SCALE,.125*l.SCALE),f.cannon.Vec3(-.58*l.SCALE,0,-.025*l.SCALE),b);var d=.02*l.SCALE;this.deadzone.addShape(f.cannon.CylinderShape(d,d,.01*l.SCALE,10),f.cannon.Vec3(-.52*l.SCALE,0,-.04),b)},initSound:function(){this.sound.addShape(new e.Box(new e.Vec3(.3,.3,.01)),new e.Vec3(.9,0,.2))},update:function(a){},updateAttraction:function(){for(var a,b,c,d,e,f=0,g=this.section.ballManager.balls.length;f<g;f++)a=this.section.ballManager.balls[f],b=this.spline.getNearestPoint(a.physic.body),e=this.spline.getProgressAtPoint(b),e=Math.min(e+.3,1)-Number.EPSILON,b=this.spline.getPositionAt(b,e),b.vsub(a.physic.body.position,m),c=m.normalize(),m[0]=0,m[1]=0,d=Math.max(0,Math.min(c/.1,1)),c<.1&&m.mult(.025*c*d,a.physic.body.force)}},b.exports=d},{"../../../eight/spline":158,"../../constants":181,"../../constants/collision-group":180,"../../utils":230,cannon:296,"gl-matrix":352}],214:[function(a,b,c){"use strict";function d(a){g.function.bind(this,"_onLoaded"),this.onHover=this._onHover.bind(this),this.disableHover=this._disableHover.bind(this),this.scene=a.scene,this.awd=new h(this.scene),this.gl=this.scene.gl,this.hasLeft=!1,this.awd.node.rotateY(3*-Math.PI/4),a.node.add(this.awd.node),this.contact=new m(this),this.physic=new i(this),this.ballManager=new k(this),this.carpet=new n(this),this.platform=new j(this),this.sponge=new o(this),this.flag=new p(this),this.tubes=[],this.cylinder_picking=new r(this),this.confeti=null,this.isOvered=!1}var e=a("when"),f=a("cursor"),g=a("./utils"),h=a("./awd-scene"),i=a("./physic"),j=a("./entities/platform"),k=a("./entities/ball/manager"),l=a("./entities/floating-tube"),m=a("./contacts/manager"),n=a("./entities/carpet"),o=a("./entities/sponge"),p=a("./entities/flag"),q=a("sound/player"),r=a("./picking/cylinder2");d.prototype={constructor:d,getLoadables:function(){var a=[];return a=a.concat(this.awd.getLoadables()),a=a.concat(this.ballManager.getLoadables()),a.push(this.cylinder_picking.getLoadable()),e.all(a).then(this._onLoaded),a},getCameraPosition:function(a,b){},getPosition:function(a){},setPosition:function(a){a<-1e-5&&(this.hasLeft||(this.hasLeft=!0,this.onLeaving()))},onLeaving:function(){q.play("transition",!1,.9),ga("send","event","wishes-0")},_onLoaded:function(){this.confeti=this.scene.confeti.createFactory(this.awd.node,{count:30,spread:1.5,size:1.05,heigth:1.5,spped:.9,lifeTime:.8}),this.ballManager.setMesh(this.awd.loader.getObjectByName("Ball")),this.flag.setMesh(this.awd.loader.getObjectByName("Flag_2")),this.platform.setMesh(this.awd.loader.getObjectByName("Plateform")),this.carpet.setMesh(this.awd.loader.getObjectByName("Carpet")),this.sponge.setMesh(this.awd.loader.getObjectByName("SpongeMarble")),this.tubes.push(new l(this,this.awd.loader.getObjectByName("Cylinder"))),this.tubes.push(new l(this,this.awd.loader.getObjectByName("Cylinder_6"))),ga("send","event","wishes-2")},start:function(){function a(){window.removeEventListener("click",a),f.canvas.transitionOutTuto()}this.ballManager.activate(),TweenMax.delayedCall(2,function(){window.addEventListener("click",a),f.canvas.transitionInTuto("CLICK")})},stop:function(){this.ballManager.desactivate(),this.ballManager.stop()},preRender:function(){this.ballManager.preRender();for(var a=0;a<this.tubes.length;a++)this.tubes[a].preRender(this.scene.dt);this.platform.preRender(),this.carpet.preRender(),this.sponge.preRender(),this.flag.preRender(),this.contact.update(),this.cylinder_picking.preRender()},_onHover:function(){f.enableHover()},_disableHover:function(){f.disableHover()},render:function(){this.awd.render(1)},postRender:function(){this.physic.preRender()},renderShadowPass:function(a){this.awd.renderDepth(a.cam,1,a.defaultpass)},rttPass:function(){}},b.exports=function(a){return new d(a)}},{"./awd-scene":179,"./contacts/manager":188,"./entities/ball/manager":191,"./entities/carpet":196,"./entities/flag":202,"./entities/floating-tube":205,"./entities/platform":206,"./entities/sponge":210,"./physic":226,"./picking/cylinder2":227,"./utils":230,cursor:19,"sound/player":260,when:445}],215:[function(a,b,c){function d(a,b){return this.scene=a,this.gl=b,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/aquarelle")),a.iGloss.attachConstant(.6),a.iSpecular.attachConstant([.35,.35,.35]),a.iLightmap.attachConstant([.9,.9,.9]),a.iAlbedoAtt.attachConstant([.2]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],216:[function(a,b,c){function d(a,b){return this.scene=a,this.gl=b,this.init()}var e=a("nanogl-pbr/standard");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([1,1,1]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([.35,.35,.35]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"nanogl-pbr/standard":403}],217:[function(a,b,c){"use strict";function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("../entities/flag/material");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.texs.get("blue-gradient")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iLightmap.attachConstant([.9,.9,.9]),a.iAlbedoAtt.attachConstant([.3]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"../entities/flag/material":204}],218:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.texs.get("gradient")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iLightmap.attachConstant([.9,.9,.9]),a.iAlbedoAtt.attachConstant([.3]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],219:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.texs.get("green")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iLightmap.attachConstant([.9,.9,.9]),a.iAlbedoAtt.attachConstant([.3]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],220:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("../entities/sponge/material");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/marbre")),a.iGloss.attachConstant(.6),a.iSpecular.attachConstant([.35,.35,.35]),a.iAlbedoAtt.attachConstant([.2]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Shapes")),a.perVertexIrrad.set(!0),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"../entities/sponge/material":211}],221:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/marbre")),a.iGloss.attachConstant(.6),a.iSpecular.attachConstant([.35,.35,.35]),a.iAlbedoAtt.attachConstant([.2]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Shapes")),a.perVertexIrrad.set(!0),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],222:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.texs.get("pink-marble")),a.iGloss.attachConstant(.6),a.iSpecular.attachConstant([.35,.35,.35]),a.iAlbedoAtt.attachConstant([.2]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Shapes")),a.perVertexIrrad.set(!0),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],223:[function(a,b,c){function d(a,b){return this.scene=a,this.gl=b,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/logo")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iLightmap.attachConstant([.9,.9,.9]),a.iAlbedoAtt.attachConstant([.3]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],224:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("../entities/carpet/material");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/wood")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iAlbedoAtt.attachConstant([.3]),a.perVertexIrrad.set(!0),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"../entities/carpet/material":198}],225:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/wood")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iAlbedoAtt.attachConstant([.3]),a.perVertexIrrad.set(!0),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],226:[function(a,b,c){"use strict";function d(a){this.section=a,this.world=new e.World,this.world.gravity.copy(g),this.world.broadphase=new e.NaiveBroadphase,this.world.solver.iterations=h,this.world.quatNormalizeSkip=0,this.world.quatNormalizeFast=!1,this.world.defaultContactMaterial.contactEquationStiffness=1e9,this.world.defaultContactMaterial.contactEquationRelaxation=4,this.ground=new e.Body({mass:0,position:new e.Vec3(0,0,0),shape:new e.Plane,collisionFilterGroup:f.FLOOR,collisionFilterMask:f.BALL,material:new e.Material}),this.ground.quaternion.setFromEuler(-Math.PI/2,0,0,"XYZ"),this.world.addBody(this.ground),this.section.contact.getContact("Ball-Floor").setEntity(this.ground),this.underground=new e.Body({mass:0,position:new e.Vec3(0,-.45,0),shape:new e.Plane,collisionFilterGroup:f.UNDERGROUND,collisionFilterMask:f.BALL,material:new e.Material}),this.underground.quaternion.setFromEuler(-Math.PI/2,0,0,"XYZ"),this.world.addBody(this.underground),this.section.contact.getContact("Ball-Underground").setEntity(this.underground)}var e=a("cannon"),f=a("./constants/collision-group"),g=new e.Vec3(0,-5.82,0),h=50;d.prototype={constructor:d,preRender:function(){this.world.step(1/60,this.section.scene.dt,50)}},b.exports=d},{"./constants/collision-group":180,cannon:296}],227:[function(a,b,c){"use strict";function d(a){this.section=a,this._onLoaded=this._onLoaded.bind(this),this.node=new i,a.awd.node.add(this.node)}var e=(a("../../eight/spline"),a("config")),f=a("lib/net"),g=a("../../eight/utils"),h=a("lib/picking"),i=a("nanogl-node"),j=a("cursor"),k=a("gl-matrix"),l=k.mat4,m=k.vec3,n=m.create(),o=l.create(),p=l.create(),q=m.create(),r=m.create(),s={pos:[0,0,0],dir:[0,0,0]};d.prototype={getLoadable:function(){var a=e.asset_url("two/cylinder.bin");return f.loadBytes(a).then(this._onLoaded)},_onLoaded:function(a){var b=g.parseBin(a);this.picking=new h({verts:b.vertices,faces:b.indices})},preRender:function(){var a=this.section.scene.getMouseRay();l.invert(o,this.node._wmatrix),l.invert(p,this.node._wmatrix),p[12]=p[13]=p[14]=0,m.transformMat4(r,a.pos,o),m.transformMat4(q,a.dir,p),m.normalize(q,q),s.pos=r,s.dir=q,this.hover=-1===this.picking.run(s,n),this.hover?j.enableHover():j.disableHover()}},b.exports=d},{"../../eight/spline":158,"../../eight/utils":163,config:18,cursor:19,"gl-matrix":352,"lib/net":110,"lib/picking":111,"nanogl-node":368}],228:[function(a,b,c){"use strict";var d=a("cannon"),e=new d.Vec3,f=new d.Quaternion,g=new d.Quaternion,h={Vec3:function(a,b,c){return new d.Vec3(a,b,c)},Quat:function(a,b,c,e){return new d.Quaternion(a,b,c,e)},BoxShape:function(a,b,c){return new d.Box(new d.Vec3(a,b,c))},SphereSphere:function(a){return new d.Sphere(a)},CylinderShape:function(a,b,c,e){return new d.Cylinder(a,b,c,e)},PlaneShape:function(){return new d.Plane},TrimeshShape:function(a,b){if(!b){b=[];for(var c=0;c<a.length/3-3;c+=2)b.push(c+0,c+1,c+2),b.push(c+2,c+1,c+3)}return new d.Trimesh(a,b)},QuatFromAxisAngle:function(a,b,c,d){return h.setRotation(h.Quat(),a,b,c,d)},setRotation:function(a,b,c,d,f){return e.set(c,d,f),a.setFromAxisAngle(e,b),a},appendRotation:function(a,b,c,d,h){return f.copy(a),e.set(c,d,h),g.setFromAxisAngle(e,b),f.mult(g,a),a},addCollisionMask:function(a,b){a.collisionFilterMask=a.collisionFilterMask|b},removeCollisionMask:function(a,b){a.collisionFilterMask=a.collisionFilterMask&~b}};b.exports=h},{cannon:296}],229:[function(a,b,c){"use strict";function d(){var a=Array.prototype.slice.apply(arguments),b=a.shift();a.forEach(function(a){b[a]=b[a].bind(b)})}function e(){var a=Array.prototype.slice.apply(arguments),b=a.shift();a.forEach(function(a){var c=b[a];b[a]=function(){return c.apply(b,arguments)}})}b.exports={bind:d,scope:e}},{}],230:[function(a,b,c){"use strict";b.exports={function:a("./function"),oimo:a("./oimo"),cannon:a("./cannon"),math:a("./math")}},{"./cannon":228,"./function":229,"./math":231,"./oimo":232}],231:[function(a,b,c){"use strict";var d={clamp:function(a,b,c){return Math.max(b,Math.min(a,c))}};b.exports=d},{}],232:[function(a,b,c){"use strict";var d=window.OIMO,e={createBoxRigidBody:function(a,b){b=e.defaultOptions(b);var c=new d.RigidBody(e.createRigidBodyConfig(b.rigidBodyConfig));return c.addShape(e.createBoxShape(a,b)),c},createCylinderRigidBody:function(a,b,c){c=e.defaultOptions(c);var f=new d.RigidBody(e.createRigidBodyConfig(c.rigidBodyConfig));return f.addShape(e.createCylinderShape(a,b,c)),f},createSphereRigidBody:function(a,b){b=e.defaultOptions(b);var c=new d.RigidBody(e.createRigidBodyConfig(b.rigidBodyConfig));return c.addShape(e.createSphereShape(a,b)),c},createBoxShape:function(a,b){b=e.defaultOptions(b);var c=e.createShapeConfig(b.shapeConfig);c.geometry=new d.BoxGeometry(a);var f=new d.Shape(c);return e.offset(f,b.offset),f},createSphereShape:function(a,b){b=e.defaultOptions(b);var c=e.createShapeConfig(b.shapeConfig);c.geometry=new d.SphereGeometry(a);var f=new d.Shape(c);return e.offset(f,b.offset),f},createCylinderShape:function(a,b,c){c=e.defaultOptions(c);var f=e.createShapeConfig(c.shapeConfig);f.geometry=new d.CylinderGeometry(a,b);var g=new d.Shape(f);return e.offset(g,c.offset),g},defaultOptions:function(a){return Object.assign({offset:{},shapeConfig:{},rigidBodyConfig:{}},a||{})},createRigidBodyConfig:function(a){var b=new d.RigidBodyConfig;return a.hasOwnProperty("position")&&(b.position=a.position),a.hasOwnProperty("rotation")&&(b.rotation=a.rotation),a.hasOwnProperty("linearVelocity")&&(b.linearVelocity=a.linearVelocity),a.hasOwnProperty("angularVelocity")&&(b.angularVelocity=a.angularVelocity),a.hasOwnProperty("type")&&(b.type=a.type),a.hasOwnProperty("autoSleep")&&(b.autoSleep=a.autoSleep),a.hasOwnProperty("linearDamping")&&(b.linearDamping=a.linearDamping),a.hasOwnProperty("angularDamping")&&(b.angularDamping=a.angularDamping),b},createShapeConfig:function(a){var b=new d.ShapeConfig;return a.hasOwnProperty("position")&&(b.position=a.position),a.hasOwnProperty("rotation")&&(b.rotation=a.rotation),a.hasOwnProperty("friction")&&(b.friction=a.friction),a.hasOwnProperty("restitution")&&(b.restitution=a.restitution),a.hasOwnProperty("density")&&(b.density=a.density),a.hasOwnProperty("geometry")&&(b.geometry=a.geometry),a.hasOwnProperty("collisionGroup")&&(b.collisionGroup=a.collisionGroup),a.hasOwnProperty("collisionMask")&&(b.collisionMask=a.collisionMask),a.hasOwnProperty("contactCallback")&&(b.contactCallback=a.contactCallback),b},offset:function(a,b){b.position&&e.offsetPosition(a,b.position),b.orientation&&e.offsetOrientation(a,b.orientation)},offsetPosition:function(a,b){var c=a.getLocalTransform(),d=c.getPosition();d.x+=b.x,d.y+=b.y,d.z+=b.z,c.setPosition(d),a.setLocalTransform(c)},offsetOrientation:function(a,b){var c=a.getLocalTransform();c.setOrientation(b),a.setLocalTransform(c)}};b.exports=e},{}],233:[function(a,b,c){function d(a){this.scene=a,this.actives=[],this.time=0,this.needUpdate=[],this.playAnim=this._playAnim.bind(this),this.stopAnim=this._stopAnim.bind(this),e.events.on("playanim",this.playAnim),e.events.on("stopanim",this.stopAnim)}var e=a("sound/sequencer2"),f=a("gl-matrix/src/gl-matrix/quat");TweenMax=a("gsap/TweenMax");var g={A1:["ShapeA_1"],A2:["ShapeA_2"],B1:["ShapeB_1"],B2:["ShapeB_2"],C1:["ShapeC_1_001","ShapeC_1_002","ShapeC_1_003","ShapeC_1_004"],C2:["ShapeC_2_001","ShapeC_2_002","ShapeC_2_003"],D1:["ShapeD_1"],D2:["ShapeD_2"]},h={},i={};d.prototype={onLoaded:function(){for(var a in g)if(g.hasOwnProperty(a))for(var b=(g[a],0);b<g[a].length;b++){var c=g[a][b],d=this.scene.awd.loader.getObjectByName(c);h[c]=[new Float32Array(d.position),new Float32Array(d.scale),new Float32Array(d.rotation)],i[c]=d}},update:function(){for(var a=0;a<this.needUpdate.length;a++)this.needUpdate[a]()},_playAnim:function(a){"ONE"!==a&&"HUIT"!==a&&this["play_anim_"+a]()},play_anim_A1:function(){function a(){f.create();i.ShapeA_1.invalidate(),i.ShapeA_1.scale[0]=1+.02*Math.sin(b.value),i.ShapeA_1.scale[1]=1+.03*Math.sin(b.value),i.ShapeA_1.scale[2]=1+.02*Math.sin(b.value)}a.bind(this);var b={value:0};TweenMax.to(b,2,{value:4*Math.PI,ease:Elastic.easeOut.config(1,.4),onUpdate:a})},play_anim_A2:function(){function a(){i.ShapeA_2.invalidate(),i.ShapeA_2.scale[0]=1+.02*Math.sin(b.value),i.ShapeA_2.scale[2]=1+.02*Math.sin(b.value)}a.bind(this);var b={value:0};TweenMax.to(b,2,{value:2*Math.PI,ease:Elastic.easeOut.config(1,.4),onUpdate:a})},play_anim_B1:function(){this.scene.awd.loader.getObjectByName(g.B1).materials[0].animated=!0},play_anim_B2:function(){this.scene.awd.loader.getObjectByName(g.B2).materials[0].animated=!0},play_anim_C1:function(){function a(){i.ShapeC_1_001.setScale(1-.1*Math.sin(e.value))}function b(){i.ShapeC_1_002.setScale(f.value)}function c(){i.ShapeC_1_003.setScale(1-.1*Math.sin(g.value))}function d(){i.ShapeC_1_004.setScale(h.value)}var e={value:0},f=(TweenMax.to(e,1,{value:4*Math.PI*2,ease:Power1.easeOut,onUpdate:a,delay:0}),{value:.8}),g=(TweenMax.to(f,1.7,{value:1,ease:Elastic.easeOut.config(1,.45),onUpdate:b,delay:.3}),{value:.2}),h=(TweenMax.to(g,1.1,{value:4*Math.PI*2,ease:Power1.easeOut,onUpdate:c,delay:.2}),{value:.8});TweenMax.to(h,1.7,{value:1,ease:Elastic.easeOut.config(1,.45),onUpdate:d,delay:.6})},play_anim_C2:function(){function a(){var a=f.create();f.rotateY(a,a,d.value+Math.PI),i.ShapeC_2_001.invalidate(),i.ShapeC_2_001.rotation=a}function b(){var a=f.create();f.rotateY(a,a,e.value+Math.PI-.1),i.ShapeC_2_002.invalidate(),i.ShapeC_2_002.rotation=a}function c(){var a=f.create();f.rotateY(a,a,g.value+Math.PI-.3),i.ShapeC_2_003.invalidate(),i.ShapeC_2_003.rotation=a}a.bind(this);var d={value:0};TweenMax.to(d,2,{value:1*Math.PI,ease:Elastic.easeOut.config(1,.5),onUpdate:a});b.bind(this);var e={value:0};TweenMax.to(e,2,{value:1*Math.PI,ease:Elastic.easeOut.config(1,.5),onUpdate:b,delay:.1});c.bind(this);var g={value:0};TweenMax.to(g,2,{value:1*Math.PI,ease:Elastic.easeOut.config(1,.5),onUpdate:c,delay:.2})},play_anim_D1:function(){function a(){i.ShapeD_1.invalidate(),i.ShapeD_1.scale[1]=1-.08*Math.sin(b.value)}var b={value:0};TweenMax.to(b,1.2,{value:2*Math.PI*2,ease:Power2.easeOut,onUpdate:a,delay:0})},play_anim_D2:function(){function a(){i.ShapeD_2.invalidate(),i.ShapeD_2.scale[1]=1-.08*Math.sin(b.value)}var b={value:0};TweenMax.to(b,2,{value:3*Math.PI*2,ease:Power3.easeOut,onUpdate:a,delay:0})},_stopAnim:function(a){"ONE"!==a&&"HUIT"!==a&&this["stop_anim_"+a]()},stop_anim_A1:function(){},stop_anim_A2:function(){},stop_anim_B1:function(){this.scene.awd.loader.getObjectByName(g.B1).materials[0].animated=!1},stop_anim_B2:function(){this.scene.awd.loader.getObjectByName(g.B2).materials[0].animated=!1},stop_anim_C1:function(){},stop_anim_C2:function(){},stop_anim_D1:function(){},stop_anim_D2:function(){}},b.exports=d},{"gl-matrix/src/gl-matrix/quat":358,"gsap/TweenMax":362,"sound/sequencer2":261}],234:[function(a,b,c){function d(a,b){this.ctx=a,this.doors=b,this.init()}var e=0,f=1e-5,g=!1;d.prototype={init:function(){this.doors[0].direction=-1,this.doors[1].direction=1},open:function(){e=1,g=!1},update:function(){if(!g){0===f&&(g=!0);var a=e-f;a*=.1,f+=a,e=Math.max(e-8*this.ctx.scene.dt,0),f=Math.max(f,0);for(var b=0;b<this.doors.length;b++)this.doors[b].z=this.doors[b].direction*f*.43}}},b.exports=d},{}],235:[function(a,b,c){function d(a,b){this.anim=a,this.length=a.length/3,this.parent=b,this.proxy=b.ballMesh.proxy(),this.currentFrame=0}d.prototype={update:function(a){var b=Math.round(a/(1/60));this.currentFrame<this.length-1?(this.currentFrame+=b,this.proxy.x=.03*this.anim[3*this.currentFrame+0],this.proxy.y=.03*this.anim[3*this.currentFrame+1],this.proxy.z=.03*this.anim[3*this.currentFrame+2]):this.parent.killAnim(this)},getFinalPos:function(){return this.proxy.position}},b.exports=d},{}],236:[function(a,b,c){function d(a){this.scene=a,this.anims=null,this.activesAnims=[],this.bind(),e=this}var e,f=a("./utils/animLoader"),g=a("./utils/animRefractor"),h=a("./ballAnim"),i=a("event-emitter"),j=(a("dev/gui"),{});i(j),d.prototype={bind:function(){this.onLoadedAnims=this._onLoadedAnims.bind(this),this.onLoaded=this._onLoaded.bind(this),this.launchBall=this._launchBall.bind(this),this.killAnim=this._killAnim.bind(this),this.update=this._update.bind(this),this.on=j.on.bind(j)},init:function(){this.ballMesh=this.scene.awd.loader.getObjectByName("Ball"),this.ballMesh.proxiesOnly=!0},_launchBall:function(a){if(this.scene.active){var b=Math.floor(3*Math.random()),c=this.anims[a][b],d=16*this.anims[a+"-offset"][b]-45;this.activesAnims.push(new h(c,e)),setTimeout(function(){e.scene.doors.open()},d)}},_onLoadedAnims:function(a){this.anims=new g(a)},_onLoaded:function(a){this.init()},_killAnim:function(a){var b=this.activesAnims.indexOf(a);this.ballMesh.removeProxy(a.proxy),this.activesAnims.splice(b,1),j.emit("ballexploded",a.getFinalPos())},getLoadable:function(){return this.animLoader=new f,this.animLoader.getPromise().then(this.onLoadedAnims)},_update:function(a){for(var b=0;b<this.activesAnims.length;b++)this.activesAnims[b].update(a)}},b.exports=d},{"./ballAnim":235,"./utils/animLoader":253,"./utils/animRefractor":254,"dev/gui":20,"event-emitter":351}],237:[function(a,b,c){function d(a){var b=a.scene;this.scene=b,this.hasLeft=!1,this.active=!1,f=this,this.awd=new g(b),this.ballsControler=new i(this),this.picking=new k(this),this.pendingAnim=new n(this),this.activeAnim=new o(this),m.setBallController(this.ballsControler),this.onLoaded=this._onLoaded.bind(this),this.onPicked=this._onPicked.bind(this),this.onHover=this._onHover.bind(this),this.disableHover=this._disableHover.bind(this),this.onBallExploded=this._onBallExploded.bind(this),this.ballsControler.on("ballexploded",this.onBallExploded),this.awd.node.rotateY(3*-Math.PI/4),this.awd.node.z=.55,this.awd.node.setScale(1.15),a.node.add(this.awd.node),this.confeti=null}function e(a){return new d(a)}var f,g=(a("nanogl/program"),a("nanogl-node"),a("./scene")),h=a("./animatedDoors"),i=a("./ballsControler"),j=(a("dev/gui"),a("config"),
a("when")),k=a("./pickingControler"),l=a("sound/player"),m=a("sound/sequencer2"),n=a("./pendingAnim"),o=a("./activeAnims"),p=a("cursor"),q=a("gsap/TweenMax"),r={doors:[]};d.prototype={_onLoaded:function(){for(var a=0;a<this.awd.meshes.length;a++){var b=this.awd.meshes[a];/Door/.test(b.name)&&r.doors.push(b)}this.doors=new h(this,r.doors),this.confeti=this.scene.confeti.createFactory(this.awd.node,{count:10}),this.ballsControler.onLoaded(),this.picking.onLoaded(),this.pendingAnim.onLoaded(),this.activeAnim.onLoaded(),this.awd.loader.getObjectByName("ShapeB_2").rotateY(-.4)},_onPicked:function(a){["A.1","A.2","B.1","B.2","C.1","C.2","D.1","D.2"].indexOf(a)>-1&&m.toggleBall(a.split(".").join(""))},_onHover:function(){p.enableHover()},_disableHover:function(){p.disableHover()},_onBallExploded:function(a){this.confeti.create(a)},setPosition:function(a){a<-1e-5&&(this.hasLeft||(this.hasLeft=!0,this.onLeaving()))},onLeaving:function(){l.play("transition",!1,.9),ga("send","event","wishes-1"),m.sequencer.addSound("ONE",!0)},getLoadables:function(){var a=this.awd.getLoadables(),b=this.ballsControler.getLoadable(),c=this.picking.getLoadable();return a.push(b),a.push(c),j.all(a).then(this.onLoaded),a},start:function(){function a(){window.removeEventListener("click",a),p.canvas.transitionOutTuto()}this.active=!0,setTimeout(function(){f.active&&(f.scene.volume=.4,f.ballsControler.launchBall("C.1"))},1e3),setTimeout(function(){f.active&&l.play("intro_zero")},2500),this.picking.on("picked",this.onPicked),this.picking.on("hover",this.onHover),this.picking.on("disablehover",this.disableHover),q.delayedCall(2,function(){window.addEventListener("click",a),p.canvas.transitionInTuto("CLICK")})},stop:function(){this.active=!1,m.sequencer.removeSound("C1"),m.sequencer.removeSound("C2"),this.picking.off("picked",this.onPicked),this.picking.off("hover",this.onHover),this.picking.off("disablehover",this.disableHover)},preRender:function(){this.doors.update(),this.ballsControler.update(this.scene.dt),this.pendingAnim.update(),this.activeAnim.update()},rttPass:function(){},render:function(){this.awd.render(4),this.awd.render(1)},renderShadowPass:function(a){this.awd.renderDepth(a.cam,1,a.defaultpass)},postRender:function(){},getCameraPosition:function(a,b){}},b.exports=e},{"./activeAnims":233,"./animatedDoors":234,"./ballsControler":236,"./pendingAnim":250,"./pickingControler":251,"./scene":252,config:18,cursor:19,"dev/gui":20,"gsap/TweenMax":362,"nanogl-node":368,"nanogl/program":419,"sound/player":260,"sound/sequencer2":261,when:445}],238:[function(a,b,c){arguments[4][215][0].apply(c,arguments)},{dup:215,"gl/standard-gi":38}],239:[function(a,b,c){function d(b,c){this.ibl=null,this.prg=null,this.mat=c,this.inputs=new h,this.depthFormat=new g("depthFormat",["D_RGB","D_DEPTH"]),this.inputs.add(this.depthFormat),this.config=new e,this._prgcache=f.getCache(b),this._uid="confetidepth",this._precision="highp",this._vertSrc=a("glsl/zero/B1-Depth.vert")(),this._fragSrc=a("nanogl-pbr/glsl/depthpass.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=(a("nanogl-pbr/lib/input"),a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/enum")),h=a("nanogl-pbr/lib/chunks-tree"),i=a("gl-matrix").mat4.create();d.prototype={setLightSetup:function(a){this.inputs.remove(this.depthFormat),this.depthFormat=a.depthFormat.createProxy(),this.inputs.add(this.depthFormat)},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),b.modelViewProjectionMatrix(i,a._wmatrix),this.prg.uMVP(i),c.setupInputs(this),c.uTime(this.mat.time)},_isDirty:function(){return null===this.prg||this.inputs._isDirty},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":352,"glsl/zero/B1-Depth.vert":89,"nanogl-pbr/glsl/depthpass.frag":370,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],240:[function(a,b,c){function d(b,c){this.ibl=null,this.prg=null,this.scene=c,this.time=0,this.animated=!1,this.animationSpeed=0,this.depthPass=new l(b,this),this._mask=1,this.inputs=new k,this.iLightmap=this.inputs.add(new h("lightmap",3)),this.iAlbedoAtt=this.inputs.add(new h("albedoAttenuation",1)),this.iUVOffset=this.inputs.add(new h("uvOffset",2,h.VERTEX)),this.iUVScale=this.inputs.add(new h("uvScale",2,h.VERTEX)),this.iAlbedo=this.inputs.add(new h("albedo",3)),this.iSpecular=this.inputs.add(new h("specular",3)),this.iGloss=this.inputs.add(new h("gloss",1)),this.iNormal=this.inputs.add(new h("normal",3)),this.iOcclusion=this.inputs.add(new h("occlusion",1)),this.iCavity=this.inputs.add(new h("cavity",1)),this.iCavityStrength=this.inputs.add(new h("cavityStrength",2)),this.iEmissive=this.inputs.add(new h("emissive",1)),this.iEmissiveScale=this.inputs.add(new h("emissiveScale",1)),this.iFresnel=this.inputs.add(new h("fresnel",3)),this.conserveEnergy=this.inputs.add(new i("receiveShadows",!0)),this.conserveEnergy=this.inputs.add(new i("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new i("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new i("glossNearest",!1)),this.gammaMode=new j("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new h("gamma",1)),this.iExposure=this.inputs.add(new h("exposure",1)),this.config=new f,this._prgcache=g.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="b1-std",this._precision="highp",this._vertSrc=a("glsl/zero/B1.vert")(),this._fragSrc=a("glsl/zero/B_.frag")()}function e(a,b){return this.scene=a,this.gl=b,this.init()}var f=(a("nanogl/program"),a("nanogl-state/config")),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=a("nanogl-pbr/lib/flag"),j=a("nanogl-pbr/lib/enum"),k=a("nanogl-pbr/lib/chunks-tree"),l=a("./b1-depth"),m=a("gl-matrix").mat4.create();d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("stdgi"))},prepare:function(a,b){this._isDirty()&&this.compile(),this.animated?this.animationSpeed+=.03:this.animationSpeed-=.02,this.time+=this.scene.dt*this.animationSpeed,this.animationSpeed=Math.min(Math.max(this.animationSpeed,0),1);var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(m,a._wmatrix),c.uMVP(m),c.uWorldMatrix(a._wmatrix),c.uTime(this.time),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},e.prototype={init:function(){var a=new d(this.gl,this.scene);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/logo")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iLightmap.attachConstant([.9,.9,.9]),a.iAlbedoAtt.attachConstant([.3]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=e},{"./b1-depth":239,"gl-matrix":352,"glsl/zero/B1.vert":90,"glsl/zero/B_.frag":93,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],241:[function(a,b,c){function d(b,c){this.ibl=null,this.prg=null,this.mat=c,this.inputs=new h,this.depthFormat=new g("depthFormat",["D_RGB","D_DEPTH"]),this.inputs.add(this.depthFormat),this.config=new e,this._prgcache=f.getCache(b),this._uid="confetidepth",this._precision="highp",this._vertSrc=a("glsl/zero/B2-Depth.vert")(),this._fragSrc=a("nanogl-pbr/glsl/depthpass.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("nanogl-pbr/lib/program-cache"),g=(a("nanogl-pbr/lib/input"),a("nanogl-pbr/lib/flag"),a("nanogl-pbr/lib/enum")),h=a("nanogl-pbr/lib/chunks-tree"),i=a("gl-matrix").mat4.create();d.prototype={setLightSetup:function(a){this.inputs.remove(this.depthFormat),this.depthFormat=a.depthFormat.createProxy(),this.inputs.add(this.depthFormat)},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),b.modelViewProjectionMatrix(i,a._wmatrix),this.prg.uMVP(i),c.setupInputs(this),c.uTime(this.mat.time)},_isDirty:function(){return null===this.prg||this.inputs._isDirty},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"gl-matrix":352,"glsl/zero/B2-Depth.vert":91,"nanogl-pbr/glsl/depthpass.frag":370,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],242:[function(a,b,c){function d(b,c){this.ibl=null,this.prg=null,this.scene=c,this.time=0,this.animated=!1,this.animationSpeed=0,this.depthPass=new l(b,this),this._mask=1,this.inputs=new k,this.iLightmap=this.inputs.add(new h("lightmap",3)),this.iAlbedoAtt=this.inputs.add(new h("albedoAttenuation",1)),this.iUVOffset=this.inputs.add(new h("uvOffset",2,h.VERTEX)),this.iUVScale=this.inputs.add(new h("uvScale",2,h.VERTEX)),this.iAlbedo=this.inputs.add(new h("albedo",3)),this.iSpecular=this.inputs.add(new h("specular",3)),this.iGloss=this.inputs.add(new h("gloss",1)),this.iNormal=this.inputs.add(new h("normal",3)),this.iOcclusion=this.inputs.add(new h("occlusion",1)),this.iCavity=this.inputs.add(new h("cavity",1)),this.iCavityStrength=this.inputs.add(new h("cavityStrength",2)),this.iEmissive=this.inputs.add(new h("emissive",1)),this.iEmissiveScale=this.inputs.add(new h("emissiveScale",1)),this.iFresnel=this.inputs.add(new h("fresnel",3)),this.conserveEnergy=this.inputs.add(new i("receiveShadows",!0)),this.conserveEnergy=this.inputs.add(new i("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new i("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new i("glossNearest",!1)),this.gammaMode=new j("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new h("gamma",1)),this.iExposure=this.inputs.add(new h("exposure",1)),this.config=new f,this._prgcache=g.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="b2-std",this._precision="highp",this._vertSrc=a("glsl/zero/B2.vert")(),this._fragSrc=a("glsl/zero/B_.frag")()}function e(a,b){return this.scene=a,this.gl=b,this.init()}var f=(a("nanogl/program"),a("nanogl-state/config")),g=a("nanogl-pbr/lib/program-cache"),h=a("nanogl-pbr/lib/input"),i=a("nanogl-pbr/lib/flag"),j=a("nanogl-pbr/lib/enum"),k=a("nanogl-pbr/lib/chunks-tree"),l=a("./b2-depth"),m=a("gl-matrix").mat4.create();d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks("stdgi"))},prepare:function(a,b){this._isDirty()&&this.compile(),this.animated?this.animationSpeed+=.03:this.animationSpeed-=.02,this.time+=this.scene.dt*this.animationSpeed,this.animationSpeed=Math.min(Math.max(this.animationSpeed,0),1);var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(m,a._wmatrix),c.uMVP(m),c.uWorldMatrix(a._wmatrix),c.uTime(this.time),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},e.prototype={init:function(){var a=new d(this.gl,this.scene);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/logo")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iLightmap.attachConstant([.9,.9,.9]),a.iAlbedoAtt.attachConstant([.3]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=e},{"./b2-depth":241,"gl-matrix":352,"glsl/zero/B2.vert":92,"glsl/zero/B_.frag":93,"nanogl-pbr/lib/chunks-tree":390,"nanogl-pbr/lib/enum":391,"nanogl-pbr/lib/flag":392,"nanogl-pbr/lib/input":393,"nanogl-pbr/lib/program-cache":398,"nanogl-state/config":409,"nanogl/program":419}],243:[function(a,b,c){arguments[4][144][0].apply(c,arguments)},{dup:144,"nanogl-pbr/standard":403}],244:[function(a,b,c){function d(a,b){return this.scene=a,this.gl=b,this.init()}var e=a("nanogl-pbr/standard");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([.6,.6,.6]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([.35,.35,.35]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"nanogl-pbr/standard":403}],245:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/marbre")),a.iGloss.attachConstant(.6),a.iSpecular.attachConstant([.35,.35,.35]),a.iAlbedoAtt.attachConstant([.2]),a.iLightmap.attachConstant([.9,.9,.9]),a.perVertexIrrad.set(!0),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],246:[function(a,b,c){function d(a,b){return this.scene=a,this.gl=b,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/logo")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iLightmap.attachConstant([.9,.9,.9]),a.iAlbedoAtt.attachConstant([.3]),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],247:[function(a,b,c){arguments[4][221][0].apply(c,arguments)},{dup:221,"gl/standard-gi":38}],248:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/dirty_metal")),a.iGloss.attachConstant(.6),a.iSpecular.attachConstant([.35,.35,.35]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Shapes")),a.perVertexIrrad.set(!0),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],249:[function(a,b,c){function d(a,b,c){return this.scene=a,this.gl=b,this.texs=c,this.init()}var e=a("gl/standard-gi");d.prototype={init:function(){var a=new e(this.gl);return a._precision="highp",a.setLightSetup(this.scene.lights.setup),a.albedo=a.iAlbedo.attachSampler("tAlbedo","vTexCoord"),a.albedo.set(this.scene.texlib.get("common/wood")),a.iGloss.attachConstant(.1),a.iSpecular.attachConstant([.25,.25,.25]),a.iAlbedoAtt.attachConstant([.3]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Shapes")),a.perVertexIrrad.set(!0),a._mask=1,a.conserveEnergy.set(!1),this.scene.env.setupMat(a),a}},b.exports=d},{"gl/standard-gi":38}],250:[function(a,b,c){function d(a){this.scene=a,this.pendings=e.pendingAnims,this.time=0,this.stopAnim=this._stopAnim.bind(this),e.events.on("unregisterpending",this.stopAnim)}var e=a("sound/sequencer2"),f=a("gsap/TweenMax"),g={A1:["ShapeA_1"],A2:["ShapeA_2"],B1:["ShapeB_1"],B2:["ShapeB_2"],C1:["ShapeC_1_001","ShapeC_1_002","ShapeC_1_003","ShapeC_1_004"],C2:["ShapeC_2_001","ShapeC_2_002","ShapeC_2_003"],D1:["ShapeD_1"],D2:["ShapeD_2"]},h={};d.prototype={onLoaded:function(){for(var a in g)if(g.hasOwnProperty(a))for(var b=(g[a],0);b<g[a].length;b++){var c=g[a][b],d=this.scene.awd.loader.getObjectByName(c);h[c]=[d.x,d.y,d.z,Math.sign(2*(Math.random()-.5)),Math.random()*Math.PI*2]}},update:function(){this.time=this.scene.scene.time;for(var a=0;a<this.pendings.length;a++)if(void 0!=g[this.pendings[a]])for(var b=0;b<g[this.pendings[a]].length;b++){var c=g[this.pendings[a]][b],d=this.scene.awd.loader.getObjectByName(c);d.y=h[c][1]-.015*Math.cos(10*this.time*h[c][3]+h[c][4])}},_stopAnim:function(a){for(var b=0;b<g[a].length;b++){var c=g[a][b],d=this.scene.awd.loader.getObjectByName(c);f.to(d,.5,{y:h[c][1],ease:Power1.easeOut})}}},b.exports=d},{"gsap/TweenMax":362,"sound/sequencer2":261}],251:[function(a,b,c){function d(a){this.scene=a,e=this,this.cBoxes=[],this.pickingMeshes,this.bind(),h.on("down",this.onMouseDown),h.on("move",this.onMouseMove)}var e,f=a("./utils/collisionMesh"),g=a("config"),h=(a("when"),a("lib/mouse")),i=a("event-emitter"),j=a("../common/utils/binaryMeshLoader"),k=[],l={};i(l),d.prototype={bind:function(){this.onLoaded=this._onLoaded.bind(this),this.onMouseDown=this._onMouseDown.bind(this),this.onMouseMove=this._onMouseMove.bind(this),this.searchPickedTarget=this._searchPickedTarget.bind(this),this.on=l.on.bind(l),this.off=l.off.bind(l)},getLoadable:function(){return new j(g.asset_url("zero/picking.json"),g.asset_url("zero/picking.bin")).then(function(a){e.pickingMeshes=a})},_onMouseDown:function(){this.searchPickedTarget(!1)},_onMouseMove:function(){this.searchPickedTarget(!0)},_searchPickedTarget:function(a){k.length=0;for(var b,c=1e3,d=0;d<this.cBoxes.length;d++)this.cBoxes[d].testPicking(),0!==this.cBoxes[d].isOvered&&k.push({target:this.cBoxes[d].target,pos:this.cBoxes[d].getPos()});if(a)k.length>0?l.emit("hover",b):l.emit("disablehover",b);else{for(var d=0;d<k.length;d++)k[d].pos[2]<c&&(b=k[d].target,c=k[d].pos[2]);void 0!=b&&l.emit("picked",b)}},_onLoaded:function(){for(var a=0;a<this.pickingMeshes.length;a++){var b=new f(this.scene.scene,this.pickingMeshes[a]);this.cBoxes.push(b),this.scene.awd.node.add(b.node)}}},b.exports=d},{"../common/utils/binaryMeshLoader":128,"./utils/collisionMesh":255,config:18,"event-emitter":351,"lib/mouse":109,when:445}],252:[function(a,b,c){function d(a){e.call(this,a,s),this.setupTextures(),this.setupMaterials()}var e=(a("when"),a("assets/awd-scene")),f=(a("lib/net"),a("lib/color")),g=(a("lib/awd"),a("dev/gui"),a("config"),a("gl/unlit-material"),a("gl/shadow-catcher-material"),a("nanogl-pbr/standard")),h=a("gl/standard-gi"),i=(a("nanogl-pbr/lib/input"),a("./materials/default")),j=a("./materials/rails"),k=a("./materials/marbre"),l=a("./materials/aquarelle"),m=a("./materials/wood"),n=a("./materials/gradient"),o=a("./materials/door"),p=a("./materials/b1"),q=a("./materials/b2"),r=a("./materials/ball"),s="zero";d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.getAssetPath=function(a){return s+"/"+a},d.prototype.texPath=function(a){return[this.getAssetPath(a+"_L0.jpg"),this.getAssetPath(a+"_L1.jpg")]},d.prototype.getAwdUrl=function(){return s+"/scene.awd"},d.prototype.setupTextures=function(){this.texs.makeTex("GI-Ground",this.getAssetPath("GI-Ground.jpg")).setFilter(!0,!1,!1),this.texs.makeTex("GI-Shapes",this.getAssetPath("GI-Shapes.jpg")).setFilter(!0,!1,!1)},d.prototype.setupMaterials=function(){var a,b=this.mats,c=b.lib,d=this.scene.gl;a=new i(this.scene,d,this.texs),c.setOpaque(a),b.registerMaterial(a,"default"),a=new j(this.scene,d,this.texs),c.setOpaque(a),b.registerMaterial(a,"rails"),a=new k(this.scene,d,this.texs),c.setOpaque(a),b.registerMaterial(a,"marbre"),a=new o(this.scene,d,this.texs),c.setOpaque(a),b.registerMaterial(a,"door"),a=new l(this.scene,d,this.texs),c.setOpaque(a),b.registerMaterial(a,"aquarelle"),a=new m(this.scene,d,this.texs),c.setOpaque(a),b.registerMaterial(a,"wood"),a=new n(this.scene,d),c.setOpaque(a),b.registerMaterial(a,"gradient"),a=new p(this.scene,d),c.setOpaque(a),b.registerMaterial(a,"b1"),a=new q(this.scene,d),c.setOpaque(a),b.registerMaterial(a,"b2");var a=new g(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([.7,.7,.7]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([.2,.2,.2]),a.conserveEnergy.set(!1),a.config.enableCullface(!1),a.perVertexIrrad.set(!0),c.setOpaque(a),a._mask=1,b.registerMaterial(a,"darkHole");var a=new r(this.scene,d,this.texs);c.setOpaque(a),b.registerMaterial(a,"ball");var a=new h(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([1,1,1]),a.iAlbedoAtt.attachConstant([.4]),a.iGloss.attachConstant(.05),a.iSpecular.attachConstant([0,0,0]),a.lm=a.iLightmap.attachSampler("tLM","vTexCoord1"),a.lm.set(this.texs.get("GI-Ground")),a.conserveEnergy.set(!1),a.perVertexIrrad.set(!0),c.setOpaque(a),a.config.enableBlend(),a.config.blendFunc(d.ZERO,d.SRC_COLOR),b.registerMaterial(a,"ground");var a=new g(d);a._precision="highp",this.scene.env.setupMat(a),a.setLightSetup(this.scene.lights.setup),a.iAlbedo.attachConstant([0,0,0]),a.iGloss.attachConstant(.7),a.specular=a.iSpecular.attachUniform("uSpec"),f.HexInput(a.specular,16699086),a.conserveEnergy.set(!1),c.setOpaque(a),b.registerMaterial(a,"metal")},b.exports=d},{"./materials/aquarelle":238,"./materials/b1":240,"./materials/b2":242,"./materials/ball":243,"./materials/default":244,"./materials/door":245,"./materials/gradient":246,"./materials/marbre":247,"./materials/rails":248,"./materials/wood":249,"assets/awd-scene":1,config:18,"dev/gui":20,"gl/shadow-catcher-material":33,"gl/standard-gi":38,"gl/unlit-material":39,"lib/awd":99,"lib/color":106,"lib/net":110,"nanogl-pbr/lib/input":393,"nanogl-pbr/standard":403,when:445}],253:[function(a,b,c){function d(){this.json=f,this.bin=g,this.itemLoaded=0,this.defer=h.defer();var a=this;"string"==typeof this.json?this.loadJson().then(function(b){a.json=b,a.itemLoaded++,a.checkIfItemIsloaded()}):this.itemLoaded++,"string"==typeof this.bin?this.loadBin().then(function(b){a.bin=b,a.itemLoaded++,a.checkIfItemIsloaded()}):this.itemLoaded++,2===this.itemLoaded&&this.init()}var e=a("config"),f=e.asset_url("zero/test-anim.json"),g=e.asset_url("zero/test-anim.bin"),h=a("when");d.prototype={init:function(){for(var a=this.json.animations,b=0;b<a.length;b++){var c=a[b].animations;for(var d in c)if(c.hasOwnProperty(d)){var e=c[d],f=e.source;e.source=new Float32Array(this.bin.slice(4*f.offset,4*f.offset+4*f.length))}}this.defer.resolve(a)},getPromise:function(){return this.defer.promise},loadJson:function(){var a=h.defer(),b=new XMLHttpRequest;return b.open("GET",this.json,!0),b.responseType="json",b.onload=function(c){a.resolve(b.response)},b.send(),a.promise},loadBin:function(){var a=h.defer(),b=new XMLHttpRequest;return b.open("GET",this.bin,!0),b.responseType="arraybuffer",b.onload=function(c){a.resolve(b.response)},b.send(),a.promise},checkIfItemIsloaded:function(){2===this.itemLoaded&&this.init()}},b.exports=d},{config:18,when:445}],254:[function(a,b,c){function d(a){return this.in=a,this.out={},this.init(),this.out}d.prototype={init:function(){for(var a=0;a<this.in.length;a++){var b=this.in[a],c=b.target.split("_")[0];void 0==this.out[c]&&(this.out[c]=[],this.out[c+"-offset"]=[]),this.out[c+"-offset"].push(b.animations.translate.doorOffset),this.out[c].push(b.animations.translate.source)}}},b.exports=d},{}],255:[function(a,b,c){function d(a,b){this.scene=a,this.geom=b,this.name=this.geom.name,this.target=this.geom.name.split("Picking_Shape").join(""),this.node=new g,this.isOvered=!1,this.picking=new h({faces:this.geom.indices,verts:this.geom.vertices},!0),this.bind()}var e=a("gl-matrix").mat4,f=a("gl-matrix").vec3,g=a("nanogl-node"),h=(a("math/ray"),a("lib/picking")),i=(e.create(),f.create()),j=e.create(),k=e.create(),l=f.create(),m=f.create();d.prototype={bind:function(){this.testPicking=this._testPicking.bind(this),this.getPos=this._getPos.bind(this)},_getPos:function(){return this.picking.getPos()},_testPicking:function(){this.isOvered=!1;var a=(this.scene,this.scene.getMouseRay());e.invert(j,this.node._wmatrix),e.invert(k,this.node._wmatrix),k[12]=k[13]=k[14]=0,f.transformMat4(m,a.pos,j),f.transformMat4(l,a.dir,k),f.normalize(l,l);var b={pos:m,dir:l};this.isOvered=this.picking.run(b,i)}},b.exports=d},{"gl-matrix":352,"lib/picking":111,"math/ray":118,"nanogl-node":368}],256:[function(a,b,c){String.prototype.splice||(String.prototype.splice=function(a,b,c){return this.slice(0,a)+c+this.slice(a+Math.abs(b))})},{}],257:[function(a,b,c){var d=a("nanogl-renderer"),e=(a("./scene"),d({pixelRatio:Math.min(window.devicePixelRatio,1.5),init:function(){this.scene=null},getContextOptions:function(){return{depth:!0,antialias:window.devicePixelRatio<2,stencil:!0,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1}},render:function(a){this.scene&&this.scene.render(a)},resize:function(){}}));b.exports=e},{"./scene":258,"nanogl-renderer":408}],258:[function(a,b,c){function d(){this.load=this._load.bind(this),this.readyForModules=this._readyForModules.bind(this),this.dt=0,this.time=0,this.ratio=1}var e=a("when"),f=a("nanogl-state"),g=a("nanogl-node"),h=a("nanogl-camera"),i=a("nanogl-primitives-2d/rect"),j=a("gl/programs"),k=a("gl/env"),l=a("lib/net"),m=a("lib/mouse"),n=a("math/ray"),o=a("modules"),p=a("assets/materials-lib"),q=a("assets/textures-loader"),r=a("assets/common-assets"),s=a("camera/camera-ctrl"),t=a("camera/max-controler"),u=a("camera/trackball-controler"),v=a("camera/screenshotCam-controler"),w=a("camera/xp-controler"),x=a("cursor"),y=a("entities/background"),z=a("entities/lights"),A=a("entities/loading"),B=a("entities/ui"),C=a("sound/sequencer2"),D=a("sound/player"),E=a("modules/common/confetis/confetiControler");Sections=a("./sections"),Konami=a("konami"),MControler=a("model/mcontroler"),d.prototype={init:function(a,b){this.loaddefer=e.defer(),this.loadPromise=this.loaddefer.promise,this.renderer=a,this.model=b,this.gl=this.renderer.gl,m.init(this),this.mctrl=new MControler(this),this.sroot=new g,this.root=new g,this.volume=0,this.smoothVol=0,this.glstate=new f(this.gl),this.lights=new z(this),this.texlib=new q(this),this.matlib=new p(this),this.cmnAssets=new r(this),this.mray=new n,this.quad=new i(this.gl),this.programs=new j(this),this.bg=new y(this),this.env=new k(this),this.envRotation=0,this.mainCamera=this.makeMainCamera(),this.devCamera=this.makeDevCamera(),this.screenCamera=this.makeCaptureCamera(),this.camera=this.mainCamera,this.camCtrl=new s(this),this.maxcam=new t(this.renderer.canvas),this.trackBallcam=new u(this,this.renderer.canvas),this.screenCam=new v(this,this.renderer.canvas),this.xpcam=new w(this),this.onKonami=this._onKonami.bind(this),this.konami=new Konami(this.onKonami),this.confeti=new E(this),this.mods=new o(this),this.loading=new A(this),this.ui=new B(this),this.sroot.add(this.lights.node),this.sroot.add(this.mainCamera),this.sroot.add(this.devCamera),this.sroot.add(this.screenCamera),this.sroot.add(this.root),this.camCtrl.setControler(this.xpcam),this.section_sep=0},getMouseRay:function(){return this.mray.update(this.camera),this.mray},_readyForModules:function(){this.mods._loaded=!0,this.mods.updateLifecycle()},_onKonami:function(){this.model.setSection(5),this.mods.mods[5].onKonami()},loaded:function(){this.texlib.getGhostLoadables(),this.matlib.compileAll();var a=this;setTimeout(function(){D.play("main_sound",!0,a.smoothVol),a.volume=1},1e3),0===this.model.getSection()&&this.model.next()},setRootPositiion:function(){var a,b,c=this.model._position,d=Math.floor(c),e=c-d,f=1-e;0===e?(a=Sections[d][0][0],b=Sections[d][0][1]):(a=Sections[d][0][0]*f+Sections[d+1][0][0]*e,b=Sections[d][0][1]*f+Sections[d+1][0][1]*e),this.root.x=-a*this.section_sep,this.root.z=b*this.section_sep},render:function(a){BrowserDetect.isMobile&&!BrowserDetect.isTablet||x.update();var b=this.volume-this.smoothVol;b*=.01,this.smoothVol+=b,D.setVolume("main_sound",this.smoothVol),this.dt=a,this.time+=a,this.ratio=this.renderer.width/this.renderer.height,this.updateOrthoProj(),this.computeSectionSep(),this.mods.step();var c=this.gl;this.setRootPositiion(),this.mctrl.preRender(),this.mods.preRender(),this.camCtrl.preRender(),this.bg.preRender(),this.lights.preRender(),this.loading.preRender(),this.ui.preRender(),this.sroot.rotation.set([0,0,0,1]),this.sroot.rotateY(this.envRotation),this.sroot.updateWorldMatrix(),this.camera.updateViewProjectionMatrix(this.renderer.width,this.renderer.height),this.mray.invalidate(),this.mods.rttPass(),this.lights.setup.update(),this.renderLightmaps(),this.glstate.apply(),c.bindFramebuffer(c.FRAMEBUFFER,null),c.viewport(0,0,this.renderer.width,this.renderer.height),c.clearColor(1,1,1,1),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),this.bg.render(),this.ui.render(),this.mods.render(),this.confeti.render(),this.mods.postRender(),C.update()},renderLightmaps:function(){var a=this.gl,b=this.lights.list,c=(this.matlib.depthPass,this.glstate),d="D_RGB"===this.lights.setup.depthFormat._val;this.matlib.depthCfg.colorMask(d,d,d,d),c.apply();for(var e=0;e<b.length;e++){var f=b[e];if(f._castShadows){f.prepareShadowmap(),a.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),c.push(this.matlib.depthCfg);var g={cam:f._camera,defaultpass:this.matlib.depthPass};this.mods.renderShadowPass(g),this.ui.renderShadowPass(g),this.confeti.renderShadow(f._camera),c.pop(this.matlib.depthCfg)}}c.apply()},updateOrthoProj:function(){var a=2.5,b=1.8;(BrowserDetect.isMobile||BrowserDetect.isTablet)&&(a=1,b=.5),BrowserDetect.device.landscape()&&!BrowserDetect.isDesktop&&(a=1.5,b=1.2),this.ratio>a/b?this.mainCamera.lens.setBound(this.ratio*-b,this.ratio*b,-b,b):this.mainCamera.lens.setBound(-a,a,-a/this.ratio,a/this.ratio)},computeSectionSep:function(){this.mainCamera.lens;this.section_sep=10},preload:function(){var a=[];return a=a.concat(this.loading.getLoadables()),l.whenAll(a)},_load:function(){var a=[];a=a.concat(this.env.getLoadables()),a=a.concat(this.cmnAssets.getLoadables()),a=a.concat(this.ui.getLoadables()),a.push(this.confeti.getLoadable()),a.push(C.getLoadables()),BrowserDetect.isDesktop&&a.push(D.getLoadable(this)),e.all(a).then(this.readyForModules),a=a.slice(0),a=a.concat(this.mods.getLoadables());var b=l.whenAll(a);return b.then(this.loaddefer.resolve,this.loaddefer.reject,this.loaddefer.notify),b},makeMainCamera:function(){var a=h.makeOrthoCamera();return a.lens.near=40,a.lens.far=60,a},makeCaptureCamera:function(){var a=h.makeOrthoCamera();return a.lens.near=.1,a.lens.far=100,a.setMatrix(new Float32Array([.9995117783546448,-4.5415227134526504e-10,.03124495968222618,0,.013839236460626125,.8965576887130737,-.4427107870578766,0,-.02801290899515152,.4429270327091217,.8961199522018433,0,.10005075484514236,1.430973768234253,3.1887450218200684,1])),a},shakeCamera:function(a,b){this.camCtrl.shakeCamera(a,b)},makeDevCamera:function(){var a=h.makePerspectiveCamera();return a.lens.setAutoFov(43.68/180*Math.PI),a.lens.near=.1,a.lens.far=100,a.setMatrix(new Float32Array([.9995117783546448,-4.5415227134526504e-10,.03124495968222618,0,.013839236460626125,.8965576887130737,-.4427107870578766,0,-.02801290899515152,.4429270327091217,.8961199522018433,0,.10005075484514236,1.430973768234253,3.1887450218200684,1])),a}},b.exports=d},{"./sections":259,"assets/common-assets":2,"assets/materials-lib":6,"assets/textures-loader":11,"camera/camera-ctrl":13,"camera/max-controler":14,"camera/screenshotCam-controler":15,"camera/trackball-controler":16,"camera/xp-controler":17,cursor:19,"entities/background":21,"entities/lights":23,"entities/loading":24,"entities/ui":27,"gl/env":28,"gl/programs":32,konami:363,"lib/mouse":109,"lib/net":110,"math/ray":118,"model/mcontroler":121,modules:166,"modules/common/confetis/confetiControler":124,"nanogl-camera":364,"nanogl-node":368,"nanogl-primitives-2d/rect":407,"nanogl-state":411,"sound/player":260,"sound/sequencer2":261,when:445}],259:[function(a,b,c){var d=[],e=[[[1,1],a("modules/two")],[[2,2],a("modules/zero")],[[3,3],a("modules/one")],[[4,4],a("modules/eight")]]
;d.push([[0,0],a("modules/loading")]),BrowserDetect.isDesktop&&(d=d.concat(e)),d.push([BrowserDetect.isDesktop?[5,5]:[1,1],a("modules/end")]),b.exports=d},{"modules/eight":141,"modules/end":164,"modules/loading":167,"modules/one":170,"modules/two":214,"modules/zero":237}],260:[function(a,b,c){function d(){this.ctx=null,this.sounds={},this.bind(),this.init(),e=this,this.ready=!1}var e,f=a("./utils/binarySoundLoader"),g=a("config"),h=a("when");d.prototype={bind:function(){this.play=this._play.bind(this),this.stop=this._stop.bind(this),this.isPlaying=this._isPlaying.bind(this),this.setVolume=this._setVolume.bind(this),this.getVolume=this._getVolume.bind(this),this.getAvancement=this._getAvancement.bind(this)},init:function(){this.grabContext()},onLoaded:function(){var a=this;return this.decodeAudio().then(function(){a.ready=!0})},grabContext:function(){var a=window.AudioContext||window.webkitAudioContext;this.ctx=new a},decodeAudio:function(){var a=this;return h.reduce(Object.keys(a.soundsBuffers),function(b,c){var d=a.soundsBuffers[c];return a.sounds[c]={audio:null,audioBuffer:null},a.ctx.decodeAudioData(d.buffer).then(function(b){a.sounds[c].audioBuffer=b})},null)},createAudioBuffer:function(a,b){this.sounds[a].audio=this.ctx.createBufferSource(),this.sounds[a].gainNode=this.ctx.createGain();var c=0===b?.01:b;"function"==typeof this.sounds[a].gainNode.gain.setTargetAtTime?this.sounds[a].gainNode.gain.setTargetAtTime(c,0,.015):this.sounds[a].gainNode.gain.value=c,this.sounds[a].audio.buffer=this.sounds[a].audioBuffer,this.sounds[a].audio.connect(this.sounds[a].gainNode),this.sounds[a].gainNode.connect(this.ctx.destination),this.sounds[a].playTime=this.scene.time},getLoadable:function(a){this.scene=a;var b=this;return new f(g.asset_url("sounds/sounds.json"),g.asset_url("sounds/sounds.bin")).then(function(a){return b.soundsBuffers=a,b.onLoaded()})},_play:function(a,b,c,d){BrowserDetect.isMobile||BrowserDetect.isTablet||!1===this.ready||(c=Math.max(c,.001),this.createAudioBuffer(a,c||1),this.sounds[a].audio.loop=!!b,this.sounds[a].audio.start(0,Math.max(d,0)||0),this.sounds[a].isPlaying=!0)},_setVolume:function(a,b){if(b=Math.max(b,.001),void 0!=this.sounds[a]&&void 0!=this.sounds[a].gainNode){var c=this.sounds[a].gainNode.gain.minValue||0,d=this.sounds[a].gainNode.gain.maxValue||1,e=Math.min(Math.max(b,c),d);"function"==typeof this.sounds[a].gainNode.gain.setTargetAtTime?this.sounds[a].gainNode.gain.setTargetAtTime(e,0,.015):this.sounds[a].gainNode.gain.value=e}},_getVolume:function(a){return void 0!=this.sounds[a]&&void 0!=this.sounds[a].gainNode?this.sounds[a].gainNode.gain.value:null},_stop:function(a){void 0!=this.sounds[a]&&null!==this.sounds[a].audio&&(!1===BrowserDetect.isSafari&&this.sounds[a].audio.stop(),this.sounds[a].isPlaying=!1)},_getAvancement:function(a){return void 0!=this.sounds[a]&&null!==this.sounds[a].audio?this.scene.time-this.sounds[a].playTime:null},_isPlaying:function(a){return this.sounds[a].isPlaying}},b.exports=new d},{"./utils/binarySoundLoader":262,config:18,when:445}],261:[function(a,b,c){function d(){return performance&&performance.now?performance.now():Date.now()}function e(){h.function.bind(this,"_onSynchronizeBall"),this.sequencer=new f,this.ballController=null,this.balls={},this.pendingAnims=[],this.pendingAddBalls=[],this.activeBalls=[],this.events=new l}function f(){h.function.bind(this,"update","_onLoaded"),this.startTime=d(),this._ctx=null,this.getContext(),this.data=null,this.sounds={},this.activeList=[],this.events=new l}function g(a,b){this.buffer=b,this.playing=!1,this._ctx=a,this._source=null,this._gainNode=null,this._startTime=0,this._time=0,this._volume=.8,this.userData=null}var h=a("../modules/two/utils"),i=a("./utils/binarySoundLoader"),j=a("config"),k=a("when"),l=a("event-emitter"),m=/ONE|HUIT/;e.prototype={getLoadables:function(){return this.sequencer.getLoadables().then(function(){for(var a in this.sequencer.sounds)this.balls[a]={id:a,launched:!1,enabled:!1};this.sequencer.events.on("playsound",this._onSynchronizeBall)}.bind(this))},_onSynchronizeBall:function(a){var b=this.balls[a];if(-1===this.pendingAddBalls.indexOf(b)||b.enabled)this.events.emit("playanim",b.id);else{b.enabled=!0;var c=this.pendingAddBalls.indexOf(b);this.pendingAddBalls.splice(c,1),this.activeBalls.push(b)}},update:function(){this.sequencer.update();var a,b,c=0,d=this.pendingAddBalls.length,e=0,f=0;for(c=0,d=this.activeBalls.length;c<d;){if(a=this.activeBalls[c],b=this.sequencer.sounds[a.id],e=b.userData.startTime+b.userData.currentTime,f=b.userData.nextTime-1500,e>f){if(!a.launched){if(!a.enabled){var g=this.activeBalls.indexOf(a);return this.activeBalls.splice(g,1),void this.sequencer.removeSound(a.id)}a.launched=!0,this.launchBall(a),this.sequencer.volumeSound(a.id,.8,20)}}else a.launched=!1;c++}},setBallController:function(a){this.ballController=a},toggleBall:function(a){var b=this.balls[a];-1===this.activeBalls.indexOf(b)?this.addBall(b.id):this.removeBall(b.id)},addBall:function(a){if(!a.match(m)){var b=this.balls[a];-1===this.pendingAddBalls.indexOf(b)&&(this.pendingAnims.push(b.id),this.pendingAddBalls.push(b),this.sequencer.addSound(b.id),this.sequencer.volumeSound(b.id,0))}},removeBall:function(a){if(!a.match(m)){var b=this.balls[a];b.enabled=!1,this.events.emit("stopanim",b.id)}},launchBall:function(a){var b=this.pendingAnims.indexOf(a.id);-1!==b&&setTimeout(function(){this.pendingAnims.splice(b,1),this.events.emit("unregisterpending",a.id)}.bind(this),1500),this.ballController.launchBall(a.id.split("").join("."))}},f.prototype={getContext:function(){if(!this._ctx){var a=window.AudioContext||window.webkitAudioContext;this._ctx=new a}return this._ctx},getLoadables:function(){return new i(j.asset_url("sequencer/sounds.json"),j.asset_url("sequencer/sounds.bin")).then(this._onLoaded)},getTime:function(a){return a?d()-(this.startTime+a.userData.currentTempo):d()-this.startTime},getTimeFromId:function(a){var b=this.sounds[a];return this.getTime(b)},_onLoaded:function(a){this.data=a;var b=Object.keys(this.data),c=this;return k.reduce(b,function(b,d){return c.getContext().decodeAudioData(a[d].buffer).then(function(a){c.sounds[d]=new g(c.getContext(),a),c.sounds[d].userData={id:d,duration:1e3*c.data[d].duration,tempo:1e3*c.data[d].tempo,currentTempo:0,nextTimeTempo:0,startTime:0,nextTime:0,currentTime:0,offsetTime:0,enabled:!1}})},null)},addSound:function(a,b){var c=this.sounds[a];c.userData.enabled=!0,-1===this.activeList.indexOf(c)&&this.activeList.push(c);var d=this.getTime(),e=d%c.userData.tempo,f=d-e,g=f+c.userData.tempo;if(c.userData.nextTimeTempo=g,!b){var h=c.userData.duration/c.userData.tempo,i=d/c.userData.tempo;c.userData.currentTempo=Math.ceil(i%h)*c.userData.tempo}},synchronizeSound:function(a){var b=this.sounds[a],c=this.getTime(b),d=b.userData.duration;b.userData.currentTime=c%d,b.userData.startTime=c-b.userData.currentTime,b.userData.nextTime=b.userData.startTime+d,this.events.emit("synchronize",a)},removeSound:function(a){var b=this.sounds[a];b.userData.enabled=!1,b.playing=!1;var c=this.activeList.indexOf(b);c>-1&&this.activeList.splice(c,1)},playSound:function(a){var b=this.sounds[a];if(b.userData.enabled){var c=this.getTime(b)%b.userData.duration;if(c>.5*b.userData.duration)return;b.seek(c/1e3),b.resume(),this.events.emit("playsound",a)}},volumeSound:function(a,b,c){this.sounds[a].volume(b,c)},update:function(){for(var a,b=0,c=0,d=this.activeList.length,e=0;c<d;)a=this.activeList[c],b=this.getTime(a),e=a.userData.duration,a.userData.currentTime=b%e,a.playing?b>a.userData.nextTime&&(this.playSound(a.userData.id),this.synchronizeSound(a.userData.id)):b>a.userData.nextTimeTempo&&(this.playSound(a.userData.id),this.synchronizeSound(a.userData.id)),c++}},g.prototype={getDuration:function(){return 1e3*this.buffer.duration},_connect:function(){this._source=this._ctx.createBufferSource(),this._source.buffer=this.buffer,this._gainNode=this._ctx.createGain();var a=this._gainNode.gain.minValue||0,b=this._gainNode.gain.maxValue||1;this._volume=Math.max(a,Math.min(this._volume,b)),"function"==typeof this._gainNode.gain.setTargetAtTime?this._gainNode.gain.setTargetAtTime(this._volume,0,.015):this._gainNode.gain.value=this._volume,this._source.connect(this._gainNode),this._gainNode.connect(this._ctx.destination)},_disconnect:function(){this._source&&this._source.disconnect(0),this._gainNode&&this._gainNode.disconnect(0),this._source=null,this._gainNode=null},play:function(){if(!this.playing)return this._connect(),this._time=0,this._startTime=this._source.context.currentTime,this.playing=!0,this._source.start(this._source.context.currentTime,this._time),this},resume:function(){return this.playing?this:(this._connect(),this._startTime=this._source.context.currentTime-this._time,this.playing=!0,this._source.start(this._source.context.currentTime,this._time),this)},pause:function(){return this.playing?(this._time=this._source.context.currentTime-this._startTime,this.playing=!1,this._source.stop(0),this._disconnect(),this):this},stop:function(){return this.playing?(this._time=0,this.playing=!1,this._source.stop(0),this._disconnect(),this):this},seek:function(a){return this.playing?(this.pause(),this._time=a,this.resume()):this._time=a,this},progress:function(a){return this.seek(a*this.buffer.duration),this},volume:function(a,b){if(this._volume=a,b=isNaN(b)?0:b,this._gainNode){var c=this._gainNode.gain.minValue||0,d=this._gainNode.gain.maxValue||1;this._volume=Math.max(c,Math.min(a,d)),"function"==typeof this._gainNode.gain.setTargetAtTime?this._gainNode.gain.setTargetAtTime(this._volume,0,b):this._gainNode.gain.value=this._volume}return this}};var n=new e;b.exports=n},{"../modules/two/utils":230,"./utils/binarySoundLoader":262,config:18,"event-emitter":351,when:445}],262:[function(a,b,c){function d(a,b){this.json=a,this.bin=b,this.itemLoaded=0,this.defer=e.defer();var c=this;return"string"==typeof this.json?this.loadJson().then(function(a){c.json=a,c.itemLoaded++,c.checkIfItemIsloaded()}):this.itemLoaded++,"string"==typeof this.bin?this.loadBin().then(function(a){c.bin=a,c.itemLoaded++,c.checkIfItemIsloaded()}):this.itemLoaded++,2===this.itemLoaded&&this.init(),this.getPromise()}var e=a("when");d.prototype={init:function(){var a=this.json.sounds;for(var b in a)a.hasOwnProperty(b)&&(a[b].buffer=this.bin.slice(a[b].offset,a[b].offset+a[b].length));this.defer.resolve(a)},getPromise:function(){return this.defer.promise},loadJson:function(){var a=e.defer(),b=new XMLHttpRequest;return b.open("GET",this.json,!0),b.responseType="json",b.onload=function(c){a.resolve(b.response)},b.send(),a.promise},loadBin:function(){var a=e.defer(),b=new XMLHttpRequest;return b.open("GET",this.bin,!0),b.responseType="arraybuffer",b.onload=function(c){a.resolve(b.response)},b.send(),a.promise},checkIfItemIsloaded:function(){2===this.itemLoaded&&this.init()}},b.exports=d},{when:445}],263:[function(a,b,c){!function(){var c=a("./consts"),d=a("./chunk"),e={_setup:function(a,b){this.awd=a,this.chunk=b,this.id=b.id},init:function(){this.injectDeps=!1,this.model=c.MODEL_GENERIC},getDependencies:function(){return this.deps?this.deps:null},prepareAndAdd:void 0,prepareChunk:function(){null===this.chunk&&(this.chunk=new d),this.chunk.type=this.type,this.chunk.ns=this.ns}},f={};f.createStruct=function(a,b,c){var d=function(){this.type=a,this.nsUri=b,this.ns=0,this.injectDeps=!0,this.init(),this.chunk=null,this.id=-1};d.TYPE=a;var f;for(f in e)d.prototype[f]=e[f];for(f in c)d.prototype[f]=c[f];return d},b.exports=f}()},{"./chunk":269,"./consts":270}],264:[function(a,b,c){var d=a("./consts"),e=a("./BaseElement"),f=e.createStruct(d.GENERIC,-1,{read:function(a){this.buf=new ArrayBuffer(this.chunk.size),a.readBytes(this.buf,this.chunk.size),this.setDeps()},write:void 0,setDeps:function(){for(var a,b=this.awd._elements,c=[],d=0,e=b.length;e>d;d++)a=b[d],c.push(a);this.deps=c},prepareAndAdd:void 0,prepareChunk:function(){}});b.exports=f},{"./BaseElement":263,"./consts":270}],265:[function(a,b,c){!function(){var c=a("./types/awdString"),d=a("./consts"),e=a("./BaseElement"),f=e.createStruct(d.NAMESPACE,null,{init:function(){this.uri="",this.nsId=0},read:function(a){this.nsId=a.U8(),this.uri=c.read(a)},write:void 0});b.exports=f}()},{"./BaseElement":263,"./consts":270,"./types/awdString":289}],266:[function(a,b,c){var d=a("./header"),e=a("./writer"),f=a("./consts"),g=a("./chunk"),h=a("./bufferReader"),i=a("./DefaultElement"),j=function(){this.header=new d,this._elements=[],this._elementsById=[],this._extensions=[]};j.prototype={addElement:function(a){this._elements.push(a),this._elementsById[a.id]=a},removeElement:function(a){var b=this._elements.indexOf(a);b>-1&&this._elements.splice(b,1)},parse:function(a){var b=new h(a);for(this.header.read(b);b.bytesAvailable()>0;)this.parseChunk(b)},write:function(){return e.write(this)},registerNamespace:function(a){var b=this.getExtension(a.uri);b&&(b.nsId=a.nsId)},addExtension:function(a){if(null===this.getExtension(a.nsUri)){var b,c=this._extensions.push(a),d=a.createNamespace();null!==a.nsUri?(b=c+1,this.addElement(d)):b=0,d.nsId=a.nsId=b}},getExtension:function(a){for(var b=this._extensions,c=0,d=b.length;d>c;c++)if(b[c].nsUri===a)return b[c];return null},getExtensionById:function(a){for(var b=this._extensions,c=0,d=b.length;d>c;c++)if(b[c].nsId===a)return b[c];return null},getDatasByType:function(a,b,c){void 0===b&&(b=null),void 0===c&&(c=[]);var d,e;if(a instanceof Array)for(d=0,e=a.length;e>d;d++)this.getDatasByType(a[d],b,c);else for(d=0,e=this._elements.length;e>d;d++)this._elements[d].type===a&&this._elements[d].nsUri===b&&c.push(this._elements[d]);return c},getAssetByID:function(a,b){var c=[],d=0,e=this._elementsById;if(a>0&&e[a])for(;d<b.length;){if(0!=(e[a].model&b[d]))return c.push(!0),c.push(e[a]),c;if(b[d]===f.MODEL_GEOMETRY&&0!=(e[a].model&f.MODEL_MESH))return c.push(!0),c.push(e[a].geometry),c;d++}return c.push(!1),c.push(null),c},parseChunk:function(a){var b=new g;b.read(a);var c=this.structFactory(b),d=a.ptr;c.read(a),a.ptr-d!==b.size&&(console.log("Warn bad block parsing , byte delta : ",b.type,b.ns,a.ptr-d-b.size),a.ptr=d+b.size),b.ns===f.DEFAULT_NS&&b.type===f.NAMESPACE&&this.registerNamespace(c),this.addElement(c)},structFactory:function(a){var b,c=this.getExtensionById(a.ns);return b=c?c.create(a.type):new i,b._setup(this,a),b},resolveNamespace:function(a){if(null==a.nsUri)return 0;var b=this.getExtension(a.nsUri);return b?b.nsId:(console.log("Missing extension "+a.nsUri),0)}},b.exports=j},{"./DefaultElement":264,"./bufferReader":267,"./chunk":269,"./consts":270,"./header":272,"./writer":294}],267:[function(a,b,c){!function(){var a=function(a,b,c){this.buffer=a,this.ptr=0,this.littleEndien=!0,b=b||0,c=c||a.byteLength,this.view=new DataView(a,b,c),this.length=this.view.byteLength};a.prototype={setPosition:function(a){this.ptr=a},setLittleEndian:function(a){this.littleEndien=a},bytesAvailable:function(){return this.length-this.ptr},I8:function(){return this.view.getInt8(this.ptr++)},U8:function(){return this.view.getUint8(this.ptr++)},I16:function(){var a=this.view.getInt16(this.ptr,this.littleEndien);return this.ptr+=2,a},U16:function(){var a=this.view.getUint16(this.ptr,this.littleEndien);return this.ptr+=2,a},I32:function(){var a=this.view.getInt32(this.ptr,this.littleEndien);return this.ptr+=4,a},U32:function(){var a=this.view.getUint32(this.ptr,this.littleEndien);return this.ptr+=4,a},F32:function(){var a=this.view.getFloat32(this.ptr,this.littleEndien);return this.ptr+=4,a},F64:function(){var a=this.view.getFloat64(this.ptr,this.littleEndien);return this.ptr+=8,a},readBytes:function(a,b){void 0===b&&(b=a.byteLength);var c=new Int8Array(a),d=new Int8Array(this.buffer,this.ptr,b);c.set(d),this.ptr+=b},subArray:function(a){var b=new Int8Array(this.buffer,this.ptr,a);return this.ptr+=a,b},readUTFBytes:function(a){for(var b,c,d,e=this.ptr+a,f=[],g=0;this.ptr<e;)0!==(b=this.U8())&&(128>b?f[g++]=String.fromCharCode(b):b>191&&224>b?(c=this.U8(),f[g++]=String.fromCharCode((31&b)<<6|63&c)):(c=this.U8(),d=this.U8(),f[g++]=String.fromCharCode((15&b)<<12|(63&c)<<6|63&d)));return f.join("")}},b.exports=a}()},{}],268:[function(a,b,c){b.exports={}},{}],269:[function(a,b,c){!function(){var a=function(){this.id=0,this.ns=0,this.type=0,this.flags=0,this.size=0,this.data=null};a.prototype={read:function(a){this.id=a.U32(),this.ns=a.U8(),this.type=a.U8(),this.flags=a.U8(),this.size=a.U32()},write:void 0},b.exports=a}()},{}],270:[function(a,b,c){!function(){var a={UNCOMPRESSED:0,DEFLATE:1,LZMA:2,AWD_FIELD_INT8:1,AWD_FIELD_INT16:2,AWD_FIELD_INT32:3,AWD_FIELD_UINT8:4,AWD_FIELD_UINT16:5,AWD_FIELD_UINT32:6,AWD_FIELD_FLOAT32:7,AWD_FIELD_FLOAT64:8,AWD_FIELD_BOOL:21,AWD_FIELD_COLOR:22,AWD_FIELD_BADDR:23,AWD_FIELD_STRING:31,AWD_FIELD_BYTEARRAY:32,AWD_FIELD_VECTOR2x1:41,AWD_FIELD_VECTOR3x1:42,AWD_FIELD_VECTOR4x1:43,AWD_FIELD_MTX3x2:44,AWD_FIELD_MTX3x3:45,AWD_FIELD_MTX4x3:46,AWD_FIELD_MTX4x4:47,INT8:1,INT16:2,INT32:3,UINT8:4,UINT16:5,UINT32:6,FLOAT32:7,FLOAT64:8,AWDSTRING:31,AWDBYTEARRAY:32,MAGIC:4282180,GENERIC:0,GEOMETRY:1,PRIMITIVE:11,CONTAINER:22,MESH:23,MATERIAL:81,TEXTURE:82,SKELETON:101,SKELETON_POSE:102,SKELETON_ANIMATION:103,ANIMATION_SET:113,ANIMATOR:122,NAMESPACE:254,METADATA:255,MODEL_ENTITY:2,MODEL_SKYBOX:4,MODEL_CAMERA:8,MODEL_SEGMENT_SET:16,MODEL_MESH:32,MODEL_GEOMETRY:64,MODEL_SKELETON:128,MODEL_SKELETON_POSE:256,MODEL_CONTAINER:512,MODEL_TEXTURE:1024,MODEL_TEXTURE_PROJECTOR:2048,MODEL_MATERIAL:4096,MODEL_ANIMATION_SET:8192,MODEL_ANIMATION_STATE:16384,MODEL_ANIMATION_NODE:32768,MODEL_ANIMATOR:65536,MODEL_STATE_TRANSITION:1<<17,MODEL_LIGHT:1<<18,MODEL_LIGHT_PICKER:1<<19,MODEL_SHADOW_MAP_METHOD:1<<20,MODEL_EFFECTS_METHOD:1<<21,MODEL_GENERIC:-1,POSITION:1,INDEX:2,UVS:3,NORMAL:4,TANGENT:5,JOIN_IDX:6,JOIN_WGT:7,SUVS:8,COLOR:11,BINORMAL:12,DEFAULT_NS:0};b.exports=a}()},{}],271:[function(a,b,c){var d=a("./DefaultElement"),e=a("./Namespace"),f=function(a){this.nsUri=a,this.structs=[],this.nsId=0};f.prototype={addStruct:function(a){this.structs.push(a)},addStructs:function(a){for(var b=0,c=a.length;c>b;b++)this.addStruct(a[b])},create:function(a){for(var b,c=this.structs,e=0,f=c.length;f>e;e++)if(b=c[e],b.TYPE===a)return new b;return new d},createNamespace:function(){var a=new e;return a.uri=this.nsUri,a}},b.exports=f},{"./DefaultElement":264,"./Namespace":265}],272:[function(a,b,c){!function(){var c=a("./consts"),d=function(){this.size=12,this.version={major:0,minor:0},this.streaming=!1,this.accuracyMatrix=!1,this.accuracyGeo=!1,this.accuracyProps=!1,this.geoNrType=c.FLOAT32,this.matrixNrType=c.FLOAT32,this.propsNrType=c.FLOAT32,this.optimized_for_accuracy=!1,this.compression=!1,this.bodylen=0};d.prototype={read:function(a){var b=a.U8()<<16|a.U8()<<8|a.U8();if(b!==c.MAGIC)throw new Error("AWD parse error - bad magic "+b.toString(16));var d=this.version;d.major=a.U8(),d.minor=a.U8();var e=a.U16();this.streaming=1==(1&e),this.optimized_for_accuracy=2==(2&e),2===d.major&&1===d.minor&&(this.accuracyMatrix=2==(2&e),this.accuracyGeo=4==(4&e),this.accuracyProps=8==(8&e)),this.geoNrType=this.accuracyGeo?c.FLOAT64:c.FLOAT32,this.matrixNrType=this.accuracyMatrix?c.FLOAT64:c.FLOAT32,this.propsNrType=this.accuracyProps?c.FLOAT64:c.FLOAT32,this.compression=a.U8(),this.bodylen=a.U32()},write:void 0},b.exports=d}()},{"./consts":270}],273:[function(a,b,c){function d(a,b,c){for(var d=c.transforms,f=0;f<d.length;f++)b=e(a,b,d[f]);return b}function e(a,b,c){return f(a,b,c.transform.data),b+7}function f(a,b,c){a[b+0]=c[12],a[b+1]=c[13],a[b+2]=c[14];var d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]),e=Math.sqrt(c[4]*c[4]+c[5]*c[5]+c[6]*c[6]),f=Math.sqrt(c[8]*c[8]+c[9]*c[9]+c[10]*c[10]);o[0]=c[0]/d,o[1]=c[1]/d,o[2]=c[2]/d,o[3]=c[4]/e,o[4]=c[5]/e,o[5]=c[6]/e,o[6]=c[8]/f,o[7]=c[9]/f,o[8]=c[10]/f,g(a,b+3,o)}function g(a,b,c){var d,e=c[0]+c[4]+c[8];if(e>0)d=Math.sqrt(e+1),a[b+3]=.5*d,d=.5/d,a[b+0]=(c[5]-c[7])*d,a[b+1]=(c[6]-c[2])*d,a[b+2]=(c[1]-c[3])*d;else{var f=0;c[4]>c[0]&&(f=1),c[8]>c[3*f+f]&&(f=2);var g=(f+1)%3,h=(f+2)%3;d=Math.sqrt(c[3*f+f]-c[3*g+g]-c[3*h+h]+1),a[b+f]=.5*d,d=.5/d,a[b+3]=(c[3*g+h]-c[3*h+g])*d,a[b+g]=(c[3*g+f]+c[3*f+g])*d,a[b+h]=(c[3*h+f]+c[3*f+h])*d}return a}var h=a("../types/properties"),i=a("../types/awdString"),j=a("../consts"),k=a("../types/userAttr"),l=a("../BaseElement"),m=a("./extInfos"),n=l.createStruct(m.COMPACT_SKEL_ANIM,m.URI,{init:function(){this.name="",this.model=j.MODEL_ANIMATION_STATE,this.extras=new k,this.props=new h({}),this.numFrames=0,this.numBones=0,this.data=null},read:function(a){this.name=i.read(a),this.numFrames=a.U16(),this.numBones=a.U16(),this.props.read(a);var b=a.U8();a.ptr+=b;var c=this.numFrames*this.numBones*7;this.data=new Float32Array(a.buffer,a.ptr,c),a.ptr+=4*c,this.extras.read(a)},write:void 0,convertFromSkeletonAnimation:function(a){var b=a.frames;this.numFrames=b.length,this.numBones=b[0].pose.transforms.length,this.data=new Float32Array(this.numFrames*this.numBones*7);for(var c=0,e=0;e<b.length;e++)c=d(this.data,c,b[e].pose)},toString:function(){return"[CompactSkeletonAnimation"+this.name+"]"}}),o=new Float32Array(9);b.exports=n},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"../types/properties":291,"../types/userAttr":292,"./extInfos":276}],274:[function(a,b,c){function d(){this.name="",this.bytesize=0,this.gltype=0,this.numcomps=0,this.normalize=!1}var e=a("../BaseElement"),f=a("../types/awdString"),g=a("../std/Geometry"),h=a("./extInfos");d.prototype={read:function(a){this.name=f.read(a),this.bytesize=a.U8(),this.gltype=a.U16();var b=a.U8();this.numcomps=7&b,this.normalize=!!(b>>>3&1)},write:void 0};var i=function(){this.data=null,this.buffertype=0,this.attributes=[]};i.prototype={read:function(a){var b=a.U8(),c=a.U16(),e=this.attributes;this.buffertype=c;for(var f=0;b>f;f++){var g=new d;g.read(a),e.push(g)}var h=a.U8();a.ptr+=h;var i=a.U32(),j=a.ptr+i;this.data=new Uint8Array(a.buffer,a.ptr,i),a.ptr=j},write:void 0};var j=e.createStruct(h.INTERLEAVED_GEOM,h.URI,g.prototype);j.prototype.subGeomFactory=function(){var a=g.prototype.subGeomFactory();return a.bufferFactory=this.bufferFactory,a},j.prototype.bufferFactory=function(){return new i},j.prototype.toString=function(){return"[InterleavedGeometry "+this.name+"]"},j.Attribute=d,j.VertexBuffer=i,b.exports=j},{"../BaseElement":263,"../std/Geometry":280,"../types/awdString":289,"./extInfos":276}],275:[function(a,b,c){var d=a("../extension"),e=a("./InterleavedGeometry"),f=a("./CompactSkeletonAnimation"),g=a("./extInfos"),h=[e,f],i=g;i.getExtension=function(){var a=new d(g.URI);return a.addStructs(h),a},b.exports=i},{"../extension":271,"./CompactSkeletonAnimation":273,"./InterleavedGeometry":274,"./extInfos":276}],276:[function(a,b,c){b.exports={URI:"https://github.com/plepers/awd-js",INTERLEAVED_GEOM:1,COMPACT_SKEL_ANIM:2}},{}],277:[function(a,b,c){!function(){var c=a("../types/properties"),d=a("../types/awdString"),e=a("../consts"),f=a("../types/userAttr"),g=a("../BaseElement"),h=g.createStruct(e.ANIMATION_SET,null,{init:function(){this.name="",this.model=e.MODEL_ANIMATION_SET,this.extras=new f,this.props=new c({}),this.animations=[]},read:function(a){this.name=d.read(a);var b=a.U16();this.props.read(a),this.animations=[];for(var c,f=0;b>f;f++){var g=a.U32(),h=this.awd.getAssetByID(g,[e.MODEL_ANIMATION_STATE]);if(!h[0])throw new Error("AnimationSet cannot find animation state reference");c=h[1],this.animations.push(c)}this.extras.read(a)},write:void 0,getDependencies:function(){for(var a=[],b=this.animations.length,c=0;b>c;c++){var d=this.animations[c];a.push(d)}return a},toString:function(){return"[AnimationSet"+this.name+"]"}});b.exports=h}()},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"../types/properties":291,"../types/userAttr":292}],278:[function(a,b,c){!function(){var c=a("../types/properties"),d=a("../types/awdString"),e=a("../consts"),f=a("../types/userAttr"),g=a("../BaseElement"),h=g.createStruct(e.ANIMATOR,null,{init:function(){this.name="",this.model=e.MODEL_ANIMATOR,this.extras=new f,this.animatorProps=new f,this.animatorProps=new c({1:e.AWD_FIELD_BADDR}),this.props=new c({}),this.targets=[],this.skeleton=null,this.animationSet=null,this.activeState=0,this.autoPlay=!1},read:function(a){var b;this.name=d.read(a);var c=a.U16();this.animatorProps.read(a);var f=a.U32(),g=a.U16();this.targets=[];for(var h=0;g>h;h++){var i=a.U32();if(b=this.awd.getAssetByID(i,[e.MODEL_MESH]),!b[0])throw new Error("Animator cannot find target reference");this.targets.push(b[1])}if(this.activeState=a.U16(),this.autoPlay=0!==a.U8(),this.props.read(a),this.extras.read(a),b=this.awd.getAssetByID(f,[e.MODEL_ANIMATION_SET]),!b[0])throw new Error("Animator cannot find AnimationSet reference");if(this.animationSet=b[1],1===c){var j=this.animatorProps.get(1,0);if(b=this.awd.getAssetByID(j,[e.MODEL_SKELETON]),!b[0])throw new Error("Animator cannot find Skeleton reference");this.skeleton=b[1]}},write:void 0,getDependencies:function(){for(var a=[this.skeleton,this.animationSet],b=0;b<this.targets.length;b++)a.push(this.targets[b]);return a},toString:function(){return"[Animator"+this.name+"]"}});b.exports=h}()},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"../types/properties":291,"../types/userAttr":292}],279:[function(a,b,c){!function(){var c=a("../types/userAttr"),d=a("../types/awdString"),e=a("../types/vec3"),f=a("../types/matrix"),g=a("../consts"),h=a("../BaseElement"),i=h.createStruct(g.CONTAINER,null,{init:function(){this.model=g.MODEL_CONTAINER,i.super(this)},read:function(a){var b=a.U32();this.matrix.read(this.awd,a),this.name=d.read(a),this.pivot.parsePivot(this.awd,a),this.extras.read(a);var c=this.awd.getAssetByID(b,[g.MODEL_CONTAINER,g.MODEL_MESH,g.MODEL_LIGHT,g.MODEL_ENTITY,g.MODEL_SEGMENT_SET]);if(c[0])void 0!==c[1].addChild&&c[1].addChild(this),this.parent=c[1];else if(b>0)throw new Error("Could not find a parent for this ObjectContainer3D id : "+b)},write:void 0,getDependencies:function(){var a=this.parent;return a?[a]:null},toString:function(){return"[Container "+this.name+"]"},addChild:function(a){-1===this.children.indexOf(a)&&(this.children.push(a),a.parent=this)},removeChild:function(a){var b=this.children.indexOf(a);b>-1&&(this.children.splice(b,1),a.parent=null)}});i.extend=function(a){a.addChild=i.prototype.addChild,a.removeChild=i.prototype.removeChild},i.super=function(a){a.parent=null,a.children=[],a.matrix=new f,a.name="",a.pivot=new e,a.extras=new c},b.exports=i}()},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"../types/matrix":290,"../types/userAttr":292,"../types/vec3":293}],280:[function(a,b,c){!function(){"use strict";var c=a("../consts"),d=a("../types/awdString"),e=a("../types/userAttr"),f=a("../types/properties"),g=a("../BaseElement"),h=g.createStruct(c.GEOMETRY,null,{subGeomFactory:function(){var a=new i;return a.bufferFactory=this.bufferFactory,a},bufferFactory:function(){return new k},init:function(){this.model=c.MODEL_GEOMETRY,this.name="",this.extras=new e,this.props=new f({}),this.subGeoms=[]},read:function(a){this.name=d.read(a);var b=a.U16(),c=this.awd.header.geoNrType,e=this.props;e.expected[1]=c,e.expected[2]=c,e.read(a);var f=e.get(1,1),g=e.get(2,1);1===f&&1===g||console.log("WARN defined scale UV in geometry");for(var h,i=this.subGeoms,j=0;b>j;j++)h=this.subGeomFactory(),h.read(this.awd,a),i.push(h);this.extras.read(a)},write:void 0,toString:function(){return"[Geometry "+this.name+"]"}}),i=function(){this.buffers=[],this.extras=new e,this.props=new f({})};i.prototype={getBuffersByType:function(a,b){void 0===b&&(b=[]);var c,d;if(a instanceof Array)for(c=0,d=a.length;d>c;c++)this.getBuffersByType(a[c],b);else for(c=0,d=this.buffers.length;d>c;c++)this.buffers[c].type===a&&b.push(this.buffers[c]);return b},read:function(a,b){var c=b.U32(),d=b.ptr+c,e=a.header.geoNrType,f=this.props;f.expected[1]=e,f.expected[2]=e,f.read(b);var g=f.get(1,1),h=f.get(2,1);1===g&&1===h||console.log("WARN defined scale UV in sub-geometry");for(var i,j=-1;b.ptr<d;)i=this.bufferFactory(),i.read(b),!i.isIndex&&i.numVertices>-1&&(j>-1&&i.numVertices!==j&&console.log("Warn buffers in geom has differents num vertices",j,i.numVertices),j=i.numVertices),this.buffers.push(i);for(var k=0,l=this.buffers.length;l>k;k++)i=this.buffers[k],-1!==i.numVertices||i.isIndex||i.solveSize(j);this.extras.read(b)},write:function(a,b){var c=b.skipBlockSize();this.writeProps(a,b);for(var d=0,e=this.buffers.length;e>d;d++){this.buffers[d].write(b)}b.writeBlockSize(c),this.extras.write(b)},writeProps:function(a,b){var c=a.header.geoNrType,d=this.props;d.expected[1]=c,d.expected[2]=c,d.set(1,1),d.set(2,1),d.write(b)}};var j=function(a){return 2===a?c.AWD_FIELD_UINT16:a},k=function(){this.data=null,this.numVertices=-1,this.type=0,this.components=0,this.ftype=c.T_FLOAT,this.isIndex=!1};k.HEAD_SIZE=6,k.prototype={allocate:function(a,b){var c=o(b);void 0===c&&console.log(b),this.data=new c(a)},solveSize:function(a){this.numVertices=a,this.components=this.data.length/a},read:function(a){var b=a.U8(),d=a.U8(),e=a.U32(),f=a.ptr+e;(d=j(d))!==c.AWD_FIELD_UINT8&&d!==c.AWD_FIELD_UINT16&&d!==c.AWD_FIELD_FLOAT32&&d!==c.AWD_FIELD_FLOAT64&&console.log("WARN unexpected stream data type ",d,b,e);var g=p(b);this.isIndex=b===c.INDEX,this.type=b,this.components=g,this.ftype=d;var h=l(d),i=e/h;-1!==g&&(this.numVertices=i/g),this.allocate(i,d);for(var k=m(d,a),n=this.data,o=0;a.ptr<f;)n[o++]=k.call(a)},write:function(a){a.U8(this.type),a.U8(this.ftype);for(var b=a.skipBlockSize(),c=n(this.ftype,a),d=this.data,e=0,f=d.length;f>e;e++)c.call(a,d[e]);a.writeBlockSize(b)}};var l=function(a){switch(a){case c.AWD_FIELD_UINT8:return 1;case c.AWD_FIELD_UINT16:return 2;case c.AWD_FIELD_FLOAT32:return 4;case c.AWD_FIELD_FLOAT64:return 8}throw new Error("WARN getTypeSize - unexpected stream data type "+a)},m=function(a,b){switch(a){case c.AWD_FIELD_UINT8:return b.U8;case c.AWD_FIELD_UINT16:return b.U16;case c.AWD_FIELD_FLOAT32:return b.F32;case c.AWD_FIELD_FLOAT64:return b.F64}throw new Error("WARN getReadFunc - unexpected stream data type "+a)},n=function(a,b){switch(a){case c.AWD_FIELD_UINT8:return b.U8;case c.AWD_FIELD_UINT16:return b.U16;case c.AWD_FIELD_FLOAT32:return b.F32;case c.AWD_FIELD_FLOAT64:return b.F64}throw new Error("WARN getWriteFunc - unexpected stream data type "+a)},o=function(a){switch(a){case c.AWD_FIELD_UINT8:return Uint8Array;case c.AWD_FIELD_UINT16:return Uint16Array;case c.AWD_FIELD_FLOAT32:return Float32Array;case c.AWD_FIELD_FLOAT64:return Float64Array}throw new Error("WARN getArray - unexpected stream data type "+a)},p=function(a){switch(a){case c.POSITION:case c.INDEX:case c.NORMAL:case c.TANGENT:case c.BINORMAL:return 3;case c.UVS:return 2;case c.JOIN_WGT:case c.JOIN_IDX:default:return-1}};h.SubGeom=i,h.VertexBuffer=k,h.getTypeSize=l,h.getReadFunc=m,h.getWriteFunc=n,h.getArray=o,h.fixC4D_Type=j,b.exports=h}()},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"../types/properties":291,"../types/userAttr":292}],281:[function(a,b,c){!function(){var c=a("../types/properties"),d=a("../types/awdString"),e=a("../consts"),f=a("../types/userAttr"),g=a("../BaseElement"),h=g.createStruct(e.MATERIAL,null,{init:function(){this.name="",this.model=e.MODEL_MATERIAL,this.extras=new f},read:function(a){this.name=d.read(a),this.mattype=a.U8(),this.numMethods=a.U8();var b=this.awd.header.propsNrType;this.props=new c({1:e.AWD_FIELD_UINT32,2:e.AWD_FIELD_BADDR,3:e.AWD_FIELD_BADDR,4:e.AWD_FIELD_UINT8,5:e.AWD_FIELD_BOOL,6:e.AWD_FIELD_BOOL,7:e.AWD_FIELD_BOOL,8:e.AWD_FIELD_BOOL,9:e.AWD_FIELD_UINT8,10:b,11:e.AWD_FIELD_BOOL,12:b,13:e.AWD_FIELD_BOOL,15:b,16:e.AWD_FIELD_UINT32,17:e.AWD_FIELD_BADDR,18:b,19:b,20:e.AWD_FIELD_UINT32,21:e.AWD_FIELD_BADDR,22:e.AWD_FIELD_BADDR}),this.props.read(a),this.extras.read(a)},write:void 0,toString:function(){}});b.exports=h}()},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"../types/properties":291,"../types/userAttr":292}],282:[function(a,b,c){!function(){
var c=a("../types/awdString"),d=a("../consts"),e=a("../BaseElement"),f=a("./Container"),g=e.createStruct(d.MESH,null,{init:function(){this.model=d.MODEL_MESH,this.pData={},f.super(this),this.geometry=null,this.materials=[]},read:function(a){var b=a.U32();this.matrix.read(this.awd,a),this.name=c.read(a);for(var e=a.U32(),f=a.U16(),g=0;f>g;g++){var h=a.U32(),i=this.awd.getAssetByID(h,[d.MODEL_MATERIAL]);if(!i[0]&&h>0)throw new Error("Could not find Material Nr "+g+" (ID = "+h+" ) for this Mesh");h>0&&this.materials.push(i[1])}this.pivot.parsePivot(this.awd,a),this.extras.read(a);var j=this.awd.getAssetByID(e,[d.MODEL_GEOMETRY]);if(j[0]&&(this.geometry=j[1]),j=this.awd.getAssetByID(b,[d.MODEL_CONTAINER,d.MODEL_MESH,d.MODEL_LIGHT,d.MODEL_ENTITY,d.MODEL_SEGMENT_SET]),j[0])void 0!==j[1].addChild&&j[1].addChild(this),this.parent=j[1];else if(b>0)throw new Error("Could not find a parent for this Mesh "+b)},write:void 0,getDependencies:function(){for(var a=[],b=this.materials.length,c=0;b>c;c++){var d=this.materials[c];a.push(d)}return this.parent&&a.push(this.parent),this.geometry&&a.push(this.geometry),a},toString:function(){return"[Mesh "+this.pData.name+"]"}});f.extend(g.prototype),b.exports=g}()},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"./Container":279}],283:[function(a,b,c){!function(){var c=a("../consts"),d=a("../types/properties"),e=a("../BaseElement"),f=e.createStruct(c.METADATA,null,{init:function(){this.timeStamp=0,this.encoderName="unknown",this.encoderVersion="unknown",this.generatorName="unknown",this.generatorVersion="unknown"},read:function(a){var b=new d({1:c.AWD_FIELD_UINT32,2:c.AWD_FIELD_STRING,3:c.AWD_FIELD_STRING,4:c.AWD_FIELD_STRING,5:c.AWD_FIELD_STRING});b.read(a),this.timeStamp=b.get(1,0),this.encoderName=b.get(2,"unknown"),this.encoderVersion=b.get(3,"unknown"),this.generatorName=b.get(4,"unknown"),this.generatorVersion=b.get(5,"unknown")},write:void 0,toString:function(){return"Metadata : TimeStamp         = "+this.timeStamp+" EncoderName       = "+this.encoderName+" EncoderVersion    = "+this.encoderVersion+" GeneratorName     = "+this.generatorName+" GeneratorVersion  = "+this.generatorVersion}});b.exports=f}()},{"../BaseElement":263,"../consts":270,"../types/properties":291}],284:[function(a,b,c){!function(){function c(){this.id=0,this.parentId=-1,this.name="",this.bindPose=new h,this.props=new d({}),this.extras=new g}var d=a("../types/properties"),e=a("../types/awdString"),f=a("../consts"),g=a("../types/userAttr"),h=a("../types/matrix"),i=a("../BaseElement"),j=i.createStruct(f.SKELETON,null,{init:function(){this.name="",this.model=f.MODEL_SKELETON,this.extras=new g,this.props=new d({}),this.joints=[],this.jointsByIds={}},read:function(a){this.name=e.read(a);var b=a.U16();this.props.read(a),this.joints=[];for(var d=0;b>d;d++){var f=new c;f.read(this.awd,a),this.jointsByIds[f.id]=f,this.joints.push(f)}this.extras.read(a)},write:void 0,toString:function(){return"[Skeleton"+this.name+"]"}});c.prototype={read:function(a,b){this.id=b.U16(),this.parentId=b.U16(),this.name=e.read(b),this.bindPose.read(a,b),this.props.read(b),this.extras.read(b)},write:void 0},b.exports=j}()},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"../types/matrix":290,"../types/properties":291,"../types/userAttr":292}],285:[function(a,b,c){!function(){function c(){this.pose=null,this.duration=16}var d=a("../types/properties"),e=a("../types/awdString"),f=a("../consts"),g=a("../types/userAttr"),h=a("../BaseElement"),i=h.createStruct(f.SKELETON_ANIMATION,null,{init:function(){this.name="",this.model=f.MODEL_ANIMATION_STATE,this.extras=new g,this.props=new d({}),this.frames=[]},read:function(a){this.name=e.read(a);var b=a.U16();this.props.read(a),this.frames=[];for(var d=0;b>d;d++){var f=new c;f.read(this.awd,a),this.frames.push(f)}this.extras.read(a)},write:void 0,getDependencies:function(){for(var a=[],b=this.frames.length,c=0;b>c;c++){var d=this.frames[c];a.push(d.pose)}return a},toString:function(){return"[SkeletonAnimation"+this.name+"]"}});c.prototype={read:function(a,b){var c=b.U32();this.duration=b.U16();var d=a.getAssetByID(c,[f.MODEL_SKELETON_POSE]);if(!d[0])throw new Error("SkeletonAnimation frame cannot find Pose reference");this.pose=d[1]},write:void 0},b.exports=i}()},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"../types/properties":291,"../types/userAttr":292}],286:[function(a,b,c){!function(){function c(){this.hasTransform=!1,this.transform=new h}var d=a("../types/properties"),e=a("../types/awdString"),f=a("../consts"),g=a("../types/userAttr"),h=a("../types/matrix"),i=a("../BaseElement"),j=i.createStruct(f.SKELETON_POSE,null,{init:function(){this.name="",this.model=f.MODEL_SKELETON_POSE,this.extras=new g,this.props=new d({}),this.transforms=[]},read:function(a){this.name=e.read(a);var b=a.U16();this.props.read(a),this.transforms=[];for(var d=0;b>d;d++){var f=new c;f.read(this.awd,a),this.transforms.push(f)}this.extras.read(a)},write:void 0,toString:function(){return"[SkeletonPose"+this.name+"]"}});c.prototype={read:function(a,b){this.hasTransform=0!==b.U8(),this.transform.read(a,b)},write:void 0},b.exports=j}()},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"../types/matrix":290,"../types/properties":291,"../types/userAttr":292}],287:[function(a,b,c){!function(){var c=a("../types/properties"),d=a("../types/awdString"),e=a("../consts"),f=a("../types/userAttr"),g=a("../BaseElement"),h=g.createStruct(e.TEXTURE,null,{init:function(){this.name="",this.textype=0,this.url=null,this.data=null,this.extras=new f,this.model=e.MODEL_TEXTURE},read:function(a){this.name=d.read(a),this.textype=a.U8();var b=a.U32();0===this.textype?this.url=a.readUTFBytes(b):(this.data=new ArrayBuffer(b),a.readBytes(this.data,b)),(new c).read(a),this.extras.read(a)},write:void 0,toString:function(){}});b.exports=h}()},{"../BaseElement":263,"../consts":270,"../types/awdString":289,"../types/properties":291,"../types/userAttr":292}],288:[function(a,b,c){var d=a("../extension"),e=a("../DefaultElement"),f=a("./Metadata"),g=a("./Container"),h=a("./Mesh"),i=a("./Texture"),j=a("./Material"),k=a("./Skeleton"),l=a("./SkeletonPose"),m=a("./SkeletonAnimation"),n=a("./AnimationSet"),o=a("./Animator"),p=a("./Geometry"),q=[e,f,g,h,i,j,k,l,m,n,o,p],r={};r.getExtension=function(){var a=new d(null);return a.addStructs(q),a},b.exports=r},{"../DefaultElement":264,"../extension":271,"./AnimationSet":277,"./Animator":278,"./Container":279,"./Geometry":280,"./Material":281,"./Mesh":282,"./Metadata":283,"./Skeleton":284,"./SkeletonAnimation":285,"./SkeletonPose":286,"./Texture":287}],289:[function(a,b,c){b.exports={read:function(a){var b=a.U16();return a.readUTFBytes(b)},write:function(a,b){b.U16(a.length),b.writeUTFBytes(a)},getUTFBytesLength:function(a){for(var b=0,c=0,d=a.length;d>c;c++){var e,f=a[c].codePointAt(0);128>f?e=1:2048>f?e=2:65536>f?e=3:2097152>f&&(e=4),b+=e}return b}}},{}],290:[function(a,b,c){!function(){var a=function(){this.data=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};a.prototype={read:function(a,b){this.parseMatrix43RawData(a,b,this.data)},write:void 0,parseMatrix43RawData:function(a,b,c){var d=c,e=a.header.accuracyMatrix?b.F64:b.F32;return d[0]=e.call(b),d[1]=e.call(b),d[2]=e.call(b),d[3]=0,d[4]=e.call(b),d[5]=e.call(b),d[6]=e.call(b),d[7]=0,d[8]=e.call(b),d[9]=e.call(b),d[10]=e.call(b),d[11]=0,d[12]=e.call(b),d[13]=e.call(b),d[14]=e.call(b),d[15]=1,isNaN(d[0])&&(d[0]=1,d[1]=0,d[2]=0,d[4]=0,d[5]=1,d[6]=0,d[8]=0,d[9]=0,d[10]=1,d[12]=0,d[13]=0,d[14]=0),d},writeMatrix43RawData:void 0},b.exports=a}()},{}],291:[function(a,b,c){!function(){var c=a("../consts"),d=(a("./awdString"),a("../bufferWriter")),e=a("../bufferReader"),f=function(a){this.expected=a,this.vars={}};f.prototype={clone:function(){var a=new d(64);this.write(a);var b=new f(this.expected);return b.read(new e(a.buffer)),b},read:function(a){var b=this.expected,c=a.U32(),d=a.ptr+c;if(b)for(;a.ptr<d;){var e,f=a.U16(),g=a.U32();this.expected.hasOwnProperty(f)?(e=b[f],this.set(f,this.parseAttrValue(e,g,a))):a.ptr+=g}a.ptr!==d&&(console.log("Warn Properties don't read entire data ",a.ptr,d,c),a.ptr=d)},write:void 0,set:function(a,b){this.vars[a]=b},get:function(a,b){return this.vars.hasOwnProperty(a)?this.vars[a]:b},writeAttrValue:void 0,parseAttrValue:function(a,b,d){var e,f;switch(a){case c.AWD_FIELD_INT8:e=1,f=d.I8;break;case c.AWD_FIELD_INT16:e=2,f=d.I16;break;case c.AWD_FIELD_INT32:e=4,f=d.I32;break;case c.AWD_FIELD_BOOL:case c.AWD_FIELD_UINT8:e=1,f=d.U8;break;case c.AWD_FIELD_UINT16:e=2,f=d.U16;break;case c.AWD_FIELD_UINT32:case c.AWD_FIELD_BADDR:e=4,f=d.U32;break;case c.AWD_FIELD_FLOAT32:e=4,f=d.F32;break;case c.AWD_FIELD_FLOAT64:e=8,f=d.F64;break;case c.AWD_FIELD_STRING:d.U16()===b&&console.log("WARN may be Prefab bug / String property bug!!"),d.ptr-=2;return d.readUTFBytes(b);case c.AWD_FIELD_VECTOR2x1:case c.AWD_FIELD_VECTOR3x1:case c.AWD_FIELD_VECTOR4x1:case c.AWD_FIELD_MTX3x2:case c.AWD_FIELD_MTX3x3:case c.AWD_FIELD_MTX4x3:case c.AWD_FIELD_MTX4x4:e=8,f=d.F64}if(b>e){var g,h,i;for(g=[],h=0,i=b/e;i>h;)g.push(f.call(d)),h++;return g}return f.call(d)}},b.exports=f}()},{"../bufferReader":267,"../bufferWriter":268,"../consts":270,"./awdString":289}],292:[function(a,b,c){!function(){var c=a("../consts"),d=a("./awdString"),e=a("../bufferWriter"),f=a("../bufferReader"),g=function(){this.attributes={},this._list=[]};g.prototype={clone:function(){var a=new e(64);this.write(a);var b=new g;return b.read(new f(a.buffer)),b},addAttribute:function(a,b,c,d){var e={name:a,value:b,type:c,ns:d};this.attributes[a]=e,this._list.push(e)},read:function(a){var b,e=a.U32();if(e>0){b={};for(var f=a.ptr+e;a.ptr<f;){var g,h=a.U8(),i=d.read(a),j=a.U8(),k=a.U32();switch(j){case c.AWDSTRING:g=a.readUTFBytes(k);break;case c.INT8:g=a.I8();break;case c.INT16:g=a.I16();break;case c.INT32:g=a.I32();break;case c.BOOL:case c.UINT8:g=a.U8();break;case c.UINT16:g=a.U16();break;case c.UINT32:case c.BADDR:g=a.U32();break;case c.FLOAT32:g=a.F32();break;case c.FLOAT64:g=a.F64();break;default:g="unimplemented attribute type "+j+"ns : "+h,a.ptr+=k}this.addAttribute(i,g,j,h),b[i]=g}}return b},write:void 0},b.exports=g}()},{"../bufferReader":267,"../bufferWriter":268,"../consts":270,"./awdString":289}],293:[function(a,b,c){!function(){var c=a("../consts"),d=a("./properties"),e=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0};e.prototype={parsePivot:function(a,b){var e=a.header.matrixNrType,f=new d({1:e,2:e,3:e,4:c.UINT8});f.read(b),this.x=f.get(1,0),this.y=f.get(2,0),this.z=f.get(3,0)},writePivot:void 0},b.exports=e}()},{"../consts":270,"./properties":291}],294:[function(a,b,c){!function(){var c=void a("./bufferWriter");b.exports=c}()},{"./bufferWriter":268}],295:[function(a,b,c){(function(a){var c=a.AudioContext||a.webkitAudioContext,d=a.OfflineAudioContext||a.webkitOfflineAudioContext,e=a.BaseAudioContext||d&&Object.getPrototypeOf(d);b.exports="function"==typeof e&&e.prototype?e:c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],296:[function(a,b,c){(function(d){!function(a){if("object"==typeof c&&void 0!==b)b.exports=a();else{var e;"undefined"!=typeof window?e=window:void 0!==d?e=d:"undefined"!=typeof self&&(e=self),e.CANNON=a()}}(function(){return function b(c,d,e){function f(h,i){if(!d[h]){if(!c[h]){var j="function"==typeof a&&a;if(!i&&j)return j(h,!0);if(g)return g(h,!0);throw new Error("Cannot find module '"+h+"'")}var k=d[h]={exports:{}};c[h][0].call(k.exports,function(a){var b=c[h][1][a];return f(b||a)},k,k.exports,b,c,d,e)}return d[h].exports}for(var g="function"==typeof a&&a,h=0;h<e.length;h++)f(e[h]);return f}({1:[function(a,b,c){b.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(a,b,c){b.exports={version:a("../package.json").version,AABB:a("./collision/AABB"),ArrayCollisionMatrix:a("./collision/ArrayCollisionMatrix"),Body:a("./objects/Body"),Box:a("./shapes/Box"),Broadphase:a("./collision/Broadphase"),Constraint:a("./constraints/Constraint"),ContactEquation:a("./equations/ContactEquation"),Narrowphase:a("./world/Narrowphase"),ConeTwistConstraint:a("./constraints/ConeTwistConstraint"),ContactMaterial:a("./material/ContactMaterial"),ConvexPolyhedron:a("./shapes/ConvexPolyhedron"),Cylinder:a("./shapes/Cylinder"),DistanceConstraint:a("./constraints/DistanceConstraint"),Equation:a("./equations/Equation"),EventTarget:a("./utils/EventTarget"),FrictionEquation:a("./equations/FrictionEquation"),GSSolver:a("./solver/GSSolver"),GridBroadphase:a("./collision/GridBroadphase"),Heightfield:a("./shapes/Heightfield"),HingeConstraint:a("./constraints/HingeConstraint"),LockConstraint:a("./constraints/LockConstraint"),Mat3:a("./math/Mat3"),Material:a("./material/Material"),NaiveBroadphase:a("./collision/NaiveBroadphase"),ObjectCollisionMatrix:a("./collision/ObjectCollisionMatrix"),Pool:a("./utils/Pool"),Particle:a("./shapes/Particle"),Plane:a("./shapes/Plane"),PointToPointConstraint:a("./constraints/PointToPointConstraint"),Quaternion:a("./math/Quaternion"),Ray:a("./collision/Ray"),RaycastVehicle:a("./objects/RaycastVehicle"),RaycastResult:a("./collision/RaycastResult"),RigidVehicle:a("./objects/RigidVehicle"),RotationalEquation:a("./equations/RotationalEquation"),RotationalMotorEquation:a("./equations/RotationalMotorEquation"),SAPBroadphase:a("./collision/SAPBroadphase"),SPHSystem:a("./objects/SPHSystem"),Shape:a("./shapes/Shape"),Solver:a("./solver/Solver"),Sphere:a("./shapes/Sphere"),SplitSolver:a("./solver/SplitSolver"),Spring:a("./objects/Spring"),Trimesh:a("./shapes/Trimesh"),Vec3:a("./math/Vec3"),Vec3Pool:a("./utils/Vec3Pool"),World:a("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(a,b,c){function d(a){a=a||{},this.lowerBound=new e,a.lowerBound&&this.lowerBound.copy(a.lowerBound),this.upperBound=new e,a.upperBound&&this.upperBound.copy(a.upperBound)}var e=a("../math/Vec3");a("../utils/Utils");b.exports=d;var f=new e;d.prototype.setFromPoints=function(a,b,c,d){var e=this.lowerBound,g=this.upperBound,h=c;e.copy(a[0]),h&&h.vmult(e,e),g.copy(e);for(var i=1;i<a.length;i++){var j=a[i];h&&(h.vmult(j,f),j=f),j.x>g.x&&(g.x=j.x),j.x<e.x&&(e.x=j.x),j.y>g.y&&(g.y=j.y),j.y<e.y&&(e.y=j.y),j.z>g.z&&(g.z=j.z),j.z<e.z&&(e.z=j.z)}return b&&(b.vadd(e,e),b.vadd(g,g)),d&&(e.x-=d,e.y-=d,e.z-=d,g.x+=d,g.y+=d,g.z+=d),this},d.prototype.copy=function(a){return this.lowerBound.copy(a.lowerBound),this.upperBound.copy(a.upperBound),this},d.prototype.clone=function(){return(new d).copy(this)},d.prototype.extend=function(a){var b=a.lowerBound.x;this.lowerBound.x>b&&(this.lowerBound.x=b);var c=a.upperBound.x;this.upperBound.x<c&&(this.upperBound.x=c);var b=a.lowerBound.y;this.lowerBound.y>b&&(this.lowerBound.y=b);var c=a.upperBound.y;this.upperBound.y<c&&(this.upperBound.y=c);var b=a.lowerBound.z;this.lowerBound.z>b&&(this.lowerBound.z=b);var c=a.upperBound.z;this.upperBound.z<c&&(this.upperBound.z=c)},d.prototype.overlaps=function(a){var b=this.lowerBound,c=this.upperBound,d=a.lowerBound,e=a.upperBound;return(d.x<=c.x&&c.x<=e.x||b.x<=e.x&&e.x<=c.x)&&(d.y<=c.y&&c.y<=e.y||b.y<=e.y&&e.y<=c.y)&&(d.z<=c.z&&c.z<=e.z||b.z<=e.z&&e.z<=c.z)},d.prototype.contains=function(a){var b=this.lowerBound,c=this.upperBound,d=a.lowerBound,e=a.upperBound;return b.x<=d.x&&c.x>=e.x&&b.y<=d.y&&c.y>=e.y&&b.z<=d.z&&c.z>=e.z},d.prototype.getCorners=function(a,b,c,d,e,f,g,h){var i=this.lowerBound,j=this.upperBound;a.copy(i),b.set(j.x,i.y,i.z),c.set(j.x,j.y,i.z),d.set(i.x,j.y,j.z),e.set(j.x,i.y,i.z),f.set(i.x,j.y,i.z),g.set(i.x,i.y,j.z),h.copy(j)};var g=[new e,new e,new e,new e,new e,new e,new e,new e];d.prototype.toLocalFrame=function(a,b){var c=g,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=c[5],k=c[6],l=c[7];this.getCorners(d,e,f,h,i,j,k,l);for(var m=0;8!==m;m++){var n=c[m];a.pointToLocal(n,n)}return b.setFromPoints(c)},d.prototype.toWorldFrame=function(a,b){var c=g,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=c[5],k=c[6],l=c[7];this.getCorners(d,e,f,h,i,j,k,l);for(var m=0;8!==m;m++){var n=c[m];a.pointToWorld(n,n)}return b.setFromPoints(c)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(a,b,c){function d(){this.matrix=[]}b.exports=d,d.prototype.get=function(a,b){if(a=a.index,(b=b.index)>a){var c=b;b=a,a=c}return this.matrix[(a*(a+1)>>1)+b-1]},d.prototype.set=function(a,b,c){if(a=a.index,(b=b.index)>a){var d=b;b=a,a=d}this.matrix[(a*(a+1)>>1)+b-1]=c?1:0},d.prototype.reset=function(){for(var a=0,b=this.matrix.length;a!==b;a++)this.matrix[a]=0},d.prototype.setNumObjects=function(a){this.matrix.length=a*(a-1)>>1}},{}],5:[function(a,b,c){function d(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var e=a("../objects/Body"),f=a("../math/Vec3"),g=a("../math/Quaternion");a("../shapes/Shape"),a("../shapes/Plane");b.exports=d,d.prototype.collisionPairs=function(a,b,c){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var h=e.STATIC|e.KINEMATIC;d.prototype.needBroadphaseCollision=function(a,b){return 0!=(a.collisionFilterGroup&b.collisionFilterMask)&&0!=(b.collisionFilterGroup&a.collisionFilterMask)&&(0==(a.type&h)&&a.sleepState!==e.SLEEPING||0==(b.type&h)&&b.sleepState!==e.SLEEPING)},d.prototype.intersectionTest=function(a,b,c,d){this.useBoundingBoxes?this.doBoundingBoxBroadphase(a,b,c,d):this.doBoundingSphereBroadphase(a,b,c,d)};var i=new f;new f,new g,new f;d.prototype.doBoundingSphereBroadphase=function(a,b,c,d){var e=i;b.position.vsub(a.position,e);var f=Math.pow(a.boundingRadius+b.boundingRadius,2);e.norm2()<f&&(c.push(a),d.push(b))},d.prototype.doBoundingBoxBroadphase=function(a,b,c,d){a.aabbNeedsUpdate&&a.computeAABB(),b.aabbNeedsUpdate&&b.computeAABB(),a.aabb.overlaps(b.aabb)&&(c.push(a),d.push(b))};var j={keys:[]},k=[],l=[];d.prototype.makePairsUnique=function(a,b){for(var c=j,d=k,e=l,f=a.length,g=0;g!==f;g++)d[g]=a[g],e[g]=b[g];a.length=0,b.length=0;for(var g=0;g!==f;g++){var h=d[g].id,i=e[g].id,m=h<i?h+","+i:i+","+h;c[m]=g,c.keys.push(m)}for(var g=0;g!==c.keys.length;g++){var m=c.keys.pop(),n=c[m];a.push(d[n]),b.push(e[n]),delete c[m]}},d.prototype.setWorld=function(a){};var m=new f;d.boundingSphereCheck=function(a,b){var c=m;return a.position.vsub(b.position,c),Math.pow(a.shape.boundingSphereRadius+b.shape.boundingSphereRadius,2)>c.norm2()},d.prototype.aabbQuery=function(a,b,c){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(a,b,c){function d(a,b,c,d,g){e.apply(this),this.nx=c||10,this.ny=d||10,this.nz=g||10,this.aabbMin=a||new f(100,100,100),this.aabbMax=b||new f(-100,-100,-100);var h=this.nx*this.ny*this.nz;if(h<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=h,this.binLengths.length=h;for(var i=0;i<h;i++)this.bins[i]=[],this.binLengths[i]=0}b.exports=d;var e=a("./Broadphase"),f=a("../math/Vec3"),g=a("../shapes/Shape");d.prototype=new e,d.prototype.constructor=d;var h=new f;new f;d.prototype.collisionPairs=function(a,b,c){function d(a,b,c,d,e,f,g){var h=(a-t)*w|0,i=(b-u)*x|0,j=(c-v)*y|0,q=K((d-t)*w),r=K((e-u)*x),s=K((f-v)*y);h<0?h=0:h>=k&&(h=k-1),i<0?i=0:i>=l&&(i=l-1),j<0?j=0:j>=m&&(j=m-1),q<0?q=0:q>=k&&(q=k-1),r<0?r=0:r>=l&&(r=l-1),s<0?s=0:s>=m&&(s=m-1),h*=n,i*=o,j*=p,q*=n,r*=o,s*=p;for(var z=h;z<=q;z+=n)for(var A=i;A<=r;A+=o)for(var B=j;B<=s;B+=p){var C=z+A+B;G[C][H[C]++]=g}}for(var e=a.numObjects(),f=a.bodies,i=this.aabbMax,j=this.aabbMin,k=this.nx,l=this.ny,m=this.nz,n=l*m,o=m,p=1,q=i.x,r=i.y,s=i.z,t=j.x,u=j.y,v=j.z,w=k/(q-t),x=l/(r-u),y=m/(s-v),z=(q-t)/k,A=(r-u)/l,B=(s-v)/m,C=.5*Math.sqrt(z*z+A*A+B*B),D=g.types,E=D.SPHERE,F=D.PLANE,G=(D.BOX,D.COMPOUND,D.CONVEXPOLYHEDRON,this.bins),H=this.binLengths,I=this.bins.length,J=0;J!==I;J++)H[J]=0;for(var K=Math.ceil,j=Math.min,i=Math.max,J=0;J!==e;J++){var L=f[J],M=L.shape;switch(M.type){case E:var N=L.position.x,O=L.position.y,P=L.position.z,Q=M.radius;d(N-Q,O-Q,P-Q,N+Q,O+Q,P+Q,L);break;case F:M.worldNormalNeedsUpdate&&M.computeWorldNormal(L.quaternion);var R=M.worldNormal,S=t+.5*z-L.position.x,T=u+.5*A-L.position.y,U=v+.5*B-L.position.z,V=h;V.set(S,T,U);for(var W=0,X=0;W!==k;W++,X+=n,V.y=T,V.x+=z)for(var Y=0,Z=0;Y!==l;Y++,Z+=o,V.z=U,V.y+=A)for(var $=0,_=0;$!==m;$++,_+=p,V.z+=B)if(V.dot(R)<C){var aa=X+Z+_;G[aa][H[aa]++]=L}break;default:L.aabbNeedsUpdate&&L.computeAABB(),d(L.aabb.lowerBound.x,L.aabb.lowerBound.y,L.aabb.lowerBound.z,L.aabb.upperBound.x,L.aabb.upperBound.y,L.aabb.upperBound.z,L)}}for(var J=0;J!==I;J++){var ba=H[J];if(ba>1)for(var ca=G[J],W=0;W!==ba;W++)for(var L=ca[W],Y=0;Y!==W;Y++){var da=ca[Y];this.needBroadphaseCollision(L,da)&&this.intersectionTest(L,da,b,c)}}this.makePairsUnique(b,c)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(a,b,c){function d(){e.apply(this)}b.exports=d;var e=a("./Broadphase"),f=a("./AABB");d.prototype=new e,d.prototype.constructor=d,d.prototype.collisionPairs=function(a,b,c){var d,e,f,g,h=a.bodies,i=h.length;for(d=0;d!==i;d++)for(e=0;e!==d;e++)f=h[d],g=h[e],this.needBroadphaseCollision(f,g)&&this.intersectionTest(f,g,b,c)};new f;d.prototype.aabbQuery=function(a,b,c){c=c||[];for(var d=0;d<a.bodies.length;d++){var e=a.bodies[d];e.aabbNeedsUpdate&&e.computeAABB(),e.aabb.overlaps(b)&&c.push(e)}return c}},{"./AABB":3,"./Broadphase":5}],8:[function(a,b,c){function d(){this.matrix={}}b.exports=d,d.prototype.get=function(a,b){if(a=a.id,(b=b.id)>a){var c=b;b=a,a=c}return a+"-"+b in this.matrix},d.prototype.set=function(a,b,c){if(a=a.id,(b=b.id)>a){var d=b;b=a,a=d}c?this.matrix[a+"-"+b]=!0:delete this.matrix[a+"-"+b]},d.prototype.reset=function(){this.matrix={}},d.prototype.setNumObjects=function(a){}},{}],9:[function(a,b,c){function d(a,b){this.from=a?a.clone():new g,this.to=b?b.clone():new g,this._direction=new g,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=d.ANY,this.result=new j,this.hasHit=!1,this.callback=function(a){}}function e(a,b,c,d){d.vsub(b,J),c.vsub(b,o),a.vsub(b,p);var e,f,g=J.dot(J),h=J.dot(o),i=J.dot(p),j=o.dot(o),k=o.dot(p);return(e=j*i-h*k)>=0&&(f=g*k-h*i)>=0&&e+f<g*j-h*h}function f(a,b,c){c.vsub(a,J);var d=J.dot(b);return b.mult(d,K),K.vadd(a,K),c.distanceTo(K)}b.exports=d;var g=a("../math/Vec3"),h=a("../math/Quaternion"),i=a("../math/Transform"),j=(a("../shapes/ConvexPolyhedron"),a("../shapes/Box"),a("../collision/RaycastResult")),k=a("../shapes/Shape"),l=a("../collision/AABB");d.prototype.constructor=d,d.CLOSEST=1,d.ANY=2,d.ALL=4;var m=new l,n=[];d.prototype.intersectWorld=function(a,b){return this.mode=b.mode||d.ANY,this.result=b.result||new j,this.skipBackfaces=!!b.skipBackfaces,this.collisionFilterMask=void 0!==b.collisionFilterMask?b.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==b.collisionFilterGroup?b.collisionFilterGroup:-1,b.from&&this.from.copy(b.from),b.to&&this.to.copy(b.to),this.callback=b.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(m),n.length=0,a.broadphase.aabbQuery(a,m,n),this.intersectBodies(n),this.hasHit};var o=new g,p=new g;d.pointInTriangle=e;var q=new g,r=new h;d.prototype.intersectBody=function(a,b){b&&(this.result=b,this._updateDirection());var c=this.checkCollisionResponse;if((!c||a.collisionResponse)&&0!=(this.collisionFilterGroup&a.collisionFilterMask)&&0!=(a.collisionFilterGroup&this.collisionFilterMask))for(var d=q,e=r,f=0,g=a.shapes.length;f<g;f++){var h=a.shapes[f];if((!c||h.collisionResponse)&&(a.quaternion.mult(a.shapeOrientations[f],e),a.quaternion.vmult(a.shapeOffsets[f],d),d.vadd(a.position,d),this.intersectShape(h,e,d,a),this.result._shouldStop))break}},d.prototype.intersectBodies=function(a,b){b&&(this.result=b,this._updateDirection());for(var c=0,d=a.length;!this.result._shouldStop&&c<d;c++)this.intersectBody(a[c])},d.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},d.prototype.intersectShape=function(a,b,c,d){if(!(f(this.from,this._direction,c)>a.boundingSphereRadius)){var e=this[a.type];e&&e.call(this,a,b,c,d)}};var s=(new g,new g,new g),t=new g,u=new g,v=new g;new g,new j;d.prototype.intersectBox=function(a,b,c,d){return this.intersectConvex(a.convexPolyhedronRepresentation,b,c,d)},d.prototype[k.types.BOX]=d.prototype.intersectBox,d.prototype.intersectPlane=function(a,b,c,d){var e=this.from,f=this.to,h=this._direction,i=new g(0,0,1);b.vmult(i,i);var j=new g;e.vsub(c,j);var k=j.dot(i);if(f.vsub(c,j),!(k*j.dot(i)>0||e.distanceTo(f)<k)){var l=i.dot(h);if(!(Math.abs(l)<this.precision)){var m=new g,n=new g,o=new g;e.vsub(c,m);var p=-i.dot(m)/l;h.scale(p,n),e.vadd(n,o),this.reportIntersection(i,o,a,d,-1)}}},d.prototype[k.types.PLANE]=d.prototype.intersectPlane,d.prototype.getAABB=function(a){var b=this.to,c=this.from;a.lowerBound.x=Math.min(b.x,c.x),a.lowerBound.y=Math.min(b.y,c.y),a.lowerBound.z=Math.min(b.z,c.z),a.upperBound.x=Math.max(b.x,c.x),a.upperBound.y=Math.max(b.y,c.y),a.upperBound.z=Math.max(b.z,c.z)};var w={faceList:[0]};d.prototype.intersectHeightfield=function(a,b,c,e){var f=(a.data,a.elementSize,new g),h=new d(this.from,this.to);i.pointToLocalFrame(c,b,h.from,h.from),i.pointToLocalFrame(c,b,h.to,h.to);var j=[],k=null,l=null,m=null,n=null,o=a.getIndexOfPosition(h.from.x,h.from.y,j,!1);if(o&&(k=j[0],l=j[1],m=j[0],n=j[1]),o=a.getIndexOfPosition(h.to.x,h.to.y,j,!1),o&&((null===k||j[0]<k)&&(k=j[0]),(null===m||j[0]>m)&&(m=j[0]),(null===l||j[1]<l)&&(l=j[1]),(null===n||j[1]>n)&&(n=j[1])),null!==k){var p=[];a.getRectMinMax(k,l,m,n,p);for(var q=k;q<=m;q++)for(var r=l;r<=n;r++){if(this.result._shouldStop)return;if(a.getConvexTrianglePillar(q,r,!1),i.pointToWorldFrame(c,b,a.pillarOffset,f),this.intersectConvex(a.pillarConvex,b,f,e,w),this.result._shouldStop)return;a.getConvexTrianglePillar(q,r,!0),i.pointToWorldFrame(c,b,a.pillarOffset,f),this.intersectConvex(a.pillarConvex,b,f,e,w)}}},d.prototype[k.types.HEIGHTFIELD]=d.prototype.intersectHeightfield;var x=new g,y=new g;d.prototype.intersectSphere=function(a,b,c,d){var e=this.from,f=this.to,g=a.radius,h=Math.pow(f.x-e.x,2)+Math.pow(f.y-e.y,2)+Math.pow(f.z-e.z,2),i=2*((f.x-e.x)*(e.x-c.x)+(f.y-e.y)*(e.y-c.y)+(f.z-e.z)*(e.z-c.z)),j=Math.pow(e.x-c.x,2)+Math.pow(e.y-c.y,2)+Math.pow(e.z-c.z,2)-Math.pow(g,2),k=Math.pow(i,2)-4*h*j,l=x,m=y;if(!(k<0))if(0===k)e.lerp(f,k,l),l.vsub(c,m),m.normalize(),this.reportIntersection(m,l,a,d,-1);else{var n=(-i-Math.sqrt(k))/(2*h),o=(-i+Math.sqrt(k))/(2*h);if(n>=0&&n<=1&&(e.lerp(f,n,l),l.vsub(c,m),m.normalize(),this.reportIntersection(m,l,a,d,-1)),this.result._shouldStop)return;o>=0&&o<=1&&(e.lerp(f,o,l),l.vsub(c,m),m.normalize(),this.reportIntersection(m,l,a,d,-1))}},d.prototype[k.types.SPHERE]=d.prototype.intersectSphere;var z=new g,A=(new g,new g,new g);d.prototype.intersectConvex=function(a,b,c,d,f){for(var g=z,h=A,i=f&&f.faceList||null,j=a.faces,k=a.vertices,l=a.faceNormals,m=this._direction,n=this.from,o=this.to,p=n.distanceTo(o),q=i?i.length:j.length,r=this.result,w=0;!r._shouldStop&&w<q;w++){var x=i?i[w]:w,y=j[x],B=l[x],C=b,D=c;h.copy(k[y[0]]),C.vmult(h,h),h.vadd(D,h),h.vsub(n,h),C.vmult(B,g);var E=m.dot(g);if(!(Math.abs(E)<this.precision)){var F=g.dot(h)/E;if(!(F<0)){m.mult(F,s),s.vadd(n,s),t.copy(k[y[0]]),C.vmult(t,t),D.vadd(t,t);for(var G=1;!r._shouldStop&&G<y.length-1;G++){u.copy(k[y[G]]),v.copy(k[y[G+1]]),C.vmult(u,u),C.vmult(v,v),D.vadd(u,u),D.vadd(v,v);var H=s.distanceTo(n);!e(s,t,u,v)&&!e(s,u,t,v)||H>p||this.reportIntersection(g,s,a,d,x)}}}}},d.prototype[k.types.CONVEXPOLYHEDRON]=d.prototype.intersectConvex;var B=new g,C=new g,D=new g,E=new g,F=new g,G=new g,H=(new l,[]),I=new i;d.prototype.intersectTrimesh=function(a,b,c,d,f){var g=B,h=H,j=I,k=A,l=C,m=D,n=E,o=G,p=F,q=(f&&f.faceList,a.indices),r=(a.vertices,a.faceNormals,this.from),w=this.to,x=this._direction;j.position.copy(c),j.quaternion.copy(b),i.vectorToLocalFrame(c,b,x,l),i.pointToLocalFrame(c,b,r,m),i.pointToLocalFrame(c,b,w,n);var y=m.distanceSquared(n);a.tree.rayQuery(this,j,h);for(var z=0,J=h.length;!this.result._shouldStop&&z!==J;z++){var K=h[z];a.getNormal(K,g),a.getVertex(q[3*K],t),t.vsub(m,k);var L=l.dot(g),M=g.dot(k)/L;if(!(M<0)){l.scale(M,s),s.vadd(m,s),a.getVertex(q[3*K+1],u),a.getVertex(q[3*K+2],v);var N=s.distanceSquared(m);!e(s,u,t,v)&&!e(s,t,u,v)||N>y||(i.vectorToWorldFrame(b,g,p),i.pointToWorldFrame(c,b,s,o),this.reportIntersection(p,o,a,d,K))}}h.length=0},d.prototype[k.types.TRIMESH]=d.prototype.intersectTrimesh,d.prototype.reportIntersection=function(a,b,c,e,f){var g=this.from,h=this.to,i=g.distanceTo(b),j=this.result;if(!(this.skipBackfaces&&a.dot(this._direction)>0))switch(j.hitFaceIndex=void 0!==f?f:-1,this.mode){case d.ALL:this.hasHit=!0,j.set(g,h,a,b,c,e,i),j.hasHit=!0,this.callback(j);break;case d.CLOSEST:(i<j.distance||!j.hasHit)&&(this.hasHit=!0,j.hasHit=!0,j.set(g,h,a,b,c,e,i));break;case d.ANY:this.hasHit=!0,j.hasHit=!0,j.set(g,h,a,b,c,e,i),j._shouldStop=!0}};var J=new g,K=new g},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(a,b,c){function d(){this.rayFromWorld=new e,this.rayToWorld=new e,this.hitNormalWorld=new e,this.hitPointWorld=new e,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var e=a("../math/Vec3");b.exports=d,d.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},d.prototype.abort=function(){this._shouldStop=!0},d.prototype.set=function(a,b,c,d,e,f,g){this.rayFromWorld.copy(a),this.rayToWorld.copy(b),this.hitNormalWorld.copy(c),this.hitPointWorld.copy(d),this.shape=e,this.body=f,this.distance=g}},{"../math/Vec3":30}],11:[function(a,b,c){function d(a){e.apply(this),this.axisList=[],this.world=null,
this.axisIndex=0;var b=this.axisList;this._addBodyHandler=function(a){b.push(a.body)},this._removeBodyHandler=function(a){var c=b.indexOf(a.body);-1!==c&&b.splice(c,1)},a&&this.setWorld(a)}var e=(a("../shapes/Shape"),a("../collision/Broadphase"));b.exports=d,d.prototype=new e,d.prototype.setWorld=function(a){this.axisList.length=0;for(var b=0;b<a.bodies.length;b++)this.axisList.push(a.bodies[b]);a.removeEventListener("addBody",this._addBodyHandler),a.removeEventListener("removeBody",this._removeBodyHandler),a.addEventListener("addBody",this._addBodyHandler),a.addEventListener("removeBody",this._removeBodyHandler),this.world=a,this.dirty=!0},d.insertionSortX=function(a){for(var b=1,c=a.length;b<c;b++){for(var d=a[b],e=b-1;e>=0&&!(a[e].aabb.lowerBound.x<=d.aabb.lowerBound.x);e--)a[e+1]=a[e];a[e+1]=d}return a},d.insertionSortY=function(a){for(var b=1,c=a.length;b<c;b++){for(var d=a[b],e=b-1;e>=0&&!(a[e].aabb.lowerBound.y<=d.aabb.lowerBound.y);e--)a[e+1]=a[e];a[e+1]=d}return a},d.insertionSortZ=function(a){for(var b=1,c=a.length;b<c;b++){for(var d=a[b],e=b-1;e>=0&&!(a[e].aabb.lowerBound.z<=d.aabb.lowerBound.z);e--)a[e+1]=a[e];a[e+1]=d}return a},d.prototype.collisionPairs=function(a,b,c){var e,f,g=this.axisList,h=g.length,i=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),e=0;e!==h;e++){var j=g[e];for(f=e+1;f<h;f++){var k=g[f];if(this.needBroadphaseCollision(j,k)){if(!d.checkBounds(j,k,i))break;this.intersectionTest(j,k,b,c)}}}},d.prototype.sortList=function(){for(var a=this.axisList,b=this.axisIndex,c=a.length,e=0;e!==c;e++){var f=a[e];f.aabbNeedsUpdate&&f.computeAABB()}0===b?d.insertionSortX(a):1===b?d.insertionSortY(a):2===b&&d.insertionSortZ(a)},d.checkBounds=function(a,b,c){var d,e;0===c?(d=a.position.x,e=b.position.x):1===c?(d=a.position.y,e=b.position.y):2===c&&(d=a.position.z,e=b.position.z);var f=a.boundingRadius,g=b.boundingRadius,h=d+f,i=e-g;return i<h},d.prototype.autoDetectAxis=function(){for(var a=0,b=0,c=0,d=0,e=0,f=0,g=this.axisList,h=g.length,i=1/h,j=0;j!==h;j++){var k=g[j],l=k.position.x;a+=l,b+=l*l;var m=k.position.y;c+=m,d+=m*m;var n=k.position.z;e+=n,f+=n*n}var o=b-a*a*i,p=d-c*c*i,q=f-e*e*i;this.axisIndex=o>p?o>q?0:2:p>q?1:2},d.prototype.aabbQuery=function(a,b,c){c=c||[],this.dirty&&(this.sortList(),this.dirty=!1);var d=this.axisIndex,e="x";1===d&&(e="y"),2===d&&(e="z");for(var f=this.axisList,g=(b.lowerBound[e],b.upperBound[e],0);g<f.length;g++){var h=f[g];h.aabbNeedsUpdate&&h.computeAABB(),h.aabb.overlaps(b)&&c.push(h)}return c}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(a,b,c){function d(a,b,c){c=c||{};var d=void 0!==c.maxForce?c.maxForce:1e6,i=c.pivotA?c.pivotA.clone():new h,j=c.pivotB?c.pivotB.clone():new h;this.axisA=c.axisA?c.axisA.clone():new h,this.axisB=c.axisB?c.axisB.clone():new h,e.call(this,a,i,b,j,d),this.collideConnected=!!c.collideConnected,this.angle=void 0!==c.angle?c.angle:0;var k=this.coneEquation=new f(a,b,c),l=this.twistEquation=new g(a,b,c);this.twistAngle=void 0!==c.twistAngle?c.twistAngle:0,k.maxForce=0,k.minForce=-d,l.maxForce=0,l.minForce=-d,this.equations.push(k,l)}b.exports=d;var e=(a("./Constraint"),a("./PointToPointConstraint")),f=a("../equations/ConeEquation"),g=a("../equations/RotationalEquation"),h=(a("../equations/ContactEquation"),a("../math/Vec3"));d.prototype=new e,d.constructor=d;new h,new h;d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.coneEquation,d=this.twistEquation;e.prototype.update.call(this),a.vectorToWorldFrame(this.axisA,c.axisA),b.vectorToWorldFrame(this.axisB,c.axisB),this.axisA.tangents(d.axisA,d.axisA),a.vectorToWorldFrame(d.axisA,d.axisA),this.axisB.tangents(d.axisB,d.axisB),b.vectorToWorldFrame(d.axisB,d.axisB),c.angle=this.angle,d.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(a,b,c){function d(a,b,c){c=e.defaults(c,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=a,this.bodyB=b,this.id=d.idCounter++,this.collideConnected=c.collideConnected,c.wakeUpBodies&&(a&&a.wakeUp(),b&&b.wakeUp())}b.exports=d;var e=a("../utils/Utils");d.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},d.prototype.enable=function(){for(var a=this.equations,b=0;b<a.length;b++)a[b].enabled=!0},d.prototype.disable=function(){for(var a=this.equations,b=0;b<a.length;b++)a[b].enabled=!1},d.idCounter=0},{"../utils/Utils":53}],14:[function(a,b,c){function d(a,b,c,d){e.call(this,a,b),void 0===c&&(c=a.position.distanceTo(b.position)),void 0===d&&(d=1e6),this.distance=c;var g=this.distanceEquation=new f(a,b);this.equations.push(g),g.minForce=-d,g.maxForce=d}b.exports=d;var e=a("./Constraint"),f=a("../equations/ContactEquation");d.prototype=new e,d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.distanceEquation,d=.5*this.distance,e=c.ni;b.position.vsub(a.position,e),e.normalize(),e.mult(d,c.ri),e.mult(-d,c.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(a,b,c){function d(a,b,c){c=c||{};var d=void 0!==c.maxForce?c.maxForce:1e6,i=c.pivotA?c.pivotA.clone():new h,j=c.pivotB?c.pivotB.clone():new h;e.call(this,a,i,b,j,d),(this.axisA=c.axisA?c.axisA.clone():new h(1,0,0)).normalize(),(this.axisB=c.axisB?c.axisB.clone():new h(1,0,0)).normalize();var k=this.rotationalEquation1=new f(a,b,c),l=this.rotationalEquation2=new f(a,b,c),m=this.motorEquation=new g(a,b,d);m.enabled=!1,this.equations.push(k,l,m)}b.exports=d;var e=(a("./Constraint"),a("./PointToPointConstraint")),f=a("../equations/RotationalEquation"),g=a("../equations/RotationalMotorEquation"),h=(a("../equations/ContactEquation"),a("../math/Vec3"));d.prototype=new e,d.constructor=d,d.prototype.enableMotor=function(){this.motorEquation.enabled=!0},d.prototype.disableMotor=function(){this.motorEquation.enabled=!1},d.prototype.setMotorSpeed=function(a){this.motorEquation.targetVelocity=a},d.prototype.setMotorMaxForce=function(a){this.motorEquation.maxForce=a,this.motorEquation.minForce=-a};var i=new h,j=new h;d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.motorEquation,d=this.rotationalEquation1,f=this.rotationalEquation2,g=i,h=j,k=this.axisA,l=this.axisB;e.prototype.update.call(this),a.quaternion.vmult(k,g),b.quaternion.vmult(l,h),g.tangents(d.axisA,f.axisA),d.axisB.copy(h),f.axisB.copy(h),this.motorEquation.enabled&&(a.quaternion.vmult(this.axisA,c.axisA),b.quaternion.vmult(this.axisB,c.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(a,b,c){function d(a,b,c){c=c||{};var d=void 0!==c.maxForce?c.maxForce:1e6,h=new g,i=new g,j=new g;a.position.vadd(b.position,j),j.scale(.5,j),b.pointToLocalFrame(j,i),a.pointToLocalFrame(j,h),e.call(this,a,h,b,i,d);var k=this.rotationalEquation1=new f(a,b,c),l=this.rotationalEquation2=new f(a,b,c),m=this.rotationalEquation3=new f(a,b,c);this.equations.push(k,l,m)}b.exports=d;var e=(a("./Constraint"),a("./PointToPointConstraint")),f=a("../equations/RotationalEquation"),g=(a("../equations/RotationalMotorEquation"),a("../equations/ContactEquation"),a("../math/Vec3"));d.prototype=new e,d.constructor=d;new g,new g;d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=(this.motorEquation,this.rotationalEquation1),d=this.rotationalEquation2,f=this.rotationalEquation3;e.prototype.update.call(this),a.vectorToWorldFrame(g.UNIT_X,c.axisA),b.vectorToWorldFrame(g.UNIT_Y,c.axisB),a.vectorToWorldFrame(g.UNIT_Y,d.axisA),b.vectorToWorldFrame(g.UNIT_Z,d.axisB),a.vectorToWorldFrame(g.UNIT_Z,f.axisA),b.vectorToWorldFrame(g.UNIT_X,f.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(a,b,c){function d(a,b,c,d,h){e.call(this,a,c),h=void 0!==h?h:1e6,this.pivotA=b?b.clone():new g,this.pivotB=d?d.clone():new g;var i=this.equationX=new f(a,c),j=this.equationY=new f(a,c),k=this.equationZ=new f(a,c);this.equations.push(i,j,k),i.minForce=j.minForce=k.minForce=-h,i.maxForce=j.maxForce=k.maxForce=h,i.ni.set(1,0,0),j.ni.set(0,1,0),k.ni.set(0,0,1)}b.exports=d;var e=a("./Constraint"),f=a("../equations/ContactEquation"),g=a("../math/Vec3");d.prototype=new e,d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.equationX,d=this.equationY,e=this.equationZ;a.quaternion.vmult(this.pivotA,c.ri),b.quaternion.vmult(this.pivotB,c.rj),d.ri.copy(c.ri),d.rj.copy(c.rj),e.ri.copy(c.ri),e.rj.copy(c.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(a,b,c){function d(a,b,c){c=c||{};var d=void 0!==c.maxForce?c.maxForce:1e6;f.call(this,a,b,-d,d),this.axisA=c.axisA?c.axisA.clone():new e(1,0,0),this.axisB=c.axisB?c.axisB.clone():new e(0,1,0),this.angle=void 0!==c.angle?c.angle:0}b.exports=d;var e=a("../math/Vec3"),f=(a("../math/Mat3"),a("./Equation"));d.prototype=new f,d.prototype.constructor=d;var g=new e,h=new e;d.prototype.computeB=function(a){var b=this.a,c=this.b,d=this.axisA,e=this.axisB,f=g,i=h,j=this.jacobianElementA,k=this.jacobianElementB;return d.cross(e,f),e.cross(d,i),j.rotational.copy(i),k.rotational.copy(f),-(Math.cos(this.angle)-d.dot(e))*b-this.computeGW()*c-a*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(a,b,c){function d(a,b,c){c=void 0!==c?c:1e6,e.call(this,a,b,0,c),this.restitution=0,this.ri=new f,this.rj=new f,this.ni=new f}b.exports=d;var e=a("./Equation"),f=a("../math/Vec3");a("../math/Mat3");d.prototype=new e,d.prototype.constructor=d;var g=new f,h=new f,i=new f;d.prototype.computeB=function(a){var b=this.a,c=this.b,d=this.bi,e=this.bj,f=this.ri,j=this.rj,k=g,l=h,m=d.velocity,n=d.angularVelocity,o=(d.force,d.torque,e.velocity),p=e.angularVelocity,q=(e.force,e.torque,i),r=this.jacobianElementA,s=this.jacobianElementB,t=this.ni;f.cross(t,k),j.cross(t,l),t.negate(r.spatial),k.negate(r.rotational),s.spatial.copy(t),s.rotational.copy(l),q.copy(e.position),q.vadd(j,q),q.vsub(d.position,q),q.vsub(f,q);var u=t.dot(q),v=this.restitution+1;return-u*b-(v*o.dot(t)-v*m.dot(t)+p.dot(l)-n.dot(k))*c-a*this.computeGiMf()};var j=new f,k=new f,l=new f,m=new f,n=new f;d.prototype.getImpactVelocityAlongNormal=function(){var a=j,b=k,c=l,d=m,e=n;return this.bi.position.vadd(this.ri,c),this.bj.position.vadd(this.rj,d),this.bi.getVelocityAtWorldPoint(c,a),this.bj.getVelocityAtWorldPoint(d,b),a.vsub(b,e),this.ni.dot(e)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(a,b,c){function d(a,b,c,f){this.id=d.id++,this.minForce=void 0===c?-1e6:c,this.maxForce=void 0===f?1e6:f,this.bi=a,this.bj=b,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new e,this.jacobianElementB=new e,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}b.exports=d;var e=a("../math/JacobianElement"),f=a("../math/Vec3");d.prototype.constructor=d,d.id=0,d.prototype.setSpookParams=function(a,b,c){var d=b,e=a,f=c;this.a=4/(f*(1+4*d)),this.b=4*d/(1+4*d),this.eps=4/(f*f*e*(1+4*d))},d.prototype.computeB=function(a,b,c){var d=this.computeGW();return-this.computeGq()*a-d*b-this.computeGiMf()*c},d.prototype.computeGq=function(){var a=this.jacobianElementA,b=this.jacobianElementB,c=this.bi,d=this.bj,e=c.position,f=d.position;return a.spatial.dot(e)+b.spatial.dot(f)};var g=new f;d.prototype.computeGW=function(){var a=this.jacobianElementA,b=this.jacobianElementB,c=this.bi,d=this.bj,e=c.velocity,f=d.velocity,h=c.angularVelocity||g,i=d.angularVelocity||g;return a.multiplyVectors(e,h)+b.multiplyVectors(f,i)},d.prototype.computeGWlambda=function(){var a=this.jacobianElementA,b=this.jacobianElementB,c=this.bi,d=this.bj,e=c.vlambda,f=d.vlambda,h=c.wlambda||g,i=d.wlambda||g;return a.multiplyVectors(e,h)+b.multiplyVectors(f,i)};var h=new f,i=new f,j=new f,k=new f;d.prototype.computeGiMf=function(){var a=this.jacobianElementA,b=this.jacobianElementB,c=this.bi,d=this.bj,e=c.force,f=c.torque,g=d.force,l=d.torque,m=c.invMassSolve,n=d.invMassSolve;return c.invInertiaWorldSolve?c.invInertiaWorldSolve.vmult(f,j):j.set(0,0,0),d.invInertiaWorldSolve?d.invInertiaWorldSolve.vmult(l,k):k.set(0,0,0),e.mult(m,h),g.mult(n,i),a.multiplyVectors(h,j)+b.multiplyVectors(i,k)};var l=new f;d.prototype.computeGiMGt=function(){var a=this.jacobianElementA,b=this.jacobianElementB,c=this.bi,d=this.bj,e=c.invMassSolve,f=d.invMassSolve,g=c.invInertiaWorldSolve,h=d.invInertiaWorldSolve,i=e+f;return g&&(g.vmult(a.rotational,l),i+=l.dot(a.rotational)),h&&(h.vmult(b.rotational,l),i+=l.dot(b.rotational)),i};var m=new f;new f,new f,new f,new f,new f;d.prototype.addToWlambda=function(a){var b=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,e=this.bj,f=m;b.spatial.mult(d.invMassSolve*a,f),d.vlambda.vadd(f,d.vlambda),c.spatial.mult(e.invMassSolve*a,f),e.vlambda.vadd(f,e.vlambda),d.invInertiaWorldSolve&&(d.invInertiaWorldSolve.vmult(b.rotational,f),f.mult(a,f),d.wlambda.vadd(f,d.wlambda)),e.invInertiaWorldSolve&&(e.invInertiaWorldSolve.vmult(c.rotational,f),f.mult(a,f),e.wlambda.vadd(f,e.wlambda))},d.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(a,b,c){function d(a,b,c){e.call(this,a,b,-c,c),this.ri=new f,this.rj=new f,this.t=new f}b.exports=d;var e=a("./Equation"),f=a("../math/Vec3");a("../math/Mat3");d.prototype=new e,d.prototype.constructor=d;var g=new f,h=new f;d.prototype.computeB=function(a){var b=(this.a,this.b),c=(this.bi,this.bj,this.ri),d=this.rj,e=g,f=h,i=this.t;c.cross(i,e),d.cross(i,f);var j=this.jacobianElementA,k=this.jacobianElementB;return i.negate(j.spatial),e.negate(j.rotational),k.spatial.copy(i),k.rotational.copy(f),-this.computeGW()*b-a*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(a,b,c){function d(a,b,c){c=c||{};var d=void 0!==c.maxForce?c.maxForce:1e6;f.call(this,a,b,-d,d),this.axisA=c.axisA?c.axisA.clone():new e(1,0,0),this.axisB=c.axisB?c.axisB.clone():new e(0,1,0),this.maxAngle=Math.PI/2}b.exports=d;var e=a("../math/Vec3"),f=(a("../math/Mat3"),a("./Equation"));d.prototype=new f,d.prototype.constructor=d;var g=new e,h=new e;d.prototype.computeB=function(a){var b=this.a,c=this.b,d=this.axisA,e=this.axisB,f=g,i=h,j=this.jacobianElementA,k=this.jacobianElementB;return d.cross(e,f),e.cross(d,i),j.rotational.copy(i),k.rotational.copy(f),-(Math.cos(this.maxAngle)-d.dot(e))*b-this.computeGW()*c-a*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(a,b,c){function d(a,b,c){c=void 0!==c?c:1e6,f.call(this,a,b,-c,c),this.axisA=new e,this.axisB=new e,this.targetVelocity=0}b.exports=d;var e=a("../math/Vec3"),f=(a("../math/Mat3"),a("./Equation"));d.prototype=new f,d.prototype.constructor=d,d.prototype.computeB=function(a){var b=(this.a,this.b),c=(this.bi,this.bj,this.axisA),d=this.axisB,e=this.jacobianElementA,f=this.jacobianElementB;return e.rotational.copy(c),d.negate(f.rotational),-(this.computeGW()-this.targetVelocity)*b-a*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(a,b,c){function d(a,b,c){c=e.defaults(c,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=d.idCounter++,this.materials=[a,b],this.friction=c.friction,this.restitution=c.restitution,this.contactEquationStiffness=c.contactEquationStiffness,this.contactEquationRelaxation=c.contactEquationRelaxation,this.frictionEquationStiffness=c.frictionEquationStiffness,this.frictionEquationRelaxation=c.frictionEquationRelaxation}var e=a("../utils/Utils");b.exports=d,d.idCounter=0},{"../utils/Utils":53}],25:[function(a,b,c){function d(a){var b="";a=a||{},"string"==typeof a?(b=a,a={}):"object"==typeof a&&(b=""),this.name=b,this.id=d.idCounter++,this.friction=void 0!==a.friction?a.friction:-1,this.restitution=void 0!==a.restitution?a.restitution:-1}b.exports=d,d.idCounter=0},{}],26:[function(a,b,c){function d(){this.spatial=new e,this.rotational=new e}b.exports=d;var e=a("./Vec3");d.prototype.multiplyElement=function(a){return a.spatial.dot(this.spatial)+a.rotational.dot(this.rotational)},d.prototype.multiplyVectors=function(a,b){return a.dot(this.spatial)+b.dot(this.rotational)}},{"./Vec3":30}],27:[function(a,b,c){function d(a){this.elements=a||[0,0,0,0,0,0,0,0,0]}b.exports=d;var e=a("./Vec3");d.prototype.identity=function(){var a=this.elements;a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1},d.prototype.setZero=function(){var a=this.elements;a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a[8]=0},d.prototype.setTrace=function(a){var b=this.elements;b[0]=a.x,b[4]=a.y,b[8]=a.z},d.prototype.getTrace=function(a){var a=a||new e,b=this.elements;a.x=b[0],a.y=b[4],a.z=b[8]},d.prototype.vmult=function(a,b){b=b||new e;var c=this.elements,d=a.x,f=a.y,g=a.z;return b.x=c[0]*d+c[1]*f+c[2]*g,b.y=c[3]*d+c[4]*f+c[5]*g,b.z=c[6]*d+c[7]*f+c[8]*g,b},d.prototype.smult=function(a){for(var b=0;b<this.elements.length;b++)this.elements[b]*=a},d.prototype.mmult=function(a,b){for(var c=b||new d,e=0;e<3;e++)for(var f=0;f<3;f++){for(var g=0,h=0;h<3;h++)g+=a.elements[e+3*h]*this.elements[h+3*f];c.elements[e+3*f]=g}return c},d.prototype.scale=function(a,b){b=b||new d;for(var c=this.elements,e=b.elements,f=0;3!==f;f++)e[3*f+0]=a.x*c[3*f+0],e[3*f+1]=a.y*c[3*f+1],e[3*f+2]=a.z*c[3*f+2];return b},d.prototype.solve=function(a,b){b=b||new e;for(var c=[],d=0;d<12;d++)c.push(0);var d,f;for(d=0;d<3;d++)for(f=0;f<3;f++)c[d+4*f]=this.elements[d+3*f];c[3]=a.x,c[7]=a.y,c[11]=a.z;var g,h,i=3,j=i;do{if(d=j-i,0===c[d+4*d])for(f=d+1;f<j;f++)if(0!==c[d+4*f]){g=4;do{h=4-g,c[h+4*d]+=c[h+4*f]}while(--g);break}if(0!==c[d+4*d])for(f=d+1;f<j;f++){var k=c[d+4*f]/c[d+4*d];g=4;do{h=4-g,c[h+4*f]=h<=d?0:c[h+4*f]-c[h+4*d]*k}while(--g)}}while(--i);if(b.z=c[11]/c[10],b.y=(c[7]-c[6]*b.z)/c[5],b.x=(c[3]-c[2]*b.z-c[1]*b.y)/c[0],isNaN(b.x)||isNaN(b.y)||isNaN(b.z)||b.x===1/0||b.y===1/0||b.z===1/0)throw"Could not solve equation! Got x=["+b.toString()+"], b=["+a.toString()+"], A=["+this.toString()+"]";return b},d.prototype.e=function(a,b,c){if(void 0===c)return this.elements[b+3*a];this.elements[b+3*a]=c},d.prototype.copy=function(a){for(var b=0;b<a.elements.length;b++)this.elements[b]=a.elements[b];return this},d.prototype.toString=function(){for(var a="",b=0;b<9;b++)a+=this.elements[b]+",";return a},d.prototype.reverse=function(a){a=a||new d;for(var b=[],c=0;c<18;c++)b.push(0);var c,e;for(c=0;c<3;c++)for(e=0;e<3;e++)b[c+6*e]=this.elements[c+3*e];b[3]=1,b[9]=0,b[15]=0,b[4]=0,b[10]=1,b[16]=0,b[5]=0,b[11]=0,b[17]=1;var f,g,h=3,i=h;do{if(c=i-h,0===b[c+6*c])for(e=c+1;e<i;e++)if(0!==b[c+6*e]){f=6;do{g=6-f,b[g+6*c]+=b[g+6*e]}while(--f);break}if(0!==b[c+6*c])for(e=c+1;e<i;e++){var j=b[c+6*e]/b[c+6*c];f=6;do{g=6-f,b[g+6*e]=g<=c?0:b[g+6*e]-b[g+6*c]*j}while(--f)}}while(--h);c=2;do{e=c-1;do{var j=b[c+6*e]/b[c+6*c];f=6;do{g=6-f,b[g+6*e]=b[g+6*e]-b[g+6*c]*j}while(--f)}while(e--)}while(--c);c=2;do{var j=1/b[c+6*c];f=6;do{g=6-f,b[g+6*c]=b[g+6*c]*j}while(--f)}while(c--);c=2;do{e=2;do{if(g=b[3+e+6*c],isNaN(g)||g===1/0)throw"Could not reverse! A=["+this.toString()+"]";a.e(c,e,g)}while(e--)}while(c--);return a},d.prototype.setRotationFromQuaternion=function(a){var b=a.x,c=a.y,d=a.z,e=a.w,f=b+b,g=c+c,h=d+d,i=b*f,j=b*g,k=b*h,l=c*g,m=c*h,n=d*h,o=e*f,p=e*g,q=e*h,r=this.elements;return r[0]=1-(l+n),r[1]=j-q,r[2]=k+p,r[3]=j+q,r[4]=1-(i+n),r[5]=m-o,r[6]=k-p,r[7]=m+o,r[8]=1-(i+l),this},d.prototype.transpose=function(a){a=a||new d;for(var b=a.elements,c=this.elements,e=0;3!==e;e++)for(var f=0;3!==f;f++)b[3*e+f]=c[3*f+e];return a}},{"./Vec3":30}],28:[function(a,b,c){function d(a,b,c,d){this.x=void 0!==a?a:0,this.y=void 0!==b?b:0,this.z=void 0!==c?c:0,this.w=void 0!==d?d:1}b.exports=d;var e=a("./Vec3");d.prototype.set=function(a,b,c,d){this.x=a,this.y=b,this.z=c,this.w=d},d.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},d.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},d.prototype.setFromAxisAngle=function(a,b){var c=Math.sin(.5*b);this.x=a.x*c,this.y=a.y*c,this.z=a.z*c,this.w=Math.cos(.5*b)},d.prototype.toAxisAngle=function(a){a=a||new e,this.normalize();var b=2*Math.acos(this.w),c=Math.sqrt(1-this.w*this.w);return c<.001?(a.x=this.x,a.y=this.y,a.z=this.z):(a.x=this.x/c,a.y=this.y/c,a.z=this.z/c),[a,b]};var f=new e,g=new e;d.prototype.setFromVectors=function(a,b){if(a.isAntiparallelTo(b)){var c=f,d=g;a.tangents(c,d),this.setFromAxisAngle(c,Math.PI)}else{var e=a.cross(b);this.x=e.x,this.y=e.y,this.z=e.z,this.w=Math.sqrt(Math.pow(a.norm(),2)*Math.pow(b.norm(),2))+a.dot(b),this.normalize()}};var h=new e,i=new e,j=new e;d.prototype.mult=function(a,b){b=b||new d;var c=this.w,e=h,f=i,g=j;return e.set(this.x,this.y,this.z),f.set(a.x,a.y,a.z),b.w=c*a.w-e.dot(f),e.cross(f,g),b.x=c*f.x+a.w*e.x+g.x,b.y=c*f.y+a.w*e.y+g.y,b.z=c*f.z+a.w*e.z+g.z,b},d.prototype.inverse=function(a){var b=this.x,c=this.y,e=this.z,f=this.w;a=a||new d,this.conjugate(a);var g=1/(b*b+c*c+e*e+f*f);return a.x*=g,a.y*=g,a.z*=g,a.w*=g,a},d.prototype.conjugate=function(a){return a=a||new d,a.x=-this.x,a.y=-this.y,a.z=-this.z,a.w=this.w,a},d.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===a?(this.x=0,this.y=0,this.z=0,this.w=0):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a)},d.prototype.normalizeFast=function(){var a=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===a?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=a,this.y*=a,this.z*=a,this.w*=a)},d.prototype.vmult=function(a,b){b=b||new e;var c=a.x,d=a.y,f=a.z,g=this.x,h=this.y,i=this.z,j=this.w,k=j*c+h*f-i*d,l=j*d+i*c-g*f,m=j*f+g*d-h*c,n=-g*c-h*d-i*f;return b.x=k*j+n*-g+l*-i-m*-h,b.y=l*j+n*-h+m*-g-k*-i,b.z=m*j+n*-i+k*-h-l*-g,b},d.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},d.prototype.toEuler=function(a,b){b=b||"YZX";var c,d,e,f=this.x,g=this.y,h=this.z,i=this.w;switch(b){case"YZX":var j=f*g+h*i;if(j>.499&&(c=2*Math.atan2(f,i),d=Math.PI/2,e=0),j<-.499&&(c=-2*Math.atan2(f,i),d=-Math.PI/2,e=0),isNaN(c)){var k=f*f,l=g*g,m=h*h;c=Math.atan2(2*g*i-2*f*h,1-2*l-2*m),d=Math.asin(2*j),e=Math.atan2(2*f*i-2*g*h,1-2*k-2*m)}break;default:throw new Error("Euler order "+b+" not supported yet.")}a.y=c,a.z=d,a.x=e},d.prototype.setFromEuler=function(a,b,c,d){d=d||"XYZ";var e=Math.cos(a/2),f=Math.cos(b/2),g=Math.cos(c/2),h=Math.sin(a/2),i=Math.sin(b/2),j=Math.sin(c/2);return"XYZ"===d?(this.x=h*f*g+e*i*j,this.y=e*i*g-h*f*j,this.z=e*f*j+h*i*g,this.w=e*f*g-h*i*j):"YXZ"===d?(this.x=h*f*g+e*i*j,this.y=e*i*g-h*f*j,this.z=e*f*j-h*i*g,this.w=e*f*g+h*i*j):"ZXY"===d?(this.x=h*f*g-e*i*j,this.y=e*i*g+h*f*j,this.z=e*f*j+h*i*g,this.w=e*f*g-h*i*j):"ZYX"===d?(this.x=h*f*g-e*i*j,this.y=e*i*g+h*f*j,this.z=e*f*j-h*i*g,this.w=e*f*g+h*i*j):"YZX"===d?(this.x=h*f*g+e*i*j,this.y=e*i*g+h*f*j,this.z=e*f*j-h*i*g,this.w=e*f*g-h*i*j):"XZY"===d&&(this.x=h*f*g-e*i*j,this.y=e*i*g-h*f*j,this.z=e*f*j+h*i*g,this.w=e*f*g+h*i*j),this},d.prototype.clone=function(){return new d(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(a,b,c){function d(a){a=a||{},this.position=new e,a.position&&this.position.copy(a.position),this.quaternion=new f,a.quaternion&&this.quaternion.copy(a.quaternion)}var e=a("./Vec3"),f=a("./Quaternion");b.exports=d;var g=new f;d.pointToLocalFrame=function(a,b,c,d){var d=d||new e;return c.vsub(a,d),b.conjugate(g),g.vmult(d,d),d},d.prototype.pointToLocal=function(a,b){return d.pointToLocalFrame(this.position,this.quaternion,a,b)},d.pointToWorldFrame=function(a,b,c,d){var d=d||new e;return b.vmult(c,d),d.vadd(a,d),d},d.prototype.pointToWorld=function(a,b){return d.pointToWorldFrame(this.position,this.quaternion,a,b)},d.prototype.vectorToWorldFrame=function(a,b){var b=b||new e;return this.quaternion.vmult(a,b),b},d.vectorToWorldFrame=function(a,b,c){return a.vmult(b,c),c},d.vectorToLocalFrame=function(a,b,c,d){var d=d||new e;return b.w*=-1,b.vmult(c,d),b.w*=-1,d}},{"./Quaternion":28,"./Vec3":30}],30:[function(a,b,c){function d(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0}b.exports=d;var e=a("./Mat3");d.ZERO=new d(0,0,0),d.UNIT_X=new d(1,0,0),d.UNIT_Y=new d(0,1,0),d.UNIT_Z=new d(0,0,1),d.prototype.cross=function(a,b){var c=a.x,e=a.y,f=a.z,g=this.x,h=this.y,i=this.z;return b=b||new d,b.x=h*f-i*e,b.y=i*c-g*f,b.z=g*e-h*c,b},d.prototype.set=function(a,b,c){return this.x=a,this.y=b,this.z=c,this},d.prototype.setZero=function(){this.x=this.y=this.z=0},d.prototype.vadd=function(a,b){if(!b)return new d(this.x+a.x,this.y+a.y,this.z+a.z);b.x=a.x+this.x,b.y=a.y+this.y,b.z=a.z+this.z},d.prototype.vsub=function(a,b){if(!b)return new d(this.x-a.x,this.y-a.y,this.z-a.z);b.x=this.x-a.x,b.y=this.y-a.y,b.z=this.z-a.z},d.prototype.crossmat=function(){return new e([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},d.prototype.normalize=function(){var a=this.x,b=this.y,c=this.z,d=Math.sqrt(a*a+b*b+c*c);if(d>0){var e=1/d;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return d},d.prototype.unit=function(a){a=a||new d;var b=this.x,c=this.y,e=this.z,f=Math.sqrt(b*b+c*c+e*e);return f>0?(f=1/f,a.x=b*f,a.y=c*f,a.z=e*f):(a.x=1,a.y=0,a.z=0),a},d.prototype.norm=function(){var a=this.x,b=this.y,c=this.z;return Math.sqrt(a*a+b*b+c*c)},d.prototype.length=d.prototype.norm,d.prototype.norm2=function(){return this.dot(this)},d.prototype.lengthSquared=d.prototype.norm2,d.prototype.distanceTo=function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;return Math.sqrt((e-b)*(e-b)+(f-c)*(f-c)+(g-d)*(g-d))},d.prototype.distanceSquared=function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;return(e-b)*(e-b)+(f-c)*(f-c)+(g-d)*(g-d)},d.prototype.mult=function(a,b){b=b||new d;var c=this.x,e=this.y,f=this.z;return b.x=a*c,b.y=a*e,b.z=a*f,b},d.prototype.scale=d.prototype.mult,d.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},d.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},d.prototype.negate=function(a){return a=a||new d,a.x=-this.x,a.y=-this.y,a.z=-this.z,a};var f=new d,g=new d;d.prototype.tangents=function(a,b){var c=this.norm();if(c>0){var d=f,e=1/c;d.set(this.x*e,this.y*e,this.z*e);var h=g;Math.abs(d.x)<.9?(h.set(1,0,0),d.cross(h,a)):(h.set(0,1,0),d.cross(h,a)),d.cross(a,b)}else a.set(1,0,0),b.set(0,1,0)},d.prototype.toString=function(){return this.x+","+this.y+","+this.z},d.prototype.toArray=function(){return[this.x,this.y,this.z]},d.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},d.prototype.lerp=function(a,b,c){var d=this.x,e=this.y,f=this.z;c.x=d+(a.x-d)*b,c.y=e+(a.y-e)*b,c.z=f+(a.z-f)*b},d.prototype.almostEquals=function(a,b){return void 0===b&&(b=1e-6),!(Math.abs(this.x-a.x)>b||Math.abs(this.y-a.y)>b||Math.abs(this.z-a.z)>b)},d.prototype.almostZero=function(a){return void 0===a&&(a=1e-6),!(Math.abs(this.x)>a||Math.abs(this.y)>a||Math.abs(this.z)>a)};var h=new d;d.prototype.isAntiparallelTo=function(a,b){return this.negate(h),h.almostEquals(a,b)},d.prototype.clone=function(){return new d(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(a,b,c){function d(a){a=a||{},e.apply(this),this.id=d.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new f,this.collisionFilterGroup="number"==typeof a.collisionFilterGroup?a.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof a.collisionFilterMask?a.collisionFilterMask:1,this.collisionResponse=!0,this.position=new f,a.position&&this.position.copy(a.position),this.previousPosition=new f,this.initPosition=new f,this.velocity=new f,a.velocity&&this.velocity.copy(a.velocity),this.initVelocity=new f,this.force=new f;var b="number"==typeof a.mass?a.mass:0;this.mass=b,this.invMass=b>0?1/b:0,this.material=a.material||null,this.linearDamping="number"==typeof a.linearDamping?a.linearDamping:.01,this.type=b<=0?d.STATIC:d.DYNAMIC,typeof a.type==typeof d.STATIC&&(this.type=a.type),this.allowSleep=void 0===a.allowSleep||a.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==a.sleepSpeedLimit?a.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==a.sleepTimeLimit?a.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new f,this.quaternion=new h,a.quaternion&&this.quaternion.copy(a.quaternion),this.initQuaternion=new h,this.angularVelocity=new f,a.angularVelocity&&this.angularVelocity.copy(a.angularVelocity),this.initAngularVelocity=new f,this.interpolatedPosition=new f,this.interpolatedQuaternion=new h,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new f,this.invInertia=new f,this.invInertiaWorld=new g,this.invMassSolve=0,this.invInertiaSolve=new f,this.invInertiaWorldSolve=new g,this.fixedRotation=void 0!==a.fixedRotation&&a.fixedRotation,this.angularDamping=void 0!==a.angularDamping?a.angularDamping:.01,this.aabb=new i,this.aabbNeedsUpdate=!0,this.wlambda=new f,a.shape&&this.addShape(a.shape),this.updateMassProperties()}b.exports=d;var e=a("../utils/EventTarget"),f=(a("../shapes/Shape"),a("../math/Vec3")),g=a("../math/Mat3"),h=a("../math/Quaternion"),i=(a("../material/Material"),a("../collision/AABB")),j=a("../shapes/Box");d.prototype=new e,d.prototype.constructor=d,d.DYNAMIC=1,d.STATIC=2,d.KINEMATIC=4,d.AWAKE=0,d.SLEEPY=1,d.SLEEPING=2,d.idCounter=0,d.prototype.wakeUp=function(){var a=this.sleepState;this.sleepState=0,a===d.SLEEPING&&this.dispatchEvent({type:"wakeup"})},d.prototype.sleep=function(){this.sleepState=d.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},d.sleepyEvent={type:"sleepy"},d.sleepEvent={type:"sleep"},d.prototype.sleepTick=function(a){if(this.allowSleep){var b=this.sleepState,c=this.velocity.norm2()+this.angularVelocity.norm2(),e=Math.pow(this.sleepSpeedLimit,2);b===d.AWAKE&&c<e?(this.sleepState=d.SLEEPY,this.timeLastSleepy=a,this.dispatchEvent(d.sleepyEvent)):b===d.SLEEPY&&c>e?this.wakeUp():b===d.SLEEPY&&a-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(d.sleepEvent))}},d.prototype.updateSolveMassProperties=function(){this.sleepState===d.SLEEPING||this.type===d.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},d.prototype.pointToLocalFrame=function(a,b){var b=b||new f;return a.vsub(this.position,b),this.quaternion.conjugate().vmult(b,b),b},d.prototype.vectorToLocalFrame=function(a,b){var b=b||new f;return this.quaternion.conjugate().vmult(a,b),b},d.prototype.pointToWorldFrame=function(a,b){var b=b||new f;return this.quaternion.vmult(a,b),b.vadd(this.position,b),b},d.prototype.vectorToWorldFrame=function(a,b){var b=b||new f;return this.quaternion.vmult(a,b),b};var k=new f,l=new h;d.prototype.addShape=function(a,b,c){var d=new f,e=new h;return b&&d.copy(b),c&&e.copy(c),this.shapes.push(a),this.shapeOffsets.push(d),this.shapeOrientations.push(e),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},d.prototype.updateBoundingRadius=function(){for(var a=this.shapes,b=this.shapeOffsets,c=a.length,d=0,e=0;e!==c;e++){var f=a[e];f.updateBoundingSphereRadius();var g=b[e].norm(),h=f.boundingSphereRadius;g+h>d&&(d=g+h)}this.boundingRadius=d};var m=new i;d.prototype.computeAABB=function(){for(var a=this.shapes,b=this.shapeOffsets,c=this.shapeOrientations,d=a.length,e=k,f=l,g=this.quaternion,h=this.aabb,i=m,j=0;j!==d;j++){var n=a[j];c[j].mult(g,f),f.vmult(b[j],e),e.vadd(this.position,e),n.calculateWorldAABB(e,f,i.lowerBound,i.upperBound),0===j?h.copy(i):h.extend(i)}this.aabbNeedsUpdate=!1};var n=new g,o=new g;new g;d.prototype.updateInertiaWorld=function(a){var b=this.invInertia;if(b.x!==b.y||b.y!==b.z||a){var c=n,d=o;c.setRotationFromQuaternion(this.quaternion),c.transpose(d),c.scale(b,c),c.mmult(d,this.invInertiaWorld)}else;};var p=new f,q=new f
;d.prototype.applyForce=function(a,b){if(this.type===d.DYNAMIC){var c=p;b.vsub(this.position,c);var e=q;c.cross(a,e),this.force.vadd(a,this.force),this.torque.vadd(e,this.torque)}};var r=new f,s=new f;d.prototype.applyLocalForce=function(a,b){if(this.type===d.DYNAMIC){var c=r,e=s;this.vectorToWorldFrame(a,c),this.pointToWorldFrame(b,e),this.applyForce(c,e)}};var t=new f,u=new f,v=new f;d.prototype.applyImpulse=function(a,b){if(this.type===d.DYNAMIC){var c=t;b.vsub(this.position,c);var e=u;e.copy(a),e.mult(this.invMass,e),this.velocity.vadd(e,this.velocity);var f=v;c.cross(a,f),this.invInertiaWorld.vmult(f,f),this.angularVelocity.vadd(f,this.angularVelocity)}};var w=new f,x=new f;d.prototype.applyLocalImpulse=function(a,b){if(this.type===d.DYNAMIC){var c=w,e=x;this.vectorToWorldFrame(a,c),this.pointToWorldFrame(b,e),this.applyImpulse(c,e)}};var y=new f;d.prototype.updateMassProperties=function(){var a=y;this.invMass=this.mass>0?1/this.mass:0;var b=this.inertia,c=this.fixedRotation;this.computeAABB(),a.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),j.calculateInertia(a,this.mass,b),this.invInertia.set(b.x>0&&!c?1/b.x:0,b.y>0&&!c?1/b.y:0,b.z>0&&!c?1/b.z:0),this.updateInertiaWorld(!0)},d.prototype.getVelocityAtWorldPoint=function(a,b){var c=new f;return a.vsub(this.position,c),this.angularVelocity.cross(c,b),this.velocity.vadd(b,b),b}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(a,b,c){function d(a){this.chassisBody=a.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==a.indexRightAxis?a.indexRightAxis:1,this.indexForwardAxis=void 0!==a.indexForwardAxis?a.indexForwardAxis:0,this.indexUpAxis=void 0!==a.indexUpAxis?a.indexUpAxis:2}function e(a,b,c,d,e){var g=0,h=c,i=u,j=v,k=w;a.getVelocityAtWorldPoint(h,i),b.getVelocityAtWorldPoint(h,j),i.vsub(j,k);return g=-d.dot(k)*(1/(f(a,c,d)+f(b,c,d))),e<g&&(g=e),g<-e&&(g=-e),g}function f(a,b,c){var d=x,e=y,f=z,g=A;return b.vsub(a.position,d),d.cross(c,e),a.invInertiaWorld.vmult(e,g),g.cross(d,f),a.invMass+c.dot(f)}function g(a,b,c,d,e,f){if(e.norm2()>1.1)return 0;var g=B,h=C,i=D;a.getVelocityAtWorldPoint(b,g),c.getVelocityAtWorldPoint(d,h),g.vsub(h,i);return-.2*e.dot(i)*(1/(a.invMass+c.invMass))}var h=(a("./Body"),a("../math/Vec3")),i=a("../math/Quaternion"),j=(a("../collision/RaycastResult"),a("../collision/Ray")),k=a("../objects/WheelInfo");b.exports=d;var l=(new h,new h,new h,new h),m=new h,n=new h;new j;d.prototype.addWheel=function(a){a=a||{};var b=new k(a),c=this.wheelInfos.length;return this.wheelInfos.push(b),c},d.prototype.setSteeringValue=function(a,b){this.wheelInfos[b].steering=a};new h;d.prototype.applyEngineForce=function(a,b){this.wheelInfos[b].engineForce=a},d.prototype.setBrake=function(a,b){this.wheelInfos[b].brake=a},d.prototype.addToWorld=function(a){this.constraints;a.add(this.chassisBody);var b=this;this.preStepCallback=function(){b.updateVehicle(a.dt)},a.addEventListener("preStep",this.preStepCallback),this.world=a},d.prototype.getVehicleAxisWorld=function(a,b){b.set(0===a?1:0,1===a?1:0,2===a?1:0),this.chassisBody.vectorToWorldFrame(b,b)},d.prototype.updateVehicle=function(a){for(var b=this.wheelInfos,c=b.length,d=this.chassisBody,e=0;e<c;e++)this.updateWheelTransform(e);this.currentVehicleSpeedKmHour=3.6*d.velocity.norm();var f=new h;this.getVehicleAxisWorld(this.indexForwardAxis,f),f.dot(d.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var e=0;e<c;e++)this.castRay(b[e]);this.updateSuspension(a);for(var g=new h,i=new h,e=0;e<c;e++){var j=b[e],k=j.suspensionForce;k>j.maxSuspensionForce&&(k=j.maxSuspensionForce),j.raycastResult.hitNormalWorld.scale(k*a,g),j.raycastResult.hitPointWorld.vsub(d.position,i),d.applyImpulse(g,j.raycastResult.hitPointWorld)}this.updateFriction(a);var l=new h,m=new h,n=new h;for(e=0;e<c;e++){var j=b[e];d.getVelocityAtWorldPoint(j.chassisConnectionPointWorld,n);var o=1;switch(this.indexUpAxis){case 1:o=-1}if(j.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,m);var p=m.dot(j.raycastResult.hitNormalWorld);j.raycastResult.hitNormalWorld.scale(p,l),m.vsub(l,m);var q=m.dot(n);j.deltaRotation=o*q*a/j.radius}!j.sliding&&j.isInContact||0===j.engineForce||!j.useCustomSlidingRotationalSpeed||(j.deltaRotation=(j.engineForce>0?1:-1)*j.customSlidingRotationalSpeed*a),Math.abs(j.brake)>Math.abs(j.engineForce)&&(j.deltaRotation=0),j.rotation+=j.deltaRotation,j.deltaRotation*=.99}},d.prototype.updateSuspension=function(a){for(var b=this.chassisBody,c=b.mass,d=this.wheelInfos,e=d.length,f=0;f<e;f++){var g=d[f];if(g.isInContact){var h,i=g.suspensionRestLength,j=g.suspensionLength,k=i-j;h=g.suspensionStiffness*k*g.clippedInvContactDotSuspension;var l,m=g.suspensionRelativeVelocity;l=m<0?g.dampingCompression:g.dampingRelaxation,h-=l*m,g.suspensionForce=h*c,g.suspensionForce<0&&(g.suspensionForce=0)}else g.suspensionForce=0}},d.prototype.removeFromWorld=function(a){this.constraints;a.remove(this.chassisBody),a.removeEventListener("preStep",this.preStepCallback),this.world=null};var o=new h,p=new h;d.prototype.castRay=function(a){var b=o,c=p;this.updateWheelTransformWorld(a);var d=this.chassisBody,e=-1,f=a.suspensionRestLength+a.radius;a.directionWorld.scale(f,b);var g=a.chassisConnectionPointWorld;g.vadd(b,c);var i=a.raycastResult;i.reset();var j=d.collisionResponse;d.collisionResponse=!1,this.world.rayTest(g,c,i),d.collisionResponse=j;var k=i.body;if(a.raycastResult.groundObject=0,k){e=i.distance,a.raycastResult.hitNormalWorld=i.hitNormalWorld,a.isInContact=!0;var l=i.distance;a.suspensionLength=l-a.radius;var m=a.suspensionRestLength-a.maxSuspensionTravel,n=a.suspensionRestLength+a.maxSuspensionTravel;a.suspensionLength<m&&(a.suspensionLength=m),a.suspensionLength>n&&(a.suspensionLength=n,a.raycastResult.reset());var q=a.raycastResult.hitNormalWorld.dot(a.directionWorld),r=new h;d.getVelocityAtWorldPoint(a.raycastResult.hitPointWorld,r);var s=a.raycastResult.hitNormalWorld.dot(r);if(q>=-.1)a.suspensionRelativeVelocity=0,a.clippedInvContactDotSuspension=10;else{var t=-1/q;a.suspensionRelativeVelocity=s*t,a.clippedInvContactDotSuspension=t}}else a.suspensionLength=a.suspensionRestLength+0*a.maxSuspensionTravel,a.suspensionRelativeVelocity=0,a.directionWorld.scale(-1,a.raycastResult.hitNormalWorld),a.clippedInvContactDotSuspension=1;return e},d.prototype.updateWheelTransformWorld=function(a){a.isInContact=!1;var b=this.chassisBody;b.pointToWorldFrame(a.chassisConnectionPointLocal,a.chassisConnectionPointWorld),b.vectorToWorldFrame(a.directionLocal,a.directionWorld),b.vectorToWorldFrame(a.axleLocal,a.axleWorld)},d.prototype.updateWheelTransform=function(a){var b=l,c=m,d=n,e=this.wheelInfos[a];this.updateWheelTransformWorld(e),e.directionLocal.scale(-1,b),c.copy(e.axleLocal),b.cross(c,d),d.normalize(),c.normalize();var f=e.steering,g=new i;g.setFromAxisAngle(b,f);var h=new i;h.setFromAxisAngle(c,e.rotation);var j=e.worldTransform.quaternion;this.chassisBody.quaternion.mult(g,j),j.mult(h,j),j.normalize();var k=e.worldTransform.position;k.copy(e.directionWorld),k.scale(e.suspensionLength,k),k.vadd(e.chassisConnectionPointWorld,k)};var q=[new h(1,0,0),new h(0,1,0),new h(0,0,1)];d.prototype.getWheelTransformWorld=function(a){return this.wheelInfos[a].worldTransform};var r=new h,s=[],t=[];d.prototype.updateFriction=function(a){for(var b=r,c=this.wheelInfos,d=c.length,f=this.chassisBody,i=t,j=s,k=0,l=0;l<d;l++){var m=c[l],n=m.raycastResult.body;n&&k++,m.sideImpulse=0,m.forwardImpulse=0,i[l]||(i[l]=new h),j[l]||(j[l]=new h)}for(var l=0;l<d;l++){var m=c[l],n=m.raycastResult.body;if(n){var o=j[l];this.getWheelTransformWorld(l).vectorToWorldFrame(q[this.indexRightAxis],o);var p=m.raycastResult.hitNormalWorld,u=o.dot(p);p.scale(u,b),o.vsub(b,o),o.normalize(),p.cross(o,i[l]),i[l].normalize(),m.sideImpulse=g(f,m.raycastResult.hitPointWorld,n,m.raycastResult.hitPointWorld,o),m.sideImpulse*=1}}this.sliding=!1;for(var l=0;l<d;l++){var m=c[l],n=m.raycastResult.body,v=0;if(m.slipInfo=1,n){var w=m.brake?m.brake:0;v=e(f,n,m.raycastResult.hitPointWorld,i[l],w),v+=m.engineForce*a;var x=w/v;m.slipInfo*=x}if(m.forwardImpulse=0,m.skidInfo=1,n){m.skidInfo=1;var y=m.suspensionForce*a*m.frictionSlip,z=y,A=y*z;m.forwardImpulse=v;var B=.5*m.forwardImpulse,C=1*m.sideImpulse,D=B*B+C*C;if(m.sliding=!1,D>A){this.sliding=!0,m.sliding=!0;var x=y/Math.sqrt(D);m.skidInfo*=x}}}if(this.sliding)for(var l=0;l<d;l++){var m=c[l];0!==m.sideImpulse&&m.skidInfo<1&&(m.forwardImpulse*=m.skidInfo,m.sideImpulse*=m.skidInfo)}for(var l=0;l<d;l++){var m=c[l],E=new h;if(E.copy(m.raycastResult.hitPointWorld),0!==m.forwardImpulse){var F=new h;i[l].scale(m.forwardImpulse,F),f.applyImpulse(F,E)}if(0!==m.sideImpulse){var n=m.raycastResult.body,G=new h;G.copy(m.raycastResult.hitPointWorld);var H=new h;j[l].scale(m.sideImpulse,H),f.pointToLocalFrame(E,E),E["xyz"[this.indexUpAxis]]*=m.rollInfluence,f.pointToWorldFrame(E,E),f.applyImpulse(H,E),H.scale(-1,H),n.applyImpulse(H,G)}}};var u=new h,v=new h,w=new h,x=new h,y=new h,z=new h,A=new h,B=new h,C=new h,D=new h},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(a,b,c){function d(a){if(this.wheelBodies=[],this.coordinateSystem=void 0===a.coordinateSystem?new h(1,2,3):a.coordinateSystem.clone(),this.chassisBody=a.chassisBody,!this.chassisBody){var b=new g(new h(5,2,.5));this.chassisBody=new e(1,b)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var e=a("./Body"),f=a("../shapes/Sphere"),g=a("../shapes/Box"),h=a("../math/Vec3"),i=a("../constraints/HingeConstraint");b.exports=d,d.prototype.addWheel=function(a){a=a||{};var b=a.body;b||(b=new e(1,new f(1.2))),this.wheelBodies.push(b),this.wheelForces.push(0);var c=(new h,void 0!==a.position?a.position.clone():new h),d=new h;this.chassisBody.pointToWorldFrame(c,d),b.position.set(d.x,d.y,d.z);var g=void 0!==a.axis?a.axis.clone():new h(0,1,0);this.wheelAxes.push(g);var j=new i(this.chassisBody,b,{pivotA:c,axisA:g,pivotB:h.ZERO,axisB:g,collideConnected:!1});return this.constraints.push(j),this.wheelBodies.length-1},d.prototype.setSteeringValue=function(a,b){var c=this.wheelAxes[b],d=Math.cos(a),e=Math.sin(a),f=c.x,g=c.y;this.constraints[b].axisA.set(d*f-e*g,e*f+d*g,0)},d.prototype.setMotorSpeed=function(a,b){var c=this.constraints[b];c.enableMotor(),c.motorTargetVelocity=a},d.prototype.disableMotor=function(a){this.constraints[a].disableMotor()};var j=new h;d.prototype.setWheelForce=function(a,b){this.wheelForces[b]=a},d.prototype.applyWheelForce=function(a,b){var c=this.wheelAxes[b],d=this.wheelBodies[b],e=d.torque;c.scale(a,j),d.vectorToWorldFrame(j,j),e.vadd(j,e)},d.prototype.addToWorld=function(a){for(var b=this.constraints,c=this.wheelBodies.concat([this.chassisBody]),d=0;d<c.length;d++)a.add(c[d]);for(var d=0;d<b.length;d++)a.addConstraint(b[d]);a.addEventListener("preStep",this._update.bind(this))},d.prototype._update=function(){for(var a=this.wheelForces,b=0;b<a.length;b++)this.applyWheelForce(a[b],b)},d.prototype.removeFromWorld=function(a){for(var b=this.constraints,c=this.wheelBodies.concat([this.chassisBody]),d=0;d<c.length;d++)a.remove(c[d]);for(var d=0;d<b.length;d++)a.removeConstraint(b[d])};var k=new h;d.prototype.getWheelSpeed=function(a){var b=this.wheelAxes[a],c=this.wheelBodies[a],d=c.angularVelocity;return this.chassisBody.vectorToWorldFrame(b,k),d.dot(k)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(a,b,c){function d(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}b.exports=d;var e=(a("../shapes/Shape"),a("../math/Vec3"));a("../math/Quaternion"),a("../shapes/Particle"),a("../objects/Body"),a("../material/Material");d.prototype.add=function(a){this.particles.push(a),this.neighbors.length<this.particles.length&&this.neighbors.push([])},d.prototype.remove=function(a){var b=this.particles.indexOf(a);-1!==b&&(this.particles.splice(b,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var f=new e;d.prototype.getNeighbors=function(a,b){for(var c=this.particles.length,d=a.id,e=this.smoothingRadius*this.smoothingRadius,g=f,h=0;h!==c;h++){var i=this.particles[h];i.position.vsub(a.position,g),d!==i.id&&g.norm2()<e&&b.push(i)}};var g=new e,h=new e,i=new e,j=new e,k=new e,l=new e;d.prototype.update=function(){for(var a=this.particles.length,b=g,c=this.speedOfSound,d=this.eps,e=0;e!==a;e++){var f=this.particles[e],m=this.neighbors[e];m.length=0,this.getNeighbors(f,m),m.push(this.particles[e]);for(var n=m.length,o=0,p=0;p!==n;p++){f.position.vsub(m[p].position,b);var q=b.norm(),r=this.w(q);o+=m[p].mass*r}this.densities[e]=o,this.pressures[e]=c*c*(this.densities[e]-this.density)}for(var s=h,t=i,u=j,v=k,w=l,e=0;e!==a;e++){var x=this.particles[e];s.set(0,0,0),t.set(0,0,0);for(var y,z,m=this.neighbors[e],n=m.length,p=0;p!==n;p++){var A=m[p];x.position.vsub(A.position,v);var B=v.norm();y=-A.mass*(this.pressures[e]/(this.densities[e]*this.densities[e]+d)+this.pressures[p]/(this.densities[p]*this.densities[p]+d)),this.gradw(v,u),u.mult(y,u),s.vadd(u,s),A.velocity.vsub(x.velocity,w),w.mult(1/(1e-4+this.densities[e]*this.densities[p])*this.viscosity*A.mass,w),z=this.nablaw(B),w.mult(z,w),t.vadd(w,t)}t.mult(x.mass,t),s.mult(x.mass,s),x.force.vadd(t,x.force),x.force.vadd(s,x.force)}},d.prototype.w=function(a){var b=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(b,9))*Math.pow(b*b-a*a,3)},d.prototype.gradw=function(a,b){var c=a.norm(),d=this.smoothingRadius;a.mult(945/(32*Math.PI*Math.pow(d,9))*Math.pow(d*d-c*c,2),b)},d.prototype.nablaw=function(a){var b=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(b,9))*(b*b-a*a)*(7*a*a-3*b*b)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(a,b,c){function d(a,b,c){c=c||{},this.restLength="number"==typeof c.restLength?c.restLength:1,this.stiffness=c.stiffness||100,this.damping=c.damping||1,this.bodyA=a,this.bodyB=b,this.localAnchorA=new e,this.localAnchorB=new e,c.localAnchorA&&this.localAnchorA.copy(c.localAnchorA),c.localAnchorB&&this.localAnchorB.copy(c.localAnchorB),c.worldAnchorA&&this.setWorldAnchorA(c.worldAnchorA),c.worldAnchorB&&this.setWorldAnchorB(c.worldAnchorB)}var e=a("../math/Vec3");b.exports=d,d.prototype.setWorldAnchorA=function(a){this.bodyA.pointToLocalFrame(a,this.localAnchorA)},d.prototype.setWorldAnchorB=function(a){this.bodyB.pointToLocalFrame(a,this.localAnchorB)},d.prototype.getWorldAnchorA=function(a){this.bodyA.pointToWorldFrame(this.localAnchorA,a)},d.prototype.getWorldAnchorB=function(a){this.bodyB.pointToWorldFrame(this.localAnchorB,a)};var f=new e,g=new e,h=new e,i=new e,j=new e,k=new e,l=new e,m=new e,n=new e,o=new e,p=new e;d.prototype.applyForce=function(){var a=this.stiffness,b=this.damping,c=this.restLength,d=this.bodyA,e=this.bodyB,q=f,r=g,s=h,t=i,u=p,v=j,w=k,x=l,y=m,z=n,A=o;this.getWorldAnchorA(v),this.getWorldAnchorB(w),v.vsub(d.position,x),w.vsub(e.position,y),w.vsub(v,q);var B=q.norm();r.copy(q),r.normalize(),e.velocity.vsub(d.velocity,s),e.angularVelocity.cross(y,u),s.vadd(u,s),d.angularVelocity.cross(x,u),s.vsub(u,s),r.mult(-a*(B-c)-b*s.dot(r),t),d.force.vsub(t,d.force),e.force.vadd(t,e.force),x.cross(t,z),y.cross(t,A),d.torque.vsub(z,d.torque),e.torque.vadd(A,e.torque)}},{"../math/Vec3":30}],36:[function(a,b,c){function d(a){a=h.defaults(a,{chassisConnectionPointLocal:new e,chassisConnectionPointWorld:new e,directionLocal:new e,directionWorld:new e,axleLocal:new e,axleWorld:new e,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=a.maxSuspensionTravel,this.customSlidingRotationalSpeed=a.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=a.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=a.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=a.chassisConnectionPointWorld.clone(),this.directionLocal=a.directionLocal.clone(),this.directionWorld=a.directionWorld.clone(),this.axleLocal=a.axleLocal.clone(),this.axleWorld=a.axleWorld.clone(),this.suspensionRestLength=a.suspensionRestLength,this.suspensionMaxLength=a.suspensionMaxLength,this.radius=a.radius,this.suspensionStiffness=a.suspensionStiffness,this.dampingCompression=a.dampingCompression,this.dampingRelaxation=a.dampingRelaxation,this.frictionSlip=a.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=a.rollInfluence,this.maxSuspensionForce=a.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=a.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new g,this.worldTransform=new f,this.isInContact=!1}var e=a("../math/Vec3"),f=a("../math/Transform"),g=a("../collision/RaycastResult"),h=a("../utils/Utils");b.exports=d;var i=new e,j=new e,i=new e;d.prototype.updateWheel=function(a){var b=this.raycastResult;if(this.isInContact){var c=b.hitNormalWorld.dot(b.directionWorld);b.hitPointWorld.vsub(a.position,j),a.getVelocityAtWorldPoint(j,i);var d=b.hitNormalWorld.dot(i);if(c>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var e=-1/c;this.suspensionRelativeVelocity=d*e,this.clippedInvContactDotSuspension=e}}else b.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,b.directionWorld.scale(-1,b.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(a,b,c){function d(a){e.call(this),this.type=e.types.BOX,this.halfExtents=a,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3"),g=a("./ConvexPolyhedron");d.prototype=new e,d.prototype.constructor=d,d.prototype.updateConvexPolyhedronRepresentation=function(){var a=this.halfExtents.x,b=this.halfExtents.y,c=this.halfExtents.z,d=f,e=[new d(-a,-b,-c),new d(a,-b,-c),new d(a,b,-c),new d(-a,b,-c),new d(-a,-b,c),new d(a,-b,c),new d(a,b,c),new d(-a,b,c)],h=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],i=(new d(0,0,1),new d(0,1,0),new d(1,0,0),new g(e,h));this.convexPolyhedronRepresentation=i,i.material=this.material},d.prototype.calculateLocalInertia=function(a,b){return b=b||new f,d.calculateInertia(this.halfExtents,a,b),b},d.calculateInertia=function(a,b,c){var d=a;c.x=1/12*b*(2*d.y*2*d.y+2*d.z*2*d.z),c.y=1/12*b*(2*d.x*2*d.x+2*d.z*2*d.z),c.z=1/12*b*(2*d.y*2*d.y+2*d.x*2*d.x)},d.prototype.getSideNormals=function(a,b){var c=a,d=this.halfExtents;if(c[0].set(d.x,0,0),c[1].set(0,d.y,0),c[2].set(0,0,d.z),c[3].set(-d.x,0,0),c[4].set(0,-d.y,0),c[5].set(0,0,-d.z),void 0!==b)for(var e=0;e!==c.length;e++)b.vmult(c[e],c[e]);return c},d.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var h=new f;new f;d.prototype.forEachWorldCorner=function(a,b,c){for(var d=this.halfExtents,e=[[d.x,d.y,d.z],[-d.x,d.y,d.z],[-d.x,-d.y,d.z],[-d.x,-d.y,-d.z],[d.x,-d.y,-d.z],[d.x,d.y,-d.z],[-d.x,d.y,-d.z],[d.x,-d.y,d.z]],f=0;f<e.length;f++)h.set(e[f][0],e[f][1],e[f][2]),b.vmult(h,h),a.vadd(h,h),c(h.x,h.y,h.z)};var i=[new f,new f,new f,new f,new f,new f,new f,new f];d.prototype.calculateWorldAABB=function(a,b,c,d){var e=this.halfExtents;i[0].set(e.x,e.y,e.z),i[1].set(-e.x,e.y,e.z),i[2].set(-e.x,-e.y,e.z),i[3].set(-e.x,-e.y,-e.z),i[4].set(e.x,-e.y,-e.z),i[5].set(e.x,e.y,-e.z),i[6].set(-e.x,e.y,-e.z),i[7].set(e.x,-e.y,e.z);var f=i[0];b.vmult(f,f),a.vadd(f,f),d.copy(f),c.copy(f);for(var g=1;g<8;g++){var f=i[g];b.vmult(f,f),a.vadd(f,f);var h=f.x,j=f.y,k=f.z;h>d.x&&(d.x=h),j>d.y&&(d.y=j),k>d.z&&(d.z=k),h<c.x&&(c.x=h),j<c.y&&(c.y=j),k<c.z&&(c.z=k)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(a,b,c){function d(a,b,c){e.call(this),this.type=e.types.CONVEXPOLYHEDRON,this.vertices=a||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=b||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=c?c.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3"),g=(a("../math/Quaternion"),a("../math/Transform"));d.prototype=new e,d.prototype.constructor=d;var h=new f;d.prototype.computeEdges=function(){var a=this.faces,b=this.vertices,c=(b.length,this.uniqueEdges);c.length=0;for(var d=h,e=0;e!==a.length;e++)for(var f=a[e],g=f.length,i=0;i!==g;i++){var j=(i+1)%g;b[f[i]].vsub(b[f[j]],d),d.normalize();for(var k=!1,l=0;l!==c.length;l++)if(c[l].almostEquals(d)||c[l].almostEquals(d)){k=!0;break}k||c.push(d.clone())}},d.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var a=0;a<this.faces.length;a++){for(var b=0;b<this.faces[a].length;b++)if(!this.vertices[this.faces[a][b]])throw new Error("Vertex "+this.faces[a][b]+" not found!");var c=this.faceNormals[a]||new f;this.getFaceNormal(a,c),c.negate(c),this.faceNormals[a]=c;var d=this.vertices[this.faces[a][0]];if(c.dot(d)<0){console.error(".faceNormals["+a+"] = Vec3("+c.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var b=0;b<this.faces[a].length;b++)console.warn(".vertices["+this.faces[a][b]+"] = Vec3("+this.vertices[this.faces[a][b]].toString()+")")}}};var i=new f,j=new f;d.computeNormal=function(a,b,c,d){b.vsub(a,j),c.vsub(b,i),i.cross(j,d),d.isZero()||d.normalize()},d.prototype.getFaceNormal=function(a,b){var c=this.faces[a],e=this.vertices[c[0]],f=this.vertices[c[1]],g=this.vertices[c[2]];return d.computeNormal(e,f,g,b)};var k=new f;d.prototype.clipAgainstHull=function(a,b,c,d,e,g,h,i,j){for(var l=k,m=-1,n=-Number.MAX_VALUE,o=0;o<c.faces.length;o++){l.copy(c.faceNormals[o]),e.vmult(l,l);var p=l.dot(g);p>n&&(n=p,m=o)}for(var q=[],r=c.faces[m],s=r.length,t=0;t<s;t++){var u=c.vertices[r[t]],v=new f;v.copy(u),e.vmult(v,v),d.vadd(v,v),q.push(v)}m>=0&&this.clipFaceAgainstHull(g,a,b,q,h,i,j)};var l=new f,m=new f,n=new f,o=new f,p=new f,q=new f;d.prototype.findSeparatingAxis=function(a,b,c,d,e,f,g,h){var i=l,j=m,k=n,r=o,s=p,t=q,u=Number.MAX_VALUE,v=this,w=0;if(v.uniqueAxes)for(var x=0;x!==v.uniqueAxes.length;x++){c.vmult(v.uniqueAxes[x],i);var y=v.testSepAxis(i,a,b,c,d,e);if(!1===y)return!1;y<u&&(u=y,f.copy(i))}else for(var z=g?g.length:v.faces.length,x=0;x<z;x++){var A=g?g[x]:x;i.copy(v.faceNormals[A]),c.vmult(i,i);var y=v.testSepAxis(i,a,b,c,d,e);if(!1===y)return!1;y<u&&(u=y,f.copy(i))}if(a.uniqueAxes)for(var x=0;x!==a.uniqueAxes.length;x++){e.vmult(a.uniqueAxes[x],j),w++;var y=v.testSepAxis(j,a,b,c,d,e);if(!1===y)return!1;y<u&&(u=y,f.copy(j))}else for(var B=h?h.length:a.faces.length,x=0;x<B;x++){var A=h?h[x]:x;j.copy(a.faceNormals[A]),e.vmult(j,j),w++;var y=v.testSepAxis(j,a,b,c,d,e);if(!1===y)return!1;y<u&&(u=y,f.copy(j))}for(var C=0;C!==v.uniqueEdges.length;C++){c.vmult(v.uniqueEdges[C],r);for(var D=0;D!==a.uniqueEdges.length;D++)if(e.vmult(a.uniqueEdges[D],s),r.cross(s,t),!t.almostZero()){t.normalize();var E=v.testSepAxis(t,a,b,c,d,e);if(!1===E)return!1;E<u&&(u=E,f.copy(t))}}return d.vsub(b,k),k.dot(f)>0&&f.negate(f),!0};var r=[],s=[];d.prototype.testSepAxis=function(a,b,c,e,f,g){var h=this;d.project(h,a,c,e,r),d.project(b,a,f,g,s);var i=r[0],j=r[1],k=s[0],l=s[1];if(i<l||k<j)return!1;var m=i-l,n=k-j;return m<n?m:n};var t=new f,u=new f;d.prototype.calculateLocalInertia=function(a,b){this.computeLocalAABB(t,u);var c=u.x-t.x,d=u.y-t.y,e=u.z-t.z;b.x=1/12*a*(2*d*2*d+2*e*2*e),b.y=1/12*a*(2*c*2*c+2*e*2*e),b.z=1/12*a*(2*d*2*d+2*c*2*c)},d.prototype.getPlaneConstantOfFace=function(a){var b=this.faces[a],c=this.faceNormals[a],d=this.vertices[b[0]];return-c.dot(d)};var v=new f,w=new f,x=new f,y=new f,z=new f,A=new f,B=new f,C=new f;d.prototype.clipFaceAgainstHull=function(a,b,c,d,e,f,g){for(var h=v,i=w,j=x,k=y,l=z,m=A,n=B,o=C,p=this,q=[],r=d,s=q,t=-1,u=Number.MAX_VALUE,D=0;D<p.faces.length;D++){h.copy(p.faceNormals[D]),c.vmult(h,h);var E=h.dot(a);E<u&&(u=E,t=D)}if(!(t<0)){var F=p.faces[t];F.connectedFaces=[];for(var G=0;G<p.faces.length;G++)for(var H=0;H<p.faces[G].length;H++)-1!==F.indexOf(p.faces[G][H])&&G!==t&&-1===F.connectedFaces.indexOf(G)&&F.connectedFaces.push(G);for(var I=(r.length,F.length),J=0;J<I;J++){var K=p.vertices[F[J]],L=p.vertices[F[(J+1)%I]];K.vsub(L,i),j.copy(i),c.vmult(j,j),b.vadd(j,j),k.copy(this.faceNormals[t]),c.vmult(k,k),b.vadd(k,k),j.cross(k,l),l.negate(l),m.copy(K),c.vmult(m,m),b.vadd(m,m);var M,N=(m.dot(l),F.connectedFaces[J]);n.copy(this.faceNormals[N]);var O=this.getPlaneConstantOfFace(N);o.copy(n),c.vmult(o,o);var M=O-o.dot(b);for(this.clipFaceAgainstPlane(r,s,o,M);r.length;)r.shift();for(;s.length;)r.push(s.shift())}n.copy(this.faceNormals[t]);var O=this.getPlaneConstantOfFace(t);o.copy(n),c.vmult(o,o);for(var M=O-o.dot(b),G=0;G<r.length;G++){var P=o.dot(r[G])+M;if(P<=e&&(console.log("clamped: depth="+P+" to minDist="+e),P=e),P<=f){var Q=r[G];if(P<=0){var R={point:Q,normal:o,depth:P};g.push(R)}}}}},d.prototype.clipFaceAgainstPlane=function(a,b,c,d){var e,g,h=a.length;if(h<2)return b;var i=a[a.length-1],j=a[0];e=c.dot(i)+d;for(var k=0;k<h;k++){if(j=a[k],g=c.dot(j)+d,e<0)if(g<0){var l=new f;l.copy(j),b.push(l)}else{var l=new f;i.lerp(j,e/(e-g),l),b.push(l)}else if(g<0){var l=new f;i.lerp(j,e/(e-g),l),b.push(l),b.push(j)}i=j,e=g}return b},d.prototype.computeWorldVertices=function(a,b){for(var c=this.vertices.length;this.worldVertices.length<c;)this.worldVertices.push(new f);for(var d=this.vertices,e=this.worldVertices,g=0;g!==c;g++)b.vmult(d[g],e[g]),a.vadd(e[g],e[g]);this.worldVerticesNeedsUpdate=!1};new f;d.prototype.computeLocalAABB=function(a,b){var c=this.vertices.length,d=this.vertices;a.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var e=0;e<c;e++){var f=d[e];f.x<a.x?a.x=f.x:f.x>b.x&&(b.x=f.x),f.y<a.y?a.y=f.y:f.y>b.y&&(b.y=f.y),f.z<a.z?a.z=f.z:f.z>b.z&&(b.z=f.z)}},d.prototype.computeWorldFaceNormals=function(a){for(var b=this.faceNormals.length;this.worldFaceNormals.length<b;)this.worldFaceNormals.push(new f);for(var c=this.faceNormals,d=this.worldFaceNormals,e=0;e!==b;e++)a.vmult(c[e],d[e]);this.worldFaceNormalsNeedsUpdate=!1},d.prototype.updateBoundingSphereRadius=function(){for(var a=0,b=this.vertices,c=0,d=b.length;c!==d;c++){var e=b[c].norm2();e>a&&(a=e)}this.boundingSphereRadius=Math.sqrt(a)};var D=new f;d.prototype.calculateWorldAABB=function(a,b,c,d){for(var e,f,g,h,i,j,k=this.vertices.length,l=this.vertices,m=0;m<k;m++){D.copy(l[m]),b.vmult(D,D),a.vadd(D,D);var n=D;n.x<e||void 0===e?e=n.x:(n.x>h||void 0===h)&&(h=n.x),n.y<f||void 0===f?f=n.y:(n.y>i||void 0===i)&&(i=n.y),n.z<g||void 0===g?g=n.z:(n.z>j||void 0===j)&&(j=n.z)}c.set(e,f,g),d.set(h,i,j)},d.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},d.prototype.getAveragePointLocal=function(a){a=a||new f;for(var b=this.vertices.length,c=this.vertices,d=0;d<b;d++)a.vadd(c[d],a);return a.mult(1/b,a),a},d.prototype.transformAllPoints=function(a,b){var c=this.vertices.length,d=this.vertices;if(b){for(var e=0;e<c;e++){var f=d[e];b.vmult(f,f)}for(var e=0;e<this.faceNormals.length;e++){var f=this.faceNormals[e];b.vmult(f,f)}}if(a)for(var e=0;e<c;e++){var f=d[e];f.vadd(a,f)}};var E=new f,F=new f,G=new f;d.prototype.pointIsInside=function(a){var b=this.vertices.length,c=this.vertices,d=this.faces,e=this.faceNormals,f=this.faces.length,g=E;this.getAveragePointLocal(g);for(var h=0;h<f;h++){var b=(this.faces[h].length,e[h]),i=c[d[h][0]],j=F;a.vsub(i,j);var k=b.dot(j),l=G;g.vsub(i,l);var m=b.dot(l);if(k<0&&m>0||k>0&&m<0)return!1}return-1};var H=(new f,new f),I=new f;d.project=function(a,b,c,d,e){var f=a.vertices.length,h=H,i=0,j=0,k=I,l=a.vertices;k.setZero(),g.vectorToLocalFrame(c,d,b,h),g.pointToLocalFrame(c,d,k,k);var m=k.dot(h);j=i=l[0].dot(h);for(var n=1;n<f;n++){var o=l[n].dot(h);o>i&&(i=o),o<j&&(j=o)}if(j-=m,i-=m,j>i){var p=j;j=i,i=p}e[0]=i,e[1]=j}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(a,b,c){function d(a,b,c,d){var h=d,i=[],j=[],k=[],l=[],m=[],n=Math.cos,o=Math.sin;i.push(new f(b*n(0),b*o(0),.5*-c)),l.push(0),i.push(new f(a*n(0),a*o(0),.5*c)),m.push(1);for(var p=0;p<h;p++){var q=2*Math.PI/h*(p+1),r=2*Math.PI/h*(p+.5);p<h-1?(i.push(new f(b*n(q),b*o(q),.5*-c)),l.push(2*p+2),i.push(new f(a*n(q),a*o(q),.5*c)),m.push(2*p+3),k.push([2*p+2,2*p+3,2*p+1,2*p])):k.push([0,1,2*p+1,2*p]),(h%2==1||p<h/2)&&j.push(new f(n(r),o(r),0))}k.push(m),j.push(new f(0,0,1));for(var s=[],p=0;p<l.length;p++)s.push(l[l.length-p-1]);k.push(s),this.type=e.types.CONVEXPOLYHEDRON,g.call(this,i,k,j)}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3"),g=(a("../math/Quaternion"),a("./ConvexPolyhedron"));d.prototype=new g},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(a,b,c){function d(a,b){b=h.defaults(b,{maxValue:null,minValue:null,elementSize:1}),this.data=a,this.maxValue=b.maxValue,this.minValue=b.minValue,this.elementSize=b.elementSize,null===b.minValue&&this.updateMinValue(),null===b.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,e.call(this),this.pillarConvex=new f,this.pillarOffset=new g,this.type=e.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}var e=a("./Shape"),f=a("./ConvexPolyhedron"),g=a("../math/Vec3"),h=a("../utils/Utils");b.exports=d,d.prototype=new e,d.prototype.update=function(){this._cachedPillars={}},d.prototype.updateMinValue=function(){for(var a=this.data,b=a[0][0],c=0;c!==a.length;c++)for(var d=0;d!==a[c].length;d++){var e=a[c][d];e<b&&(b=e)}this.minValue=b},d.prototype.updateMaxValue=function(){for(var a=this.data,b=a[0][0],c=0;c!==a.length;c++)for(var d=0;d!==a[c].length;d++){var e=a[c][d];e>b&&(b=e)}this.maxValue=b},d.prototype.setHeightValueAtIndex=function(a,b,c){this.data[a][b]=c,this.clearCachedConvexTrianglePillar(a,b,!1),a>0&&(this.clearCachedConvexTrianglePillar(a-1,b,!0),this.clearCachedConvexTrianglePillar(a-1,b,!1)),b>0&&(this.clearCachedConvexTrianglePillar(a,b-1,!0),this.clearCachedConvexTrianglePillar(a,b-1,!1)),b>0&&a>0&&this.clearCachedConvexTrianglePillar(a-1,b-1,!0)},d.prototype.getRectMinMax=function(a,b,c,d,e){e=e||[];for(var f=this.data,g=this.minValue,h=a;h<=c;h++)for(var i=b;i<=d;i++){var j=f[h][i];j>g&&(g=j)}e[0]=this.minValue,e[1]=g},d.prototype.getIndexOfPosition=function(a,b,c,d){var e=this.elementSize,f=this.data,g=Math.floor(a/e),h=Math.floor(b/e);return c[0]=g,c[1]=h,d&&(g<0&&(g=0),h<0&&(h=0),g>=f.length-1&&(g=f.length-1),h>=f[0].length-1&&(h=f[0].length-1)),!(g<0||h<0||g>=f.length-1||h>=f[0].length-1)},d.prototype.getHeightAt=function(a,b,c){var d=[];this.getIndexOfPosition(a,b,d,c);var e=[];return this.getRectMinMax(d[0],d[1]+1,d[0],d[1]+1,e),(e[0]+e[1])/2},d.prototype.getCacheConvexTrianglePillarKey=function(a,b,c){return a+"_"+b+"_"+(c?1:0)},d.prototype.getCachedConvexTrianglePillar=function(a,b,c){
return this._cachedPillars[this.getCacheConvexTrianglePillarKey(a,b,c)]},d.prototype.setCachedConvexTrianglePillar=function(a,b,c,d,e){this._cachedPillars[this.getCacheConvexTrianglePillarKey(a,b,c)]={convex:d,offset:e}},d.prototype.clearCachedConvexTrianglePillar=function(a,b,c){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(a,b,c)]},d.prototype.getConvexTrianglePillar=function(a,b,c){var d=this.pillarConvex,e=this.pillarOffset;if(this.cacheEnabled){var h=this.getCachedConvexTrianglePillar(a,b,c);if(h)return this.pillarConvex=h.convex,void(this.pillarOffset=h.offset);d=new f,e=new g,this.pillarConvex=d,this.pillarOffset=e}var h=this.data,i=this.elementSize,j=d.faces;d.vertices.length=6;for(var k=0;k<6;k++)d.vertices[k]||(d.vertices[k]=new g);j.length=5;for(var k=0;k<5;k++)j[k]||(j[k]=[]);var l=d.vertices,m=(Math.min(h[a][b],h[a+1][b],h[a][b+1],h[a+1][b+1])-this.minValue)/2+this.minValue;c?(e.set((a+.75)*i,(b+.75)*i,m),l[0].set(.25*i,.25*i,h[a+1][b+1]-m),l[1].set(-.75*i,.25*i,h[a][b+1]-m),l[2].set(.25*i,-.75*i,h[a+1][b]-m),l[3].set(.25*i,.25*i,-m-1),l[4].set(-.75*i,.25*i,-m-1),l[5].set(.25*i,-.75*i,-m-1),j[0][0]=0,j[0][1]=1,j[0][2]=2,j[1][0]=5,j[1][1]=4,j[1][2]=3,j[2][0]=2,j[2][1]=5,j[2][2]=3,j[2][3]=0,j[3][0]=3,j[3][1]=4,j[3][2]=1,j[3][3]=0,j[4][0]=1,j[4][1]=4,j[4][2]=5,j[4][3]=2):(e.set((a+.25)*i,(b+.25)*i,m),l[0].set(-.25*i,-.25*i,h[a][b]-m),l[1].set(.75*i,-.25*i,h[a+1][b]-m),l[2].set(-.25*i,.75*i,h[a][b+1]-m),l[3].set(-.25*i,-.25*i,-m-1),l[4].set(.75*i,-.25*i,-m-1),l[5].set(-.25*i,.75*i,-m-1),j[0][0]=0,j[0][1]=1,j[0][2]=2,j[1][0]=5,j[1][1]=4,j[1][2]=3,j[2][0]=0,j[2][1]=2,j[2][2]=5,j[2][3]=3,j[3][0]=1,j[3][1]=0,j[3][2]=3,j[3][3]=4,j[4][0]=4,j[4][1]=5,j[4][2]=2,j[4][3]=1),d.computeNormals(),d.computeEdges(),d.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(a,b,c,d,e)},d.prototype.calculateLocalInertia=function(a,b){return b=b||new g,b.set(0,0,0),b},d.prototype.volume=function(){return Number.MAX_VALUE},d.prototype.calculateWorldAABB=function(a,b,c,d){c.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),d.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},d.prototype.updateBoundingSphereRadius=function(){var a=this.data,b=this.elementSize;this.boundingSphereRadius=new g(a.length*b,a[0].length*b,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(a,b,c){function d(){e.call(this),this.type=e.types.PARTICLE}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3");d.prototype=new e,d.prototype.constructor=d,d.prototype.calculateLocalInertia=function(a,b){return b=b||new f,b.set(0,0,0),b},d.prototype.volume=function(){return 0},d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},d.prototype.calculateWorldAABB=function(a,b,c,d){c.copy(a),d.copy(a)}},{"../math/Vec3":30,"./Shape":43}],42:[function(a,b,c){function d(){e.call(this),this.type=e.types.PLANE,this.worldNormal=new f,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3");d.prototype=new e,d.prototype.constructor=d,d.prototype.computeWorldNormal=function(a){var b=this.worldNormal;b.set(0,0,1),a.vmult(b,b),this.worldNormalNeedsUpdate=!1},d.prototype.calculateLocalInertia=function(a,b){return b=b||new f},d.prototype.volume=function(){return Number.MAX_VALUE};var g=new f;d.prototype.calculateWorldAABB=function(a,b,c,d){g.set(0,0,1),b.vmult(g,g);var e=Number.MAX_VALUE;c.set(-e,-e,-e),d.set(e,e,e),1===g.x&&(d.x=a.x),1===g.y&&(d.y=a.y),1===g.z&&(d.z=a.z),-1===g.x&&(c.x=a.x),-1===g.y&&(c.y=a.y),-1===g.z&&(c.z=a.z)},d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(a,b,c){function d(){this.id=d.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}b.exports=d;var d=a("./Shape");a("../math/Vec3"),a("../math/Quaternion"),a("../material/Material");d.prototype.constructor=d,d.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},d.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},d.prototype.calculateLocalInertia=function(a,b){throw"calculateLocalInertia() not implemented for shape type "+this.type},d.idCounter=0,d.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(a,b,c){function d(a){if(e.call(this),this.radius=void 0!==a?Number(a):1,this.type=e.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3");d.prototype=new e,d.prototype.constructor=d,d.prototype.calculateLocalInertia=function(a,b){b=b||new f;var c=2*a*this.radius*this.radius/5;return b.x=c,b.y=c,b.z=c,b},d.prototype.volume=function(){return 4*Math.PI*this.radius/3},d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},d.prototype.calculateWorldAABB=function(a,b,c,d){for(var e=this.radius,f=["x","y","z"],g=0;g<f.length;g++){var h=f[g];c[h]=a[h]-e,d[h]=a[h]+e}}},{"../math/Vec3":30,"./Shape":43}],45:[function(a,b,c){function d(a,b){e.call(this),this.type=e.types.TRIMESH,this.vertices=new Float32Array(a),this.indices=new Int16Array(b),this.normals=new Float32Array(b.length),this.aabb=new h,this.edges=null,this.scale=new f(1,1,1),this.tree=new i,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3"),g=(a("../math/Quaternion"),a("../math/Transform")),h=a("../collision/AABB"),i=a("../utils/Octree");d.prototype=new e,d.prototype.constructor=d;var j=new f;d.prototype.updateTree=function(){var a=this.tree;a.reset(),a.aabb.copy(this.aabb);var b=this.scale;a.aabb.lowerBound.x*=1/b.x,a.aabb.lowerBound.y*=1/b.y,a.aabb.lowerBound.z*=1/b.z,a.aabb.upperBound.x*=1/b.x,a.aabb.upperBound.y*=1/b.y,a.aabb.upperBound.z*=1/b.z;for(var c=new h,d=new f,e=new f,g=new f,i=[d,e,g],j=0;j<this.indices.length/3;j++){var k=3*j;this._getUnscaledVertex(this.indices[k],d),this._getUnscaledVertex(this.indices[k+1],e),this._getUnscaledVertex(this.indices[k+2],g),c.setFromPoints(i),a.insert(c,j)}a.removeEmptyNodes()};var k=new h;d.prototype.getTrianglesInAABB=function(a,b){k.copy(a);var c=this.scale,d=c.x,e=c.y,f=c.z,g=k.lowerBound,h=k.upperBound;return g.x/=d,g.y/=e,g.z/=f,h.x/=d,h.y/=e,h.z/=f,this.tree.aabbQuery(k,b)},d.prototype.setScale=function(a){var b=this.scale.x===this.scale.y===this.scale.z,c=a.x===a.y===a.z;b&&c||this.updateNormals(),this.scale.copy(a),this.updateAABB(),this.updateBoundingSphereRadius()},d.prototype.updateNormals=function(){for(var a=j,b=this.normals,c=0;c<this.indices.length/3;c++){var e=3*c,f=this.indices[e],g=this.indices[e+1],h=this.indices[e+2];this.getVertex(f,p),this.getVertex(g,q),this.getVertex(h,r),d.computeNormal(q,p,r,a),b[e]=a.x,b[e+1]=a.y,b[e+2]=a.z}},d.prototype.updateEdges=function(){for(var a={},b=function(b,c){a[e<f?e+"_"+f:f+"_"+e]=!0},c=0;c<this.indices.length/3;c++){var d=3*c,e=this.indices[d],f=this.indices[d+1];this.indices[d+2];b(),b(),b()}var g=Object.keys(a);this.edges=new Int16Array(2*g.length);for(var c=0;c<g.length;c++){var h=g[c].split("_");this.edges[2*c]=parseInt(h[0],10),this.edges[2*c+1]=parseInt(h[1],10)}},d.prototype.getEdgeVertex=function(a,b,c){var d=this.edges[2*a+(b?1:0)];this.getVertex(d,c)};var l=new f,m=new f;d.prototype.getEdgeVector=function(a,b){var c=l,d=m;this.getEdgeVertex(a,0,c),this.getEdgeVertex(a,1,d),d.vsub(c,b)};var n=new f,o=new f;d.computeNormal=function(a,b,c,d){b.vsub(a,o),c.vsub(b,n),n.cross(o,d),d.isZero()||d.normalize()};var p=new f,q=new f,r=new f;d.prototype.getVertex=function(a,b){var c=this.scale;return this._getUnscaledVertex(a,b),b.x*=c.x,b.y*=c.y,b.z*=c.z,b},d.prototype._getUnscaledVertex=function(a,b){var c=3*a,d=this.vertices;return b.set(d[c],d[c+1],d[c+2])},d.prototype.getWorldVertex=function(a,b,c,d){return this.getVertex(a,d),g.pointToWorldFrame(b,c,d,d),d},d.prototype.getTriangleVertices=function(a,b,c,d){var e=3*a;this.getVertex(this.indices[e],b),this.getVertex(this.indices[e+1],c),this.getVertex(this.indices[e+2],d)},d.prototype.getNormal=function(a,b){var c=3*a;return b.set(this.normals[c],this.normals[c+1],this.normals[c+2])};var s=new h;d.prototype.calculateLocalInertia=function(a,b){this.computeLocalAABB(s);var c=s.upperBound.x-s.lowerBound.x,d=s.upperBound.y-s.lowerBound.y,e=s.upperBound.z-s.lowerBound.z;return b.set(1/12*a*(2*d*2*d+2*e*2*e),1/12*a*(2*c*2*c+2*e*2*e),1/12*a*(2*d*2*d+2*c*2*c))};var t=new f;d.prototype.computeLocalAABB=function(a){var b=a.lowerBound,c=a.upperBound,d=this.vertices.length,e=(this.vertices,t);this.getVertex(0,e),b.copy(e),c.copy(e);for(var f=0;f!==d;f++)this.getVertex(f,e),e.x<b.x?b.x=e.x:e.x>c.x&&(c.x=e.x),e.y<b.y?b.y=e.y:e.y>c.y&&(c.y=e.y),e.z<b.z?b.z=e.z:e.z>c.z&&(c.z=e.z)},d.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},d.prototype.updateBoundingSphereRadius=function(){for(var a=0,b=this.vertices,c=new f,d=0,e=b.length/3;d!==e;d++){this.getVertex(d,c);var g=c.norm2();g>a&&(a=g)}this.boundingSphereRadius=Math.sqrt(a)};var u=(new f,new g),v=new h;d.prototype.calculateWorldAABB=function(a,b,c,d){var e=u,f=v;e.position=a,e.quaternion=b,this.aabb.toWorldFrame(e,f),c.copy(f.lowerBound),d.copy(f.upperBound)},d.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},d.createTorus=function(a,b,c,e,f){a=a||1,b=b||.5,c=c||8,e=e||6,f=f||2*Math.PI;for(var g=[],h=[],i=0;i<=c;i++)for(var j=0;j<=e;j++){var k=j/e*f,l=i/c*Math.PI*2,m=(a+b*Math.cos(l))*Math.cos(k),n=(a+b*Math.cos(l))*Math.sin(k),o=b*Math.sin(l);g.push(m,n,o)}for(var i=1;i<=c;i++)for(var j=1;j<=e;j++){var p=(e+1)*i+j-1,q=(e+1)*(i-1)+j-1,r=(e+1)*(i-1)+j,s=(e+1)*i+j;h.push(p,q,s),h.push(q,r,s)}return new d(g,h)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(a,b,c){function d(){e.call(this),this.iterations=10,this.tolerance=1e-7}b.exports=d;var e=(a("../math/Vec3"),a("../math/Quaternion"),a("./Solver"));d.prototype=new e;var f=[],g=[],h=[];d.prototype.solve=function(a,b){var c,d,e,i,j,k,l=0,m=this.iterations,n=this.tolerance*this.tolerance,o=this.equations,p=o.length,q=b.bodies,r=q.length,s=a;if(0!==p)for(var t=0;t!==r;t++)q[t].updateSolveMassProperties();var u=g,v=h,w=f;u.length=p,v.length=p,w.length=p;for(var t=0;t!==p;t++){var x=o[t];w[t]=0,v[t]=x.computeB(s),u[t]=1/x.computeC()}if(0!==p){for(var t=0;t!==r;t++){var y=q[t],z=y.vlambda,A=y.wlambda;z.set(0,0,0),A&&A.set(0,0,0)}for(l=0;l!==m;l++){i=0;for(var B=0;B!==p;B++){var x=o[B];c=v[B],d=u[B],k=w[B],j=x.computeGWlambda(),e=d*(c-j-x.eps*k),k+e<x.minForce?e=x.minForce-k:k+e>x.maxForce&&(e=x.maxForce-k),w[B]+=e,i+=e>0?e:-e,x.addToWlambda(e)}if(i*i<n)break}for(var t=0;t!==r;t++){var y=q[t],C=y.velocity,D=y.angularVelocity;C.vadd(y.vlambda,C),D&&D.vadd(y.wlambda,D)}}return l}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(a,b,c){function d(){this.equations=[]}b.exports=d,d.prototype.solve=function(a,b){return 0},d.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)},d.prototype.removeEquation=function(a){var b=this.equations,c=b.indexOf(a);-1!==c&&b.splice(c,1)},d.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(a,b,c){function d(a){for(i.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=a,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}function e(a){for(var b=a.length,c=0;c!==b;c++){var d=a[c];if(!(d.visited||d.body.type&n))return d}return!1}function f(a,b,c,d){for(o.push(a),a.visited=!0,b(a,c,d);o.length;)for(var f,g=o.pop();f=e(g.children);)f.visited=!0,b(f,c,d),o.push(f)}function g(a,b,c){b.push(a.body);for(var d=a.eqs.length,e=0;e!==d;e++){var f=a.eqs[e];-1===c.indexOf(f)&&c.push(f)}}function h(a,b){return b.id-a.id}b.exports=d;var i=(a("../math/Vec3"),a("../math/Quaternion"),a("./Solver")),j=a("../objects/Body");d.prototype=new i;var k=[],l=[],m={bodies:[]},n=j.STATIC,o=[];d.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},d.prototype.solve=function(a,b){for(var c=k,d=this.nodePool,i=b.bodies,j=this.equations,n=j.length,o=i.length,p=this.subsolver;d.length<o;)d.push(this.createNode());c.length=o;for(var q=0;q<o;q++)c[q]=d[q];for(var q=0;q!==o;q++){var r=c[q];r.body=i[q],r.children.length=0,r.eqs.length=0,r.visited=!1}for(var s=0;s!==n;s++){var t=j[s],q=i.indexOf(t.bi),u=i.indexOf(t.bj),v=c[q],w=c[u];v.children.push(w),v.eqs.push(t),w.children.push(v),w.eqs.push(t)}var x,y=0,z=l;p.tolerance=this.tolerance,p.iterations=this.iterations;for(var A=m;x=e(c);){z.length=0,A.bodies.length=0,f(x,g,A.bodies,z);var B=z.length;z=z.sort(h);for(var q=0;q!==B;q++)p.addEquation(z[q]);p.solve(a,A);p.removeAllEquations(),y++}return y}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(a,b,c){var d=function(){};b.exports=d,d.prototype={constructor:d,addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;return void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b),this},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){if(void 0===this._listeners)return this;var c=this._listeners;if(void 0===c[a])return this;var d=c[a].indexOf(b);return-1!==d&&c[a].splice(d,1),this},dispatchEvent:function(a){if(void 0===this._listeners)return this;var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=0,e=c.length;d<e;d++)c[d].call(this,a)}return this}}},{}],50:[function(a,b,c){function d(a){a=a||{},this.root=a.root||null,this.aabb=a.aabb?a.aabb.clone():new f,this.data=[],this.children=[]}function e(a,b){b=b||{},b.root=null,b.aabb=a,d.call(this,b),this.maxDepth=void 0!==b.maxDepth?b.maxDepth:8}var f=a("../collision/AABB"),g=a("../math/Vec3");b.exports=e,e.prototype=new d,d.prototype.reset=function(a,b){this.children.length=this.data.length=0},d.prototype.insert=function(a,b,c){var d=this.data;if(c=c||0,!this.aabb.contains(a))return!1;var e=this.children;if(c<(this.maxDepth||this.root.maxDepth)){var f=!1;e.length||(this.subdivide(),f=!0);for(var g=0;8!==g;g++)if(e[g].insert(a,b,c+1))return!0;f&&(e.length=0)}return d.push(b),!0};var h=new g;d.prototype.subdivide=function(){var a=this.aabb,b=a.lowerBound,c=a.upperBound,e=this.children;e.push(new d({aabb:new f({lowerBound:new g(0,0,0)})}),new d({aabb:new f({lowerBound:new g(1,0,0)})}),new d({aabb:new f({lowerBound:new g(1,1,0)})}),new d({aabb:new f({lowerBound:new g(1,1,1)})}),new d({aabb:new f({lowerBound:new g(0,1,1)})}),new d({aabb:new f({lowerBound:new g(0,0,1)})}),new d({aabb:new f({lowerBound:new g(1,0,1)})}),new d({aabb:new f({lowerBound:new g(0,1,0)})})),c.vsub(b,h),h.scale(.5,h);for(var i=this.root||this,j=0;8!==j;j++){var k=e[j];k.root=i;var l=k.aabb.lowerBound;l.x*=h.x,l.y*=h.y,l.z*=h.z,l.vadd(b,l),l.vadd(h,k.aabb.upperBound)}},d.prototype.aabbQuery=function(a,b){for(var c=(this.data,this.children,[this]);c.length;){var d=c.pop();d.aabb.overlaps(a)&&Array.prototype.push.apply(b,d.data),Array.prototype.push.apply(c,d.children)}return b};var i=new f;d.prototype.rayQuery=function(a,b,c){return a.getAABB(i),i.toLocalFrame(b,i),this.aabbQuery(i,c),c},d.prototype.removeEmptyNodes=function(){for(var a=[this];a.length;){for(var b=a.pop(),c=b.children.length-1;c>=0;c--)b.children[c].data.length||b.children.splice(c,1);Array.prototype.push.apply(a,b.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(a,b,c){function d(){this.objects=[],this.type=Object}b.exports=d,d.prototype.release=function(){for(var a=arguments.length,b=0;b!==a;b++)this.objects.push(arguments[b])},d.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},d.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(a,b,c){function d(){this.data={keys:[]}}b.exports=d,d.prototype.get=function(a,b){if(a>b){var c=b;b=a,a=c}return this.data[a+"-"+b]},d.prototype.set=function(a,b,c){if(a>b){var d=b;b=a,a=d}var e=a+"-"+b;this.get(a,b)||this.data.keys.push(e),this.data[e]=c},d.prototype.reset=function(){for(var a=this.data,b=a.keys;b.length>0;){delete a[b.pop()]}}},{}],53:[function(a,b,c){function d(){}b.exports=d,d.defaults=function(a,b){a=a||{};for(var c in b)c in a||(a[c]=b[c]);return a}},{}],54:[function(a,b,c){function d(){f.call(this),this.type=e}b.exports=d;var e=a("../math/Vec3"),f=a("./Pool");d.prototype=new f,d.prototype.constructObject=function(){return new e}},{"../math/Vec3":30,"./Pool":51}],55:[function(a,b,c){function d(a){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new l,this.world=a,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function e(a,b,c){for(var d=null,e=a.length,f=0;f!==e;f++){var g=a[f],h=P;a[(f+1)%e].vsub(g,h);var i=Q;h.cross(b,i);var j=R;c.vsub(g,j);var k=i.dot(j);if(!(null===d||k>0&&!0===d||k<=0&&!1===d))return!1;null===d&&(d=k>0)}return!0}b.exports=d;var f=a("../collision/AABB"),g=a("../shapes/Shape"),h=a("../collision/Ray"),i=a("../math/Vec3"),j=a("../math/Transform"),k=(a("../shapes/ConvexPolyhedron"),a("../math/Quaternion")),l=(a("../solver/Solver"),a("../utils/Vec3Pool")),m=a("../equations/ContactEquation"),n=a("../equations/FrictionEquation");d.prototype.createContactEquation=function(a,b,c,d,e,f){var g;this.contactPointPool.length?(g=this.contactPointPool.pop(),g.bi=a,g.bj=b):g=new m(a,b),g.enabled=a.collisionResponse&&b.collisionResponse&&c.collisionResponse&&d.collisionResponse;var h=this.currentContactMaterial;g.restitution=h.restitution,g.setSpookParams(h.contactEquationStiffness,h.contactEquationRelaxation,this.world.dt);var i=c.material||a.material,j=d.material||b.material;return i&&j&&i.restitution>=0&&j.restitution>=0&&(g.restitution=i.restitution*j.restitution),g.si=e||c,g.sj=f||d,g},d.prototype.createFrictionEquationsFromContact=function(a,b){var c=a.bi,d=a.bj,e=a.si,f=a.sj,g=this.world,h=this.currentContactMaterial,i=h.friction,j=e.material||c.material,k=f.material||d.material;if(j&&k&&j.friction>=0&&k.friction>=0&&(i=j.friction*k.friction),i>0){var l=i*g.gravity.length(),m=c.invMass+d.invMass;m>0&&(m=1/m);var o=this.frictionEquationPool,p=o.length?o.pop():new n(c,d,l*m),q=o.length?o.pop():new n(c,d,l*m);return p.bi=q.bi=c,p.bj=q.bj=d,p.minForce=q.minForce=-l*m,p.maxForce=q.maxForce=l*m,p.ri.copy(a.ri),p.rj.copy(a.rj),q.ri.copy(a.ri),q.rj.copy(a.rj),a.ni.tangents(p.t,q.t),p.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,g.dt),q.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,g.dt),p.enabled=q.enabled=a.enabled,b.push(p,q),!0}return!1};var o=new i,p=new i,q=new i;d.prototype.createFrictionFromAverage=function(a){var b=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(b,this.frictionResult)&&1!==a){var c=this.frictionResult[this.frictionResult.length-2],d=this.frictionResult[this.frictionResult.length-1];o.setZero(),p.setZero(),q.setZero();for(var e=b.bi,f=(b.bj,0);f!==a;f++)b=this.result[this.result.length-1-f],b.bodyA!==e?(o.vadd(b.ni,o),p.vadd(b.ri,p),q.vadd(b.rj,q)):(o.vsub(b.ni,o),p.vadd(b.rj,p),q.vadd(b.ri,q));var g=1/a;p.scale(g,c.ri),q.scale(g,c.rj),d.ri.copy(c.ri),d.rj.copy(c.rj),o.normalize(),o.tangents(c.t,d.t)}};var r=new i,s=new i,t=new k,u=new k;d.prototype.getContacts=function(a,b,c,d,e,f,g){this.contactPointPool=e,this.frictionEquationPool=g,this.result=d,this.frictionResult=f;for(var h=t,i=u,j=r,k=s,l=0,m=a.length;l!==m;l++){var n=a[l],o=b[l],p=null;n.material&&o.material&&(p=c.getContactMaterial(n.material,o.material)||null);for(var q=0;q<n.shapes.length;q++){n.quaternion.mult(n.shapeOrientations[q],h),n.quaternion.vmult(n.shapeOffsets[q],j),j.vadd(n.position,j);for(var v=n.shapes[q],w=0;w<o.shapes.length;w++){o.quaternion.mult(o.shapeOrientations[w],i),o.quaternion.vmult(o.shapeOffsets[w],k),k.vadd(o.position,k);var x=o.shapes[w];if(!(j.distanceTo(k)>v.boundingSphereRadius+x.boundingSphereRadius)){var y=null;v.material&&x.material&&(y=c.getContactMaterial(v.material,x.material)||null),this.currentContactMaterial=y||p||c.defaultContactMaterial;var z=this[v.type|x.type];z&&(v.type<x.type?z.call(this,v,x,j,k,h,i,n,o,v,x):z.call(this,x,v,k,j,i,h,o,n,v,x))}}}}};d.prototype[g.types.BOX|g.types.BOX]=d.prototype.boxBox=function(a,b,c,d,e,f,g,h){a.convexPolyhedronRepresentation.material=a.material,b.convexPolyhedronRepresentation.material=b.material,a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse,b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse,this.convexConvex(a.convexPolyhedronRepresentation,b.convexPolyhedronRepresentation,c,d,e,f,g,h,a,b)},d.prototype[g.types.BOX|g.types.CONVEXPOLYHEDRON]=d.prototype.boxConvex=function(a,b,c,d,e,f,g,h){a.convexPolyhedronRepresentation.material=a.material,a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse,this.convexConvex(a.convexPolyhedronRepresentation,b,c,d,e,f,g,h,a,b)},d.prototype[g.types.BOX|g.types.PARTICLE]=d.prototype.boxParticle=function(a,b,c,d,e,f,g,h){a.convexPolyhedronRepresentation.material=a.material,a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse,this.convexParticle(a.convexPolyhedronRepresentation,b,c,d,e,f,g,h,a,b)},d.prototype[g.types.SPHERE]=d.prototype.sphereSphere=function(a,b,c,d,e,f,g,h){var i=this.createContactEquation(g,h,a,b);d.vsub(c,i.ni),i.ni.normalize(),i.ri.copy(i.ni),i.rj.copy(i.ni),i.ri.mult(a.radius,i.ri),i.rj.mult(-b.radius,i.rj),i.ri.vadd(c,i.ri),i.ri.vsub(g.position,i.ri),i.rj.vadd(d,i.rj),i.rj.vsub(h.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)};var v=new i,w=new i,x=new i;d.prototype[g.types.PLANE|g.types.TRIMESH]=d.prototype.planeTrimesh=function(a,b,c,d,e,f,g,h){var k=new i,l=v;l.set(0,0,1),e.vmult(l,l);for(var m=0;m<b.vertices.length/3;m++){b.getVertex(m,k);var n=new i;n.copy(k),j.pointToWorldFrame(d,f,n,k);var o=w;k.vsub(c,o);if(l.dot(o)<=0){var p=this.createContactEquation(g,h,a,b);p.ni.copy(l);var q=x;l.scale(o.dot(l),q),k.vsub(q,q),p.ri.copy(q),p.ri.vsub(g.position,p.ri),p.rj.copy(k),p.rj.vsub(h.position,p.rj),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}}};var y=new i,z=new i,A=(new i,new i),B=new i,C=new i,D=new i,E=new i,F=new i,G=new i,H=new i,I=new i,J=new i,K=new i,L=new f,M=[];d.prototype[g.types.SPHERE|g.types.TRIMESH]=d.prototype.sphereTrimesh=function(a,b,c,d,e,f,g,i){var k=C,l=D,m=E,n=F,o=G,p=H,q=L,r=B,s=z,t=M;j.pointToLocalFrame(d,f,c,o);var u=a.radius;q.lowerBound.set(o.x-u,o.y-u,o.z-u),q.upperBound.set(o.x+u,o.y+u,o.z+u),b.getTrianglesInAABB(q,t);for(var v=A,w=a.radius*a.radius,x=0;x<t.length;x++)for(var N=0;N<3;N++)if(b.getVertex(b.indices[3*t[x]+N],v),v.vsub(o,s),s.norm2()<=w){r.copy(v),j.pointToWorldFrame(d,f,r,v),v.vsub(c,s);var O=this.createContactEquation(g,i,a,b);O.ni.copy(s),O.ni.normalize(),O.ri.copy(O.ni),O.ri.scale(a.radius,O.ri),O.ri.vadd(c,O.ri),O.ri.vsub(g.position,O.ri),O.rj.copy(v),O.rj.vsub(i.position,O.rj),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}for(var x=0;x<t.length;x++)for(var N=0;N<3;N++){b.getVertex(b.indices[3*t[x]+N],k),b.getVertex(b.indices[3*t[x]+(N+1)%3],l),l.vsub(k,m),o.vsub(l,p);var P=p.dot(m);o.vsub(k,p);var Q=p.dot(m);if(Q>0&&P<0){o.vsub(k,p),n.copy(m),n.normalize(),Q=p.dot(n),n.scale(Q,p),p.vadd(k,p);var R=p.distanceTo(o);if(R<a.radius){var O=this.createContactEquation(g,i,a,b);p.vsub(o,O.ni),O.ni.normalize(),O.ni.scale(a.radius,O.ri),j.pointToWorldFrame(d,f,p,p),p.vsub(i.position,O.rj),j.vectorToWorldFrame(f,O.ni,O.ni),j.vectorToWorldFrame(f,O.ri,O.ri),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}}}for(var S=I,T=J,U=K,V=y,x=0,W=t.length;x!==W;x++){b.getTriangleVertices(t[x],S,T,U),b.getNormal(t[x],V),o.vsub(S,p);var R=p.dot(V);if(V.scale(R,p),o.vsub(p,p),R=p.distanceTo(o),h.pointInTriangle(p,S,T,U)&&R<a.radius){var O=this.createContactEquation(g,i,a,b);p.vsub(o,O.ni),O.ni.normalize(),O.ni.scale(a.radius,O.ri),j.pointToWorldFrame(d,f,p,p),p.vsub(i.position,O.rj),j.vectorToWorldFrame(f,O.ni,O.ni),j.vectorToWorldFrame(f,O.ri,O.ri),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}}t.length=0};var N=new i,O=new i;d.prototype[g.types.SPHERE|g.types.PLANE]=d.prototype.spherePlane=function(a,b,c,d,e,f,g,h){var i=this.createContactEquation(g,h,a,b);if(i.ni.set(0,0,1),f.vmult(i.ni,i.ni),i.ni.negate(i.ni),i.ni.normalize(),i.ni.mult(a.radius,i.ri),c.vsub(d,N),i.ni.mult(i.ni.dot(N),O),N.vsub(O,i.rj),-N.dot(i.ni)<=a.radius){var j=i.ri,k=i.rj;j.vadd(c,j),j.vsub(g.position,j),k.vadd(d,k),k.vsub(h.position,k),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}};var P=new i,Q=new i,R=new i,S=new i,T=new i,U=new i,V=new i,W=[new i,new i,new i,new i,new i,new i],X=new i,Y=new i,Z=new i,$=new i;d.prototype[g.types.SPHERE|g.types.BOX]=d.prototype.sphereBox=function(a,b,c,d,e,f,g,h){var i=this.v3pool,j=W;c.vsub(d,S),b.getSideNormals(j,f);for(var k=a.radius,l=!1,m=Y,n=Z,o=$,p=null,q=0,r=0,s=0,t=null,u=0,v=j.length;u!==v&&!1===l;u++){var w=T;w.copy(j[u]);var x=w.norm();w.normalize();var y=S.dot(w);if(y<x+k&&y>0){var z=U,A=V;z.copy(j[(u+1)%3]),A.copy(j[(u+2)%3]);var B=z.norm(),C=A.norm();z.normalize(),A.normalize();var D=S.dot(z),E=S.dot(A);if(D<B&&D>-B&&E<C&&E>-C){var F=Math.abs(y-x-k);(null===t||F<t)&&(t=F,r=D,s=E,p=x,m.copy(w),n.copy(z),o.copy(A),q++)}}}if(q){l=!0;var G=this.createContactEquation(g,h,a,b);m.mult(-k,G.ri),G.ni.copy(m),G.ni.negate(G.ni),m.mult(p,m),n.mult(r,n),m.vadd(n,m),o.mult(s,o),m.vadd(o,G.rj),G.ri.vadd(c,G.ri),G.ri.vsub(g.position,G.ri),G.rj.vadd(d,G.rj),G.rj.vsub(h.position,G.rj),this.result.push(G),this.createFrictionEquationsFromContact(G,this.frictionResult)}for(var H=i.get(),I=X,J=0;2!==J&&!l;J++)for(var K=0;2!==K&&!l;K++)for(var L=0;2!==L&&!l;L++)if(H.set(0,0,0),J?H.vadd(j[0],H):H.vsub(j[0],H),K?H.vadd(j[1],H):H.vsub(j[1],H),L?H.vadd(j[2],H):H.vsub(j[2],H),d.vadd(H,I),I.vsub(c,I),I.norm2()<k*k){l=!0;var G=this.createContactEquation(g,h,a,b);G.ri.copy(I),G.ri.normalize(),G.ni.copy(G.ri),G.ri.mult(k,G.ri),G.rj.copy(H),G.ri.vadd(c,G.ri),G.ri.vsub(g.position,G.ri),G.rj.vadd(d,G.rj),G.rj.vsub(h.position,G.rj),this.result.push(G),this.createFrictionEquationsFromContact(G,this.frictionResult)}i.release(H),H=null;for(var M=i.get(),N=i.get(),G=i.get(),O=i.get(),F=i.get(),P=j.length,J=0;J!==P&&!l;J++)for(var K=0;K!==P&&!l;K++)if(J%3!=K%3){j[K].cross(j[J],M),M.normalize(),j[J].vadd(j[K],N),G.copy(c),G.vsub(N,G),G.vsub(d,G);var Q=G.dot(M);M.mult(Q,O);for(var L=0;L===J%3||L===K%3;)L++;F.copy(c),F.vsub(O,F),F.vsub(N,F),F.vsub(d,F);var R=Math.abs(Q),_=F.norm();if(R<j[L].norm()&&_<k){l=!0;var aa=this.createContactEquation(g,h,a,b);N.vadd(O,aa.rj),aa.rj.copy(aa.rj),F.negate(aa.ni),aa.ni.normalize(),aa.ri.copy(aa.rj),aa.ri.vadd(d,aa.ri),aa.ri.vsub(c,aa.ri),aa.ri.normalize(),aa.ri.mult(k,aa.ri),aa.ri.vadd(c,aa.ri),aa.ri.vsub(g.position,aa.ri),aa.rj.vadd(d,aa.rj),aa.rj.vsub(h.position,aa.rj),this.result.push(aa),this.createFrictionEquationsFromContact(aa,this.frictionResult)}}i.release(M,N,G,O,F)};var _=new i,aa=new i,ba=new i,ca=new i,da=new i,ea=new i,fa=new i,ga=new i,ha=new i,ia=new i;d.prototype[g.types.SPHERE|g.types.CONVEXPOLYHEDRON]=d.prototype.sphereConvex=function(a,b,c,d,f,g,h,i){var j=this.v3pool;c.vsub(d,_);for(var k=b.faceNormals,l=b.faces,m=b.vertices,n=a.radius,o=0;o!==m.length;o++){var p=m[o],q=da;g.vmult(p,q),d.vadd(q,q);var r=ca;if(q.vsub(c,r),r.norm2()<n*n){t=!0;var s=this.createContactEquation(h,i,a,b);return s.ri.copy(r),s.ri.normalize(),s.ni.copy(s.ri),s.ri.mult(n,s.ri),q.vsub(d,s.rj),s.ri.vadd(c,s.ri),s.ri.vsub(h.position,s.ri),s.rj.vadd(d,s.rj),s.rj.vsub(i.position,s.rj),this.result.push(s),void this.createFrictionEquationsFromContact(s,this.frictionResult)}}for(var t=!1,o=0,u=l.length;o!==u&&!1===t;o++){var v=k[o],w=l[o],x=ea;g.vmult(v,x);var y=fa;g.vmult(m[w[0]],y),y.vadd(d,y);var z=ga;x.mult(-n,z),c.vadd(z,z);var A=ha;z.vsub(y,A);var B=A.dot(x),C=ia;if(c.vsub(y,C),B<0&&C.dot(x)>0){for(var D=[],E=0,F=w.length;E!==F;E++){var G=j.get();g.vmult(m[w[E]],G),d.vadd(G,G),D.push(G)}if(e(D,x,c)){t=!0;var s=this.createContactEquation(h,i,a,b);x.mult(-n,s.ri),x.negate(s.ni);var H=j.get();x.mult(-B,H);var I=j.get();x.mult(-n,I),c.vsub(d,s.rj),s.rj.vadd(I,s.rj),s.rj.vadd(H,s.rj),s.rj.vadd(d,s.rj),s.rj.vsub(i.position,s.rj),s.ri.vadd(c,s.ri),s.ri.vsub(h.position,s.ri),j.release(H),j.release(I),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(var E=0,J=D.length;E!==J;E++)j.release(D[E]);return}for(var E=0;E!==w.length;E++){var K=j.get(),L=j.get();g.vmult(m[w[(E+1)%w.length]],K),g.vmult(m[w[(E+2)%w.length]],L),d.vadd(K,K),d.vadd(L,L);var M=aa;L.vsub(K,M);var N=ba;M.unit(N);var O=j.get(),P=j.get();c.vsub(K,P);var Q=P.dot(N);N.mult(Q,O),O.vadd(K,O);var R=j.get();if(O.vsub(c,R),Q>0&&Q*Q<M.norm2()&&R.norm2()<n*n){var s=this.createContactEquation(h,i,a,b);O.vsub(d,s.rj),O.vsub(c,s.ni),s.ni.normalize(),s.ni.mult(n,s.ri),s.rj.vadd(d,s.rj),s.rj.vsub(i.position,s.rj),s.ri.vadd(c,s.ri),s.ri.vsub(h.position,s.ri),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(var E=0,J=D.length;E!==J;E++)j.release(D[E]);return j.release(K),j.release(L),j.release(O),j.release(R),void j.release(P)}j.release(K),j.release(L),j.release(O),j.release(R),j.release(P)}for(var E=0,J=D.length;E!==J;E++)j.release(D[E])}}};new i,new i;d.prototype[g.types.PLANE|g.types.BOX]=d.prototype.planeBox=function(a,b,c,d,e,f,g,h){b.convexPolyhedronRepresentation.material=b.material,b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse,this.planeConvex(a,b.convexPolyhedronRepresentation,c,d,e,f,g,h)};var ja=new i,ka=new i,la=new i,ma=new i;d.prototype[g.types.PLANE|g.types.CONVEXPOLYHEDRON]=d.prototype.planeConvex=function(a,b,c,d,e,f,g,h){var i=ja,j=ka;j.set(0,0,1),e.vmult(j,j);for(var k=0,l=la,m=0;m!==b.vertices.length;m++){i.copy(b.vertices[m]),f.vmult(i,i),d.vadd(i,i),i.vsub(c,l);if(j.dot(l)<=0){var n=this.createContactEquation(g,h,a,b),o=ma;j.mult(j.dot(l),o),i.vsub(o,o),o.vsub(c,n.ri),n.ni.copy(j),i.vsub(d,n.rj),n.ri.vadd(c,n.ri),n.ri.vsub(g.position,n.ri),n.rj.vadd(d,n.rj),n.rj.vsub(h.position,n.rj),this.result.push(n),k++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(n,this.frictionResult)}}this.enableFrictionReduction&&k&&this.createFrictionFromAverage(k)};var na=new i,oa=new i;d.prototype[g.types.CONVEXPOLYHEDRON]=d.prototype.convexConvex=function(a,b,c,d,e,f,g,h,i,j,k,l){var m=na;if(!(c.distanceTo(d)>a.boundingSphereRadius+b.boundingSphereRadius)&&a.findSeparatingAxis(b,c,e,d,f,m,k,l)){var n=[],o=oa;a.clipAgainstHull(c,e,b,d,f,m,-100,100,n);for(var p=0,q=0;q!==n.length;q++){var r=this.createContactEquation(g,h,a,b,i,j),s=r.ri,t=r.rj;m.negate(r.ni),n[q].normal.negate(o),o.mult(n[q].depth,o),n[q].point.vadd(o,s),t.copy(n[q].point),s.vsub(c,s),t.vsub(d,t),s.vadd(c,s),s.vsub(g.position,s),t.vadd(d,t),t.vsub(h.position,t),this.result.push(r),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(r,this.frictionResult)}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}};var pa=new i,qa=new i,ra=new i;d.prototype[g.types.PLANE|g.types.PARTICLE]=d.prototype.planeParticle=function(a,b,c,d,e,f,g,h){var i=pa;i.set(0,0,1),g.quaternion.vmult(i,i);var j=qa;if(d.vsub(g.position,j),i.dot(j)<=0){
var k=this.createContactEquation(h,g,b,a);k.ni.copy(i),k.ni.negate(k.ni),k.ri.set(0,0,0);var l=ra;i.mult(i.dot(d),l),d.vsub(l,l),k.rj.copy(l),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult)}};var sa=new i;d.prototype[g.types.PARTICLE|g.types.SPHERE]=d.prototype.sphereParticle=function(a,b,c,d,e,f,g,h){var i=sa;if(i.set(0,0,1),d.vsub(c,i),i.norm2()<=a.radius*a.radius){var j=this.createContactEquation(h,g,b,a);i.normalize(),j.rj.copy(i),j.rj.mult(a.radius,j.rj),j.ni.copy(i),j.ni.negate(j.ni),j.ri.set(0,0,0),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}};var ta=new k,ua=new i,va=(new i,new i),wa=new i,xa=new i;d.prototype[g.types.PARTICLE|g.types.CONVEXPOLYHEDRON]=d.prototype.convexParticle=function(a,b,c,d,e,f,g,h){var i=-1,j=va,k=xa,l=null,m=0,n=ua;if(n.copy(d),n.vsub(c,n),e.conjugate(ta),ta.vmult(n,n),a.pointIsInside(n)){a.worldVerticesNeedsUpdate&&a.computeWorldVertices(c,e),a.worldFaceNormalsNeedsUpdate&&a.computeWorldFaceNormals(e);for(var o=0,p=a.faces.length;o!==p;o++){var q=[a.worldVertices[a.faces[o][0]]],r=a.worldFaceNormals[o];d.vsub(q[0],wa);var s=-r.dot(wa);(null===l||Math.abs(s)<Math.abs(l))&&(l=s,i=o,j.copy(r),m++)}if(-1!==i){var t=this.createContactEquation(h,g,b,a);j.mult(l,k),k.vadd(d,k),k.vsub(c,k),t.rj.copy(k),j.negate(t.ni),t.ri.set(0,0,0);var u=t.ri,v=t.rj;u.vadd(d,u),u.vsub(h.position,u),v.vadd(c,v),v.vsub(g.position,v),this.result.push(t),this.createFrictionEquationsFromContact(t,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},d.prototype[g.types.BOX|g.types.HEIGHTFIELD]=d.prototype.boxHeightfield=function(a,b,c,d,e,f,g,h){a.convexPolyhedronRepresentation.material=a.material,a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse,this.convexHeightfield(a.convexPolyhedronRepresentation,b,c,d,e,f,g,h)};var ya=new i,za=new i,Aa=[0];d.prototype[g.types.CONVEXPOLYHEDRON|g.types.HEIGHTFIELD]=d.prototype.convexHeightfield=function(a,b,c,d,e,f,g,h){var i=b.data,k=b.elementSize,l=a.boundingSphereRadius,m=za,n=Aa,o=ya;j.pointToLocalFrame(d,f,c,o);var p=Math.floor((o.x-l)/k)-1,q=Math.ceil((o.x+l)/k)+1,r=Math.floor((o.y-l)/k)-1,s=Math.ceil((o.y+l)/k)+1;if(!(q<0||s<0||p>i.length||r>i[0].length)){p<0&&(p=0),q<0&&(q=0),r<0&&(r=0),s<0&&(s=0),p>=i.length&&(p=i.length-1),q>=i.length&&(q=i.length-1),s>=i[0].length&&(s=i[0].length-1),r>=i[0].length&&(r=i[0].length-1);var t=[];b.getRectMinMax(p,r,q,s,t);var u=t[0],v=t[1];if(!(o.z-l>v||o.z+l<u))for(var w=p;w<q;w++)for(var x=r;x<s;x++)b.getConvexTrianglePillar(w,x,!1),j.pointToWorldFrame(d,f,b.pillarOffset,m),c.distanceTo(m)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.convexConvex(a,b.pillarConvex,c,m,e,f,g,h,null,null,n,null),b.getConvexTrianglePillar(w,x,!0),j.pointToWorldFrame(d,f,b.pillarOffset,m),c.distanceTo(m)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.convexConvex(a,b.pillarConvex,c,m,e,f,g,h,null,null,n,null)}};var Ba=new i,Ca=new i;d.prototype[g.types.SPHERE|g.types.HEIGHTFIELD]=d.prototype.sphereHeightfield=function(a,b,c,d,e,f,g,h){var i=b.data,k=a.radius,l=b.elementSize,m=Ca,n=Ba;j.pointToLocalFrame(d,f,c,n);var o=Math.floor((n.x-k)/l)-1,p=Math.ceil((n.x+k)/l)+1,q=Math.floor((n.y-k)/l)-1,r=Math.ceil((n.y+k)/l)+1;if(!(p<0||r<0||o>i.length||r>i[0].length)){o<0&&(o=0),p<0&&(p=0),q<0&&(q=0),r<0&&(r=0),o>=i.length&&(o=i.length-1),p>=i.length&&(p=i.length-1),r>=i[0].length&&(r=i[0].length-1),q>=i[0].length&&(q=i[0].length-1);var s=[];b.getRectMinMax(o,q,p,r,s);var t=s[0],u=s[1];if(!(n.z-k>u||n.z+k<t))for(var v=this.result,w=o;w<p;w++)for(var x=q;x<r;x++){var y=v.length;b.getConvexTrianglePillar(w,x,!1),j.pointToWorldFrame(d,f,b.pillarOffset,m),c.distanceTo(m)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.sphereConvex(a,b.pillarConvex,c,m,e,f,g,h),b.getConvexTrianglePillar(w,x,!0),j.pointToWorldFrame(d,f,b.pillarOffset,m),c.distanceTo(m)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.sphereConvex(a,b.pillarConvex,c,m,e,f,g,h);var z=v.length-y;if(z>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(a,b,c){function d(){j.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new f,this.broadphase=new s,this.bodies=[],this.solver=new h,this.constraints=[],this.narrowphase=new i(this),this.collisionMatrix=new k,this.collisionMatrixPrevious=new k,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new o,this.defaultMaterial=new l("default"),this.defaultContactMaterial=new m(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}b.exports=d;var e=a("../shapes/Shape"),f=a("../math/Vec3"),g=a("../math/Quaternion"),h=a("../solver/GSSolver"),i=(a("../utils/Vec3Pool"),a("../equations/ContactEquation"),a("../equations/FrictionEquation"),a("./Narrowphase")),j=a("../utils/EventTarget"),k=a("../collision/ArrayCollisionMatrix"),l=a("../material/Material"),m=a("../material/ContactMaterial"),n=a("../objects/Body"),o=a("../utils/TupleDictionary"),p=a("../collision/RaycastResult"),q=a("../collision/AABB"),r=a("../collision/Ray"),s=a("../collision/NaiveBroadphase");d.prototype=new j;var t=(new q,new r);if(d.prototype.getContactMaterial=function(a,b){return this.contactMaterialTable.get(a.id,b.id)},d.prototype.numObjects=function(){return this.bodies.length},d.prototype.collisionMatrixTick=function(){var a=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=a,this.collisionMatrix.reset()},d.prototype.add=d.prototype.addBody=function(a){-1===this.bodies.indexOf(a)&&(a.index=this.bodies.length,this.bodies.push(a),a.world=this,a.initPosition.copy(a.position),a.initVelocity.copy(a.velocity),a.timeLastSleepy=this.time,a instanceof n&&(a.initAngularVelocity.copy(a.angularVelocity),a.initQuaternion.copy(a.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=a,this.dispatchEvent(this.addBodyEvent))},d.prototype.addConstraint=function(a){this.constraints.push(a)},d.prototype.removeConstraint=function(a){var b=this.constraints.indexOf(a);-1!==b&&this.constraints.splice(b,1)},d.prototype.rayTest=function(a,b,c){c instanceof p?this.raycastClosest(a,b,{skipBackfaces:!0},c):this.raycastAll(a,b,{skipBackfaces:!0},c)},d.prototype.raycastAll=function(a,b,c,d){return c.mode=r.ALL,c.from=a,c.to=b,c.callback=d,t.intersectWorld(this,c)},d.prototype.raycastAny=function(a,b,c,d){return c.mode=r.ANY,c.from=a,c.to=b,c.result=d,t.intersectWorld(this,c)},d.prototype.raycastClosest=function(a,b,c,d){return c.mode=r.CLOSEST,c.from=a,c.to=b,c.result=d,t.intersectWorld(this,c)},d.prototype.remove=function(a){a.world=null;var b=this.bodies.length-1,c=this.bodies,d=c.indexOf(a);if(-1!==d){c.splice(d,1);for(var e=0;e!==c.length;e++)c[e].index=e;this.collisionMatrix.setNumObjects(b),this.removeBodyEvent.body=a,this.dispatchEvent(this.removeBodyEvent)}},d.prototype.removeBody=d.prototype.remove,d.prototype.addMaterial=function(a){this.materials.push(a)},d.prototype.addContactMaterial=function(a){this.contactmaterials.push(a),this.contactMaterialTable.set(a.materials[0].id,a.materials[1].id,a)},"undefined"==typeof performance&&(performance={}),!performance.now){var u=Date.now();performance.timing&&performance.timing.navigationStart&&(u=performance.timing.navigationStart),performance.now=function(){return Date.now()-u}}var v=new f;d.prototype.step=function(a,b,c){if(c=c||10,0===(b=b||0))this.internalStep(a),this.time+=a;else{var d=Math.floor((this.time+b)/a)-Math.floor(this.time/a);d=Math.min(d,c);for(var e=performance.now(),f=0;f!==d&&(this.internalStep(a),!(performance.now()-e>1e3*a));f++);this.time+=b;for(var g=this.time%a,h=g/a,i=v,j=this.bodies,k=0;k!==j.length;k++){var l=j[k];l.type!==n.STATIC&&l.sleepState!==n.SLEEPING?(l.position.vsub(l.previousPosition,i),i.scale(h,i),l.position.vadd(i,l.interpolatedPosition)):(l.interpolatedPosition.copy(l.position),l.interpolatedQuaternion.copy(l.quaternion))}}};var w={type:"postStep"},x={type:"preStep"},y={type:"collide",body:null,contact:null},z=[],A=[],B=[],C=[],D=(new f,new f,new f,new f,new f,new f,new f,new f,new f,new g,new g),E=new g,F=new f;d.prototype.internalStep=function(a){this.dt=a;var b,c=this.contacts,d=B,f=C,g=this.numObjects(),h=this.bodies,i=this.solver,j=this.gravity,k=this.doProfiling,l=this.profile,m=n.DYNAMIC,o=this.constraints,p=A,q=(j.norm(),j.x),r=j.y,s=j.z,t=0;for(k&&(b=performance.now()),t=0;t!==g;t++){var u=h[t];if(u.type&m){var v=u.force,G=u.mass;v.x+=G*q,v.y+=G*r,v.z+=G*s}}for(var t=0,H=this.subsystems.length;t!==H;t++)this.subsystems[t].update();k&&(b=performance.now()),d.length=0,f.length=0,this.broadphase.collisionPairs(this,d,f),k&&(l.broadphase=performance.now()-b);var I=o.length;for(t=0;t!==I;t++){var J=o[t];if(!J.collideConnected)for(var K=d.length-1;K>=0;K-=1)(J.bodyA===d[K]&&J.bodyB===f[K]||J.bodyB===d[K]&&J.bodyA===f[K])&&(d.splice(K,1),f.splice(K,1))}this.collisionMatrixTick(),k&&(b=performance.now());var L=z,M=c.length;for(t=0;t!==M;t++)L.push(c[t]);c.length=0;var N=this.frictionEquations.length;for(t=0;t!==N;t++)p.push(this.frictionEquations[t]);this.frictionEquations.length=0,this.narrowphase.getContacts(d,f,this,c,L,this.frictionEquations,p),k&&(l.narrowphase=performance.now()-b),k&&(b=performance.now());for(var t=0;t<this.frictionEquations.length;t++)i.addEquation(this.frictionEquations[t]);for(var O=c.length,P=0;P!==O;P++){var Q,J=c[P],u=J.bi,R=J.bj;J.si,J.sj;Q=u.material&&R.material?this.getContactMaterial(u.material,R.material)||this.defaultContactMaterial:this.defaultContactMaterial;Q.friction;if(u.material&&R.material&&(u.material.friction>=0&&R.material.friction>=0&&u.material.friction*R.material.friction,u.material.restitution>=0&&R.material.restitution>=0&&(J.restitution=u.material.restitution*R.material.restitution)),i.addEquation(J),u.allowSleep&&u.type===n.DYNAMIC&&u.sleepState===n.SLEEPING&&R.sleepState===n.AWAKE&&R.type!==n.STATIC){R.velocity.norm2()+R.angularVelocity.norm2()>=2*Math.pow(R.sleepSpeedLimit,2)&&(u._wakeUpAfterNarrowphase=!0)}if(R.allowSleep&&R.type===n.DYNAMIC&&R.sleepState===n.SLEEPING&&u.sleepState===n.AWAKE&&u.type!==n.STATIC){u.velocity.norm2()+u.angularVelocity.norm2()>=2*Math.pow(u.sleepSpeedLimit,2)&&(R._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(u,R,!0),this.collisionMatrixPrevious.get(u,R)||(y.body=R,y.contact=J,u.dispatchEvent(y),y.body=u,R.dispatchEvent(y))}for(k&&(l.makeContactConstraints=performance.now()-b,b=performance.now()),t=0;t!==g;t++){var u=h[t];u._wakeUpAfterNarrowphase&&(u.wakeUp(),u._wakeUpAfterNarrowphase=!1)}var I=o.length;for(t=0;t!==I;t++){var J=o[t];J.update();for(var K=0,S=J.equations.length;K!==S;K++){var T=J.equations[K];i.addEquation(T)}}i.solve(a,this),k&&(l.solve=performance.now()-b),i.removeAllEquations();var U=Math.pow;for(t=0;t!==g;t++){var u=h[t];if(u.type&m){var V=U(1-u.linearDamping,a),W=u.velocity;W.mult(V,W);var X=u.angularVelocity;if(X){var Y=U(1-u.angularDamping,a);X.mult(Y,X)}}}for(this.dispatchEvent(x),t=0;t!==g;t++){var u=h[t];u.preStep&&u.preStep.call(u)}k&&(b=performance.now());var Z=D,$=E,_=this.stepnumber,aa=n.DYNAMIC|n.KINEMATIC,ba=_%(this.quatNormalizeSkip+1)==0,ca=this.quatNormalizeFast,da=.5*a;e.types.PLANE,e.types.CONVEXPOLYHEDRON;for(t=0;t!==g;t++){var ea=h[t],fa=ea.force,ga=ea.torque;if(ea.type&aa&&ea.sleepState!==n.SLEEPING){var ha=ea.velocity,ia=ea.angularVelocity,ja=ea.position,ka=ea.quaternion,la=ea.invMass,ma=ea.invInertiaWorld;ha.x+=fa.x*la*a,ha.y+=fa.y*la*a,ha.z+=fa.z*la*a,ea.angularVelocity&&(ma.vmult(ga,F),F.mult(a,F),F.vadd(ia,ia)),ja.x+=ha.x*a,ja.y+=ha.y*a,ja.z+=ha.z*a,ea.angularVelocity&&(Z.set(ia.x,ia.y,ia.z,0),Z.mult(ka,$),ka.x+=da*$.x,ka.y+=da*$.y,ka.z+=da*$.z,ka.w+=da*$.w,ba&&(ca?ka.normalizeFast():ka.normalize())),ea.aabb&&(ea.aabbNeedsUpdate=!0),ea.updateInertiaWorld&&ea.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,k&&(l.integrate=performance.now()-b),this.time+=a,this.stepnumber+=1,this.dispatchEvent(w),t=0;t!==g;t++){var u=h[t],na=u.postStep;na&&na.call(u)}if(this.allowSleep)for(t=0;t!==g;t++)h[t].sleepTick(this.time)},d.prototype.clearForces=function(){for(var a=this.bodies,b=a.length,c=0;c!==b;c++){var d=a[c];d.force,d.torque;d.force.set(0,0,0),d.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],297:[function(a,b,c){function d(a){a=a||{},this.lowerBound=new e,a.lowerBound&&this.lowerBound.copy(a.lowerBound),this.upperBound=new e,a.upperBound&&this.upperBound.copy(a.upperBound)}var e=a("../math/Vec3");a("../utils/Utils");b.exports=d;var f=new e;d.prototype.setFromPoints=function(a,b,c,d){var e=this.lowerBound,g=this.upperBound,h=c;e.copy(a[0]),h&&h.vmult(e,e),g.copy(e);for(var i=1;i<a.length;i++){var j=a[i];h&&(h.vmult(j,f),j=f),j.x>g.x&&(g.x=j.x),j.x<e.x&&(e.x=j.x),j.y>g.y&&(g.y=j.y),j.y<e.y&&(e.y=j.y),j.z>g.z&&(g.z=j.z),j.z<e.z&&(e.z=j.z)}return b&&(b.vadd(e,e),b.vadd(g,g)),d&&(e.x-=d,e.y-=d,e.z-=d,g.x+=d,g.y+=d,g.z+=d),this},d.prototype.copy=function(a){return this.lowerBound.copy(a.lowerBound),this.upperBound.copy(a.upperBound),this},d.prototype.clone=function(){return(new d).copy(this)},d.prototype.extend=function(a){var b=a.lowerBound.x;this.lowerBound.x>b&&(this.lowerBound.x=b);var c=a.upperBound.x;this.upperBound.x<c&&(this.upperBound.x=c);var b=a.lowerBound.y;this.lowerBound.y>b&&(this.lowerBound.y=b);var c=a.upperBound.y;this.upperBound.y<c&&(this.upperBound.y=c);var b=a.lowerBound.z;this.lowerBound.z>b&&(this.lowerBound.z=b);var c=a.upperBound.z;this.upperBound.z<c&&(this.upperBound.z=c)},d.prototype.overlaps=function(a){var b=this.lowerBound,c=this.upperBound,d=a.lowerBound,e=a.upperBound;return(d.x<=c.x&&c.x<=e.x||b.x<=e.x&&e.x<=c.x)&&(d.y<=c.y&&c.y<=e.y||b.y<=e.y&&e.y<=c.y)&&(d.z<=c.z&&c.z<=e.z||b.z<=e.z&&e.z<=c.z)},d.prototype.contains=function(a){var b=this.lowerBound,c=this.upperBound,d=a.lowerBound,e=a.upperBound;return b.x<=d.x&&c.x>=e.x&&b.y<=d.y&&c.y>=e.y&&b.z<=d.z&&c.z>=e.z},d.prototype.getCorners=function(a,b,c,d,e,f,g,h){var i=this.lowerBound,j=this.upperBound;a.copy(i),b.set(j.x,i.y,i.z),c.set(j.x,j.y,i.z),d.set(i.x,j.y,j.z),e.set(j.x,i.y,i.z),f.set(i.x,j.y,i.z),g.set(i.x,i.y,j.z),h.copy(j)};var g=[new e,new e,new e,new e,new e,new e,new e,new e];d.prototype.toLocalFrame=function(a,b){var c=g,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=c[5],k=c[6],l=c[7];this.getCorners(d,e,f,h,i,j,k,l);for(var m=0;8!==m;m++){var n=c[m];a.pointToLocal(n,n)}return b.setFromPoints(c)},d.prototype.toWorldFrame=function(a,b){var c=g,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=c[5],k=c[6],l=c[7];this.getCorners(d,e,f,h,i,j,k,l);for(var m=0;8!==m;m++){var n=c[m];a.pointToWorld(n,n)}return b.setFromPoints(c)}},{"../math/Vec3":318,"../utils/Utils":331}],298:[function(a,b,c){function d(){this.matrix=[]}b.exports=d,d.prototype.get=function(a,b){if(a=a.index,(b=b.index)>a){var c=b;b=a,a=c}return this.matrix[(a*(a+1)>>1)+b-1]},d.prototype.set=function(a,b,c){if(a=a.index,(b=b.index)>a){var d=b;b=a,a=d}this.matrix[(a*(a+1)>>1)+b-1]=c?1:0},d.prototype.reset=function(){for(var a=0,b=this.matrix.length;a!==b;a++)this.matrix[a]=0},d.prototype.setNumObjects=function(a){this.matrix.length=a*(a-1)>>1}},{}],299:[function(a,b,c){function d(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var e=a("../objects/Body"),f=a("../math/Vec3"),g=a("../math/Quaternion");a("../shapes/Shape"),a("../shapes/Plane");b.exports=d,d.prototype.collisionPairs=function(a,b,c){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var h=e.STATIC|e.KINEMATIC;d.prototype.needBroadphaseCollision=function(a,b){return 0!=(a.collisionFilterGroup&b.collisionFilterMask)&&0!=(b.collisionFilterGroup&a.collisionFilterMask)&&(0==(a.type&h)&&a.sleepState!==e.SLEEPING||0==(b.type&h)&&b.sleepState!==e.SLEEPING)},d.prototype.intersectionTest=function(a,b,c,d){this.useBoundingBoxes?this.doBoundingBoxBroadphase(a,b,c,d):this.doBoundingSphereBroadphase(a,b,c,d)};var i=new f;new f,new g,new f;d.prototype.doBoundingSphereBroadphase=function(a,b,c,d){var e=i;b.position.vsub(a.position,e);var f=Math.pow(a.boundingRadius+b.boundingRadius,2);e.norm2()<f&&(c.push(a),d.push(b))},d.prototype.doBoundingBoxBroadphase=function(a,b,c,d){a.aabbNeedsUpdate&&a.computeAABB(),b.aabbNeedsUpdate&&b.computeAABB(),a.aabb.overlaps(b.aabb)&&(c.push(a),d.push(b))};var j={keys:[]},k=[],l=[];d.prototype.makePairsUnique=function(a,b){for(var c=j,d=k,e=l,f=a.length,g=0;g!==f;g++)d[g]=a[g],e[g]=b[g];a.length=0,b.length=0;for(var g=0;g!==f;g++){var h=d[g].id,i=e[g].id,m=h<i?h+","+i:i+","+h;c[m]=g,c.keys.push(m)}for(var g=0;g!==c.keys.length;g++){var m=c.keys.pop(),n=c[m];a.push(d[n]),b.push(e[n]),delete c[m]}},d.prototype.setWorld=function(a){};var m=new f;d.boundingSphereCheck=function(a,b){var c=m;return a.position.vsub(b.position,c),Math.pow(a.shape.boundingSphereRadius+b.shape.boundingSphereRadius,2)>c.norm2()},d.prototype.aabbQuery=function(a,b,c){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":316,"../math/Vec3":318,"../objects/Body":319,"../shapes/Plane":323,"../shapes/Shape":324}],300:[function(a,b,c){function d(){e.apply(this)}b.exports=d;var e=a("./Broadphase"),f=a("./AABB");d.prototype=new e,d.prototype.constructor=d,d.prototype.collisionPairs=function(a,b,c){var d,e,f,g,h=a.bodies,i=h.length;for(d=0;d!==i;d++)for(e=0;e!==d;e++)f=h[d],g=h[e],this.needBroadphaseCollision(f,g)&&this.intersectionTest(f,g,b,c)};new f;d.prototype.aabbQuery=function(a,b,c){c=c||[];for(var d=0;d<a.bodies.length;d++){var e=a.bodies[d];e.aabbNeedsUpdate&&e.computeAABB(),e.aabb.overlaps(b)&&c.push(e)}return c}},{"./AABB":297,"./Broadphase":299}],301:[function(a,b,c){function d(a,b){this.from=a?a.clone():new g,this.to=b?b.clone():new g,this._direction=new g,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=d.ANY,this.result=new j,this.hasHit=!1,this.callback=function(a){}}function e(a,b,c,d){d.vsub(b,J),c.vsub(b,o),a.vsub(b,p);var e,f,g=J.dot(J),h=J.dot(o),i=J.dot(p),j=o.dot(o),k=o.dot(p);return(e=j*i-h*k)>=0&&(f=g*k-h*i)>=0&&e+f<g*j-h*h}function f(a,b,c){c.vsub(a,J);var d=J.dot(b);return b.mult(d,K),K.vadd(a,K),c.distanceTo(K)}b.exports=d;var g=a("../math/Vec3"),h=a("../math/Quaternion"),i=a("../math/Transform"),j=(a("../shapes/ConvexPolyhedron"),a("../shapes/Box"),a("../collision/RaycastResult")),k=a("../shapes/Shape"),l=a("../collision/AABB");d.prototype.constructor=d,d.CLOSEST=1,d.ANY=2,d.ALL=4;var m=new l,n=[];d.prototype.intersectWorld=function(a,b){return this.mode=b.mode||d.ANY,this.result=b.result||new j,this.skipBackfaces=!!b.skipBackfaces,this.collisionFilterMask=void 0!==b.collisionFilterMask?b.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==b.collisionFilterGroup?b.collisionFilterGroup:-1,b.from&&this.from.copy(b.from),b.to&&this.to.copy(b.to),this.callback=b.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(m),n.length=0,a.broadphase.aabbQuery(a,m,n),this.intersectBodies(n),this.hasHit};var o=new g,p=new g;d.pointInTriangle=e;var q=new g,r=new h;d.prototype.intersectBody=function(a,b){b&&(this.result=b,this._updateDirection());var c=this.checkCollisionResponse;if((!c||a.collisionResponse)&&0!=(this.collisionFilterGroup&a.collisionFilterMask)&&0!=(a.collisionFilterGroup&this.collisionFilterMask))for(var d=q,e=r,f=0,g=a.shapes.length;f<g;f++){var h=a.shapes[f];if((!c||h.collisionResponse)&&(a.quaternion.mult(a.shapeOrientations[f],e),a.quaternion.vmult(a.shapeOffsets[f],d),d.vadd(a.position,d),this.intersectShape(h,e,d,a),this.result._shouldStop))break}},d.prototype.intersectBodies=function(a,b){b&&(this.result=b,this._updateDirection());for(var c=0,d=a.length;!this.result._shouldStop&&c<d;c++)this.intersectBody(a[c])},d.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},d.prototype.intersectShape=function(a,b,c,d){if(!(f(this.from,this._direction,c)>a.boundingSphereRadius)){var e=this[a.type];e&&e.call(this,a,b,c,d)}};var s=(new g,new g,new g),t=new g,u=new g,v=new g;new g,new j;d.prototype.intersectBox=function(a,b,c,d){return this.intersectConvex(a.convexPolyhedronRepresentation,b,c,d)},d.prototype[k.types.BOX]=d.prototype.intersectBox,d.prototype.intersectPlane=function(a,b,c,d){var e=this.from,f=this.to,h=this._direction,i=new g(0,0,1);b.vmult(i,i);var j=new g;e.vsub(c,j);var k=j.dot(i);if(f.vsub(c,j),!(k*j.dot(i)>0||e.distanceTo(f)<k)){var l=i.dot(h);if(!(Math.abs(l)<this.precision)){var m=new g,n=new g,o=new g;e.vsub(c,m);var p=-i.dot(m)/l;h.scale(p,n),e.vadd(n,o),this.reportIntersection(i,o,a,d,-1)}}},d.prototype[k.types.PLANE]=d.prototype.intersectPlane,d.prototype.getAABB=function(a){var b=this.to,c=this.from;a.lowerBound.x=Math.min(b.x,c.x),a.lowerBound.y=Math.min(b.y,c.y),a.lowerBound.z=Math.min(b.z,c.z),a.upperBound.x=Math.max(b.x,c.x),a.upperBound.y=Math.max(b.y,c.y),a.upperBound.z=Math.max(b.z,c.z)};var w={faceList:[0]};d.prototype.intersectHeightfield=function(a,b,c,e){var f=(a.data,a.elementSize,new g),h=new d(this.from,this.to);i.pointToLocalFrame(c,b,h.from,h.from),i.pointToLocalFrame(c,b,h.to,h.to);var j=[],k=null,l=null,m=null,n=null,o=a.getIndexOfPosition(h.from.x,h.from.y,j,!1);if(o&&(k=j[0],l=j[1],m=j[0],n=j[1]),o=a.getIndexOfPosition(h.to.x,h.to.y,j,!1),o&&((null===k||j[0]<k)&&(k=j[0]),(null===m||j[0]>m)&&(m=j[0]),(null===l||j[1]<l)&&(l=j[1]),(null===n||j[1]>n)&&(n=j[1])),null!==k){var p=[];a.getRectMinMax(k,l,m,n,p);for(var q=k;q<=m;q++)for(var r=l;r<=n;r++){if(this.result._shouldStop)return;if(a.getConvexTrianglePillar(q,r,!1),i.pointToWorldFrame(c,b,a.pillarOffset,f),this.intersectConvex(a.pillarConvex,b,f,e,w),this.result._shouldStop)return;a.getConvexTrianglePillar(q,r,!0),i.pointToWorldFrame(c,b,a.pillarOffset,f),this.intersectConvex(a.pillarConvex,b,f,e,w)}}},d.prototype[k.types.HEIGHTFIELD]=d.prototype.intersectHeightfield;var x=new g,y=new g;d.prototype.intersectSphere=function(a,b,c,d){var e=this.from,f=this.to,g=a.radius,h=Math.pow(f.x-e.x,2)+Math.pow(f.y-e.y,2)+Math.pow(f.z-e.z,2),i=2*((f.x-e.x)*(e.x-c.x)+(f.y-e.y)*(e.y-c.y)+(f.z-e.z)*(e.z-c.z)),j=Math.pow(e.x-c.x,2)+Math.pow(e.y-c.y,2)+Math.pow(e.z-c.z,2)-Math.pow(g,2),k=Math.pow(i,2)-4*h*j,l=x,m=y;if(!(k<0))if(0===k)e.lerp(f,k,l),l.vsub(c,m),m.normalize(),this.reportIntersection(m,l,a,d,-1);else{var n=(-i-Math.sqrt(k))/(2*h),o=(-i+Math.sqrt(k))/(2*h);if(n>=0&&n<=1&&(e.lerp(f,n,l),l.vsub(c,m),m.normalize(),this.reportIntersection(m,l,a,d,-1)),this.result._shouldStop)return;o>=0&&o<=1&&(e.lerp(f,o,l),l.vsub(c,m),m.normalize(),this.reportIntersection(m,l,a,d,-1))}},d.prototype[k.types.SPHERE]=d.prototype.intersectSphere;var z=new g,A=(new g,new g,new g);d.prototype.intersectConvex=function(a,b,c,d,f){for(var g=z,h=A,i=f&&f.faceList||null,j=a.faces,k=a.vertices,l=a.faceNormals,m=this._direction,n=this.from,o=this.to,p=n.distanceTo(o),q=i?i.length:j.length,r=this.result,w=0;!r._shouldStop&&w<q;w++){var x=i?i[w]:w,y=j[x],B=l[x],C=b,D=c;h.copy(k[y[0]]),C.vmult(h,h),h.vadd(D,h),h.vsub(n,h),C.vmult(B,g);var E=m.dot(g);if(!(Math.abs(E)<this.precision)){var F=g.dot(h)/E;if(!(F<0)){m.mult(F,s),s.vadd(n,s),t.copy(k[y[0]]),C.vmult(t,t),D.vadd(t,t);for(var G=1;!r._shouldStop&&G<y.length-1;G++){u.copy(k[y[G]]),v.copy(k[y[G+1]]),C.vmult(u,u),C.vmult(v,v),D.vadd(u,u),D.vadd(v,v);var H=s.distanceTo(n);!e(s,t,u,v)&&!e(s,u,t,v)||H>p||this.reportIntersection(g,s,a,d,x)}}}}},d.prototype[k.types.CONVEXPOLYHEDRON]=d.prototype.intersectConvex;var B=new g,C=new g,D=new g,E=new g,F=new g,G=new g,H=(new l,[]),I=new i;d.prototype.intersectTrimesh=function(a,b,c,d,f){var g=B,h=H,j=I,k=A,l=C,m=D,n=E,o=G,p=F,q=(f&&f.faceList,a.indices),r=(a.vertices,a.faceNormals,this.from),w=this.to,x=this._direction;j.position.copy(c),j.quaternion.copy(b),i.vectorToLocalFrame(c,b,x,l),i.pointToLocalFrame(c,b,r,m),i.pointToLocalFrame(c,b,w,n);var y=m.distanceSquared(n);a.tree.rayQuery(this,j,h);for(var z=0,J=h.length;!this.result._shouldStop&&z!==J;z++){var K=h[z];a.getNormal(K,g),a.getVertex(q[3*K],t),t.vsub(m,k);var L=l.dot(g),M=g.dot(k)/L;if(!(M<0)){l.scale(M,s),s.vadd(m,s),a.getVertex(q[3*K+1],u),a.getVertex(q[3*K+2],v);var N=s.distanceSquared(m);!e(s,u,t,v)&&!e(s,t,u,v)||N>y||(i.vectorToWorldFrame(b,g,p),i.pointToWorldFrame(c,b,s,o),this.reportIntersection(p,o,a,d,K))}}h.length=0},d.prototype[k.types.TRIMESH]=d.prototype.intersectTrimesh,d.prototype.reportIntersection=function(a,b,c,e,f){var g=this.from,h=this.to,i=g.distanceTo(b),j=this.result;if(!(this.skipBackfaces&&a.dot(this._direction)>0))switch(j.hitFaceIndex=void 0!==f?f:-1,this.mode){case d.ALL:this.hasHit=!0,j.set(g,h,a,b,c,e,i),j.hasHit=!0,this.callback(j);break;case d.CLOSEST:(i<j.distance||!j.hasHit)&&(this.hasHit=!0,j.hasHit=!0,j.set(g,h,a,b,c,e,i));break;case d.ANY:this.hasHit=!0,j.hasHit=!0,j.set(g,h,a,b,c,e,i),j._shouldStop=!0}};var J=new g,K=new g},{"../collision/AABB":297,"../collision/RaycastResult":302,"../math/Quaternion":316,"../math/Transform":317,"../math/Vec3":318,"../shapes/Box":320,"../shapes/ConvexPolyhedron":321,"../shapes/Shape":324}],302:[function(a,b,c){function d(){this.rayFromWorld=new e,this.rayToWorld=new e,this.hitNormalWorld=new e,this.hitPointWorld=new e,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}var e=a("../math/Vec3");b.exports=d,d.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},d.prototype.abort=function(){this._shouldStop=!0},d.prototype.set=function(a,b,c,d,e,f,g){this.rayFromWorld.copy(a),this.rayToWorld.copy(b),this.hitNormalWorld.copy(c),this.hitPointWorld.copy(d),this.shape=e,this.body=f,this.distance=g}},{"../math/Vec3":318}],303:[function(a,b,c){function d(a,b,c){c=e.defaults(c,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=a,this.bodyB=b,this.id=d.idCounter++,this.collideConnected=c.collideConnected,c.wakeUpBodies&&(a&&a.wakeUp(),b&&b.wakeUp())}b.exports=d;var e=a("../utils/Utils");d.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},d.prototype.enable=function(){for(var a=this.equations,b=0;b<a.length;b++)a[b].enabled=!0},d.prototype.disable=function(){for(var a=this.equations,b=0;b<a.length;b++)a[b].enabled=!1},d.idCounter=0},{"../utils/Utils":331}],304:[function(a,b,c){function d(a,b,c){c=c||{};var d=void 0!==c.maxForce?c.maxForce:1e6,i=c.pivotA?c.pivotA.clone():new h,j=c.pivotB?c.pivotB.clone():new h;e.call(this,a,i,b,j,d),(this.axisA=c.axisA?c.axisA.clone():new h(1,0,0)).normalize(),(this.axisB=c.axisB?c.axisB.clone():new h(1,0,0)).normalize();var k=this.rotationalEquation1=new f(a,b,c),l=this.rotationalEquation2=new f(a,b,c),m=this.motorEquation=new g(a,b,d);m.enabled=!1,this.equations.push(k,l,m)}b.exports=d;var e=(a("./Constraint"),a("./PointToPointConstraint")),f=a("../equations/RotationalEquation"),g=a("../equations/RotationalMotorEquation"),h=(a("../equations/ContactEquation"),a("../math/Vec3"));d.prototype=new e,d.constructor=d,d.prototype.enableMotor=function(){this.motorEquation.enabled=!0},d.prototype.disableMotor=function(){this.motorEquation.enabled=!1},d.prototype.setMotorSpeed=function(a){this.motorEquation.targetVelocity=a},d.prototype.setMotorMaxForce=function(a){this.motorEquation.maxForce=a,this.motorEquation.minForce=-a};var i=new h,j=new h;d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.motorEquation,d=this.rotationalEquation1,f=this.rotationalEquation2,g=i,h=j,k=this.axisA,l=this.axisB;e.prototype.update.call(this),a.quaternion.vmult(k,g),b.quaternion.vmult(l,h),g.tangents(d.axisA,f.axisA),d.axisB.copy(h),f.axisB.copy(h),this.motorEquation.enabled&&(a.quaternion.vmult(this.axisA,c.axisA),b.quaternion.vmult(this.axisB,c.axisB))}},{"../equations/ContactEquation":307,"../equations/RotationalEquation":310,"../equations/RotationalMotorEquation":311,"../math/Vec3":318,"./Constraint":303,"./PointToPointConstraint":306}],305:[function(a,b,c){function d(a,b,c){c=c||{};var d=void 0!==c.maxForce?c.maxForce:1e6,h=new g,i=new g,j=new g;a.position.vadd(b.position,j),j.scale(.5,j),b.pointToLocalFrame(j,i),a.pointToLocalFrame(j,h),e.call(this,a,h,b,i,d);var k=this.rotationalEquation1=new f(a,b,c),l=this.rotationalEquation2=new f(a,b,c),m=this.rotationalEquation3=new f(a,b,c);this.equations.push(k,l,m)}b.exports=d;var e=(a("./Constraint"),a("./PointToPointConstraint")),f=a("../equations/RotationalEquation"),g=(a("../equations/RotationalMotorEquation"),a("../equations/ContactEquation"),a("../math/Vec3"));d.prototype=new e,d.constructor=d;new g,new g;d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=(this.motorEquation,this.rotationalEquation1),d=this.rotationalEquation2,f=this.rotationalEquation3;e.prototype.update.call(this),a.vectorToWorldFrame(g.UNIT_X,c.axisA),b.vectorToWorldFrame(g.UNIT_Y,c.axisB),a.vectorToWorldFrame(g.UNIT_Y,d.axisA),b.vectorToWorldFrame(g.UNIT_Z,d.axisB),a.vectorToWorldFrame(g.UNIT_Z,f.axisA),b.vectorToWorldFrame(g.UNIT_X,f.axisB)}},{"../equations/ContactEquation":307,"../equations/RotationalEquation":310,"../equations/RotationalMotorEquation":311,"../math/Vec3":318,"./Constraint":303,"./PointToPointConstraint":306}],306:[function(a,b,c){function d(a,b,c,d,h){e.call(this,a,c),h=void 0!==h?h:1e6,this.pivotA=b?b.clone():new g,this.pivotB=d?d.clone():new g;var i=this.equationX=new f(a,c),j=this.equationY=new f(a,c),k=this.equationZ=new f(a,c);this.equations.push(i,j,k),i.minForce=j.minForce=k.minForce=-h,i.maxForce=j.maxForce=k.maxForce=h,i.ni.set(1,0,0),j.ni.set(0,1,0),k.ni.set(0,0,1)}b.exports=d;var e=a("./Constraint"),f=a("../equations/ContactEquation"),g=a("../math/Vec3");d.prototype=new e,d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.equationX,d=this.equationY,e=this.equationZ;a.quaternion.vmult(this.pivotA,c.ri),b.quaternion.vmult(this.pivotB,c.rj),d.ri.copy(c.ri),d.rj.copy(c.rj),e.ri.copy(c.ri),e.rj.copy(c.rj)}},{"../equations/ContactEquation":307,"../math/Vec3":318,"./Constraint":303}],307:[function(a,b,c){function d(a,b,c){c=void 0!==c?c:1e6,e.call(this,a,b,0,c),this.restitution=0,this.ri=new f,this.rj=new f,this.ni=new f}b.exports=d;var e=a("./Equation"),f=a("../math/Vec3");a("../math/Mat3");d.prototype=new e,d.prototype.constructor=d;var g=new f,h=new f,i=new f;d.prototype.computeB=function(a){var b=this.a,c=this.b,d=this.bi,e=this.bj,f=this.ri,j=this.rj,k=g,l=h,m=d.velocity,n=d.angularVelocity,o=(d.force,d.torque,e.velocity),p=e.angularVelocity,q=(e.force,e.torque,i),r=this.jacobianElementA,s=this.jacobianElementB,t=this.ni;f.cross(t,k),j.cross(t,l),
t.negate(r.spatial),k.negate(r.rotational),s.spatial.copy(t),s.rotational.copy(l),q.copy(e.position),q.vadd(j,q),q.vsub(d.position,q),q.vsub(f,q);var u=t.dot(q),v=this.restitution+1;return-u*b-(v*o.dot(t)-v*m.dot(t)+p.dot(l)-n.dot(k))*c-a*this.computeGiMf()};var j=new f,k=new f,l=new f,m=new f,n=new f;d.prototype.getImpactVelocityAlongNormal=function(){var a=j,b=k,c=l,d=m,e=n;return this.bi.position.vadd(this.ri,c),this.bj.position.vadd(this.rj,d),this.bi.getVelocityAtWorldPoint(c,a),this.bj.getVelocityAtWorldPoint(d,b),a.vsub(b,e),this.ni.dot(e)}},{"../math/Mat3":315,"../math/Vec3":318,"./Equation":308}],308:[function(a,b,c){function d(a,b,c,f){this.id=d.id++,this.minForce=void 0===c?-1e6:c,this.maxForce=void 0===f?1e6:f,this.bi=a,this.bj=b,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new e,this.jacobianElementB=new e,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}b.exports=d;var e=a("../math/JacobianElement"),f=a("../math/Vec3");d.prototype.constructor=d,d.id=0,d.prototype.setSpookParams=function(a,b,c){var d=b,e=a,f=c;this.a=4/(f*(1+4*d)),this.b=4*d/(1+4*d),this.eps=4/(f*f*e*(1+4*d))},d.prototype.computeB=function(a,b,c){var d=this.computeGW();return-this.computeGq()*a-d*b-this.computeGiMf()*c},d.prototype.computeGq=function(){var a=this.jacobianElementA,b=this.jacobianElementB,c=this.bi,d=this.bj,e=c.position,f=d.position;return a.spatial.dot(e)+b.spatial.dot(f)};var g=new f;d.prototype.computeGW=function(){var a=this.jacobianElementA,b=this.jacobianElementB,c=this.bi,d=this.bj,e=c.velocity,f=d.velocity,h=c.angularVelocity||g,i=d.angularVelocity||g;return a.multiplyVectors(e,h)+b.multiplyVectors(f,i)},d.prototype.computeGWlambda=function(){var a=this.jacobianElementA,b=this.jacobianElementB,c=this.bi,d=this.bj,e=c.vlambda,f=d.vlambda,h=c.wlambda||g,i=d.wlambda||g;return a.multiplyVectors(e,h)+b.multiplyVectors(f,i)};var h=new f,i=new f,j=new f,k=new f;d.prototype.computeGiMf=function(){var a=this.jacobianElementA,b=this.jacobianElementB,c=this.bi,d=this.bj,e=c.force,f=c.torque,g=d.force,l=d.torque,m=c.invMassSolve,n=d.invMassSolve;return c.invInertiaWorldSolve?c.invInertiaWorldSolve.vmult(f,j):j.set(0,0,0),d.invInertiaWorldSolve?d.invInertiaWorldSolve.vmult(l,k):k.set(0,0,0),e.mult(m,h),g.mult(n,i),a.multiplyVectors(h,j)+b.multiplyVectors(i,k)};var l=new f;d.prototype.computeGiMGt=function(){var a=this.jacobianElementA,b=this.jacobianElementB,c=this.bi,d=this.bj,e=c.invMassSolve,f=d.invMassSolve,g=c.invInertiaWorldSolve,h=d.invInertiaWorldSolve,i=e+f;return g&&(g.vmult(a.rotational,l),i+=l.dot(a.rotational)),h&&(h.vmult(b.rotational,l),i+=l.dot(b.rotational)),i};var m=new f;new f,new f,new f,new f,new f;d.prototype.addToWlambda=function(a){var b=this.jacobianElementA,c=this.jacobianElementB,d=this.bi,e=this.bj,f=m;b.spatial.mult(d.invMassSolve*a,f),d.vlambda.vadd(f,d.vlambda),c.spatial.mult(e.invMassSolve*a,f),e.vlambda.vadd(f,e.vlambda),d.invInertiaWorldSolve&&(d.invInertiaWorldSolve.vmult(b.rotational,f),f.mult(a,f),d.wlambda.vadd(f,d.wlambda)),e.invInertiaWorldSolve&&(e.invInertiaWorldSolve.vmult(c.rotational,f),f.mult(a,f),e.wlambda.vadd(f,e.wlambda))},d.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":314,"../math/Vec3":318}],309:[function(a,b,c){function d(a,b,c){e.call(this,a,b,-c,c),this.ri=new f,this.rj=new f,this.t=new f}b.exports=d;var e=a("./Equation"),f=a("../math/Vec3");a("../math/Mat3");d.prototype=new e,d.prototype.constructor=d;var g=new f,h=new f;d.prototype.computeB=function(a){var b=(this.a,this.b),c=(this.bi,this.bj,this.ri),d=this.rj,e=g,f=h,i=this.t;c.cross(i,e),d.cross(i,f);var j=this.jacobianElementA,k=this.jacobianElementB;return i.negate(j.spatial),e.negate(j.rotational),k.spatial.copy(i),k.rotational.copy(f),-this.computeGW()*b-a*this.computeGiMf()}},{"../math/Mat3":315,"../math/Vec3":318,"./Equation":308}],310:[function(a,b,c){function d(a,b,c){c=c||{};var d=void 0!==c.maxForce?c.maxForce:1e6;f.call(this,a,b,-d,d),this.axisA=c.axisA?c.axisA.clone():new e(1,0,0),this.axisB=c.axisB?c.axisB.clone():new e(0,1,0),this.maxAngle=Math.PI/2}b.exports=d;var e=a("../math/Vec3"),f=(a("../math/Mat3"),a("./Equation"));d.prototype=new f,d.prototype.constructor=d;var g=new e,h=new e;d.prototype.computeB=function(a){var b=this.a,c=this.b,d=this.axisA,e=this.axisB,f=g,i=h,j=this.jacobianElementA,k=this.jacobianElementB;return d.cross(e,f),e.cross(d,i),j.rotational.copy(i),k.rotational.copy(f),-(Math.cos(this.maxAngle)-d.dot(e))*b-this.computeGW()*c-a*this.computeGiMf()}},{"../math/Mat3":315,"../math/Vec3":318,"./Equation":308}],311:[function(a,b,c){function d(a,b,c){c=void 0!==c?c:1e6,f.call(this,a,b,-c,c),this.axisA=new e,this.axisB=new e,this.targetVelocity=0}b.exports=d;var e=a("../math/Vec3"),f=(a("../math/Mat3"),a("./Equation"));d.prototype=new f,d.prototype.constructor=d,d.prototype.computeB=function(a){var b=(this.a,this.b),c=(this.bi,this.bj,this.axisA),d=this.axisB,e=this.jacobianElementA,f=this.jacobianElementB;return e.rotational.copy(c),d.negate(f.rotational),-(this.computeGW()-this.targetVelocity)*b-a*this.computeGiMf()}},{"../math/Mat3":315,"../math/Vec3":318,"./Equation":308}],312:[function(a,b,c){function d(a,b,c){c=e.defaults(c,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=d.idCounter++,this.materials=[a,b],this.friction=c.friction,this.restitution=c.restitution,this.contactEquationStiffness=c.contactEquationStiffness,this.contactEquationRelaxation=c.contactEquationRelaxation,this.frictionEquationStiffness=c.frictionEquationStiffness,this.frictionEquationRelaxation=c.frictionEquationRelaxation}var e=a("../utils/Utils");b.exports=d,d.idCounter=0},{"../utils/Utils":331}],313:[function(a,b,c){function d(a){var b="";a=a||{},"string"==typeof a?(b=a,a={}):"object"==typeof a&&(b=""),this.name=b,this.id=d.idCounter++,this.friction=void 0!==a.friction?a.friction:-1,this.restitution=void 0!==a.restitution?a.restitution:-1}b.exports=d,d.idCounter=0},{}],314:[function(a,b,c){function d(){this.spatial=new e,this.rotational=new e}b.exports=d;var e=a("./Vec3");d.prototype.multiplyElement=function(a){return a.spatial.dot(this.spatial)+a.rotational.dot(this.rotational)},d.prototype.multiplyVectors=function(a,b){return a.dot(this.spatial)+b.dot(this.rotational)}},{"./Vec3":318}],315:[function(a,b,c){function d(a){this.elements=a||[0,0,0,0,0,0,0,0,0]}b.exports=d;var e=a("./Vec3");d.prototype.identity=function(){var a=this.elements;a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1},d.prototype.setZero=function(){var a=this.elements;a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a[8]=0},d.prototype.setTrace=function(a){var b=this.elements;b[0]=a.x,b[4]=a.y,b[8]=a.z},d.prototype.getTrace=function(a){var a=a||new e,b=this.elements;a.x=b[0],a.y=b[4],a.z=b[8]},d.prototype.vmult=function(a,b){b=b||new e;var c=this.elements,d=a.x,f=a.y,g=a.z;return b.x=c[0]*d+c[1]*f+c[2]*g,b.y=c[3]*d+c[4]*f+c[5]*g,b.z=c[6]*d+c[7]*f+c[8]*g,b},d.prototype.smult=function(a){for(var b=0;b<this.elements.length;b++)this.elements[b]*=a},d.prototype.mmult=function(a,b){for(var c=b||new d,e=0;e<3;e++)for(var f=0;f<3;f++){for(var g=0,h=0;h<3;h++)g+=a.elements[e+3*h]*this.elements[h+3*f];c.elements[e+3*f]=g}return c},d.prototype.scale=function(a,b){b=b||new d;for(var c=this.elements,e=b.elements,f=0;3!==f;f++)e[3*f+0]=a.x*c[3*f+0],e[3*f+1]=a.y*c[3*f+1],e[3*f+2]=a.z*c[3*f+2];return b},d.prototype.solve=function(a,b){b=b||new e;for(var c=[],d=0;d<12;d++)c.push(0);var d,f;for(d=0;d<3;d++)for(f=0;f<3;f++)c[d+4*f]=this.elements[d+3*f];c[3]=a.x,c[7]=a.y,c[11]=a.z;var g,h,i=3,j=i;do{if(d=j-i,0===c[d+4*d])for(f=d+1;f<j;f++)if(0!==c[d+4*f]){g=4;do{h=4-g,c[h+4*d]+=c[h+4*f]}while(--g);break}if(0!==c[d+4*d])for(f=d+1;f<j;f++){var k=c[d+4*f]/c[d+4*d];g=4;do{h=4-g,c[h+4*f]=h<=d?0:c[h+4*f]-c[h+4*d]*k}while(--g)}}while(--i);if(b.z=c[11]/c[10],b.y=(c[7]-c[6]*b.z)/c[5],b.x=(c[3]-c[2]*b.z-c[1]*b.y)/c[0],isNaN(b.x)||isNaN(b.y)||isNaN(b.z)||b.x===1/0||b.y===1/0||b.z===1/0)throw"Could not solve equation! Got x=["+b.toString()+"], b=["+a.toString()+"], A=["+this.toString()+"]";return b},d.prototype.e=function(a,b,c){if(void 0===c)return this.elements[b+3*a];this.elements[b+3*a]=c},d.prototype.copy=function(a){for(var b=0;b<a.elements.length;b++)this.elements[b]=a.elements[b];return this},d.prototype.toString=function(){for(var a="",b=0;b<9;b++)a+=this.elements[b]+",";return a},d.prototype.reverse=function(a){a=a||new d;for(var b=[],c=0;c<18;c++)b.push(0);var c,e;for(c=0;c<3;c++)for(e=0;e<3;e++)b[c+6*e]=this.elements[c+3*e];b[3]=1,b[9]=0,b[15]=0,b[4]=0,b[10]=1,b[16]=0,b[5]=0,b[11]=0,b[17]=1;var f,g,h=3,i=h;do{if(c=i-h,0===b[c+6*c])for(e=c+1;e<i;e++)if(0!==b[c+6*e]){f=6;do{g=6-f,b[g+6*c]+=b[g+6*e]}while(--f);break}if(0!==b[c+6*c])for(e=c+1;e<i;e++){var j=b[c+6*e]/b[c+6*c];f=6;do{g=6-f,b[g+6*e]=g<=c?0:b[g+6*e]-b[g+6*c]*j}while(--f)}}while(--h);c=2;do{e=c-1;do{var j=b[c+6*e]/b[c+6*c];f=6;do{g=6-f,b[g+6*e]=b[g+6*e]-b[g+6*c]*j}while(--f)}while(e--)}while(--c);c=2;do{var j=1/b[c+6*c];f=6;do{g=6-f,b[g+6*c]=b[g+6*c]*j}while(--f)}while(c--);c=2;do{e=2;do{if(g=b[3+e+6*c],isNaN(g)||g===1/0)throw"Could not reverse! A=["+this.toString()+"]";a.e(c,e,g)}while(e--)}while(c--);return a},d.prototype.setRotationFromQuaternion=function(a){var b=a.x,c=a.y,d=a.z,e=a.w,f=b+b,g=c+c,h=d+d,i=b*f,j=b*g,k=b*h,l=c*g,m=c*h,n=d*h,o=e*f,p=e*g,q=e*h,r=this.elements;return r[0]=1-(l+n),r[1]=j-q,r[2]=k+p,r[3]=j+q,r[4]=1-(i+n),r[5]=m-o,r[6]=k-p,r[7]=m+o,r[8]=1-(i+l),this},d.prototype.transpose=function(a){a=a||new d;for(var b=a.elements,c=this.elements,e=0;3!==e;e++)for(var f=0;3!==f;f++)b[3*e+f]=c[3*f+e];return a}},{"./Vec3":318}],316:[function(a,b,c){function d(a,b,c,d){this.x=void 0!==a?a:0,this.y=void 0!==b?b:0,this.z=void 0!==c?c:0,this.w=void 0!==d?d:1}b.exports=d;var e=a("./Vec3");d.prototype.set=function(a,b,c,d){this.x=a,this.y=b,this.z=c,this.w=d},d.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},d.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},d.prototype.setFromAxisAngle=function(a,b){var c=Math.sin(.5*b);this.x=a.x*c,this.y=a.y*c,this.z=a.z*c,this.w=Math.cos(.5*b)},d.prototype.toAxisAngle=function(a){a=a||new e,this.normalize();var b=2*Math.acos(this.w),c=Math.sqrt(1-this.w*this.w);return c<.001?(a.x=this.x,a.y=this.y,a.z=this.z):(a.x=this.x/c,a.y=this.y/c,a.z=this.z/c),[a,b]};var f=new e,g=new e;d.prototype.setFromVectors=function(a,b){if(a.isAntiparallelTo(b)){var c=f,d=g;a.tangents(c,d),this.setFromAxisAngle(c,Math.PI)}else{var e=a.cross(b);this.x=e.x,this.y=e.y,this.z=e.z,this.w=Math.sqrt(Math.pow(a.norm(),2)*Math.pow(b.norm(),2))+a.dot(b),this.normalize()}};var h=new e,i=new e,j=new e;d.prototype.mult=function(a,b){b=b||new d;var c=this.w,e=h,f=i,g=j;return e.set(this.x,this.y,this.z),f.set(a.x,a.y,a.z),b.w=c*a.w-e.dot(f),e.cross(f,g),b.x=c*f.x+a.w*e.x+g.x,b.y=c*f.y+a.w*e.y+g.y,b.z=c*f.z+a.w*e.z+g.z,b},d.prototype.inverse=function(a){var b=this.x,c=this.y,e=this.z,f=this.w;a=a||new d,this.conjugate(a);var g=1/(b*b+c*c+e*e+f*f);return a.x*=g,a.y*=g,a.z*=g,a.w*=g,a},d.prototype.conjugate=function(a){return a=a||new d,a.x=-this.x,a.y=-this.y,a.z=-this.z,a.w=this.w,a},d.prototype.normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===a?(this.x=0,this.y=0,this.z=0,this.w=0):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a)},d.prototype.normalizeFast=function(){var a=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===a?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=a,this.y*=a,this.z*=a,this.w*=a)},d.prototype.vmult=function(a,b){b=b||new e;var c=a.x,d=a.y,f=a.z,g=this.x,h=this.y,i=this.z,j=this.w,k=j*c+h*f-i*d,l=j*d+i*c-g*f,m=j*f+g*d-h*c,n=-g*c-h*d-i*f;return b.x=k*j+n*-g+l*-i-m*-h,b.y=l*j+n*-h+m*-g-k*-i,b.z=m*j+n*-i+k*-h-l*-g,b},d.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w,this},d.prototype.toEuler=function(a,b){b=b||"YZX";var c,d,e,f=this.x,g=this.y,h=this.z,i=this.w;switch(b){case"YZX":var j=f*g+h*i;if(j>.499&&(c=2*Math.atan2(f,i),d=Math.PI/2,e=0),j<-.499&&(c=-2*Math.atan2(f,i),d=-Math.PI/2,e=0),isNaN(c)){var k=f*f,l=g*g,m=h*h;c=Math.atan2(2*g*i-2*f*h,1-2*l-2*m),d=Math.asin(2*j),e=Math.atan2(2*f*i-2*g*h,1-2*k-2*m)}break;default:throw new Error("Euler order "+b+" not supported yet.")}a.y=c,a.z=d,a.x=e},d.prototype.setFromEuler=function(a,b,c,d){d=d||"XYZ";var e=Math.cos(a/2),f=Math.cos(b/2),g=Math.cos(c/2),h=Math.sin(a/2),i=Math.sin(b/2),j=Math.sin(c/2);return"XYZ"===d?(this.x=h*f*g+e*i*j,this.y=e*i*g-h*f*j,this.z=e*f*j+h*i*g,this.w=e*f*g-h*i*j):"YXZ"===d?(this.x=h*f*g+e*i*j,this.y=e*i*g-h*f*j,this.z=e*f*j-h*i*g,this.w=e*f*g+h*i*j):"ZXY"===d?(this.x=h*f*g-e*i*j,this.y=e*i*g+h*f*j,this.z=e*f*j+h*i*g,this.w=e*f*g-h*i*j):"ZYX"===d?(this.x=h*f*g-e*i*j,this.y=e*i*g+h*f*j,this.z=e*f*j-h*i*g,this.w=e*f*g+h*i*j):"YZX"===d?(this.x=h*f*g+e*i*j,this.y=e*i*g+h*f*j,this.z=e*f*j-h*i*g,this.w=e*f*g-h*i*j):"XZY"===d&&(this.x=h*f*g-e*i*j,this.y=e*i*g-h*f*j,this.z=e*f*j+h*i*g,this.w=e*f*g+h*i*j),this},d.prototype.clone=function(){return new d(this.x,this.y,this.z,this.w)}},{"./Vec3":318}],317:[function(a,b,c){function d(a){a=a||{},this.position=new e,a.position&&this.position.copy(a.position),this.quaternion=new f,a.quaternion&&this.quaternion.copy(a.quaternion)}var e=a("./Vec3"),f=a("./Quaternion");b.exports=d;var g=new f;d.pointToLocalFrame=function(a,b,c,d){var d=d||new e;return c.vsub(a,d),b.conjugate(g),g.vmult(d,d),d},d.prototype.pointToLocal=function(a,b){return d.pointToLocalFrame(this.position,this.quaternion,a,b)},d.pointToWorldFrame=function(a,b,c,d){var d=d||new e;return b.vmult(c,d),d.vadd(a,d),d},d.prototype.pointToWorld=function(a,b){return d.pointToWorldFrame(this.position,this.quaternion,a,b)},d.prototype.vectorToWorldFrame=function(a,b){var b=b||new e;return this.quaternion.vmult(a,b),b},d.vectorToWorldFrame=function(a,b,c){return a.vmult(b,c),c},d.vectorToLocalFrame=function(a,b,c,d){var d=d||new e;return b.w*=-1,b.vmult(c,d),b.w*=-1,d}},{"./Quaternion":316,"./Vec3":318}],318:[function(a,b,c){function d(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0}b.exports=d;var e=a("./Mat3");d.ZERO=new d(0,0,0),d.UNIT_X=new d(1,0,0),d.UNIT_Y=new d(0,1,0),d.UNIT_Z=new d(0,0,1),d.prototype.cross=function(a,b){var c=a.x,e=a.y,f=a.z,g=this.x,h=this.y,i=this.z;return b=b||new d,b.x=h*f-i*e,b.y=i*c-g*f,b.z=g*e-h*c,b},d.prototype.set=function(a,b,c){return this.x=a,this.y=b,this.z=c,this},d.prototype.setZero=function(){this.x=this.y=this.z=0},d.prototype.vadd=function(a,b){if(!b)return new d(this.x+a.x,this.y+a.y,this.z+a.z);b.x=a.x+this.x,b.y=a.y+this.y,b.z=a.z+this.z},d.prototype.vsub=function(a,b){if(!b)return new d(this.x-a.x,this.y-a.y,this.z-a.z);b.x=this.x-a.x,b.y=this.y-a.y,b.z=this.z-a.z},d.prototype.crossmat=function(){return new e([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},d.prototype.normalize=function(){var a=this.x,b=this.y,c=this.z,d=Math.sqrt(a*a+b*b+c*c);if(d>0){var e=1/d;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return d},d.prototype.unit=function(a){a=a||new d;var b=this.x,c=this.y,e=this.z,f=Math.sqrt(b*b+c*c+e*e);return f>0?(f=1/f,a.x=b*f,a.y=c*f,a.z=e*f):(a.x=1,a.y=0,a.z=0),a},d.prototype.norm=function(){var a=this.x,b=this.y,c=this.z;return Math.sqrt(a*a+b*b+c*c)},d.prototype.length=d.prototype.norm,d.prototype.norm2=function(){return this.dot(this)},d.prototype.lengthSquared=d.prototype.norm2,d.prototype.distanceTo=function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;return Math.sqrt((e-b)*(e-b)+(f-c)*(f-c)+(g-d)*(g-d))},d.prototype.distanceSquared=function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;return(e-b)*(e-b)+(f-c)*(f-c)+(g-d)*(g-d)},d.prototype.mult=function(a,b){b=b||new d;var c=this.x,e=this.y,f=this.z;return b.x=a*c,b.y=a*e,b.z=a*f,b},d.prototype.scale=d.prototype.mult,d.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},d.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},d.prototype.negate=function(a){return a=a||new d,a.x=-this.x,a.y=-this.y,a.z=-this.z,a};var f=new d,g=new d;d.prototype.tangents=function(a,b){var c=this.norm();if(c>0){var d=f,e=1/c;d.set(this.x*e,this.y*e,this.z*e);var h=g;Math.abs(d.x)<.9?(h.set(1,0,0),d.cross(h,a)):(h.set(0,1,0),d.cross(h,a)),d.cross(a,b)}else a.set(1,0,0),b.set(0,1,0)},d.prototype.toString=function(){return this.x+","+this.y+","+this.z},d.prototype.toArray=function(){return[this.x,this.y,this.z]},d.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},d.prototype.lerp=function(a,b,c){var d=this.x,e=this.y,f=this.z;c.x=d+(a.x-d)*b,c.y=e+(a.y-e)*b,c.z=f+(a.z-f)*b},d.prototype.almostEquals=function(a,b){return void 0===b&&(b=1e-6),!(Math.abs(this.x-a.x)>b||Math.abs(this.y-a.y)>b||Math.abs(this.z-a.z)>b)},d.prototype.almostZero=function(a){return void 0===a&&(a=1e-6),!(Math.abs(this.x)>a||Math.abs(this.y)>a||Math.abs(this.z)>a)};var h=new d;d.prototype.isAntiparallelTo=function(a,b){return this.negate(h),h.almostEquals(a,b)},d.prototype.clone=function(){return new d(this.x,this.y,this.z)}},{"./Mat3":315}],319:[function(a,b,c){function d(a){a=a||{},e.apply(this),this.id=d.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new f,this.collisionFilterGroup="number"==typeof a.collisionFilterGroup?a.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof a.collisionFilterMask?a.collisionFilterMask:1,this.collisionResponse=!0,this.position=new f,a.position&&this.position.copy(a.position),this.previousPosition=new f,this.initPosition=new f,this.velocity=new f,a.velocity&&this.velocity.copy(a.velocity),this.initVelocity=new f,this.force=new f;var b="number"==typeof a.mass?a.mass:0;this.mass=b,this.invMass=b>0?1/b:0,this.material=a.material||null,this.linearDamping="number"==typeof a.linearDamping?a.linearDamping:.01,this.type=b<=0?d.STATIC:d.DYNAMIC,typeof a.type==typeof d.STATIC&&(this.type=a.type),this.allowSleep=void 0===a.allowSleep||a.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==a.sleepSpeedLimit?a.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==a.sleepTimeLimit?a.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new f,this.quaternion=new h,a.quaternion&&this.quaternion.copy(a.quaternion),this.initQuaternion=new h,this.angularVelocity=new f,a.angularVelocity&&this.angularVelocity.copy(a.angularVelocity),this.initAngularVelocity=new f,this.interpolatedPosition=new f,this.interpolatedQuaternion=new h,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new f,this.invInertia=new f,this.invInertiaWorld=new g,this.invMassSolve=0,this.invInertiaSolve=new f,this.invInertiaWorldSolve=new g,this.fixedRotation=void 0!==a.fixedRotation&&a.fixedRotation,this.angularDamping=void 0!==a.angularDamping?a.angularDamping:.01,this.aabb=new i,this.aabbNeedsUpdate=!0,this.wlambda=new f,a.shape&&this.addShape(a.shape),this.updateMassProperties()}b.exports=d;var e=a("../utils/EventTarget"),f=(a("../shapes/Shape"),a("../math/Vec3")),g=a("../math/Mat3"),h=a("../math/Quaternion"),i=(a("../material/Material"),a("../collision/AABB")),j=a("../shapes/Box");d.prototype=new e,d.prototype.constructor=d,d.DYNAMIC=1,d.STATIC=2,d.KINEMATIC=4,d.AWAKE=0,d.SLEEPY=1,d.SLEEPING=2,d.idCounter=0,d.prototype.wakeUp=function(){var a=this.sleepState;this.sleepState=0,a===d.SLEEPING&&this.dispatchEvent({type:"wakeup"})},d.prototype.sleep=function(){this.sleepState=d.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},d.sleepyEvent={type:"sleepy"},d.sleepEvent={type:"sleep"},d.prototype.sleepTick=function(a){if(this.allowSleep){var b=this.sleepState,c=this.velocity.norm2()+this.angularVelocity.norm2(),e=Math.pow(this.sleepSpeedLimit,2);b===d.AWAKE&&c<e?(this.sleepState=d.SLEEPY,this.timeLastSleepy=a,this.dispatchEvent(d.sleepyEvent)):b===d.SLEEPY&&c>e?this.wakeUp():b===d.SLEEPY&&a-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(d.sleepEvent))}},d.prototype.updateSolveMassProperties=function(){this.sleepState===d.SLEEPING||this.type===d.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},d.prototype.pointToLocalFrame=function(a,b){var b=b||new f;return a.vsub(this.position,b),this.quaternion.conjugate().vmult(b,b),b},d.prototype.vectorToLocalFrame=function(a,b){var b=b||new f;return this.quaternion.conjugate().vmult(a,b),b},d.prototype.pointToWorldFrame=function(a,b){var b=b||new f;return this.quaternion.vmult(a,b),b.vadd(this.position,b),b},d.prototype.vectorToWorldFrame=function(a,b){var b=b||new f;return this.quaternion.vmult(a,b),b};var k=new f,l=new h;d.prototype.addShape=function(a,b,c){var d=new f,e=new h;return b&&d.copy(b),c&&e.copy(c),this.shapes.push(a),this.shapeOffsets.push(d),this.shapeOrientations.push(e),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},d.prototype.updateBoundingRadius=function(){for(var a=this.shapes,b=this.shapeOffsets,c=a.length,d=0,e=0;e!==c;e++){var f=a[e];f.updateBoundingSphereRadius();var g=b[e].norm(),h=f.boundingSphereRadius;g+h>d&&(d=g+h)}this.boundingRadius=d};var m=new i;d.prototype.computeAABB=function(){for(var a=this.shapes,b=this.shapeOffsets,c=this.shapeOrientations,d=a.length,e=k,f=l,g=this.quaternion,h=this.aabb,i=m,j=0;j!==d;j++){var n=a[j];c[j].mult(g,f),f.vmult(b[j],e),e.vadd(this.position,e),n.calculateWorldAABB(e,f,i.lowerBound,i.upperBound),0===j?h.copy(i):h.extend(i)}this.aabbNeedsUpdate=!1};var n=new g,o=new g;new g;d.prototype.updateInertiaWorld=function(a){var b=this.invInertia;if(b.x!==b.y||b.y!==b.z||a){var c=n,d=o;c.setRotationFromQuaternion(this.quaternion),c.transpose(d),c.scale(b,c),c.mmult(d,this.invInertiaWorld)}else;};var p=new f,q=new f;d.prototype.applyForce=function(a,b){if(this.type===d.DYNAMIC){var c=p;b.vsub(this.position,c);var e=q;c.cross(a,e),this.force.vadd(a,this.force),this.torque.vadd(e,this.torque)}};var r=new f,s=new f;d.prototype.applyLocalForce=function(a,b){if(this.type===d.DYNAMIC){var c=r,e=s;this.vectorToWorldFrame(a,c),this.pointToWorldFrame(b,e),this.applyForce(c,e)}};var t=new f,u=new f,v=new f;d.prototype.applyImpulse=function(a,b){if(this.type===d.DYNAMIC){var c=t;b.vsub(this.position,c);var e=u;e.copy(a),e.mult(this.invMass,e),this.velocity.vadd(e,this.velocity);var f=v;c.cross(a,f),this.invInertiaWorld.vmult(f,f),this.angularVelocity.vadd(f,this.angularVelocity)}};var w=new f,x=new f;d.prototype.applyLocalImpulse=function(a,b){if(this.type===d.DYNAMIC){var c=w,e=x;this.vectorToWorldFrame(a,c),this.pointToWorldFrame(b,e),this.applyImpulse(c,e)}};var y=new f;d.prototype.updateMassProperties=function(){var a=y;this.invMass=this.mass>0?1/this.mass:0;var b=this.inertia,c=this.fixedRotation;this.computeAABB(),a.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),j.calculateInertia(a,this.mass,b),this.invInertia.set(b.x>0&&!c?1/b.x:0,b.y>0&&!c?1/b.y:0,b.z>0&&!c?1/b.z:0),this.updateInertiaWorld(!0)},d.prototype.getVelocityAtWorldPoint=function(a,b){var c=new f;return a.vsub(this.position,c),this.angularVelocity.cross(c,b),this.velocity.vadd(b,b),b}},{"../collision/AABB":297,"../material/Material":313,"../math/Mat3":315,"../math/Quaternion":316,"../math/Vec3":318,"../shapes/Box":320,"../shapes/Shape":324,"../utils/EventTarget":328}],320:[function(a,b,c){function d(a){e.call(this),this.type=e.types.BOX,this.halfExtents=a,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3"),g=a("./ConvexPolyhedron");d.prototype=new e,d.prototype.constructor=d,d.prototype.updateConvexPolyhedronRepresentation=function(){var a=this.halfExtents.x,b=this.halfExtents.y,c=this.halfExtents.z,d=f,e=[new d(-a,-b,-c),new d(a,-b,-c),new d(a,b,-c),new d(-a,b,-c),new d(-a,-b,c),new d(a,-b,c),new d(a,b,c),new d(-a,b,c)],h=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],i=(new d(0,0,1),new d(0,1,0),new d(1,0,0),new g(e,h));this.convexPolyhedronRepresentation=i,i.material=this.material},d.prototype.calculateLocalInertia=function(a,b){return b=b||new f,d.calculateInertia(this.halfExtents,a,b),b},d.calculateInertia=function(a,b,c){var d=a;c.x=1/12*b*(2*d.y*2*d.y+2*d.z*2*d.z),c.y=1/12*b*(2*d.x*2*d.x+2*d.z*2*d.z),c.z=1/12*b*(2*d.y*2*d.y+2*d.x*2*d.x)},d.prototype.getSideNormals=function(a,b){var c=a,d=this.halfExtents;if(c[0].set(d.x,0,0),c[1].set(0,d.y,0),c[2].set(0,0,d.z),c[3].set(-d.x,0,0),c[4].set(0,-d.y,0),c[5].set(0,0,-d.z),void 0!==b)for(var e=0;e!==c.length;e++)b.vmult(c[e],c[e]);return c},d.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var h=new f;new f;d.prototype.forEachWorldCorner=function(a,b,c){for(var d=this.halfExtents,e=[[d.x,d.y,d.z],[-d.x,d.y,d.z],[-d.x,-d.y,d.z],[-d.x,-d.y,-d.z],[d.x,-d.y,-d.z],[d.x,d.y,-d.z],[-d.x,d.y,-d.z],[d.x,-d.y,d.z]],f=0;f<e.length;f++)h.set(e[f][0],e[f][1],e[f][2]),b.vmult(h,h),a.vadd(h,h),c(h.x,h.y,h.z)};var i=[new f,new f,new f,new f,new f,new f,new f,new f];d.prototype.calculateWorldAABB=function(a,b,c,d){var e=this.halfExtents;i[0].set(e.x,e.y,e.z),i[1].set(-e.x,e.y,e.z),i[2].set(-e.x,-e.y,e.z),i[3].set(-e.x,-e.y,-e.z),i[4].set(e.x,-e.y,-e.z),i[5].set(e.x,e.y,-e.z),i[6].set(-e.x,e.y,-e.z),i[7].set(e.x,-e.y,e.z);var f=i[0];b.vmult(f,f),a.vadd(f,f),d.copy(f),c.copy(f);for(var g=1;g<8;g++){var f=i[g];b.vmult(f,f),a.vadd(f,f);var h=f.x,j=f.y,k=f.z;h>d.x&&(d.x=h),j>d.y&&(d.y=j),k>d.z&&(d.z=k),h<c.x&&(c.x=h),j<c.y&&(c.y=j),k<c.z&&(c.z=k)}}},{"../math/Vec3":318,"./ConvexPolyhedron":321,"./Shape":324}],321:[function(a,b,c){function d(a,b,c){e.call(this),this.type=e.types.CONVEXPOLYHEDRON,this.vertices=a||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=b||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=c?c.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3"),g=(a("../math/Quaternion"),a("../math/Transform"));d.prototype=new e,d.prototype.constructor=d;var h=new f;d.prototype.computeEdges=function(){var a=this.faces,b=this.vertices,c=(b.length,this.uniqueEdges);c.length=0;for(var d=h,e=0;e!==a.length;e++)for(var f=a[e],g=f.length,i=0;i!==g;i++){var j=(i+1)%g;b[f[i]].vsub(b[f[j]],d),d.normalize();for(var k=!1,l=0;l!==c.length;l++)if(c[l].almostEquals(d)||c[l].almostEquals(d)){k=!0;break}k||c.push(d.clone())}},d.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var a=0;a<this.faces.length;a++){for(var b=0;b<this.faces[a].length;b++)if(!this.vertices[this.faces[a][b]])throw new Error("Vertex "+this.faces[a][b]+" not found!");var c=this.faceNormals[a]||new f;this.getFaceNormal(a,c),c.negate(c),this.faceNormals[a]=c;var d=this.vertices[this.faces[a][0]];if(c.dot(d)<0){console.error(".faceNormals["+a+"] = Vec3("+c.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var b=0;b<this.faces[a].length;b++)console.warn(".vertices["+this.faces[a][b]+"] = Vec3("+this.vertices[this.faces[a][b]].toString()+")")}}};var i=new f,j=new f;d.computeNormal=function(a,b,c,d){b.vsub(a,j),c.vsub(b,i),i.cross(j,d),d.isZero()||d.normalize()},d.prototype.getFaceNormal=function(a,b){var c=this.faces[a],e=this.vertices[c[0]],f=this.vertices[c[1]],g=this.vertices[c[2]];return d.computeNormal(e,f,g,b)};var k=new f;d.prototype.clipAgainstHull=function(a,b,c,d,e,g,h,i,j){for(var l=k,m=-1,n=-Number.MAX_VALUE,o=0;o<c.faces.length;o++){l.copy(c.faceNormals[o]),e.vmult(l,l);var p=l.dot(g);p>n&&(n=p,m=o)}for(var q=[],r=c.faces[m],s=r.length,t=0;t<s;t++){var u=c.vertices[r[t]],v=new f;v.copy(u),e.vmult(v,v),d.vadd(v,v),q.push(v)}m>=0&&this.clipFaceAgainstHull(g,a,b,q,h,i,j)};var l=new f,m=new f,n=new f,o=new f,p=new f,q=new f;d.prototype.findSeparatingAxis=function(a,b,c,d,e,f,g,h){var i=l,j=m,k=n,r=o,s=p,t=q,u=Number.MAX_VALUE,v=this,w=0;if(v.uniqueAxes)for(var x=0;x!==v.uniqueAxes.length;x++){c.vmult(v.uniqueAxes[x],i);var y=v.testSepAxis(i,a,b,c,d,e);if(!1===y)return!1;y<u&&(u=y,f.copy(i))}else for(var z=g?g.length:v.faces.length,x=0;x<z;x++){var A=g?g[x]:x;i.copy(v.faceNormals[A]),c.vmult(i,i);var y=v.testSepAxis(i,a,b,c,d,e);if(!1===y)return!1;y<u&&(u=y,f.copy(i))}if(a.uniqueAxes)for(var x=0;x!==a.uniqueAxes.length;x++){e.vmult(a.uniqueAxes[x],j),w++;var y=v.testSepAxis(j,a,b,c,d,e);if(!1===y)return!1;y<u&&(u=y,f.copy(j))}else for(var B=h?h.length:a.faces.length,x=0;x<B;x++){var A=h?h[x]:x;j.copy(a.faceNormals[A]),e.vmult(j,j),w++;var y=v.testSepAxis(j,a,b,c,d,e);if(!1===y)return!1;y<u&&(u=y,f.copy(j))}for(var C=0;C!==v.uniqueEdges.length;C++){c.vmult(v.uniqueEdges[C],r);for(var D=0;D!==a.uniqueEdges.length;D++)if(e.vmult(a.uniqueEdges[D],s),r.cross(s,t),!t.almostZero()){t.normalize();var E=v.testSepAxis(t,a,b,c,d,e);if(!1===E)return!1;E<u&&(u=E,f.copy(t))}}return d.vsub(b,k),k.dot(f)>0&&f.negate(f),!0};var r=[],s=[];d.prototype.testSepAxis=function(a,b,c,e,f,g){var h=this;d.project(h,a,c,e,r),d.project(b,a,f,g,s);var i=r[0],j=r[1],k=s[0],l=s[1];if(i<l||k<j)return!1;var m=i-l,n=k-j;return m<n?m:n};var t=new f,u=new f;d.prototype.calculateLocalInertia=function(a,b){this.computeLocalAABB(t,u);var c=u.x-t.x,d=u.y-t.y,e=u.z-t.z;b.x=1/12*a*(2*d*2*d+2*e*2*e),b.y=1/12*a*(2*c*2*c+2*e*2*e),b.z=1/12*a*(2*d*2*d+2*c*2*c)},d.prototype.getPlaneConstantOfFace=function(a){var b=this.faces[a],c=this.faceNormals[a],d=this.vertices[b[0]];return-c.dot(d)};var v=new f,w=new f,x=new f,y=new f,z=new f,A=new f,B=new f,C=new f;d.prototype.clipFaceAgainstHull=function(a,b,c,d,e,f,g){for(var h=v,i=w,j=x,k=y,l=z,m=A,n=B,o=C,p=this,q=[],r=d,s=q,t=-1,u=Number.MAX_VALUE,D=0;D<p.faces.length;D++){h.copy(p.faceNormals[D]),c.vmult(h,h);var E=h.dot(a);E<u&&(u=E,t=D)}if(!(t<0)){var F=p.faces[t];F.connectedFaces=[];for(var G=0;G<p.faces.length;G++)for(var H=0;H<p.faces[G].length;H++)-1!==F.indexOf(p.faces[G][H])&&G!==t&&-1===F.connectedFaces.indexOf(G)&&F.connectedFaces.push(G);for(var I=(r.length,F.length),J=0;J<I;J++){var K=p.vertices[F[J]],L=p.vertices[F[(J+1)%I]];K.vsub(L,i),j.copy(i),c.vmult(j,j),b.vadd(j,j),k.copy(this.faceNormals[t]),c.vmult(k,k),b.vadd(k,k),j.cross(k,l),l.negate(l),m.copy(K),c.vmult(m,m),b.vadd(m,m);var M,N=(m.dot(l),F.connectedFaces[J]);n.copy(this.faceNormals[N]);var O=this.getPlaneConstantOfFace(N);o.copy(n),c.vmult(o,o);var M=O-o.dot(b);for(this.clipFaceAgainstPlane(r,s,o,M);r.length;)r.shift();for(;s.length;)r.push(s.shift())}n.copy(this.faceNormals[t]);var O=this.getPlaneConstantOfFace(t);o.copy(n),c.vmult(o,o);for(var M=O-o.dot(b),G=0;G<r.length;G++){var P=o.dot(r[G])+M;if(P<=e&&(console.log("clamped: depth="+P+" to minDist="+e),P=e),P<=f){var Q=r[G];if(P<=0){var R={point:Q,normal:o,depth:P};g.push(R)}}}}},d.prototype.clipFaceAgainstPlane=function(a,b,c,d){var e,g,h=a.length;if(h<2)return b;var i=a[a.length-1],j=a[0];e=c.dot(i)+d;for(var k=0;k<h;k++){if(j=a[k],g=c.dot(j)+d,e<0)if(g<0){var l=new f;l.copy(j),b.push(l)}else{var l=new f;i.lerp(j,e/(e-g),l),b.push(l)}else if(g<0){var l=new f;i.lerp(j,e/(e-g),l),b.push(l),b.push(j)}i=j,e=g}return b},d.prototype.computeWorldVertices=function(a,b){for(var c=this.vertices.length;this.worldVertices.length<c;)this.worldVertices.push(new f);for(var d=this.vertices,e=this.worldVertices,g=0;g!==c;g++)b.vmult(d[g],e[g]),a.vadd(e[g],e[g]);this.worldVerticesNeedsUpdate=!1};new f;d.prototype.computeLocalAABB=function(a,b){var c=this.vertices.length,d=this.vertices
;a.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var e=0;e<c;e++){var f=d[e];f.x<a.x?a.x=f.x:f.x>b.x&&(b.x=f.x),f.y<a.y?a.y=f.y:f.y>b.y&&(b.y=f.y),f.z<a.z?a.z=f.z:f.z>b.z&&(b.z=f.z)}},d.prototype.computeWorldFaceNormals=function(a){for(var b=this.faceNormals.length;this.worldFaceNormals.length<b;)this.worldFaceNormals.push(new f);for(var c=this.faceNormals,d=this.worldFaceNormals,e=0;e!==b;e++)a.vmult(c[e],d[e]);this.worldFaceNormalsNeedsUpdate=!1},d.prototype.updateBoundingSphereRadius=function(){for(var a=0,b=this.vertices,c=0,d=b.length;c!==d;c++){var e=b[c].norm2();e>a&&(a=e)}this.boundingSphereRadius=Math.sqrt(a)};var D=new f;d.prototype.calculateWorldAABB=function(a,b,c,d){for(var e,f,g,h,i,j,k=this.vertices.length,l=this.vertices,m=0;m<k;m++){D.copy(l[m]),b.vmult(D,D),a.vadd(D,D);var n=D;n.x<e||void 0===e?e=n.x:(n.x>h||void 0===h)&&(h=n.x),n.y<f||void 0===f?f=n.y:(n.y>i||void 0===i)&&(i=n.y),n.z<g||void 0===g?g=n.z:(n.z>j||void 0===j)&&(j=n.z)}c.set(e,f,g),d.set(h,i,j)},d.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},d.prototype.getAveragePointLocal=function(a){a=a||new f;for(var b=this.vertices.length,c=this.vertices,d=0;d<b;d++)a.vadd(c[d],a);return a.mult(1/b,a),a},d.prototype.transformAllPoints=function(a,b){var c=this.vertices.length,d=this.vertices;if(b){for(var e=0;e<c;e++){var f=d[e];b.vmult(f,f)}for(var e=0;e<this.faceNormals.length;e++){var f=this.faceNormals[e];b.vmult(f,f)}}if(a)for(var e=0;e<c;e++){var f=d[e];f.vadd(a,f)}};var E=new f,F=new f,G=new f;d.prototype.pointIsInside=function(a){var b=this.vertices.length,c=this.vertices,d=this.faces,e=this.faceNormals,f=this.faces.length,g=E;this.getAveragePointLocal(g);for(var h=0;h<f;h++){var b=(this.faces[h].length,e[h]),i=c[d[h][0]],j=F;a.vsub(i,j);var k=b.dot(j),l=G;g.vsub(i,l);var m=b.dot(l);if(k<0&&m>0||k>0&&m<0)return!1}return-1};var H=(new f,new f),I=new f;d.project=function(a,b,c,d,e){var f=a.vertices.length,h=H,i=0,j=0,k=I,l=a.vertices;k.setZero(),g.vectorToLocalFrame(c,d,b,h),g.pointToLocalFrame(c,d,k,k);var m=k.dot(h);j=i=l[0].dot(h);for(var n=1;n<f;n++){var o=l[n].dot(h);o>i&&(i=o),o<j&&(j=o)}if(j-=m,i-=m,j>i){var p=j;j=i,i=p}e[0]=i,e[1]=j}},{"../math/Quaternion":316,"../math/Transform":317,"../math/Vec3":318,"./Shape":324}],322:[function(a,b,c){function d(a,b,c,d){var h=d,i=[],j=[],k=[],l=[],m=[],n=Math.cos,o=Math.sin;i.push(new f(b*n(0),b*o(0),.5*-c)),l.push(0),i.push(new f(a*n(0),a*o(0),.5*c)),m.push(1);for(var p=0;p<h;p++){var q=2*Math.PI/h*(p+1),r=2*Math.PI/h*(p+.5);p<h-1?(i.push(new f(b*n(q),b*o(q),.5*-c)),l.push(2*p+2),i.push(new f(a*n(q),a*o(q),.5*c)),m.push(2*p+3),k.push([2*p+2,2*p+3,2*p+1,2*p])):k.push([0,1,2*p+1,2*p]),(h%2==1||p<h/2)&&j.push(new f(n(r),o(r),0))}k.push(m),j.push(new f(0,0,1));for(var s=[],p=0;p<l.length;p++)s.push(l[l.length-p-1]);k.push(s),this.type=e.types.CONVEXPOLYHEDRON,g.call(this,i,k,j)}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3"),g=(a("../math/Quaternion"),a("./ConvexPolyhedron"));d.prototype=new g},{"../math/Quaternion":316,"../math/Vec3":318,"./ConvexPolyhedron":321,"./Shape":324}],323:[function(a,b,c){function d(){e.call(this),this.type=e.types.PLANE,this.worldNormal=new f,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3");d.prototype=new e,d.prototype.constructor=d,d.prototype.computeWorldNormal=function(a){var b=this.worldNormal;b.set(0,0,1),a.vmult(b,b),this.worldNormalNeedsUpdate=!1},d.prototype.calculateLocalInertia=function(a,b){return b=b||new f},d.prototype.volume=function(){return Number.MAX_VALUE};var g=new f;d.prototype.calculateWorldAABB=function(a,b,c,d){g.set(0,0,1),b.vmult(g,g);var e=Number.MAX_VALUE;c.set(-e,-e,-e),d.set(e,e,e),1===g.x&&(d.x=a.x),1===g.y&&(d.y=a.y),1===g.z&&(d.z=a.z),-1===g.x&&(c.x=a.x),-1===g.y&&(c.y=a.y),-1===g.z&&(c.z=a.z)},d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":318,"./Shape":324}],324:[function(a,b,c){function d(){this.id=d.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}b.exports=d;var d=a("./Shape");a("../math/Vec3"),a("../math/Quaternion"),a("../material/Material");d.prototype.constructor=d,d.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},d.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},d.prototype.calculateLocalInertia=function(a,b){throw"calculateLocalInertia() not implemented for shape type "+this.type},d.idCounter=0,d.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":313,"../math/Quaternion":316,"../math/Vec3":318,"./Shape":324}],325:[function(a,b,c){function d(a){if(e.call(this),this.radius=void 0!==a?Number(a):1,this.type=e.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}b.exports=d;var e=a("./Shape"),f=a("../math/Vec3");d.prototype=new e,d.prototype.constructor=d,d.prototype.calculateLocalInertia=function(a,b){b=b||new f;var c=2*a*this.radius*this.radius/5;return b.x=c,b.y=c,b.z=c,b},d.prototype.volume=function(){return 4*Math.PI*this.radius/3},d.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},d.prototype.calculateWorldAABB=function(a,b,c,d){for(var e=this.radius,f=["x","y","z"],g=0;g<f.length;g++){var h=f[g];c[h]=a[h]-e,d[h]=a[h]+e}}},{"../math/Vec3":318,"./Shape":324}],326:[function(a,b,c){function d(){e.call(this),this.iterations=10,this.tolerance=1e-7}b.exports=d;var e=(a("../math/Vec3"),a("../math/Quaternion"),a("./Solver"));d.prototype=new e;var f=[],g=[],h=[];d.prototype.solve=function(a,b){var c,d,e,i,j,k,l=0,m=this.iterations,n=this.tolerance*this.tolerance,o=this.equations,p=o.length,q=b.bodies,r=q.length,s=a;if(0!==p)for(var t=0;t!==r;t++)q[t].updateSolveMassProperties();var u=g,v=h,w=f;u.length=p,v.length=p,w.length=p;for(var t=0;t!==p;t++){var x=o[t];w[t]=0,v[t]=x.computeB(s),u[t]=1/x.computeC()}if(0!==p){for(var t=0;t!==r;t++){var y=q[t],z=y.vlambda,A=y.wlambda;z.set(0,0,0),A&&A.set(0,0,0)}for(l=0;l!==m;l++){i=0;for(var B=0;B!==p;B++){var x=o[B];c=v[B],d=u[B],k=w[B],j=x.computeGWlambda(),e=d*(c-j-x.eps*k),k+e<x.minForce?e=x.minForce-k:k+e>x.maxForce&&(e=x.maxForce-k),w[B]+=e,i+=e>0?e:-e,x.addToWlambda(e)}if(i*i<n)break}for(var t=0;t!==r;t++){var y=q[t],C=y.velocity,D=y.angularVelocity;C.vadd(y.vlambda,C),D&&D.vadd(y.wlambda,D)}}return l}},{"../math/Quaternion":316,"../math/Vec3":318,"./Solver":327}],327:[function(a,b,c){function d(){this.equations=[]}b.exports=d,d.prototype.solve=function(a,b){return 0},d.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)},d.prototype.removeEquation=function(a){var b=this.equations,c=b.indexOf(a);-1!==c&&b.splice(c,1)},d.prototype.removeAllEquations=function(){this.equations.length=0}},{}],328:[function(a,b,c){var d=function(){};b.exports=d,d.prototype={constructor:d,addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;return void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b),this},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){if(void 0===this._listeners)return this;var c=this._listeners;if(void 0===c[a])return this;var d=c[a].indexOf(b);return-1!==d&&c[a].splice(d,1),this},dispatchEvent:function(a){if(void 0===this._listeners)return this;var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=0,e=c.length;d<e;d++)c[d].call(this,a)}return this}}},{}],329:[function(a,b,c){function d(){this.objects=[],this.type=Object}b.exports=d,d.prototype.release=function(){for(var a=arguments.length,b=0;b!==a;b++)this.objects.push(arguments[b])},d.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},d.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],330:[function(a,b,c){function d(){this.data={keys:[]}}b.exports=d,d.prototype.get=function(a,b){if(a>b){var c=b;b=a,a=c}return this.data[a+"-"+b]},d.prototype.set=function(a,b,c){if(a>b){var d=b;b=a,a=d}var e=a+"-"+b;this.get(a,b)||this.data.keys.push(e),this.data[e]=c},d.prototype.reset=function(){for(var a=this.data,b=a.keys;b.length>0;){delete a[b.pop()]}}},{}],331:[function(a,b,c){function d(){}b.exports=d,d.defaults=function(a,b){a=a||{};for(var c in b)c in a||(a[c]=b[c]);return a}},{}],332:[function(a,b,c){function d(){f.call(this),this.type=e}b.exports=d;var e=a("../math/Vec3"),f=a("./Pool");d.prototype=new f,d.prototype.constructObject=function(){return new e}},{"../math/Vec3":318,"./Pool":329}],333:[function(a,b,c){function d(a){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new l,this.world=a,this.currentContactMaterial=null,this.enableFrictionReduction=!1}function e(a,b,c){for(var d=null,e=a.length,f=0;f!==e;f++){var g=a[f],h=P;a[(f+1)%e].vsub(g,h);var i=Q;h.cross(b,i);var j=R;c.vsub(g,j);var k=i.dot(j);if(!(null===d||k>0&&!0===d||k<=0&&!1===d))return!1;null===d&&(d=k>0)}return!0}b.exports=d;var f=a("../collision/AABB"),g=a("../shapes/Shape"),h=a("../collision/Ray"),i=a("../math/Vec3"),j=a("../math/Transform"),k=(a("../shapes/ConvexPolyhedron"),a("../math/Quaternion")),l=(a("../solver/Solver"),a("../utils/Vec3Pool")),m=a("../equations/ContactEquation"),n=a("../equations/FrictionEquation");d.prototype.createContactEquation=function(a,b,c,d,e,f){var g;this.contactPointPool.length?(g=this.contactPointPool.pop(),g.bi=a,g.bj=b):g=new m(a,b),g.enabled=a.collisionResponse&&b.collisionResponse&&c.collisionResponse&&d.collisionResponse;var h=this.currentContactMaterial;g.restitution=h.restitution,g.setSpookParams(h.contactEquationStiffness,h.contactEquationRelaxation,this.world.dt);var i=c.material||a.material,j=d.material||b.material;return i&&j&&i.restitution>=0&&j.restitution>=0&&(g.restitution=i.restitution*j.restitution),g.si=e||c,g.sj=f||d,g},d.prototype.createFrictionEquationsFromContact=function(a,b){var c=a.bi,d=a.bj,e=a.si,f=a.sj,g=this.world,h=this.currentContactMaterial,i=h.friction,j=e.material||c.material,k=f.material||d.material;if(j&&k&&j.friction>=0&&k.friction>=0&&(i=j.friction*k.friction),i>0){var l=i*g.gravity.length(),m=c.invMass+d.invMass;m>0&&(m=1/m);var o=this.frictionEquationPool,p=o.length?o.pop():new n(c,d,l*m),q=o.length?o.pop():new n(c,d,l*m);return p.bi=q.bi=c,p.bj=q.bj=d,p.minForce=q.minForce=-l*m,p.maxForce=q.maxForce=l*m,p.ri.copy(a.ri),p.rj.copy(a.rj),q.ri.copy(a.ri),q.rj.copy(a.rj),a.ni.tangents(p.t,q.t),p.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,g.dt),q.setSpookParams(h.frictionEquationStiffness,h.frictionEquationRelaxation,g.dt),p.enabled=q.enabled=a.enabled,b.push(p,q),!0}return!1};var o=new i,p=new i,q=new i;d.prototype.createFrictionFromAverage=function(a){var b=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(b,this.frictionResult)&&1!==a){var c=this.frictionResult[this.frictionResult.length-2],d=this.frictionResult[this.frictionResult.length-1];o.setZero(),p.setZero(),q.setZero();for(var e=b.bi,f=(b.bj,0);f!==a;f++)b=this.result[this.result.length-1-f],b.bodyA!==e?(o.vadd(b.ni,o),p.vadd(b.ri,p),q.vadd(b.rj,q)):(o.vsub(b.ni,o),p.vadd(b.rj,p),q.vadd(b.ri,q));var g=1/a;p.scale(g,c.ri),q.scale(g,c.rj),d.ri.copy(c.ri),d.rj.copy(c.rj),o.normalize(),o.tangents(c.t,d.t)}};var r=new i,s=new i,t=new k,u=new k;d.prototype.getContacts=function(a,b,c,d,e,f,g){this.contactPointPool=e,this.frictionEquationPool=g,this.result=d,this.frictionResult=f;for(var h=t,i=u,j=r,k=s,l=0,m=a.length;l!==m;l++){var n=a[l],o=b[l],p=null;n.material&&o.material&&(p=c.getContactMaterial(n.material,o.material)||null);for(var q=0;q<n.shapes.length;q++){n.quaternion.mult(n.shapeOrientations[q],h),n.quaternion.vmult(n.shapeOffsets[q],j),j.vadd(n.position,j);for(var v=n.shapes[q],w=0;w<o.shapes.length;w++){o.quaternion.mult(o.shapeOrientations[w],i),o.quaternion.vmult(o.shapeOffsets[w],k),k.vadd(o.position,k);var x=o.shapes[w];if(!(j.distanceTo(k)>v.boundingSphereRadius+x.boundingSphereRadius)){var y=null;v.material&&x.material&&(y=c.getContactMaterial(v.material,x.material)||null),this.currentContactMaterial=y||p||c.defaultContactMaterial;var z=this[v.type|x.type];z&&(v.type<x.type?z.call(this,v,x,j,k,h,i,n,o,v,x):z.call(this,x,v,k,j,i,h,o,n,v,x))}}}}};d.prototype[g.types.BOX|g.types.BOX]=d.prototype.boxBox=function(a,b,c,d,e,f,g,h){a.convexPolyhedronRepresentation.material=a.material,b.convexPolyhedronRepresentation.material=b.material,a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse,b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse,this.convexConvex(a.convexPolyhedronRepresentation,b.convexPolyhedronRepresentation,c,d,e,f,g,h,a,b)},d.prototype[g.types.BOX|g.types.CONVEXPOLYHEDRON]=d.prototype.boxConvex=function(a,b,c,d,e,f,g,h){a.convexPolyhedronRepresentation.material=a.material,a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse,this.convexConvex(a.convexPolyhedronRepresentation,b,c,d,e,f,g,h,a,b)},d.prototype[g.types.BOX|g.types.PARTICLE]=d.prototype.boxParticle=function(a,b,c,d,e,f,g,h){a.convexPolyhedronRepresentation.material=a.material,a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse,this.convexParticle(a.convexPolyhedronRepresentation,b,c,d,e,f,g,h,a,b)},d.prototype[g.types.SPHERE]=d.prototype.sphereSphere=function(a,b,c,d,e,f,g,h){var i=this.createContactEquation(g,h,a,b);d.vsub(c,i.ni),i.ni.normalize(),i.ri.copy(i.ni),i.rj.copy(i.ni),i.ri.mult(a.radius,i.ri),i.rj.mult(-b.radius,i.rj),i.ri.vadd(c,i.ri),i.ri.vsub(g.position,i.ri),i.rj.vadd(d,i.rj),i.rj.vsub(h.position,i.rj),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)};var v=new i,w=new i,x=new i;d.prototype[g.types.PLANE|g.types.TRIMESH]=d.prototype.planeTrimesh=function(a,b,c,d,e,f,g,h){var k=new i,l=v;l.set(0,0,1),e.vmult(l,l);for(var m=0;m<b.vertices.length/3;m++){b.getVertex(m,k);var n=new i;n.copy(k),j.pointToWorldFrame(d,f,n,k);var o=w;k.vsub(c,o);if(l.dot(o)<=0){var p=this.createContactEquation(g,h,a,b);p.ni.copy(l);var q=x;l.scale(o.dot(l),q),k.vsub(q,q),p.ri.copy(q),p.ri.vsub(g.position,p.ri),p.rj.copy(k),p.rj.vsub(h.position,p.rj),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}}};var y=new i,z=new i,A=(new i,new i),B=new i,C=new i,D=new i,E=new i,F=new i,G=new i,H=new i,I=new i,J=new i,K=new i,L=new f,M=[];d.prototype[g.types.SPHERE|g.types.TRIMESH]=d.prototype.sphereTrimesh=function(a,b,c,d,e,f,g,i){var k=C,l=D,m=E,n=F,o=G,p=H,q=L,r=B,s=z,t=M;j.pointToLocalFrame(d,f,c,o);var u=a.radius;q.lowerBound.set(o.x-u,o.y-u,o.z-u),q.upperBound.set(o.x+u,o.y+u,o.z+u),b.getTrianglesInAABB(q,t);for(var v=A,w=a.radius*a.radius,x=0;x<t.length;x++)for(var N=0;N<3;N++)if(b.getVertex(b.indices[3*t[x]+N],v),v.vsub(o,s),s.norm2()<=w){r.copy(v),j.pointToWorldFrame(d,f,r,v),v.vsub(c,s);var O=this.createContactEquation(g,i,a,b);O.ni.copy(s),O.ni.normalize(),O.ri.copy(O.ni),O.ri.scale(a.radius,O.ri),O.ri.vadd(c,O.ri),O.ri.vsub(g.position,O.ri),O.rj.copy(v),O.rj.vsub(i.position,O.rj),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}for(var x=0;x<t.length;x++)for(var N=0;N<3;N++){b.getVertex(b.indices[3*t[x]+N],k),b.getVertex(b.indices[3*t[x]+(N+1)%3],l),l.vsub(k,m),o.vsub(l,p);var P=p.dot(m);o.vsub(k,p);var Q=p.dot(m);if(Q>0&&P<0){o.vsub(k,p),n.copy(m),n.normalize(),Q=p.dot(n),n.scale(Q,p),p.vadd(k,p);var R=p.distanceTo(o);if(R<a.radius){var O=this.createContactEquation(g,i,a,b);p.vsub(o,O.ni),O.ni.normalize(),O.ni.scale(a.radius,O.ri),j.pointToWorldFrame(d,f,p,p),p.vsub(i.position,O.rj),j.vectorToWorldFrame(f,O.ni,O.ni),j.vectorToWorldFrame(f,O.ri,O.ri),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}}}for(var S=I,T=J,U=K,V=y,x=0,W=t.length;x!==W;x++){b.getTriangleVertices(t[x],S,T,U),b.getNormal(t[x],V),o.vsub(S,p);var R=p.dot(V);if(V.scale(R,p),o.vsub(p,p),R=p.distanceTo(o),h.pointInTriangle(p,S,T,U)&&R<a.radius){var O=this.createContactEquation(g,i,a,b);p.vsub(o,O.ni),O.ni.normalize(),O.ni.scale(a.radius,O.ri),j.pointToWorldFrame(d,f,p,p),p.vsub(i.position,O.rj),j.vectorToWorldFrame(f,O.ni,O.ni),j.vectorToWorldFrame(f,O.ri,O.ri),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}}t.length=0};var N=new i,O=new i;d.prototype[g.types.SPHERE|g.types.PLANE]=d.prototype.spherePlane=function(a,b,c,d,e,f,g,h){var i=this.createContactEquation(g,h,a,b);if(i.ni.set(0,0,1),f.vmult(i.ni,i.ni),i.ni.negate(i.ni),i.ni.normalize(),i.ni.mult(a.radius,i.ri),c.vsub(d,N),i.ni.mult(i.ni.dot(N),O),N.vsub(O,i.rj),-N.dot(i.ni)<=a.radius){var j=i.ri,k=i.rj;j.vadd(c,j),j.vsub(g.position,j),k.vadd(d,k),k.vsub(h.position,k),this.result.push(i),this.createFrictionEquationsFromContact(i,this.frictionResult)}};var P=new i,Q=new i,R=new i,S=new i,T=new i,U=new i,V=new i,W=[new i,new i,new i,new i,new i,new i],X=new i,Y=new i,Z=new i,$=new i;d.prototype[g.types.SPHERE|g.types.BOX]=d.prototype.sphereBox=function(a,b,c,d,e,f,g,h){var i=this.v3pool,j=W;c.vsub(d,S),b.getSideNormals(j,f);for(var k=a.radius,l=!1,m=Y,n=Z,o=$,p=null,q=0,r=0,s=0,t=null,u=0,v=j.length;u!==v&&!1===l;u++){var w=T;w.copy(j[u]);var x=w.norm();w.normalize();var y=S.dot(w);if(y<x+k&&y>0){var z=U,A=V;z.copy(j[(u+1)%3]),A.copy(j[(u+2)%3]);var B=z.norm(),C=A.norm();z.normalize(),A.normalize();var D=S.dot(z),E=S.dot(A);if(D<B&&D>-B&&E<C&&E>-C){var F=Math.abs(y-x-k);(null===t||F<t)&&(t=F,r=D,s=E,p=x,m.copy(w),n.copy(z),o.copy(A),q++)}}}if(q){l=!0;var G=this.createContactEquation(g,h,a,b);m.mult(-k,G.ri),G.ni.copy(m),G.ni.negate(G.ni),m.mult(p,m),n.mult(r,n),m.vadd(n,m),o.mult(s,o),m.vadd(o,G.rj),G.ri.vadd(c,G.ri),G.ri.vsub(g.position,G.ri),G.rj.vadd(d,G.rj),G.rj.vsub(h.position,G.rj),this.result.push(G),this.createFrictionEquationsFromContact(G,this.frictionResult)}for(var H=i.get(),I=X,J=0;2!==J&&!l;J++)for(var K=0;2!==K&&!l;K++)for(var L=0;2!==L&&!l;L++)if(H.set(0,0,0),J?H.vadd(j[0],H):H.vsub(j[0],H),K?H.vadd(j[1],H):H.vsub(j[1],H),L?H.vadd(j[2],H):H.vsub(j[2],H),d.vadd(H,I),I.vsub(c,I),I.norm2()<k*k){l=!0;var G=this.createContactEquation(g,h,a,b);G.ri.copy(I),G.ri.normalize(),G.ni.copy(G.ri),G.ri.mult(k,G.ri),G.rj.copy(H),G.ri.vadd(c,G.ri),G.ri.vsub(g.position,G.ri),G.rj.vadd(d,G.rj),G.rj.vsub(h.position,G.rj),this.result.push(G),this.createFrictionEquationsFromContact(G,this.frictionResult)}i.release(H),H=null;for(var M=i.get(),N=i.get(),G=i.get(),O=i.get(),F=i.get(),P=j.length,J=0;J!==P&&!l;J++)for(var K=0;K!==P&&!l;K++)if(J%3!=K%3){j[K].cross(j[J],M),M.normalize(),j[J].vadd(j[K],N),G.copy(c),G.vsub(N,G),G.vsub(d,G);var Q=G.dot(M);M.mult(Q,O);for(var L=0;L===J%3||L===K%3;)L++;F.copy(c),F.vsub(O,F),F.vsub(N,F),F.vsub(d,F);var R=Math.abs(Q),_=F.norm();if(R<j[L].norm()&&_<k){l=!0;var aa=this.createContactEquation(g,h,a,b);N.vadd(O,aa.rj),aa.rj.copy(aa.rj),F.negate(aa.ni),aa.ni.normalize(),aa.ri.copy(aa.rj),aa.ri.vadd(d,aa.ri),aa.ri.vsub(c,aa.ri),aa.ri.normalize(),aa.ri.mult(k,aa.ri),aa.ri.vadd(c,aa.ri),aa.ri.vsub(g.position,aa.ri),aa.rj.vadd(d,aa.rj),aa.rj.vsub(h.position,aa.rj),this.result.push(aa),this.createFrictionEquationsFromContact(aa,this.frictionResult)}}i.release(M,N,G,O,F)};var _=new i,aa=new i,ba=new i,ca=new i,da=new i,ea=new i,fa=new i,ga=new i,ha=new i,ia=new i;d.prototype[g.types.SPHERE|g.types.CONVEXPOLYHEDRON]=d.prototype.sphereConvex=function(a,b,c,d,f,g,h,i){var j=this.v3pool;c.vsub(d,_);for(var k=b.faceNormals,l=b.faces,m=b.vertices,n=a.radius,o=0;o!==m.length;o++){var p=m[o],q=da;g.vmult(p,q),d.vadd(q,q);var r=ca;if(q.vsub(c,r),r.norm2()<n*n){t=!0;var s=this.createContactEquation(h,i,a,b);return s.ri.copy(r),s.ri.normalize(),s.ni.copy(s.ri),s.ri.mult(n,s.ri),q.vsub(d,s.rj),s.ri.vadd(c,s.ri),s.ri.vsub(h.position,s.ri),s.rj.vadd(d,s.rj),s.rj.vsub(i.position,s.rj),this.result.push(s),void this.createFrictionEquationsFromContact(s,this.frictionResult)}}for(var t=!1,o=0,u=l.length;o!==u&&!1===t;o++){var v=k[o],w=l[o],x=ea;g.vmult(v,x);var y=fa;g.vmult(m[w[0]],y),y.vadd(d,y);var z=ga;x.mult(-n,z),c.vadd(z,z);var A=ha;z.vsub(y,A);var B=A.dot(x),C=ia;if(c.vsub(y,C),B<0&&C.dot(x)>0){for(var D=[],E=0,F=w.length;E!==F;E++){var G=j.get();g.vmult(m[w[E]],G),d.vadd(G,G),D.push(G)}if(e(D,x,c)){t=!0;var s=this.createContactEquation(h,i,a,b);x.mult(-n,s.ri),x.negate(s.ni);var H=j.get();x.mult(-B,H);var I=j.get();x.mult(-n,I),c.vsub(d,s.rj),s.rj.vadd(I,s.rj),s.rj.vadd(H,s.rj),s.rj.vadd(d,s.rj),s.rj.vsub(i.position,s.rj),s.ri.vadd(c,s.ri),s.ri.vsub(h.position,s.ri),j.release(H),j.release(I),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(var E=0,J=D.length;E!==J;E++)j.release(D[E]);return}for(var E=0;E!==w.length;E++){var K=j.get(),L=j.get();g.vmult(m[w[(E+1)%w.length]],K),g.vmult(m[w[(E+2)%w.length]],L),d.vadd(K,K),d.vadd(L,L);var M=aa;L.vsub(K,M);var N=ba;M.unit(N);var O=j.get(),P=j.get();c.vsub(K,P);var Q=P.dot(N);N.mult(Q,O),O.vadd(K,O);var R=j.get();if(O.vsub(c,R),Q>0&&Q*Q<M.norm2()&&R.norm2()<n*n){var s=this.createContactEquation(h,i,a,b);O.vsub(d,s.rj),O.vsub(c,s.ni),s.ni.normalize(),s.ni.mult(n,s.ri),s.rj.vadd(d,s.rj),s.rj.vsub(i.position,s.rj),s.ri.vadd(c,s.ri),s.ri.vsub(h.position,s.ri),this.result.push(s),this.createFrictionEquationsFromContact(s,this.frictionResult);for(var E=0,J=D.length;E!==J;E++)j.release(D[E]);return j.release(K),j.release(L),j.release(O),j.release(R),void j.release(P)}j.release(K),j.release(L),j.release(O),j.release(R),j.release(P)}for(var E=0,J=D.length;E!==J;E++)j.release(D[E])}}};new i,new i;d.prototype[g.types.PLANE|g.types.BOX]=d.prototype.planeBox=function(a,b,c,d,e,f,g,h){b.convexPolyhedronRepresentation.material=b.material,b.convexPolyhedronRepresentation.collisionResponse=b.collisionResponse,this.planeConvex(a,b.convexPolyhedronRepresentation,c,d,e,f,g,h)};var ja=new i,ka=new i,la=new i,ma=new i;d.prototype[g.types.PLANE|g.types.CONVEXPOLYHEDRON]=d.prototype.planeConvex=function(a,b,c,d,e,f,g,h){var i=ja,j=ka;j.set(0,0,1),e.vmult(j,j);for(var k=0,l=la,m=0;m!==b.vertices.length;m++){i.copy(b.vertices[m]),f.vmult(i,i),d.vadd(i,i),i.vsub(c,l);if(j.dot(l)<=0){var n=this.createContactEquation(g,h,a,b),o=ma;j.mult(j.dot(l),o),i.vsub(o,o),o.vsub(c,n.ri),n.ni.copy(j),i.vsub(d,n.rj),n.ri.vadd(c,n.ri),n.ri.vsub(g.position,n.ri),n.rj.vadd(d,n.rj),n.rj.vsub(h.position,n.rj),this.result.push(n),k++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(n,this.frictionResult)}}this.enableFrictionReduction&&k&&this.createFrictionFromAverage(k)};var na=new i,oa=new i;d.prototype[g.types.CONVEXPOLYHEDRON]=d.prototype.convexConvex=function(a,b,c,d,e,f,g,h,i,j,k,l){var m=na;if(!(c.distanceTo(d)>a.boundingSphereRadius+b.boundingSphereRadius)&&a.findSeparatingAxis(b,c,e,d,f,m,k,l)){var n=[],o=oa;a.clipAgainstHull(c,e,b,d,f,m,-100,100,n);for(var p=0,q=0;q!==n.length;q++){var r=this.createContactEquation(g,h,a,b,i,j),s=r.ri,t=r.rj;m.negate(r.ni),n[q].normal.negate(o),o.mult(n[q].depth,o),n[q].point.vadd(o,s),t.copy(n[q].point),s.vsub(c,s),t.vsub(d,t),s.vadd(c,s),s.vsub(g.position,s),t.vadd(d,t),t.vsub(h.position,t),this.result.push(r),p++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(r,this.frictionResult)}this.enableFrictionReduction&&p&&this.createFrictionFromAverage(p)}};var pa=new i,qa=new i,ra=new i;d.prototype[g.types.PLANE|g.types.PARTICLE]=d.prototype.planeParticle=function(a,b,c,d,e,f,g,h){var i=pa;i.set(0,0,1),g.quaternion.vmult(i,i);var j=qa;if(d.vsub(g.position,j),i.dot(j)<=0){var k=this.createContactEquation(h,g,b,a);k.ni.copy(i),k.ni.negate(k.ni),k.ri.set(0,0,0);var l=ra;i.mult(i.dot(d),l),d.vsub(l,l),k.rj.copy(l),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult)}};var sa=new i;d.prototype[g.types.PARTICLE|g.types.SPHERE]=d.prototype.sphereParticle=function(a,b,c,d,e,f,g,h){var i=sa;if(i.set(0,0,1),d.vsub(c,i),i.norm2()<=a.radius*a.radius){var j=this.createContactEquation(h,g,b,a);i.normalize(),j.rj.copy(i),j.rj.mult(a.radius,j.rj),j.ni.copy(i),j.ni.negate(j.ni),j.ri.set(0,0,0),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}};var ta=new k,ua=new i,va=(new i,new i),wa=new i,xa=new i;d.prototype[g.types.PARTICLE|g.types.CONVEXPOLYHEDRON]=d.prototype.convexParticle=function(a,b,c,d,e,f,g,h){var i=-1,j=va,k=xa,l=null,m=0,n=ua;if(n.copy(d),n.vsub(c,n),e.conjugate(ta),ta.vmult(n,n),a.pointIsInside(n)){a.worldVerticesNeedsUpdate&&a.computeWorldVertices(c,e),a.worldFaceNormalsNeedsUpdate&&a.computeWorldFaceNormals(e);for(var o=0,p=a.faces.length;o!==p;o++){var q=[a.worldVertices[a.faces[o][0]]],r=a.worldFaceNormals[o];d.vsub(q[0],wa);var s=-r.dot(wa);(null===l||Math.abs(s)<Math.abs(l))&&(l=s,i=o,j.copy(r),m++)}if(-1!==i){var t=this.createContactEquation(h,g,b,a);j.mult(l,k),k.vadd(d,k),k.vsub(c,k),t.rj.copy(k),j.negate(t.ni),t.ri.set(0,0,0);var u=t.ri,v=t.rj;u.vadd(d,u),u.vsub(h.position,u),v.vadd(c,v),v.vsub(g.position,v),this.result.push(t),this.createFrictionEquationsFromContact(t,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},d.prototype[g.types.BOX|g.types.HEIGHTFIELD]=d.prototype.boxHeightfield=function(a,b,c,d,e,f,g,h){a.convexPolyhedronRepresentation.material=a.material,a.convexPolyhedronRepresentation.collisionResponse=a.collisionResponse,this.convexHeightfield(a.convexPolyhedronRepresentation,b,c,d,e,f,g,h)};var ya=new i,za=new i,Aa=[0];d.prototype[g.types.CONVEXPOLYHEDRON|g.types.HEIGHTFIELD]=d.prototype.convexHeightfield=function(a,b,c,d,e,f,g,h){var i=b.data,k=b.elementSize,l=a.boundingSphereRadius,m=za,n=Aa,o=ya;j.pointToLocalFrame(d,f,c,o);var p=Math.floor((o.x-l)/k)-1,q=Math.ceil((o.x+l)/k)+1,r=Math.floor((o.y-l)/k)-1,s=Math.ceil((o.y+l)/k)+1;if(!(q<0||s<0||p>i.length||r>i[0].length)){p<0&&(p=0),q<0&&(q=0),r<0&&(r=0),s<0&&(s=0),p>=i.length&&(p=i.length-1),q>=i.length&&(q=i.length-1),s>=i[0].length&&(s=i[0].length-1),r>=i[0].length&&(r=i[0].length-1);var t=[];b.getRectMinMax(p,r,q,s,t);var u=t[0],v=t[1];if(!(o.z-l>v||o.z+l<u))for(var w=p;w<q;w++)for(var x=r;x<s;x++)b.getConvexTrianglePillar(w,x,!1),j.pointToWorldFrame(d,f,b.pillarOffset,m),c.distanceTo(m)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.convexConvex(a,b.pillarConvex,c,m,e,f,g,h,null,null,n,null),b.getConvexTrianglePillar(w,x,!0),j.pointToWorldFrame(d,f,b.pillarOffset,m),c.distanceTo(m)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.convexConvex(a,b.pillarConvex,c,m,e,f,g,h,null,null,n,null)}};var Ba=new i,Ca=new i;d.prototype[g.types.SPHERE|g.types.HEIGHTFIELD]=d.prototype.sphereHeightfield=function(a,b,c,d,e,f,g,h){var i=b.data,k=a.radius,l=b.elementSize,m=Ca,n=Ba;j.pointToLocalFrame(d,f,c,n);var o=Math.floor((n.x-k)/l)-1,p=Math.ceil((n.x+k)/l)+1,q=Math.floor((n.y-k)/l)-1,r=Math.ceil((n.y+k)/l)+1;if(!(p<0||r<0||o>i.length||r>i[0].length)){o<0&&(o=0),p<0&&(p=0),q<0&&(q=0),r<0&&(r=0),o>=i.length&&(o=i.length-1),p>=i.length&&(p=i.length-1),r>=i[0].length&&(r=i[0].length-1),q>=i[0].length&&(q=i[0].length-1);var s=[];b.getRectMinMax(o,q,p,r,s);var t=s[0],u=s[1];if(!(n.z-k>u||n.z+k<t))for(var v=this.result,w=o;w<p;w++)for(var x=q;x<r;x++){var y=v.length;b.getConvexTrianglePillar(w,x,!1),j.pointToWorldFrame(d,f,b.pillarOffset,m),c.distanceTo(m)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.sphereConvex(a,b.pillarConvex,c,m,e,f,g,h),b.getConvexTrianglePillar(w,x,!0),j.pointToWorldFrame(d,f,b.pillarOffset,m),c.distanceTo(m)<b.pillarConvex.boundingSphereRadius+a.boundingSphereRadius&&this.sphereConvex(a,b.pillarConvex,c,m,e,f,g,h);var z=v.length-y;if(z>2)return}}}},{"../collision/AABB":297,"../collision/Ray":301,"../equations/ContactEquation":307,"../equations/FrictionEquation":309,"../math/Quaternion":316,"../math/Transform":317,"../math/Vec3":318,"../shapes/ConvexPolyhedron":321,"../shapes/Shape":324,"../solver/Solver":327,"../utils/Vec3Pool":332}],334:[function(a,b,c){function d(){j.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new f,this.broadphase=new s,this.bodies=[],this.solver=new h,this.constraints=[],this.narrowphase=new i(this),this.collisionMatrix=new k,this.collisionMatrixPrevious=new k,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new o,this.defaultMaterial=new l("default"),this.defaultContactMaterial=new m(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}b.exports=d;var e=a("../shapes/Shape"),f=a("../math/Vec3"),g=a("../math/Quaternion"),h=a("../solver/GSSolver"),i=(a("../utils/Vec3Pool"),a("../equations/ContactEquation"),a("../equations/FrictionEquation"),a("./Narrowphase")),j=a("../utils/EventTarget"),k=a("../collision/ArrayCollisionMatrix"),l=a("../material/Material"),m=a("../material/ContactMaterial"),n=a("../objects/Body"),o=a("../utils/TupleDictionary"),p=a("../collision/RaycastResult"),q=a("../collision/AABB"),r=a("../collision/Ray"),s=a("../collision/NaiveBroadphase");d.prototype=new j;var t=(new q,new r);if(d.prototype.getContactMaterial=function(a,b){return this.contactMaterialTable.get(a.id,b.id)},d.prototype.numObjects=function(){return this.bodies.length},d.prototype.collisionMatrixTick=function(){var a=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=a,this.collisionMatrix.reset()},d.prototype.add=d.prototype.addBody=function(a){-1===this.bodies.indexOf(a)&&(a.index=this.bodies.length,this.bodies.push(a),a.world=this,a.initPosition.copy(a.position),a.initVelocity.copy(a.velocity),a.timeLastSleepy=this.time,a instanceof n&&(a.initAngularVelocity.copy(a.angularVelocity),a.initQuaternion.copy(a.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=a,this.dispatchEvent(this.addBodyEvent))},d.prototype.addConstraint=function(a){this.constraints.push(a)},d.prototype.removeConstraint=function(a){var b=this.constraints.indexOf(a);-1!==b&&this.constraints.splice(b,1)},d.prototype.rayTest=function(a,b,c){c instanceof p?this.raycastClosest(a,b,{skipBackfaces:!0},c):this.raycastAll(a,b,{skipBackfaces:!0},c)},d.prototype.raycastAll=function(a,b,c,d){return c.mode=r.ALL,c.from=a,c.to=b,c.callback=d,t.intersectWorld(this,c)},d.prototype.raycastAny=function(a,b,c,d){return c.mode=r.ANY,c.from=a,c.to=b,c.result=d,t.intersectWorld(this,c)},d.prototype.raycastClosest=function(a,b,c,d){return c.mode=r.CLOSEST,c.from=a,c.to=b,c.result=d,t.intersectWorld(this,c)},d.prototype.remove=function(a){a.world=null;var b=this.bodies.length-1,c=this.bodies,d=c.indexOf(a);if(-1!==d){c.splice(d,1);for(var e=0;e!==c.length;e++)c[e].index=e;this.collisionMatrix.setNumObjects(b),this.removeBodyEvent.body=a,this.dispatchEvent(this.removeBodyEvent)}},d.prototype.removeBody=d.prototype.remove,d.prototype.addMaterial=function(a){this.materials.push(a)},d.prototype.addContactMaterial=function(a){this.contactmaterials.push(a),this.contactMaterialTable.set(a.materials[0].id,a.materials[1].id,a)},"undefined"==typeof performance&&(performance={}),!performance.now){var u=Date.now();performance.timing&&performance.timing.navigationStart&&(u=performance.timing.navigationStart),performance.now=function(){return Date.now()-u}}var v=new f;d.prototype.step=function(a,b,c){if(c=c||10,
0===(b=b||0))this.internalStep(a),this.time+=a;else{var d=Math.floor((this.time+b)/a)-Math.floor(this.time/a);d=Math.min(d,c);for(var e=performance.now(),f=0;f!==d&&(this.internalStep(a),!(performance.now()-e>1e3*a));f++);this.time+=b;for(var g=this.time%a,h=g/a,i=v,j=this.bodies,k=0;k!==j.length;k++){var l=j[k];l.type!==n.STATIC&&l.sleepState!==n.SLEEPING?(l.position.vsub(l.previousPosition,i),i.scale(h,i),l.position.vadd(i,l.interpolatedPosition)):(l.interpolatedPosition.copy(l.position),l.interpolatedQuaternion.copy(l.quaternion))}}};var w={type:"postStep"},x={type:"preStep"},y={type:"collide",body:null,contact:null},z=[],A=[],B=[],C=[],D=(new f,new f,new f,new f,new f,new f,new f,new f,new f,new g,new g),E=new g,F=new f;d.prototype.internalStep=function(a){this.dt=a;var b,c=this.contacts,d=B,f=C,g=this.numObjects(),h=this.bodies,i=this.solver,j=this.gravity,k=this.doProfiling,l=this.profile,m=n.DYNAMIC,o=this.constraints,p=A,q=(j.norm(),j.x),r=j.y,s=j.z,t=0;for(k&&(b=performance.now()),t=0;t!==g;t++){var u=h[t];if(u.type&m){var v=u.force,G=u.mass;v.x+=G*q,v.y+=G*r,v.z+=G*s}}for(var t=0,H=this.subsystems.length;t!==H;t++)this.subsystems[t].update();k&&(b=performance.now()),d.length=0,f.length=0,this.broadphase.collisionPairs(this,d,f),k&&(l.broadphase=performance.now()-b);var I=o.length;for(t=0;t!==I;t++){var J=o[t];if(!J.collideConnected)for(var K=d.length-1;K>=0;K-=1)(J.bodyA===d[K]&&J.bodyB===f[K]||J.bodyB===d[K]&&J.bodyA===f[K])&&(d.splice(K,1),f.splice(K,1))}this.collisionMatrixTick(),k&&(b=performance.now());var L=z,M=c.length;for(t=0;t!==M;t++)L.push(c[t]);c.length=0;var N=this.frictionEquations.length;for(t=0;t!==N;t++)p.push(this.frictionEquations[t]);this.frictionEquations.length=0,this.narrowphase.getContacts(d,f,this,c,L,this.frictionEquations,p),k&&(l.narrowphase=performance.now()-b),k&&(b=performance.now());for(var t=0;t<this.frictionEquations.length;t++)i.addEquation(this.frictionEquations[t]);for(var O=c.length,P=0;P!==O;P++){var Q,J=c[P],u=J.bi,R=J.bj;J.si,J.sj;Q=u.material&&R.material?this.getContactMaterial(u.material,R.material)||this.defaultContactMaterial:this.defaultContactMaterial;Q.friction;if(u.material&&R.material&&(u.material.friction>=0&&R.material.friction>=0&&u.material.friction*R.material.friction,u.material.restitution>=0&&R.material.restitution>=0&&(J.restitution=u.material.restitution*R.material.restitution)),i.addEquation(J),u.allowSleep&&u.type===n.DYNAMIC&&u.sleepState===n.SLEEPING&&R.sleepState===n.AWAKE&&R.type!==n.STATIC){R.velocity.norm2()+R.angularVelocity.norm2()>=2*Math.pow(R.sleepSpeedLimit,2)&&(u._wakeUpAfterNarrowphase=!0)}if(R.allowSleep&&R.type===n.DYNAMIC&&R.sleepState===n.SLEEPING&&u.sleepState===n.AWAKE&&u.type!==n.STATIC){u.velocity.norm2()+u.angularVelocity.norm2()>=2*Math.pow(u.sleepSpeedLimit,2)&&(R._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(u,R,!0),this.collisionMatrixPrevious.get(u,R)||(y.body=R,y.contact=J,u.dispatchEvent(y),y.body=u,R.dispatchEvent(y))}for(k&&(l.makeContactConstraints=performance.now()-b,b=performance.now()),t=0;t!==g;t++){var u=h[t];u._wakeUpAfterNarrowphase&&(u.wakeUp(),u._wakeUpAfterNarrowphase=!1)}var I=o.length;for(t=0;t!==I;t++){var J=o[t];J.update();for(var K=0,S=J.equations.length;K!==S;K++){var T=J.equations[K];i.addEquation(T)}}i.solve(a,this),k&&(l.solve=performance.now()-b),i.removeAllEquations();var U=Math.pow;for(t=0;t!==g;t++){var u=h[t];if(u.type&m){var V=U(1-u.linearDamping,a),W=u.velocity;W.mult(V,W);var X=u.angularVelocity;if(X){var Y=U(1-u.angularDamping,a);X.mult(Y,X)}}}for(this.dispatchEvent(x),t=0;t!==g;t++){var u=h[t];u.preStep&&u.preStep.call(u)}k&&(b=performance.now());var Z=D,$=E,_=this.stepnumber,aa=n.DYNAMIC|n.KINEMATIC,ba=_%(this.quatNormalizeSkip+1)==0,ca=this.quatNormalizeFast,da=.5*a;e.types.PLANE,e.types.CONVEXPOLYHEDRON;for(t=0;t!==g;t++){var ea=h[t],fa=ea.force,ga=ea.torque;if(ea.type&aa&&ea.sleepState!==n.SLEEPING){var ha=ea.velocity,ia=ea.angularVelocity,ja=ea.position,ka=ea.quaternion,la=ea.invMass,ma=ea.invInertiaWorld;ha.x+=fa.x*la*a,ha.y+=fa.y*la*a,ha.z+=fa.z*la*a,ea.angularVelocity&&(ma.vmult(ga,F),F.mult(a,F),F.vadd(ia,ia)),ja.x+=ha.x*a,ja.y+=ha.y*a,ja.z+=ha.z*a,ea.angularVelocity&&(Z.set(ia.x,ia.y,ia.z,0),Z.mult(ka,$),ka.x+=da*$.x,ka.y+=da*$.y,ka.z+=da*$.z,ka.w+=da*$.w,ba&&(ca?ka.normalizeFast():ka.normalize())),ea.aabb&&(ea.aabbNeedsUpdate=!0),ea.updateInertiaWorld&&ea.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,k&&(l.integrate=performance.now()-b),this.time+=a,this.stepnumber+=1,this.dispatchEvent(w),t=0;t!==g;t++){var u=h[t],na=u.postStep;na&&na.call(u)}if(this.allowSleep)for(t=0;t!==g;t++)h[t].sleepTick(this.time)},d.prototype.clearForces=function(){for(var a=this.bodies,b=a.length,c=0;c!==b;c++){var d=a[c];d.force,d.torque;d.force.set(0,0,0),d.torque.set(0,0,0)}}},{"../collision/AABB":297,"../collision/ArrayCollisionMatrix":298,"../collision/NaiveBroadphase":300,"../collision/Ray":301,"../collision/RaycastResult":302,"../equations/ContactEquation":307,"../equations/FrictionEquation":309,"../material/ContactMaterial":312,"../material/Material":313,"../math/Quaternion":316,"../math/Vec3":318,"../objects/Body":319,"../shapes/Shape":324,"../solver/GSSolver":326,"../utils/EventTarget":328,"../utils/TupleDictionary":330,"../utils/Vec3Pool":332,"./Narrowphase":333}],335:[function(a,b,c){"use strict";var d,e=a("es5-ext/object/assign"),f=a("es5-ext/object/normalize-options"),g=a("es5-ext/object/is-callable"),h=a("es5-ext/string/#/contains");d=b.exports=function(a,b){var c,d,g,i,j;return arguments.length<2||"string"!=typeof a?(i=b,b=a,a=null):i=arguments[2],null==a?(c=g=!0,d=!1):(c=h.call(a,"c"),d=h.call(a,"e"),g=h.call(a,"w")),j={value:b,configurable:c,enumerable:d,writable:g},i?e(f(i),j):j},d.gs=function(a,b,c){var d,i,j,k;return"string"!=typeof a?(j=c,c=b,b=a,a=null):j=arguments[3],null==b?b=void 0:g(b)?null==c?c=void 0:g(c)||(j=c,c=void 0):(j=b,b=c=void 0),null==a?(d=!0,i=!1):(d=h.call(a,"c"),i=h.call(a,"e")),k={get:b,set:c,configurable:d,enumerable:i},j?e(f(j),k):k}},{"es5-ext/object/assign":337,"es5-ext/object/is-callable":340,"es5-ext/object/normalize-options":345,"es5-ext/string/#/contains":348}],336:[function(a,b,c){"use strict";b.exports=function(){}},{}],337:[function(a,b,c){"use strict";b.exports=a("./is-implemented")()?Object.assign:a("./shim")},{"./is-implemented":338,"./shim":339}],338:[function(a,b,c){"use strict";b.exports=function(){var a,b=Object.assign;return"function"==typeof b&&(a={foo:"raz"},b(a,{bar:"dwa"},{trzy:"trzy"}),a.foo+a.bar+a.trzy==="razdwatrzy")}},{}],339:[function(a,b,c){"use strict";var d=a("../keys"),e=a("../valid-value"),f=Math.max;b.exports=function(a,b){var c,g,h,i=f(arguments.length,2);for(a=Object(e(a)),h=function(d){try{a[d]=b[d]}catch(a){c||(c=a)}},g=1;g<i;++g)b=arguments[g],d(b).forEach(h);if(void 0!==c)throw c;return a}},{"../keys":342,"../valid-value":347}],340:[function(a,b,c){"use strict";b.exports=function(a){return"function"==typeof a}},{}],341:[function(a,b,c){"use strict";var d=a("../function/noop")();b.exports=function(a){return a!==d&&null!==a}},{"../function/noop":336}],342:[function(a,b,c){"use strict";b.exports=a("./is-implemented")()?Object.keys:a("./shim")},{"./is-implemented":343,"./shim":344}],343:[function(a,b,c){"use strict";b.exports=function(){try{return Object.keys("primitive"),!0}catch(a){return!1}}},{}],344:[function(a,b,c){"use strict";var d=a("../is-value"),e=Object.keys;b.exports=function(a){return e(d(a)?Object(a):a)}},{"../is-value":341}],345:[function(a,b,c){"use strict";var d=a("./is-value"),e=Array.prototype.forEach,f=Object.create,g=function(a,b){var c;for(c in a)b[c]=a[c]};b.exports=function(a){var b=f(null);return e.call(arguments,function(a){d(a)&&g(Object(a),b)}),b}},{"./is-value":341}],346:[function(a,b,c){"use strict";b.exports=function(a){if("function"!=typeof a)throw new TypeError(a+" is not a function");return a}},{}],347:[function(a,b,c){"use strict";var d=a("./is-value");b.exports=function(a){if(!d(a))throw new TypeError("Cannot use null or undefined");return a}},{"./is-value":341}],348:[function(a,b,c){"use strict";b.exports=a("./is-implemented")()?String.prototype.contains:a("./shim")},{"./is-implemented":349,"./shim":350}],349:[function(a,b,c){"use strict";var d="razdwatrzy";b.exports=function(){return"function"==typeof d.contains&&(!0===d.contains("dwa")&&!1===d.contains("foo"))}},{}],350:[function(a,b,c){"use strict";var d=String.prototype.indexOf;b.exports=function(a){return d.call(this,a,arguments[1])>-1}},{}],351:[function(a,b,c){"use strict";var d,e,f,g,h,i,j,k=a("d"),l=a("es5-ext/object/valid-callable"),m=Function.prototype.apply,n=Function.prototype.call,o=Object.create,p=Object.defineProperty,q=Object.defineProperties,r=Object.prototype.hasOwnProperty,s={configurable:!0,enumerable:!1,writable:!0};d=function(a,b){var c;return l(b),r.call(this,"__ee__")?c=this.__ee__:(c=s.value=o(null),p(this,"__ee__",s),s.value=null),c[a]?"object"==typeof c[a]?c[a].push(b):c[a]=[c[a],b]:c[a]=b,this},e=function(a,b){var c,e;return l(b),e=this,d.call(this,a,c=function(){f.call(e,a,c),m.call(b,this,arguments)}),c.__eeOnceListener__=b,this},f=function(a,b){var c,d,e,f;if(l(b),!r.call(this,"__ee__"))return this;if(c=this.__ee__,!c[a])return this;if("object"==typeof(d=c[a]))for(f=0;e=d[f];++f)e!==b&&e.__eeOnceListener__!==b||(2===d.length?c[a]=d[f?0:1]:d.splice(f,1));else d!==b&&d.__eeOnceListener__!==b||delete c[a];return this},g=function(a){var b,c,d,e,f;if(r.call(this,"__ee__")&&(e=this.__ee__[a]))if("object"==typeof e){for(c=arguments.length,f=new Array(c-1),b=1;b<c;++b)f[b-1]=arguments[b];for(e=e.slice(),b=0;d=e[b];++b)m.call(d,this,f)}else switch(arguments.length){case 1:n.call(e,this);break;case 2:n.call(e,this,arguments[1]);break;case 3:n.call(e,this,arguments[1],arguments[2]);break;default:for(c=arguments.length,f=new Array(c-1),b=1;b<c;++b)f[b-1]=arguments[b];m.call(e,this,f)}},h={on:d,once:e,off:f,emit:g},i={on:k(d),once:k(e),off:k(f),emit:k(g)},j=q({},i),b.exports=c=function(a){return null==a?o(j):q(Object(a),i)},c.methods=h},{d:335,"es5-ext/object/valid-callable":346}],352:[function(a,b,c){c.glMatrix=a("./gl-matrix/common.js"),c.mat2=a("./gl-matrix/mat2.js"),c.mat2d=a("./gl-matrix/mat2d.js"),c.mat3=a("./gl-matrix/mat3.js"),c.mat4=a("./gl-matrix/mat4.js"),c.quat=a("./gl-matrix/quat.js"),c.vec2=a("./gl-matrix/vec2.js"),c.vec3=a("./gl-matrix/vec3.js"),c.vec4=a("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":353,"./gl-matrix/mat2.js":354,"./gl-matrix/mat2d.js":355,"./gl-matrix/mat3.js":356,"./gl-matrix/mat4.js":357,"./gl-matrix/quat.js":358,"./gl-matrix/vec2.js":359,"./gl-matrix/vec3.js":360,"./gl-matrix/vec4.js":361}],353:[function(a,b,c){var d={};d.EPSILON=1e-6,d.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,d.RANDOM=Math.random,d.setMatrixArrayType=function(a){GLMAT_ARRAY_TYPE=a};var e=Math.PI/180;d.toRadian=function(a){return a*e},b.exports=d},{}],354:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2],a[2]=c}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;return g?(g=1/g,a[0]=f*g,a[1]=-d*g,a[2]=-e*g,a[3]=c*g,a):null},e.adjoint=function(a,b){var c=b[0];return a[0]=b[3],a[1]=-b[1],a[2]=-b[2],a[3]=c,a},e.determinant=function(a){return a[0]*a[3]-a[2]*a[1]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*h+f*i,a[1]=e*h+g*i,a[2]=d*j+f*k,a[3]=e*j+g*k,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+f*h,a[1]=e*i+g*h,a[2]=d*-h+f*i,a[3]=e*-h+g*i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];return a[0]=d*h,a[1]=e*h,a[2]=f*i,a[3]=g*i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a},e.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))},e.LDU=function(a,b,c,d){return a[2]=d[2]/d[0],c[0]=d[0],c[1]=d[1],c[3]=d[3]-a[2]*c[1],[a,b,c]},b.exports=e},{"./common.js":353}],355:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(6);return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(6);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=0,a[5]=0,a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=c*f-d*e;return i?(i=1/i,a[0]=f*i,a[1]=-d*i,a[2]=-e*i,a[3]=c*i,a[4]=(e*h-f*g)*i,a[5]=(d*g-c*h)*i,a):null},e.determinant=function(a){return a[0]*a[3]-a[1]*a[2]},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];return a[0]=d*j+f*k,a[1]=e*j+g*k,a[2]=d*l+f*m,a[3]=e*l+g*m,a[4]=d*n+f*o+h,a[5]=e*n+g*o+i,a},e.mul=e.multiply,e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);return a[0]=d*k+f*j,a[1]=e*k+g*j,a[2]=d*-j+f*k,a[3]=e*-j+g*k,a[4]=h,a[5]=i,a},e.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d*j,a[1]=e*j,a[2]=f*k,a[3]=g*k,a[4]=h,a[5]=i,a},e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=d*j+f*k+h,a[5]=e*j+g*k+i,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=-c,a[3]=d,a[4]=0,a[5]=0,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=b[1],a[4]=0,a[5]=0,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=1,a[4]=b[0],a[5]=b[1],a},e.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)},b.exports=e},{"./common.js":353}],356:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(9);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat4=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a},e.clone=function(a){var b=new d.ARRAY_TYPE(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},e.mul=e.multiply,e.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a},e.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a},e.scale=function(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a},e.fromRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},e.fromMat2d=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a},e.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null},e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},b.exports=e},{"./common.js":353}],357:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.clone=function(a){var b=new d.ARRAY_TYPE(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},e.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},e.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},e.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15];return(b*g-c*f)*(l*q-m*p)-(b*h-d*f)*(k*q-m*o)+(b*i-e*f)*(k*p-l*o)+(c*h-d*g)*(j*q-m*n)-(c*i-e*g)*(j*p-l*n)+(d*i-e*h)*(j*o-k*n)},e.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a},e.mul=e.multiply,e.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},e.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},e.rotate=function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<d.EPSILON?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(c),g=Math.cos(c),h=1-g,i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)},e.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a},e.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a},e.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a},e.fromTranslation=function(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a},e.fromScaling=function(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotation=function(a,b,c){var e,f,g,h=c[0],i=c[1],j=c[2],k=Math.sqrt(h*h+i*i+j*j);return Math.abs(k)<d.EPSILON?null:(k=1/k,h*=k,i*=k,j*=k,e=Math.sin(b),f=Math.cos(b),g=1-f,a[0]=h*h*g+f,a[1]=i*h*g+j*e,a[2]=j*h*g-i*e,a[3]=0,a[4]=h*i*g-j*e,a[5]=i*i*g+f,a[6]=j*i*g+h*e,a[7]=0,a[8]=h*j*g+i*e,a[9]=i*j*g-h*e,a[10]=j*j*g+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)},e.fromXRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromYRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromZRotation=function(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=d[0],v=d[1],w=d[2];return a[0]=(1-(o+q))*u,a[1]=(m+t)*u,a[2]=(n-s)*u,a[3]=0,a[4]=(m-t)*v,a[5]=(1-(l+q))*v,a[6]=(p+r)*v,a[7]=0,a[8]=(n+s)*w,a[9]=(p-r)*w,a[10]=(1-(l+o))*w,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a},e.fromRotationTranslationScaleOrigin=function(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,m=f*j,n=f*k,o=f*l,p=g*k,q=g*l,r=h*l,s=i*j,t=i*k,u=i*l,v=d[0],w=d[1],x=d[2],y=e[0],z=e[1],A=e[2];return a[0]=(1-(p+r))*v,a[1]=(n+u)*v,a[2]=(o-t)*v,a[3]=0,a[4]=(n-u)*w,a[5]=(1-(m+r))*w,a[6]=(q+s)*w,a[7]=0,a[8]=(o+t)*x,a[9]=(q-s)*x,a[10]=(1-(m+p))*x,a[11]=0,a[12]=c[0]+y-(a[0]*y+a[4]*z+a[8]*A),a[13]=c[1]+z-(a[1]*y+a[5]*z+a[9]*A),a[14]=c[2]+A-(a[2]*y+a[6]*z+a[10]*A),a[15]=1,a},e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},e.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a},e.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},e.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-(g-h)*i*.5,a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a},e.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a},e.lookAt=function(a,b,c,f){var g,h,i,j,k,l,m,n,o,p,q=b[0],r=b[1],s=b[2],t=f[0],u=f[1],v=f[2],w=c[0],x=c[1],y=c[2];return Math.abs(q-w)<d.EPSILON&&Math.abs(r-x)<d.EPSILON&&Math.abs(s-y)<d.EPSILON?e.identity(a):(m=q-w,n=r-x,o=s-y,p=1/Math.sqrt(m*m+n*n+o*o),m*=p,n*=p,o*=p,g=u*o-v*n,h=v*m-t*o,i=t*n-u*m,p=Math.sqrt(g*g+h*h+i*i),p?(p=1/p,g*=p,h*=p,i*=p):(g=0,h=0,i=0),j=n*i-o*h,k=o*g-m*i,l=m*h-n*g,p=Math.sqrt(j*j+k*k+l*l),p?(p=1/p,j*=p,k*=p,l*=p):(j=0,k=0,l=0),a[0]=g,a[1]=j,a[2]=m,a[3]=0,a[4]=h,a[5]=k,a[6]=n,a[7]=0,a[8]=i,a[9]=l,a[10]=o,a[11]=0,a[12]=-(g*q+h*r+i*s),a[13]=-(j*q+k*r+l*s),a[14]=-(m*q+n*r+o*s),a[15]=1,a)},e.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},b.exports=e},{"./common.js":353}],358:[function(a,b,c){var d=a("./common.js"),e=a("./mat3.js"),f=a("./vec3.js"),g=a("./vec4.js"),h={};h.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.rotationTo=function(){var a=f.create(),b=f.fromValues(1,0,0),c=f.fromValues(0,1,0);return function(d,e,g){var i=f.dot(e,g);return i<-.999999?(f.cross(a,b,e),f.length(a)<1e-6&&f.cross(a,c,e),f.normalize(a,a),h.setAxisAngle(d,a,Math.PI),d):i>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(f.cross(a,e,g),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+i,h.normalize(d,d))}}(),h.setAxes=function(){var a=e.create();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=-c[0],a[5]=-c[1],a[8]=-c[2],h.normalize(b,h.fromMat3(b,a))}}(),h.clone=g.clone,h.fromValues=g.fromValues,h.copy=g.copy,h.set=g.set,h.identity=function(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a},h.setAxisAngle=function(a,b,c){c*=.5;var d=Math.sin(c);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a},h.add=g.add,h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a},h.mul=h.multiply,h.scale=g.scale,h.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a},h.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a},h.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a},h.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a},h.dot=g.dot,h.lerp=g.lerp,h.slerp=function(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return f=j*n+k*o+l*p+m*q,f<0&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(e=Math.acos(f),g=Math.sin(e),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a},h.sqlerp=function(){var a=h.create(),b=h.create();return function(c,d,e,f,g,i){return h.slerp(a,d,g,i),h.slerp(b,e,f,i),h.slerp(c,a,b,2*i*(1-i)),c}}(),h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a},h.conjugate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a},h.length=g.length,h.len=h.length,h.squaredLength=g.squaredLength,
h.sqrLen=h.squaredLength,h.normalize=g.normalize,h.fromMat3=function(a,b){var c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1),b[8]>b[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3;c=Math.sqrt(b[3*e+e]-b[3*f+f]-b[3*g+g]+1),a[e]=.5*c,c=.5/c,a[3]=(b[3*f+g]-b[3*g+f])*c,a[f]=(b[3*f+e]+b[3*e+f])*c,a[g]=(b[3*g+e]+b[3*e+g])*c}return a},h.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},b.exports=h},{"./common.js":353,"./mat3.js":356,"./vec3.js":360,"./vec4.js":361}],359:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},e.fromValues=function(a,b){var c=new d.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},e.set=function(a,b,c){return a[0]=b,a[1]=c,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},e.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a},e.transformMat2=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a},e.transformMat2d=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=2),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;h<i;h+=c)a[0]=b[h],a[1]=b[h+1],f(a,a,g),b[h]=a[0],b[h+1]=a[1];return b}}(),e.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},b.exports=e},{"./common.js":353}],360:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(3);return a[0]=0,a[1]=0,a[2]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b},e.fromValues=function(a,b,c){var e=new d.ARRAY_TYPE(3);return e[0]=a,e[1]=b,e[2]=c,e},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a},e.set=function(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},e.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a},e.hermite=function(a,b,c,d,e,f){var g=f*f,h=g*(2*f-3)+1,i=g*(f-2)+f,j=g*(f-1),k=g*(3-2*f);return a[0]=b[0]*h+c[0]*i+d[0]*j+e[0]*k,a[1]=b[1]*h+c[1]*i+d[1]*j+e[1]*k,a[2]=b[2]*h+c[2]*i+d[2]*j+e[2]*k,a},e.bezier=function(a,b,c,d,e,f){var g=1-f,h=g*g,i=f*f,j=h*g,k=3*f*h,l=3*i*g,m=i*f;return a[0]=b[0]*j+c[0]*k+d[0]*l+e[0]*m,a[1]=b[1]*j+c[1]*k+d[1]*l+e[1]*m,a[2]=b[2]*j+c[2]*k+d[2]*l+e[2]*m,a},e.random=function(a,b){b=b||1;var c=2*d.RANDOM()*Math.PI,e=2*d.RANDOM()-1,f=Math.sqrt(1-e*e)*b;return a[0]=Math.cos(c)*f,a[1]=Math.sin(c)*f,a[2]=e*b,a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a},e.transformMat3=function(a,b,c){var d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a},e.rotateX=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0],f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d),f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateY=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d),f[1]=e[1],f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.rotateZ=function(a,b,c,d){var e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d),f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d),f[2]=e[2],a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=3),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;h<i;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2];return b}}(),e.angle=function(a,b){var c=e.fromValues(a[0],a[1],a[2]),d=e.fromValues(b[0],b[1],b[2]);e.normalize(c,c),e.normalize(d,d);var f=e.dot(c,d);return f>1?0:Math.acos(f)},e.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},b.exports=e},{"./common.js":353}],361:[function(a,b,c){var d=a("./common.js"),e={};e.create=function(){var a=new d.ARRAY_TYPE(4);return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a},e.clone=function(a){var b=new d.ARRAY_TYPE(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},e.fromValues=function(a,b,c,e){var f=new d.ARRAY_TYPE(4);return f[0]=a,f[1]=b,f[2]=c,f[3]=e,f},e.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},e.set=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},e.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},e.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a},e.sub=e.subtract,e.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a},e.mul=e.multiply,e.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a},e.div=e.divide,e.min=function(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a},e.max=function(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a},e.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},e.scaleAndAdd=function(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a},e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)},e.dist=e.distance,e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f},e.sqrDist=e.squaredDistance,e.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)},e.len=e.length,e.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},e.sqrLen=e.squaredLength,e.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a},e.inverse=function(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a},e.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g),a},e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},e.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},e.random=function(a,b){return b=b||1,a[0]=d.RANDOM(),a[1]=d.RANDOM(),a[2]=d.RANDOM(),a[3]=d.RANDOM(),e.normalize(a,a),e.scale(a,a,b),a},e.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a},e.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;return a[0]=k*j+n*-g+l*-i-m*-h,a[1]=l*j+n*-h+m*-g-k*-i,a[2]=m*j+n*-i+k*-h-l*-g,a[3]=b[3],a},e.forEach=function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;for(c||(c=4),d||(d=0),i=e?Math.min(e*c+d,b.length):b.length,h=d;h<i;h+=c)a[0]=b[h],a[1]=b[h+1],a[2]=b[h+2],a[3]=b[h+3],f(a,a,g),b[h]=a[0],b[h+1]=a[1],b[h+2]=a[2],b[h+3]=a[3];return b}}(),e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},b.exports=e},{"./common.js":353}],362:[function(a,b,c){(function(a){var c=void 0!==b&&b.exports&&void 0!==a?a:this||window;(c._gsQueue||(c._gsQueue=[])).push(function(){"use strict";c._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(a,b,c){var d=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},e=function(a,b,c){var d,e,f=a.cycle;for(d in f)e=f[d],a[d]="function"==typeof e?e(c,b[c]):e[c%e.length];delete a.cycle},f=function(a,b,d){c.call(this,a,b,d),this._cycle=0,this._yoyo=!0===this.vars.yoyo||!!this.vars.yoyoEase,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._repeat&&this._uncache(!0),this.render=f.prototype.render},g=c._internals,h=g.isSelector,i=g.isArray,j=f.prototype=c.to({},.1,{}),k=[];f.version="1.20.3",j.constructor=f,j.kill()._gc=!1,f.killTweensOf=f.killDelayedCallsTo=c.killTweensOf,f.getTweensOf=c.getTweensOf,f.lagSmoothing=c.lagSmoothing,f.ticker=c.ticker,f.render=c.render,j.invalidate=function(){return this._yoyo=!0===this.vars.yoyo||!!this.vars.yoyoEase,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._yoyoEase=null,this._uncache(!0),c.prototype.invalidate.call(this)},j.updateTo=function(a,b){var d,e=this.ratio,f=this.vars.immediateRender||a.immediateRender;b&&this._startTime<this._timeline._time&&(this._startTime=this._timeline._time,this._uncache(!1),this._gc?this._enabled(!0,!1):this._timeline.insert(this,this._startTime-this._delay));for(d in a)this.vars[d]=a[d];if(this._initted||f)if(b)this._initted=!1,f&&this.render(0,!0,!0);else if(this._gc&&this._enabled(!0,!1),this._notifyPluginsOfEnabled&&this._firstPT&&c._onPluginEvent("_onDisable",this),this._time/this._duration>.998){var g=this._totalTime;this.render(0,!0,!1),this._initted=!1,this.render(g,!0,!1)}else if(this._initted=!1,this._init(),this._time>0||f)for(var h,i=1/(1-e),j=this._firstPT;j;)h=j.s+j.c,j.c*=i,j.s=h-j.c,j=j._next;return this},j.render=function(a,b,d){this._initted||0===this._duration&&this.vars.repeat&&this.invalidate();var e,f,h,i,j,k,l,m,n,o=this._dirty?this.totalDuration():this._totalDuration,p=this._time,q=this._totalTime,r=this._cycle,s=this._duration,t=this._rawPrevTime;if(a>=o-1e-7&&a>=0?(this._totalTime=o,this._cycle=this._repeat,this._yoyo&&0!=(1&this._cycle)?(this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0):(this._time=s,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1),this._reversed||(e=!0,f="onComplete",d=d||this._timeline.autoRemoveChildren),0===s&&(this._initted||!this.vars.lazy||d)&&(this._startTime===this._timeline._duration&&(a=0),(t<0||a<=0&&a>=-1e-7||1e-10===t&&"isPause"!==this.data)&&t!==a&&(d=!0,t>1e-10&&(f="onReverseComplete")),this._rawPrevTime=m=!b||a||t===a?a:1e-10)):a<1e-7?(this._totalTime=this._time=this._cycle=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==q||0===s&&t>0)&&(f="onReverseComplete",e=this._reversed),a<0&&(this._active=!1,0===s&&(this._initted||!this.vars.lazy||d)&&(t>=0&&(d=!0),this._rawPrevTime=m=!b||a||t===a?a:1e-10)),this._initted||(d=!0)):(this._totalTime=this._time=a,0!==this._repeat&&(i=s+this._repeatDelay,this._cycle=this._totalTime/i>>0,0!==this._cycle&&this._cycle===this._totalTime/i&&q<=a&&this._cycle--,this._time=this._totalTime-this._cycle*i,this._yoyo&&0!=(1&this._cycle)&&(this._time=s-this._time,(n=this._yoyoEase||this.vars.yoyoEase)&&(this._yoyoEase||(!0!==n||this._initted?this._yoyoEase=n=!0===n?this._ease:n instanceof Ease?n:Ease.map[n]:(n=this.vars.ease,this._yoyoEase=n=n?n instanceof Ease?n:"function"==typeof n?new Ease(n,this.vars.easeParams):Ease.map[n]||c.defaultEase:c.defaultEase)),this.ratio=n?1-n.getRatio((s-this._time)/s):0)),this._time>s?this._time=s:this._time<0&&(this._time=0)),this._easeType&&!n?(j=this._time/s,k=this._easeType,l=this._easePower,(1===k||3===k&&j>=.5)&&(j=1-j),3===k&&(j*=2),1===l?j*=j:2===l?j*=j*j:3===l?j*=j*j*j:4===l&&(j*=j*j*j*j),1===k?this.ratio=1-j:2===k?this.ratio=j:this._time/s<.5?this.ratio=j/2:this.ratio=1-j/2):n||(this.ratio=this._ease.getRatio(this._time/s))),p===this._time&&!d&&r===this._cycle)return void(q!==this._totalTime&&this._onUpdate&&(b||this._callback("onUpdate")));if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!d&&this._firstPT&&(!1!==this.vars.lazy&&this._duration||this.vars.lazy&&!this._duration))return this._time=p,this._totalTime=q,this._rawPrevTime=t,this._cycle=r,g.lazyTweens.push(this),void(this._lazy=[a,b]);!this._time||e||n?e&&this._ease._calcEnd&&!n&&(this.ratio=this._ease.getRatio(0===this._time?0:1)):this.ratio=this._ease.getRatio(this._time/s)}for(!1!==this._lazy&&(this._lazy=!1),this._active||!this._paused&&this._time!==p&&a>=0&&(this._active=!0),0===q&&(2===this._initted&&a>0&&this._init(),this._startAt&&(a>=0?this._startAt.render(a,!0,d):f||(f="_dummyGS")),this.vars.onStart&&(0===this._totalTime&&0!==s||b||this._callback("onStart"))),h=this._firstPT;h;)h.f?h.t[h.p](h.c*this.ratio+h.s):h.t[h.p]=h.c*this.ratio+h.s,h=h._next;this._onUpdate&&(a<0&&this._startAt&&this._startTime&&this._startAt.render(a,!0,d),b||(this._totalTime!==q||f)&&this._callback("onUpdate")),this._cycle!==r&&(b||this._gc||this.vars.onRepeat&&this._callback("onRepeat")),f&&(this._gc&&!d||(a<0&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(a,!0,d),e&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[f]&&this._callback(f),0===s&&1e-10===this._rawPrevTime&&1e-10!==m&&(this._rawPrevTime=0)))},f.to=function(a,b,c){return new f(a,b,c)},f.from=function(a,b,c){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,new f(a,b,c)},f.fromTo=function(a,b,c,d){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,new f(a,b,d)},f.staggerTo=f.allTo=function(a,b,g,j,l,m,n){j=j||0;var o,p,q,r,s=0,t=[],u=function(){g.onComplete&&g.onComplete.apply(g.onCompleteScope||this,arguments),l.apply(n||g.callbackScope||this,m||k)},v=g.cycle,w=g.startAt&&g.startAt.cycle;for(i(a)||("string"==typeof a&&(a=c.selector(a)||a),h(a)&&(a=d(a))),a=a||[],j<0&&(a=d(a),a.reverse(),j*=-1),o=a.length-1,q=0;q<=o;q++){p={};for(r in g)p[r]=g[r];if(v&&(e(p,a,q),null!=p.duration&&(b=p.duration,delete p.duration)),w){w=p.startAt={};for(r in g.startAt)w[r]=g.startAt[r];e(p.startAt,a,q)}p.delay=s+(p.delay||0),q===o&&l&&(p.onComplete=u),t[q]=new f(a[q],b,p),s+=j}return t},f.staggerFrom=f.allFrom=function(a,b,c,d,e,g,h){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,f.staggerTo(a,b,c,d,e,g,h)},f.staggerFromTo=f.allFromTo=function(a,b,c,d,e,g,h,i){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,f.staggerTo(a,b,d,e,g,h,i)},f.delayedCall=function(a,b,c,d,e){return new f(b,0,{delay:a,onComplete:b,onCompleteParams:c,callbackScope:d,onReverseComplete:b,onReverseCompleteParams:c,immediateRender:!1,useFrames:e,overwrite:0})},f.set=function(a,b){return new f(a,0,b)},f.isTweening=function(a){return c.getTweensOf(a,!0).length>0};var l=function(a,b){for(var d=[],e=0,f=a._first;f;)f instanceof c?d[e++]=f:(b&&(d[e++]=f),d=d.concat(l(f,b)),e=d.length),f=f._next;return d},m=f.getAllTweens=function(b){return l(a._rootTimeline,b).concat(l(a._rootFramesTimeline,b))};f.killAll=function(a,c,d,e){null==c&&(c=!0),null==d&&(d=!0);var f,g,h,i=m(0!=e),j=i.length,k=c&&d&&e;for(h=0;h<j;h++)g=i[h],(k||g instanceof b||(f=g.target===g.vars.onComplete)&&d||c&&!f)&&(a?g.totalTime(g._reversed?0:g.totalDuration()):g._enabled(!1,!1))},f.killChildTweensOf=function(a,b){if(null!=a){var e,j,k,l,m,n=g.tweenLookup;if("string"==typeof a&&(a=c.selector(a)||a),h(a)&&(a=d(a)),i(a))for(l=a.length;--l>-1;)f.killChildTweensOf(a[l],b);else{e=[];for(k in n)for(j=n[k].target.parentNode;j;)j===a&&(e=e.concat(n[k].tweens)),j=j.parentNode;for(m=e.length,l=0;l<m;l++)b&&e[l].totalTime(e[l].totalDuration()),e[l]._enabled(!1,!1)}}};var n=function(a,c,d,e){c=!1!==c,d=!1!==d,e=!1!==e;for(var f,g,h=m(e),i=c&&d&&e,j=h.length;--j>-1;)g=h[j],(i||g instanceof b||(f=g.target===g.vars.onComplete)&&d||c&&!f)&&g.paused(a)};return f.pauseAll=function(a,b,c){n(!0,a,b,c)},f.resumeAll=function(a,b,c){n(!1,a,b,c)},f.globalTimeScale=function(b){var d=a._rootTimeline,e=c.ticker.time;return arguments.length?(b=b||1e-10,d._startTime=e-(e-d._startTime)*d._timeScale/b,d=a._rootFramesTimeline,e=c.ticker.frame,d._startTime=e-(e-d._startTime)*d._timeScale/b,d._timeScale=a._rootTimeline._timeScale=b,b):d._timeScale},j.progress=function(a,b){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!=(1&this._cycle)?1-a:a)+this._cycle*(this._duration+this._repeatDelay),b):this._time/this.duration()},j.totalProgress=function(a,b){return arguments.length?this.totalTime(this.totalDuration()*a,b):this._totalTime/this.totalDuration()},j.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),a>this._duration&&(a=this._duration),this._yoyo&&0!=(1&this._cycle)?a=this._duration-a+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(a+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(a,b)):this._time},j.duration=function(b){return arguments.length?a.prototype.duration.call(this,b):this._duration},j.totalDuration=function(a){return arguments.length?-1===this._repeat?this:this.duration((a-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},j.repeat=function(a){return arguments.length?(this._repeat=a,this._uncache(!0)):this._repeat},j.repeatDelay=function(a){return arguments.length?(this._repeatDelay=a,this._uncache(!0)):this._repeatDelay},j.yoyo=function(a){return arguments.length?(this._yoyo=a,this):this._yoyo},f},!0),c._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(a,b,d){var e=function(a){b.call(this,a),this._labels={},this.autoRemoveChildren=!0===this.vars.autoRemoveChildren,this.smoothChildTiming=!0===this.vars.smoothChildTiming,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var c,d,e=this.vars;for(d in e)c=e[d],i(c)&&-1!==c.join("").indexOf("{self}")&&(e[d]=this._swapSelfInParams(c));i(e.tweens)&&this.add(e.tweens,0,e.align,e.stagger)},f=d._internals,g=e._internals={},h=f.isSelector,i=f.isArray,j=f.lazyTweens,k=f.lazyRender,l=c._gsDefine.globals,m=function(a){var b,c={};for(b in a)c[b]=a[b];return c},n=function(a,b,c){var d,e,f=a.cycle;for(d in f)e=f[d],a[d]="function"==typeof e?e(c,b[c]):e[c%e.length];delete a.cycle},o=g.pauseCallback=function(){},p=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},q=e.prototype=new b;return e.version="1.20.3",q.constructor=e,q.kill()._gc=q._forcingPlayhead=q._hasPause=!1,q.to=function(a,b,c,e){var f=c.repeat&&l.TweenMax||d;return b?this.add(new f(a,b,c),e):this.set(a,c,e)},q.from=function(a,b,c,e){return this.add((c.repeat&&l.TweenMax||d).from(a,b,c),e)},q.fromTo=function(a,b,c,e,f){var g=e.repeat&&l.TweenMax||d;return b?this.add(g.fromTo(a,b,c,e),f):this.set(a,e,f)},q.staggerTo=function(a,b,c,f,g,i,j,k){var l,o,q=new e({onComplete:i,onCompleteParams:j,callbackScope:k,smoothChildTiming:this.smoothChildTiming}),r=c.cycle;for("string"==typeof a&&(a=d.selector(a)||a),a=a||[],h(a)&&(a=p(a)),f=f||0,f<0&&(a=p(a),a.reverse(),f*=-1),o=0;o<a.length;o++)l=m(c),l.startAt&&(l.startAt=m(l.startAt),l.startAt.cycle&&n(l.startAt,a,o)),r&&(n(l,a,o),null!=l.duration&&(b=l.duration,delete l.duration)),q.to(a[o],b,l,o*f);return this.add(q,g)},q.staggerFrom=function(a,b,c,d,e,f,g,h){return c.immediateRender=0!=c.immediateRender,c.runBackwards=!0,this.staggerTo(a,b,c,d,e,f,g,h)},q.staggerFromTo=function(a,b,c,d,e,f,g,h,i){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,this.staggerTo(a,b,d,e,f,g,h,i)},q.call=function(a,b,c,e){return this.add(d.delayedCall(0,a,b,c),e)},q.set=function(a,b,c){return c=this._parseTimeOrLabel(c,0,!0),null==b.immediateRender&&(b.immediateRender=c===this._time&&!this._paused),this.add(new d(a,0,b),c)},e.exportRoot=function(a,b){a=a||{},null==a.smoothChildTiming&&(a.smoothChildTiming=!0);var c,f,g,h,i=new e(a),j=i._timeline;for(null==b&&(b=!0),j._remove(i,!0),i._startTime=0,i._rawPrevTime=i._time=i._totalTime=j._time,g=j._first;g;)h=g._next,b&&g instanceof d&&g.target===g.vars.onComplete||(f=g._startTime-g._delay,f<0&&(c=1),i.add(g,f)),g=h;return j.add(i,0),c&&i.totalDuration(),i},q.add=function(c,f,g,h){var j,k,l,m,n,o;if("number"!=typeof f&&(f=this._parseTimeOrLabel(f,0,!0,c)),!(c instanceof a)){if(c instanceof Array||c&&c.push&&i(c)){for(g=g||"normal",h=h||0,j=f,k=c.length,l=0;l<k;l++)i(m=c[l])&&(m=new e({tweens:m})),this.add(m,j),"string"!=typeof m&&"function"!=typeof m&&("sequence"===g?j=m._startTime+m.totalDuration()/m._timeScale:"start"===g&&(m._startTime-=m.delay())),j+=h;return this._uncache(!0)}if("string"==typeof c)return this.addLabel(c,f);if("function"!=typeof c)throw"Cannot add "+c+" into the timeline; it is not a tween, timeline, function, or string.";c=d.delayedCall(0,c)}if(b.prototype.add.call(this,c,f),c._time&&c.render((this.rawTime()-c._startTime)*c._timeScale,!1,!1),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(n=this,o=n.rawTime()>c._startTime;n._timeline;)o&&n._timeline.smoothChildTiming?n.totalTime(n._totalTime,!0):n._gc&&n._enabled(!0,!1),n=n._timeline;return this},q.remove=function(b){if(b instanceof a){this._remove(b,!1);var c=b._timeline=b.vars.useFrames?a._rootFramesTimeline:a._rootTimeline;return b._startTime=(b._paused?b._pauseTime:c._time)-(b._reversed?b.totalDuration()-b._totalTime:b._totalTime)/b._timeScale,this}if(b instanceof Array||b&&b.push&&i(b)){for(var d=b.length;--d>-1;)this.remove(b[d]);return this}return"string"==typeof b?this.removeLabel(b):this.kill(null,b)},q._remove=function(a,c){return b.prototype._remove.call(this,a,c),this._last?this._time>this.duration()&&(this._time=this._duration,this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},q.append=function(a,b){return this.add(a,this._parseTimeOrLabel(null,b,!0,a))},q.insert=q.insertMultiple=function(a,b,c,d){return this.add(a,b||0,c,d)},q.appendMultiple=function(a,b,c,d){return this.add(a,this._parseTimeOrLabel(null,b,!0,a),c,d)},q.addLabel=function(a,b){return this._labels[a]=this._parseTimeOrLabel(b),this},q.addPause=function(a,b,c,e){var f=d.delayedCall(0,o,c,e||this);return f.vars.onComplete=f.vars.onReverseComplete=b,f.data="isPause",this._hasPause=!0,this.add(f,a)},q.removeLabel=function(a){return delete this._labels[a],this},q.getLabelTime=function(a){return null!=this._labels[a]?this._labels[a]:-1},q._parseTimeOrLabel=function(b,c,d,e){var f,g;if(e instanceof a&&e.timeline===this)this.remove(e);else if(e&&(e instanceof Array||e.push&&i(e)))for(g=e.length;--g>-1;)e[g]instanceof a&&e[g].timeline===this&&this.remove(e[g]);if(f="number"!=typeof b||c?this.duration()>99999999999?this.recent().endTime(!1):this._duration:0,"string"==typeof c)return this._parseTimeOrLabel(c,d&&"number"==typeof b&&null==this._labels[c]?b-f:0,d);if(c=c||0,"string"!=typeof b||!isNaN(b)&&null==this._labels[b])null==b&&(b=f);else{if(-1===(g=b.indexOf("=")))return null==this._labels[b]?d?this._labels[b]=f+c:c:this._labels[b]+c;c=parseInt(b.charAt(g-1)+"1",10)*Number(b.substr(g+1)),b=g>1?this._parseTimeOrLabel(b.substr(0,g-1),0,d):f}return Number(b)+c},q.seek=function(a,b){return this.totalTime("number"==typeof a?a:this._parseTimeOrLabel(a),!1!==b)},q.stop=function(){return this.paused(!0)},q.gotoAndPlay=function(a,b){return this.play(a,b)},q.gotoAndStop=function(a,b){return this.pause(a,b)},q.render=function(a,b,c){this._gc&&this._enabled(!0,!1);var d,e,f,g,h,i,l,m=this._time,n=this._dirty?this.totalDuration():this._totalDuration,o=this._startTime,p=this._timeScale,q=this._paused;if(m!==this._time&&(a+=this._time-m),a>=n-1e-7&&a>=0)this._totalTime=this._time=n,this._reversed||this._hasPausedChild()||(e=!0,g="onComplete",h=!!this._timeline.autoRemoveChildren,0===this._duration&&(a<=0&&a>=-1e-7||this._rawPrevTime<0||1e-10===this._rawPrevTime)&&this._rawPrevTime!==a&&this._first&&(h=!0,this._rawPrevTime>1e-10&&(g="onReverseComplete"))),this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:1e-10,a=n+1e-4;else if(a<1e-7)if(this._totalTime=this._time=0,(0!==m||0===this._duration&&1e-10!==this._rawPrevTime&&(this._rawPrevTime>0||a<0&&this._rawPrevTime>=0))&&(g="onReverseComplete",e=this._reversed),a<0)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(h=e=!0,g="onReverseComplete"):this._rawPrevTime>=0&&this._first&&(h=!0),this._rawPrevTime=a;else{if(this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:1e-10,0===a&&e)for(d=this._first;d&&0===d._startTime;)d._duration||(e=!1),d=d._next;a=0,this._initted||(h=!0)}else{if(this._hasPause&&!this._forcingPlayhead&&!b){if(a>=m)for(d=this._first;d&&d._startTime<=a&&!i;)d._duration||"isPause"!==d.data||d.ratio||0===d._startTime&&0===this._rawPrevTime||(i=d),d=d._next;else for(d=this._last;d&&d._startTime>=a&&!i;)d._duration||"isPause"===d.data&&d._rawPrevTime>0&&(i=d),d=d._prev;i&&(this._time=a=i._startTime,this._totalTime=a+this._cycle*(this._totalDuration+this._repeatDelay))}this._totalTime=this._time=this._rawPrevTime=a}if(this._time!==m&&this._first||c||h||i){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==m&&a>0&&(this._active=!0),0===m&&this.vars.onStart&&(0===this._time&&this._duration||b||this._callback("onStart")),(l=this._time)>=m)for(d=this._first;d&&(f=d._next,l===this._time&&(!this._paused||q));)(d._active||d._startTime<=l&&!d._paused&&!d._gc)&&(i===d&&this.pause(),d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)),d=f;else for(d=this._last;d&&(f=d._prev,l===this._time&&(!this._paused||q));){if(d._active||d._startTime<=m&&!d._paused&&!d._gc){if(i===d){for(i=d._prev;i&&i.endTime()>this._time;)i.render(i._reversed?i.totalDuration()-(a-i._startTime)*i._timeScale:(a-i._startTime)*i._timeScale,b,c),i=i._prev;i=null,this.pause()}d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)}d=f}this._onUpdate&&(b||(j.length&&k(),this._callback("onUpdate"))),g&&(this._gc||o!==this._startTime&&p===this._timeScale||(0===this._time||n>=this.totalDuration())&&(e&&(j.length&&k(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[g]&&this._callback(g)))}},q._hasPausedChild=function(){for(var a=this._first;a;){if(a._paused||a instanceof e&&a._hasPausedChild())return!0;a=a._next}return!1},q.getChildren=function(a,b,c,e){e=e||-9999999999;for(var f=[],g=this._first,h=0;g;)g._startTime<e||(g instanceof d?!1!==b&&(f[h++]=g):(!1!==c&&(f[h++]=g),!1!==a&&(f=f.concat(g.getChildren(!0,b,c)),h=f.length))),g=g._next;return f},q.getTweensOf=function(a,b){var c,e,f=this._gc,g=[],h=0;for(f&&this._enabled(!0,!0),c=d.getTweensOf(a),e=c.length;--e>-1;)(c[e].timeline===this||b&&this._contains(c[e]))&&(g[h++]=c[e]);return f&&this._enabled(!1,!0),g},q.recent=function(){return this._recent},q._contains=function(a){for(var b=a.timeline;b;){if(b===this)return!0;b=b.timeline}return!1},q.shiftChildren=function(a,b,c){c=c||0;for(var d,e=this._first,f=this._labels;e;)e._startTime>=c&&(e._startTime+=a),e=e._next;if(b)for(d in f)f[d]>=c&&(f[d]+=a);return this._uncache(!0)},q._kill=function(a,b){if(!a&&!b)return this._enabled(!1,!1);for(var c=b?this.getTweensOf(b):this.getChildren(!0,!0,!1),d=c.length,e=!1;--d>-1;)c[d]._kill(a,b)&&(e=!0);return e},q.clear=function(a){var b=this.getChildren(!1,!0,!0),c=b.length;for(this._time=this._totalTime=0;--c>-1;)b[c]._enabled(!1,!1);return!1!==a&&(this._labels={}),this._uncache(!0)},q.invalidate=function(){for(var b=this._first;b;)b.invalidate(),b=b._next;return a.prototype.invalidate.call(this)},q._enabled=function(a,c){if(a===this._gc)for(var d=this._first;d;)d._enabled(a,!0),d=d._next;return b.prototype._enabled.call(this,a,c)},q.totalTime=function(b,c,d){this._forcingPlayhead=!0;var e=a.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,e},q.duration=function(a){return arguments.length?(0!==this.duration()&&0!==a&&this.timeScale(this._duration/a),this):(this._dirty&&this.totalDuration(),this._duration)},q.totalDuration=function(a){if(!arguments.length){if(this._dirty){for(var b,c,d=0,e=this._last,f=999999999999;e;)b=e._prev,e._dirty&&e.totalDuration(),e._startTime>f&&this._sortChildren&&!e._paused&&!this._calculatingDuration?(this._calculatingDuration=1,this.add(e,e._startTime-e._delay),this._calculatingDuration=0):f=e._startTime,e._startTime<0&&!e._paused&&(d-=e._startTime,this._timeline.smoothChildTiming&&(this._startTime+=e._startTime/this._timeScale,this._time-=e._startTime,this._totalTime-=e._startTime,this._rawPrevTime-=e._startTime),this.shiftChildren(-e._startTime,!1,-9999999999),f=0),c=e._startTime+e._totalDuration/e._timeScale,
c>d&&(d=c),e=b;this._duration=this._totalDuration=d,this._dirty=!1}return this._totalDuration}return a&&this.totalDuration()?this.timeScale(this._totalDuration/a):this},q.paused=function(b){if(!b)for(var c=this._first,d=this._time;c;)c._startTime===d&&"isPause"===c.data&&(c._rawPrevTime=0),c=c._next;return a.prototype.paused.apply(this,arguments)},q.usesFrames=function(){for(var b=this._timeline;b._timeline;)b=b._timeline;return b===a._rootFramesTimeline},q.rawTime=function(a){return a&&(this._paused||this._repeat&&this.time()>0&&this.totalProgress()<1)?this._totalTime%(this._duration+this._repeatDelay):this._paused?this._totalTime:(this._timeline.rawTime(a)-this._startTime)*this._timeScale},e},!0),c._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(a,b,d){var e=function(b){a.call(this,b),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=!0===this.vars.yoyo,this._dirty=!0},f=b._internals,g=f.lazyTweens,h=f.lazyRender,i=c._gsDefine.globals,j=new d(null,null,1,0),k=e.prototype=new a;return k.constructor=e,k.kill()._gc=!1,e.version="1.20.3",k.invalidate=function(){return this._yoyo=!0===this.vars.yoyo,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),a.prototype.invalidate.call(this)},k.addCallback=function(a,c,d,e){return this.add(b.delayedCall(0,a,d,e),c)},k.removeCallback=function(a,b){if(a)if(null==b)this._kill(null,a);else for(var c=this.getTweensOf(a,!1),d=c.length,e=this._parseTimeOrLabel(b);--d>-1;)c[d]._startTime===e&&c[d]._enabled(!1,!1);return this},k.removePause=function(b){return this.removeCallback(a._internals.pauseCallback,b)},k.tweenTo=function(a,c){c=c||{};var d,e,f,g={ease:j,useFrames:this.usesFrames(),immediateRender:!1},h=c.repeat&&i.TweenMax||b;for(e in c)g[e]=c[e];return g.time=this._parseTimeOrLabel(a),d=Math.abs(Number(g.time)-this._time)/this._timeScale||.001,f=new h(this,d,g),g.onStart=function(){f.target.paused(!0),f.vars.time!==f.target.time()&&d===f.duration()&&f.duration(Math.abs(f.vars.time-f.target.time())/f.target._timeScale),c.onStart&&c.onStart.apply(c.onStartScope||c.callbackScope||f,c.onStartParams||[])},f},k.tweenFromTo=function(a,b,c){c=c||{},a=this._parseTimeOrLabel(a),c.startAt={onComplete:this.seek,onCompleteParams:[a],callbackScope:this},c.immediateRender=!1!==c.immediateRender;var d=this.tweenTo(b,c);return d.duration(Math.abs(d.vars.time-a)/this._timeScale||.001)},k.render=function(a,b,c){this._gc&&this._enabled(!0,!1);var d,e,f,i,j,k,l,m,n=this._time,o=this._dirty?this.totalDuration():this._totalDuration,p=this._duration,q=this._totalTime,r=this._startTime,s=this._timeScale,t=this._rawPrevTime,u=this._paused,v=this._cycle;if(n!==this._time&&(a+=this._time-n),a>=o-1e-7&&a>=0)this._locked||(this._totalTime=o,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(e=!0,i="onComplete",j=!!this._timeline.autoRemoveChildren,0===this._duration&&(a<=0&&a>=-1e-7||t<0||1e-10===t)&&t!==a&&this._first&&(j=!0,t>1e-10&&(i="onReverseComplete"))),this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:1e-10,this._yoyo&&0!=(1&this._cycle)?this._time=a=0:(this._time=p,a=p+1e-4);else if(a<1e-7)if(this._locked||(this._totalTime=this._cycle=0),this._time=0,(0!==n||0===p&&1e-10!==t&&(t>0||a<0&&t>=0)&&!this._locked)&&(i="onReverseComplete",e=this._reversed),a<0)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(j=e=!0,i="onReverseComplete"):t>=0&&this._first&&(j=!0),this._rawPrevTime=a;else{if(this._rawPrevTime=p||!b||a||this._rawPrevTime===a?a:1e-10,0===a&&e)for(d=this._first;d&&0===d._startTime;)d._duration||(e=!1),d=d._next;a=0,this._initted||(j=!0)}else if(0===p&&t<0&&(j=!0),this._time=this._rawPrevTime=a,this._locked||(this._totalTime=a,0!==this._repeat&&(k=p+this._repeatDelay,this._cycle=this._totalTime/k>>0,0!==this._cycle&&this._cycle===this._totalTime/k&&q<=a&&this._cycle--,this._time=this._totalTime-this._cycle*k,this._yoyo&&0!=(1&this._cycle)&&(this._time=p-this._time),this._time>p?(this._time=p,a=p+1e-4):this._time<0?this._time=a=0:a=this._time)),this._hasPause&&!this._forcingPlayhead&&!b){if((a=this._time)>=n||this._repeat&&v!==this._cycle)for(d=this._first;d&&d._startTime<=a&&!l;)d._duration||"isPause"!==d.data||d.ratio||0===d._startTime&&0===this._rawPrevTime||(l=d),d=d._next;else for(d=this._last;d&&d._startTime>=a&&!l;)d._duration||"isPause"===d.data&&d._rawPrevTime>0&&(l=d),d=d._prev;l&&l._startTime<p&&(this._time=a=l._startTime,this._totalTime=a+this._cycle*(this._totalDuration+this._repeatDelay))}if(this._cycle!==v&&!this._locked){var w=this._yoyo&&0!=(1&v),x=w===(this._yoyo&&0!=(1&this._cycle)),y=this._totalTime,z=this._cycle,A=this._rawPrevTime,B=this._time;if(this._totalTime=v*p,this._cycle<v?w=!w:this._totalTime+=p,this._time=n,this._rawPrevTime=0===p?t-1e-4:t,this._cycle=v,this._locked=!0,n=w?0:p,this.render(n,b,0===p),b||this._gc||this.vars.onRepeat&&(this._cycle=z,this._locked=!1,this._callback("onRepeat")),n!==this._time)return;if(x&&(this._cycle=v,this._locked=!0,n=w?p+1e-4:-1e-4,this.render(n,!0,!1)),this._locked=!1,this._paused&&!u)return;this._time=B,this._totalTime=y,this._cycle=z,this._rawPrevTime=A}if(!(this._time!==n&&this._first||c||j||l))return void(q!==this._totalTime&&this._onUpdate&&(b||this._callback("onUpdate")));if(this._initted||(this._initted=!0),this._active||!this._paused&&this._totalTime!==q&&a>0&&(this._active=!0),0===q&&this.vars.onStart&&(0===this._totalTime&&this._totalDuration||b||this._callback("onStart")),(m=this._time)>=n)for(d=this._first;d&&(f=d._next,m===this._time&&(!this._paused||u));)(d._active||d._startTime<=this._time&&!d._paused&&!d._gc)&&(l===d&&this.pause(),d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)),d=f;else for(d=this._last;d&&(f=d._prev,m===this._time&&(!this._paused||u));){if(d._active||d._startTime<=n&&!d._paused&&!d._gc){if(l===d){for(l=d._prev;l&&l.endTime()>this._time;)l.render(l._reversed?l.totalDuration()-(a-l._startTime)*l._timeScale:(a-l._startTime)*l._timeScale,b,c),l=l._prev;l=null,this.pause()}d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)}d=f}this._onUpdate&&(b||(g.length&&h(),this._callback("onUpdate"))),i&&(this._locked||this._gc||r!==this._startTime&&s===this._timeScale||(0===this._time||o>=this.totalDuration())&&(e&&(g.length&&h(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[i]&&this._callback(i)))},k.getActive=function(a,b,c){null==a&&(a=!0),null==b&&(b=!0),null==c&&(c=!1);var d,e,f=[],g=this.getChildren(a,b,c),h=0,i=g.length;for(d=0;d<i;d++)e=g[d],e.isActive()&&(f[h++]=e);return f},k.getLabelAfter=function(a){a||0!==a&&(a=this._time);var b,c=this.getLabelsArray(),d=c.length;for(b=0;b<d;b++)if(c[b].time>a)return c[b].name;return null},k.getLabelBefore=function(a){null==a&&(a=this._time);for(var b=this.getLabelsArray(),c=b.length;--c>-1;)if(b[c].time<a)return b[c].name;return null},k.getLabelsArray=function(){var a,b=[],c=0;for(a in this._labels)b[c++]={time:this._labels[a],name:a};return b.sort(function(a,b){return a.time-b.time}),b},k.invalidate=function(){return this._locked=!1,a.prototype.invalidate.call(this)},k.progress=function(a,b){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!=(1&this._cycle)?1-a:a)+this._cycle*(this._duration+this._repeatDelay),b):this._time/this.duration()||0},k.totalProgress=function(a,b){return arguments.length?this.totalTime(this.totalDuration()*a,b):this._totalTime/this.totalDuration()||0},k.totalDuration=function(b){return arguments.length?-1!==this._repeat&&b?this.timeScale(this.totalDuration()/b):this:(this._dirty&&(a.prototype.totalDuration.call(this),this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},k.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),a>this._duration&&(a=this._duration),this._yoyo&&0!=(1&this._cycle)?a=this._duration-a+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(a+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(a,b)):this._time},k.repeat=function(a){return arguments.length?(this._repeat=a,this._uncache(!0)):this._repeat},k.repeatDelay=function(a){return arguments.length?(this._repeatDelay=a,this._uncache(!0)):this._repeatDelay},k.yoyo=function(a){return arguments.length?(this._yoyo=a,this):this._yoyo},k.currentLabel=function(a){return arguments.length?this.seek(a,!0):this.getLabelBefore(this._time+1e-8)},e},!0),function(){var a=180/Math.PI,b=[],d=[],e=[],f={},g=c._gsDefine.globals,h=function(a,b,c,d){c===d&&(c=d-(d-b)/1e6),a===b&&(b=a+(c-a)/1e6),this.a=a,this.b=b,this.c=c,this.d=d,this.da=d-a,this.ca=c-a,this.ba=b-a},i=function(a,b,c,d){var e={a:a},f={},g={},h={c:d},i=(a+b)/2,j=(b+c)/2,k=(c+d)/2,l=(i+j)/2,m=(j+k)/2,n=(m-l)/8;return e.b=i+(a-i)/4,f.b=l+n,e.c=f.a=(e.b+f.b)/2,f.c=g.a=(l+m)/2,g.b=m-n,h.b=k+(d-k)/4,g.c=h.a=(g.b+h.b)/2,[e,f,g,h]},j=function(a,c,f,g,h){var j,k,l,m,n,o,p,q,r,s,t,u,v,w=a.length-1,x=0,y=a[0].a;for(j=0;j<w;j++)n=a[x],k=n.a,l=n.d,m=a[x+1].d,h?(t=b[j],u=d[j],v=(u+t)*c*.25/(g?.5:e[j]||.5),o=l-(l-k)*(g?.5*c:0!==t?v/t:0),p=l+(m-l)*(g?.5*c:0!==u?v/u:0),q=l-(o+((p-o)*(3*t/(t+u)+.5)/4||0))):(o=l-(l-k)*c*.5,p=l+(m-l)*c*.5,q=l-(o+p)/2),o+=q,p+=q,n.c=r=o,n.b=0!==j?y:y=n.a+.6*(n.c-n.a),n.da=l-k,n.ca=r-k,n.ba=y-k,f?(s=i(k,y,r,l),a.splice(x,1,s[0],s[1],s[2],s[3]),x+=4):x++,y=p;n=a[x],n.b=y,n.c=y+.4*(n.d-y),n.da=n.d-n.a,n.ca=n.c-n.a,n.ba=y-n.a,f&&(s=i(n.a,y,n.c,n.d),a.splice(x,1,s[0],s[1],s[2],s[3]))},k=function(a,c,e,f){var g,i,j,k,l,m,n=[];if(f)for(a=[f].concat(a),i=a.length;--i>-1;)"string"==typeof(m=a[i][c])&&"="===m.charAt(1)&&(a[i][c]=f[c]+Number(m.charAt(0)+m.substr(2)));if((g=a.length-2)<0)return n[0]=new h(a[0][c],0,0,a[0][c]),n;for(i=0;i<g;i++)j=a[i][c],k=a[i+1][c],n[i]=new h(j,0,0,k),e&&(l=a[i+2][c],b[i]=(b[i]||0)+(k-j)*(k-j),d[i]=(d[i]||0)+(l-k)*(l-k));return n[i]=new h(a[i][c],0,0,a[i+1][c]),n},l=function(a,c,g,h,i,l){var m,n,o,p,q,r,s,t,u={},v=[],w=l||a[0];i="string"==typeof i?","+i+",":",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",null==c&&(c=1);for(n in a[0])v.push(n);if(a.length>1){for(t=a[a.length-1],s=!0,m=v.length;--m>-1;)if(n=v[m],Math.abs(w[n]-t[n])>.05){s=!1;break}s&&(a=a.concat(),l&&a.unshift(l),a.push(a[1]),l=a[a.length-3])}for(b.length=d.length=e.length=0,m=v.length;--m>-1;)n=v[m],f[n]=-1!==i.indexOf(","+n+","),u[n]=k(a,n,f[n],l);for(m=b.length;--m>-1;)b[m]=Math.sqrt(b[m]),d[m]=Math.sqrt(d[m]);if(!h){for(m=v.length;--m>-1;)if(f[n])for(o=u[v[m]],r=o.length-1,p=0;p<r;p++)q=o[p+1].da/d[p]+o[p].da/b[p]||0,e[p]=(e[p]||0)+q*q;for(m=e.length;--m>-1;)e[m]=Math.sqrt(e[m])}for(m=v.length,p=g?4:1;--m>-1;)n=v[m],o=u[n],j(o,c,g,h,f[n]),s&&(o.splice(0,p),o.splice(o.length-p,p));return u},m=function(a,b,c){b=b||"soft";var d,e,f,g,i,j,k,l,m,n,o,p={},q="cubic"===b?3:2,r="soft"===b,s=[];if(r&&c&&(a=[c].concat(a)),null==a||a.length<q+1)throw"invalid Bezier data";for(m in a[0])s.push(m);for(j=s.length;--j>-1;){for(m=s[j],p[m]=i=[],n=0,l=a.length,k=0;k<l;k++)d=null==c?a[k][m]:"string"==typeof(o=a[k][m])&&"="===o.charAt(1)?c[m]+Number(o.charAt(0)+o.substr(2)):Number(o),r&&k>1&&k<l-1&&(i[n++]=(d+i[n-2])/2),i[n++]=d;for(l=n-q+1,n=0,k=0;k<l;k+=q)d=i[k],e=i[k+1],f=i[k+2],g=2===q?0:i[k+3],i[n++]=o=3===q?new h(d,e,f,g):new h(d,(2*e+d)/3,(2*e+f)/3,f);i.length=n}return p},n=function(a,b,c){for(var d,e,f,g,h,i,j,k,l,m,n,o=1/c,p=a.length;--p>-1;)for(m=a[p],f=m.a,g=m.d-f,h=m.c-f,i=m.b-f,d=e=0,k=1;k<=c;k++)j=o*k,l=1-j,d=e-(e=(j*j*g+3*l*(j*h+l*i))*j),n=p*c+k-1,b[n]=(b[n]||0)+d*d},o=function(a,b){b=b>>0||6;var c,d,e,f,g=[],h=[],i=0,j=0,k=b-1,l=[],m=[];for(c in a)n(a[c],g,b);for(e=g.length,d=0;d<e;d++)i+=Math.sqrt(g[d]),f=d%b,m[f]=i,f===k&&(j+=i,f=d/b>>0,l[f]=m,h[f]=j,i=0,m=[]);return{length:j,lengths:h,segments:l}},p=c._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.8",API:2,global:!0,init:function(a,b,c){this._target=a,b instanceof Array&&(b={values:b}),this._func={},this._mod={},this._props=[],this._timeRes=null==b.timeResolution?6:parseInt(b.timeResolution,10);var d,e,f,g,h,i=b.values||[],j={},k=i[0],n=b.autoRotate||c.vars.orientToBezier;this._autoRotate=n?n instanceof Array?n:[["x","y","rotation",!0===n?0:Number(n)||0]]:null;for(d in k)this._props.push(d);for(f=this._props.length;--f>-1;)d=this._props[f],this._overwriteProps.push(d),e=this._func[d]="function"==typeof a[d],j[d]=e?a[d.indexOf("set")||"function"!=typeof a["get"+d.substr(3)]?d:"get"+d.substr(3)]():parseFloat(a[d]),h||j[d]!==i[0][d]&&(h=j);if(this._beziers="cubic"!==b.type&&"quadratic"!==b.type&&"soft"!==b.type?l(i,isNaN(b.curviness)?1:b.curviness,!1,"thruBasic"===b.type,b.correlate,h):m(i,b.type,j),this._segCount=this._beziers[d].length,this._timeRes){var p=o(this._beziers,this._timeRes);this._length=p.length,this._lengths=p.lengths,this._segments=p.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(n=this._autoRotate)for(this._initialRotations=[],n[0]instanceof Array||(this._autoRotate=n=[n]),f=n.length;--f>-1;){for(g=0;g<3;g++)d=n[f][g],this._func[d]="function"==typeof a[d]&&a[d.indexOf("set")||"function"!=typeof a["get"+d.substr(3)]?d:"get"+d.substr(3)];d=n[f][2],this._initialRotations[f]=(this._func[d]?this._func[d].call(this._target):this._target[d])||0,this._overwriteProps.push(d)}return this._startRatio=c.vars.runBackwards?1:0,!0},set:function(b){var c,d,e,f,g,h,i,j,k,l,m=this._segCount,n=this._func,o=this._target,p=b!==this._startRatio;if(this._timeRes){if(k=this._lengths,l=this._curSeg,b*=this._length,e=this._li,b>this._l2&&e<m-1){for(j=m-1;e<j&&(this._l2=k[++e])<=b;);this._l1=k[e-1],this._li=e,this._curSeg=l=this._segments[e],this._s2=l[this._s1=this._si=0]}else if(b<this._l1&&e>0){for(;e>0&&(this._l1=k[--e])>=b;);0===e&&b<this._l1?this._l1=0:e++,this._l2=k[e],this._li=e,this._curSeg=l=this._segments[e],this._s1=l[(this._si=l.length-1)-1]||0,this._s2=l[this._si]}if(c=e,b-=this._l1,e=this._si,b>this._s2&&e<l.length-1){for(j=l.length-1;e<j&&(this._s2=l[++e])<=b;);this._s1=l[e-1],this._si=e}else if(b<this._s1&&e>0){for(;e>0&&(this._s1=l[--e])>=b;);0===e&&b<this._s1?this._s1=0:e++,this._s2=l[e],this._si=e}h=(e+(b-this._s1)/(this._s2-this._s1))*this._prec||0}else c=b<0?0:b>=1?m-1:m*b>>0,h=(b-c*(1/m))*m;for(d=1-h,e=this._props.length;--e>-1;)f=this._props[e],g=this._beziers[f][c],i=(h*h*g.da+3*d*(h*g.ca+d*g.ba))*h+g.a,this._mod[f]&&(i=this._mod[f](i,o)),n[f]?o[f](i):o[f]=i;if(this._autoRotate){var q,r,s,t,u,v,w,x=this._autoRotate;for(e=x.length;--e>-1;)f=x[e][2],v=x[e][3]||0,w=!0===x[e][4]?1:a,g=this._beziers[x[e][0]],q=this._beziers[x[e][1]],g&&q&&(g=g[c],q=q[c],r=g.a+(g.b-g.a)*h,t=g.b+(g.c-g.b)*h,r+=(t-r)*h,t+=(g.c+(g.d-g.c)*h-t)*h,s=q.a+(q.b-q.a)*h,u=q.b+(q.c-q.b)*h,s+=(u-s)*h,u+=(q.c+(q.d-q.c)*h-u)*h,i=p?Math.atan2(u-s,t-r)*w+v:this._initialRotations[e],this._mod[f]&&(i=this._mod[f](i,o)),n[f]?o[f](i):o[f]=i)}}}),q=p.prototype;p.bezierThrough=l,p.cubicToQuadratic=i,p._autoCSS=!0,p.quadraticToCubic=function(a,b,c){return new h(a,(2*b+a)/3,(2*b+c)/3,c)},p._cssRegister=function(){var a=g.CSSPlugin;if(a){var b=a._internals,c=b._parseToProxy,d=b._setPluginRatio,e=b.CSSPropTween;b._registerComplexSpecialProp("bezier",{parser:function(a,b,f,g,h,i){b instanceof Array&&(b={values:b}),i=new p;var j,k,l,m=b.values,n=m.length-1,o=[],q={};if(n<0)return h;for(j=0;j<=n;j++)l=c(a,m[j],g,h,i,n!==j),o[j]=l.end;for(k in b)q[k]=b[k];return q.values=o,h=new e(a,"bezier",0,0,l.pt,2),h.data=l,h.plugin=i,h.setRatio=d,0===q.autoRotate&&(q.autoRotate=!0),!q.autoRotate||q.autoRotate instanceof Array||(j=!0===q.autoRotate?0:Number(q.autoRotate),q.autoRotate=null!=l.end.left?[["left","top","rotation",j,!1]]:null!=l.end.x&&[["x","y","rotation",j,!1]]),q.autoRotate&&(g._transform||g._enableTransforms(!1),l.autoRotate=g._target._gsTransform,l.proxy.rotation=l.autoRotate.rotation||0,g._overwriteProps.push("rotation")),i._onInitTween(l.proxy,q,g._tween),h}})}},q._mod=function(a){for(var b,c=this._overwriteProps,d=c.length;--d>-1;)(b=a[c[d]])&&"function"==typeof b&&(this._mod[c[d]]=b)},q._kill=function(a){var b,c,d=this._props;for(b in this._beziers)if(b in a)for(delete this._beziers[b],delete this._func[b],c=d.length;--c>-1;)d[c]===b&&d.splice(c,1);if(d=this._autoRotate)for(c=d.length;--c>-1;)a[d[c][2]]&&d.splice(c,1);return this._super._kill.call(this,a)}}(),c._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(a,b){var d,e,f,g,h=function(){a.call(this,"css"),this._overwriteProps.length=0,this.setRatio=h.prototype.setRatio},i=c._gsDefine.globals,j={},k=h.prototype=new a("css");k.constructor=h,h.version="1.20.3",h.API=2,h.defaultTransformPerspective=0,h.defaultSkewType="compensated",h.defaultSmoothOrigin=!0,k="px",h.suffixMap={top:k,right:k,bottom:k,left:k,width:k,height:k,fontSize:k,padding:k,margin:k,perspective:k,lineHeight:""};var l,m,n,o,p,q,r,s,t=/(?:\-|\.|\b)(\d|\.|e\-)+/g,u=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,v=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,w=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,x=/(?:\d|\-|\+|=|#|\.)*/g,y=/opacity *= *([^)]*)/i,z=/opacity:([^;]*)/i,A=/alpha\(opacity *=.+?\)/i,B=/^(rgb|hsl)/,C=/([A-Z])/g,D=/-([a-z])/gi,E=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,F=function(a,b){return b.toUpperCase()},G=/(?:Left|Right|Width)/i,H=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,I=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,J=/,(?=[^\)]*(?:\(|$))/gi,K=/[\s,\(]/i,L=Math.PI/180,M=180/Math.PI,N={},O={style:{}},P=c.document||{createElement:function(){return O}},Q=function(a,b){return P.createElementNS?P.createElementNS(b||"http://www.w3.org/1999/xhtml",a):P.createElement(a)},R=Q("div"),S=Q("img"),T=h._internals={_specialProps:j},U=(c.navigator||{}).userAgent||"",V=function(){var a=U.indexOf("Android"),b=Q("a");return n=-1!==U.indexOf("Safari")&&-1===U.indexOf("Chrome")&&(-1===a||parseFloat(U.substr(a+8,2))>3),p=n&&parseFloat(U.substr(U.indexOf("Version/")+8,2))<6,o=-1!==U.indexOf("Firefox"),(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(U)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(U))&&(q=parseFloat(RegExp.$1)),!!b&&(b.style.cssText="top:1px;opacity:.55;",/^0.55/.test(b.style.opacity))}(),W=function(a){return y.test("string"==typeof a?a:(a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100:1},X=function(a){c.console&&console.log(a)},Y="",Z="",$=function(a,b){b=b||R;var c,d,e=b.style;if(void 0!==e[a])return a;for(a=a.charAt(0).toUpperCase()+a.substr(1),c=["O","Moz","ms","Ms","Webkit"],d=5;--d>-1&&void 0===e[c[d]+a];);return d>=0?(Z=3===d?"ms":c[d],Y="-"+Z.toLowerCase()+"-",Z+a):null},_=P.defaultView?P.defaultView.getComputedStyle:function(){},aa=h.getStyle=function(a,b,c,d,e){var f;return V||"opacity"!==b?(!d&&a.style[b]?f=a.style[b]:(c=c||_(a))?f=c[b]||c.getPropertyValue(b)||c.getPropertyValue(b.replace(C,"-$1").toLowerCase()):a.currentStyle&&(f=a.currentStyle[b]),null==e||f&&"none"!==f&&"auto"!==f&&"auto auto"!==f?f:e):W(a)},ba=T.convertToPixels=function(a,c,d,e,f){if("px"===e||!e&&"lineHeight"!==c)return d;if("auto"===e||!d)return 0;var g,i,j,k=G.test(c),l=a,m=R.style,n=d<0,o=1===d;if(n&&(d=-d),o&&(d*=100),"lineHeight"!==c||e)if("%"===e&&-1!==c.indexOf("border"))g=d/100*(k?a.clientWidth:a.clientHeight);else{if(m.cssText="border:0 solid red;position:"+aa(a,"position")+";line-height:0;","%"!==e&&l.appendChild&&"v"!==e.charAt(0)&&"rem"!==e)m[k?"borderLeftWidth":"borderTopWidth"]=d+e;else{if(l=a.parentNode||P.body,-1!==aa(l,"display").indexOf("flex")&&(m.position="absolute"),i=l._gsCache,j=b.ticker.frame,i&&k&&i.time===j)return i.width*d/100;m[k?"width":"height"]=d+e}l.appendChild(R),g=parseFloat(R[k?"offsetWidth":"offsetHeight"]),l.removeChild(R),k&&"%"===e&&!1!==h.cacheWidths&&(i=l._gsCache=l._gsCache||{},i.time=j,i.width=g/d*100),0!==g||f||(g=ba(a,c,d,e,!0))}else i=_(a).lineHeight,a.style.lineHeight=d,g=parseFloat(_(a).lineHeight),a.style.lineHeight=i;return o&&(g/=100),n?-g:g},ca=T.calculateOffset=function(a,b,c){if("absolute"!==aa(a,"position",c))return 0;var d="left"===b?"Left":"Top",e=aa(a,"margin"+d,c);return a["offset"+d]-(ba(a,b,parseFloat(e),e.replace(x,""))||0)},da=function(a,b){var c,d,e,f={};if(b=b||_(a,null))if(c=b.length)for(;--c>-1;)e=b[c],-1!==e.indexOf("-transform")&&Ea!==e||(f[e.replace(D,F)]=b.getPropertyValue(e));else for(c in b)-1!==c.indexOf("Transform")&&Da!==c||(f[c]=b[c]);else if(b=a.currentStyle||a.style)for(c in b)"string"==typeof c&&void 0===f[c]&&(f[c.replace(D,F)]=b[c]);return V||(f.opacity=W(a)),d=Sa(a,b,!1),f.rotation=d.rotation,f.skewX=d.skewX,f.scaleX=d.scaleX,f.scaleY=d.scaleY,f.x=d.x,f.y=d.y,Ga&&(f.z=d.z,f.rotationX=d.rotationX,f.rotationY=d.rotationY,f.scaleZ=d.scaleZ),f.filters&&delete f.filters,f},ea=function(a,b,c,d,e){var f,g,h,i={},j=a.style;for(g in c)"cssText"!==g&&"length"!==g&&isNaN(g)&&(b[g]!==(f=c[g])||e&&e[g])&&-1===g.indexOf("Origin")&&("number"!=typeof f&&"string"!=typeof f||(i[g]="auto"!==f||"left"!==g&&"top"!==g?""!==f&&"auto"!==f&&"none"!==f||"string"!=typeof b[g]||""===b[g].replace(w,"")?f:0:ca(a,g),void 0!==j[g]&&(h=new ta(j,g,j[g],h))));if(d)for(g in d)"className"!==g&&(i[g]=d[g]);return{difs:i,firstMPT:h}},fa={width:["Left","Right"],height:["Top","Bottom"]},ga=["marginLeft","marginRight","marginTop","marginBottom"],ha=function(a,b,c){if("svg"===(a.nodeName+"").toLowerCase())return(c||_(a))[b]||0;if(a.getCTM&&Pa(a))return a.getBBox()[b]||0;var d=parseFloat("width"===b?a.offsetWidth:a.offsetHeight),e=fa[b],f=e.length;for(c=c||_(a,null);--f>-1;)d-=parseFloat(aa(a,"padding"+e[f],c,!0))||0,d-=parseFloat(aa(a,"border"+e[f]+"Width",c,!0))||0;return d},ia=function(a,b){if("contain"===a||"auto"===a||"auto auto"===a)return a+" ";null!=a&&""!==a||(a="0 0");var c,d=a.split(" "),e=-1!==a.indexOf("left")?"0%":-1!==a.indexOf("right")?"100%":d[0],f=-1!==a.indexOf("top")?"0%":-1!==a.indexOf("bottom")?"100%":d[1];if(d.length>3&&!b){for(d=a.split(", ").join(",").split(","),a=[],c=0;c<d.length;c++)a.push(ia(d[c]));return a.join(",")}return null==f?f="center"===e?"50%":"0":"center"===f&&(f="50%"),("center"===e||isNaN(parseFloat(e))&&-1===(e+"").indexOf("="))&&(e="50%"),a=e+" "+f+(d.length>2?" "+d[2]:""),b&&(b.oxp=-1!==e.indexOf("%"),b.oyp=-1!==f.indexOf("%"),b.oxr="="===e.charAt(1),b.oyr="="===f.charAt(1),b.ox=parseFloat(e.replace(w,"")),b.oy=parseFloat(f.replace(w,"")),b.v=a),b||a},ja=function(a,b){return"function"==typeof a&&(a=a(s,r)),"string"==typeof a&&"="===a.charAt(1)?parseInt(a.charAt(0)+"1",10)*parseFloat(a.substr(2)):parseFloat(a)-parseFloat(b)||0},ka=function(a,b){return"function"==typeof a&&(a=a(s,r)),null==a?b:"string"==typeof a&&"="===a.charAt(1)?parseInt(a.charAt(0)+"1",10)*parseFloat(a.substr(2))+b:parseFloat(a)||0},la=function(a,b,c,d){var e,f,g,h,i;return"function"==typeof a&&(a=a(s,r)),null==a?h=b:"number"==typeof a?h=a:(e=360,f=a.split("_"),i="="===a.charAt(1),g=(i?parseInt(a.charAt(0)+"1",10)*parseFloat(f[0].substr(2)):parseFloat(f[0]))*(-1===a.indexOf("rad")?1:M)-(i?0:b),f.length&&(d&&(d[c]=b+g),-1!==a.indexOf("short")&&(g%=e)!==g%(e/2)&&(g=g<0?g+e:g-e),-1!==a.indexOf("_cw")&&g<0?g=(g+9999999999*e)%e-(g/e|0)*e:-1!==a.indexOf("ccw")&&g>0&&(g=(g-9999999999*e)%e-(g/e|0)*e)),h=b+g),h<1e-6&&h>-1e-6&&(h=0),h},ma={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},na=function(a,b,c){return a=a<0?a+1:a>1?a-1:a,255*(6*a<1?b+(c-b)*a*6:a<.5?c:3*a<2?b+(c-b)*(2/3-a)*6:b)+.5|0},oa=h.parseColor=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;if(a)if("number"==typeof a)c=[a>>16,a>>8&255,255&a];else{if(","===a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),ma[a])c=ma[a];else if("#"===a.charAt(0))4===a.length&&(d=a.charAt(1),e=a.charAt(2),f=a.charAt(3),a="#"+d+d+e+e+f+f),a=parseInt(a.substr(1),16),c=[a>>16,a>>8&255,255&a];else if("hsl"===a.substr(0,3))if(c=m=a.match(t),b){if(-1!==a.indexOf("="))return a.match(u)}else g=Number(c[0])%360/360,h=Number(c[1])/100,i=Number(c[2])/100,e=i<=.5?i*(h+1):i+h-i*h,d=2*i-e,c.length>3&&(c[3]=Number(c[3])),c[0]=na(g+1/3,d,e),c[1]=na(g,d,e),c[2]=na(g-1/3,d,e);else c=a.match(t)||ma.transparent;c[0]=Number(c[0]),c[1]=Number(c[1]),c[2]=Number(c[2]),c.length>3&&(c[3]=Number(c[3]))}else c=ma.black;return b&&!m&&(d=c[0]/255,e=c[1]/255,f=c[2]/255,j=Math.max(d,e,f),k=Math.min(d,e,f),i=(j+k)/2,j===k?g=h=0:(l=j-k,h=i>.5?l/(2-j-k):l/(j+k),g=j===d?(e-f)/l+(e<f?6:0):j===e?(f-d)/l+2:(d-e)/l+4,g*=60),c[0]=g+.5|0,c[1]=100*h+.5|0,c[2]=100*i+.5|0),c},pa=function(a,b){var c,d,e,f=a.match(qa)||[],g=0,h="";if(!f.length)return a;for(c=0;c<f.length;c++)d=f[c],e=a.substr(g,a.indexOf(d,g)-g),g+=e.length+d.length,d=oa(d,b),3===d.length&&d.push(1),h+=e+(b?"hsla("+d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:"rgba("+d.join(","))+")";return h+a.substr(g)},qa="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(k in ma)qa+="|"+k+"\\b";qa=new RegExp(qa+")","gi"),h.colorStringFilter=function(a){var b,c=a[0]+" "+a[1];qa.test(c)&&(b=-1!==c.indexOf("hsl(")||-1!==c.indexOf("hsla("),a[0]=pa(a[0],b),a[1]=pa(a[1],b)),qa.lastIndex=0},b.defaultStringFilter||(b.defaultStringFilter=h.colorStringFilter);var ra=function(a,b,c,d){if(null==a)return function(a){return a};var e,f=b?(a.match(qa)||[""])[0]:"",g=a.split(f).join("").match(v)||[],h=a.substr(0,a.indexOf(g[0])),i=")"===a.charAt(a.length-1)?")":"",j=-1!==a.indexOf(" ")?" ":",",k=g.length,l=k>0?g[0].replace(t,""):"";return k?e=b?function(a){var b,m,n,o;if("number"==typeof a)a+=l;else if(d&&J.test(a)){for(o=a.replace(J,"|").split("|"),n=0;n<o.length;n++)o[n]=e(o[n]);return o.join(",")}if(b=(a.match(qa)||[f])[0],m=a.split(b).join("").match(v)||[],n=m.length,k>n--)for(;++n<k;)m[n]=c?m[(n-1)/2|0]:g[n];return h+m.join(j)+j+b+i+(-1!==a.indexOf("inset")?" inset":"")}:function(a){var b,f,m;if("number"==typeof a)a+=l;else if(d&&J.test(a)){for(f=a.replace(J,"|").split("|"),m=0;m<f.length;m++)f[m]=e(f[m]);return f.join(",")}if(b=a.match(v)||[],m=b.length,k>m--)for(;++m<k;)b[m]=c?b[(m-1)/2|0]:g[m];return h+b.join(j)+i}:function(a){return a}},sa=function(a){return a=a.split(","),function(b,c,d,e,f,g,h){var i,j=(c+"").split(" ");for(h={},i=0;i<4;i++)h[a[i]]=j[i]=j[i]||j[(i-1)/2>>0];return e.parse(b,h,f,g)}},ta=(T._setPluginRatio=function(a){this.plugin.setRatio(a);for(var b,c,d,e,f,g=this.data,h=g.proxy,i=g.firstMPT;i;)b=h[i.v],i.r?b=Math.round(b):b<1e-6&&b>-1e-6&&(b=0),i.t[i.p]=b,i=i._next;if(g.autoRotate&&(g.autoRotate.rotation=g.mod?g.mod(h.rotation,this.t):h.rotation),1===a||0===a)for(i=g.firstMPT,f=1===a?"e":"b";i;){if(c=i.t,c.type){if(1===c.type){for(e=c.xs0+c.s+c.xs1,d=1;d<c.l;d++)e+=c["xn"+d]+c["xs"+(d+1)];c[f]=e}}else c[f]=c.s+c.xs0;i=i._next}},function(a,b,c,d,e){this.t=a,this.p=b,this.v=c,this.r=e,d&&(d._prev=this,this._next=d)}),ua=(T._parseToProxy=function(a,b,c,d,e,f){var g,h,i,j,k,l=d,m={},n={},o=c._transform,p=N;for(c._transform=null,N=b,d=k=c.parse(a,b,d,e),N=p,f&&(c._transform=o,l&&(l._prev=null,l._prev&&(l._prev._next=null)));d&&d!==l;){if(d.type<=1&&(h=d.p,n[h]=d.s+d.c,m[h]=d.s,f||(j=new ta(d,"s",h,j,d.r),d.c=0),1===d.type))for(g=d.l;--g>0;)i="xn"+g,h=d.p+"_"+i,n[h]=d.data[i],m[h]=d[i],f||(j=new ta(d,i,h,j,d.rxp[i]));d=d._next}return{proxy:m,end:n,firstMPT:j,pt:k}},T.CSSPropTween=function(a,b,c,e,f,h,i,j,k,l,m){this.t=a,this.p=b,this.s=c,this.c=e,this.n=i||b,a instanceof ua||g.push(this.n),this.r=j,this.type=h||0,k&&(this.pr=k,d=!0),this.b=void 0===l?c:l,this.e=void 0===m?c+e:m,f&&(this._next=f,f._prev=this)}),va=function(a,b,c,d,e,f){var g=new ua(a,b,c,d-c,e,-1,f);return g.b=c,g.e=g.xs0=d,g},wa=h.parseComplex=function(a,b,c,d,e,f,g,i,j,k){c=c||f||"","function"==typeof d&&(d=d(s,r)),g=new ua(a,b,0,0,g,k?2:1,null,!1,i,c,d),d+="",e&&qa.test(d+c)&&(d=[c,d],h.colorStringFilter(d),c=d[0],d=d[1]);var m,n,o,p,q,v,w,x,y,z,A,B,C,D=c.split(", ").join(",").split(" "),E=d.split(", ").join(",").split(" "),F=D.length,G=!1!==l;for(-1===d.indexOf(",")&&-1===c.indexOf(",")||(-1!==(d+c).indexOf("rgb")||-1!==(d+c).indexOf("hsl")?(D=D.join(" ").replace(J,", ").split(" "),E=E.join(" ").replace(J,", ").split(" ")):(D=D.join(" ").split(",").join(", ").split(" "),E=E.join(" ").split(",").join(", ").split(" ")),F=D.length),F!==E.length&&(D=(f||"").split(" "),F=D.length),g.plugin=j,g.setRatio=k,qa.lastIndex=0,m=0;m<F;m++)if(p=D[m],q=E[m],(x=parseFloat(p))||0===x)g.appendXtra("",x,ja(q,x),q.replace(u,""),G&&-1!==q.indexOf("px"),!0);else if(e&&qa.test(p))B=q.indexOf(")")+1,B=")"+(B?q.substr(B):""),C=-1!==q.indexOf("hsl")&&V,z=q,p=oa(p,C),q=oa(q,C),y=p.length+q.length>6,y&&!V&&0===q[3]?(g["xs"+g.l]+=g.l?" transparent":"transparent",g.e=g.e.split(E[m]).join("transparent")):(V||(y=!1),C?g.appendXtra(z.substr(0,z.indexOf("hsl"))+(y?"hsla(":"hsl("),p[0],ja(q[0],p[0]),",",!1,!0).appendXtra("",p[1],ja(q[1],p[1]),"%,",!1).appendXtra("",p[2],ja(q[2],p[2]),y?"%,":"%"+B,!1):g.appendXtra(z.substr(0,z.indexOf("rgb"))+(y?"rgba(":"rgb("),p[0],q[0]-p[0],",",!0,!0).appendXtra("",p[1],q[1]-p[1],",",!0).appendXtra("",p[2],q[2]-p[2],y?",":B,!0),y&&(p=p.length<4?1:p[3],g.appendXtra("",p,(q.length<4?1:q[3])-p,B,!1))),qa.lastIndex=0;else if(v=p.match(t)){if(!(w=q.match(u))||w.length!==v.length)return g;for(o=0,n=0;n<v.length;n++)A=v[n],z=p.indexOf(A,o),g.appendXtra(p.substr(o,z-o),Number(A),ja(w[n],A),"",G&&"px"===p.substr(z+A.length,2),0===n),o=z+A.length;g["xs"+g.l]+=p.substr(o)}else g["xs"+g.l]+=g.l||g["xs"+g.l]?" "+q:q;if(-1!==d.indexOf("=")&&g.data){for(B=g.xs0+g.data.s,m=1;m<g.l;m++)B+=g["xs"+m]+g.data["xn"+m];g.e=B+g["xs"+m]}return g.l||(g.type=-1,g.xs0=g.e),g.xfirst||g},xa=9;for(k=ua.prototype,k.l=k.pr=0;--xa>0;)k["xn"+xa]=0,k["xs"+xa]="";k.xs0="",k._next=k._prev=k.xfirst=k.data=k.plugin=k.setRatio=k.rxp=null,k.appendXtra=function(a,b,c,d,e,f){var g=this,h=g.l;return g["xs"+h]+=f&&(h||g["xs"+h])?" "+a:a||"",c||0===h||g.plugin?(g.l++,g.type=g.setRatio?2:1,g["xs"+g.l]=d||"",h>0?(g.data["xn"+h]=b+c,g.rxp["xn"+h]=e,g["xn"+h]=b,g.plugin||(g.xfirst=new ua(g,"xn"+h,b,c,g.xfirst||g,0,g.n,e,g.pr),g.xfirst.xs0=0),g):(g.data={s:b+c},g.rxp={},g.s=b,g.c=c,g.r=e,g)):(g["xs"+h]+=b+(d||""),g)};var ya=function(a,b){b=b||{},this.p=b.prefix?$(a)||a:a,j[a]=j[this.p]=this,this.format=b.formatter||ra(b.defaultValue,b.color,b.collapsible,b.multi),b.parser&&(this.parse=b.parser),this.clrs=b.color,this.multi=b.multi,this.keyword=b.keyword,this.dflt=b.defaultValue,this.pr=b.priority||0},za=T._registerComplexSpecialProp=function(a,b,c){"object"!=typeof b&&(b={parser:c});var d,e=a.split(","),f=b.defaultValue;for(c=c||[f],d=0;d<e.length;d++)b.prefix=0===d&&b.prefix,b.defaultValue=c[d]||f,new ya(e[d],b)},Aa=T._registerPluginProp=function(a){if(!j[a]){var b=a.charAt(0).toUpperCase()+a.substr(1)+"Plugin";za(a,{parser:function(a,c,d,e,f,g,h){var k=i.com.greensock.plugins[b];return k?(k._cssRegister(),j[d].parse(a,c,d,e,f,g,h)):(X("Error: "+b+" js file not loaded."),f)}})}};k=ya.prototype,k.parseComplex=function(a,b,c,d,e,f){var g,h,i,j,k,l,m=this.keyword;if(this.multi&&(J.test(c)||J.test(b)?(h=b.replace(J,"|").split("|"),i=c.replace(J,"|").split("|")):m&&(h=[b],i=[c])),i){for(j=i.length>h.length?i.length:h.length,g=0;g<j;g++)b=h[g]=h[g]||this.dflt,c=i[g]=i[g]||this.dflt,m&&(k=b.indexOf(m),l=c.indexOf(m),k!==l&&(-1===l?h[g]=h[g].split(m).join(""):-1===k&&(h[g]+=" "+m)));b=h.join(", "),c=i.join(", ")}return wa(a,this.p,b,c,this.clrs,this.dflt,d,this.pr,e,f)},k.parse=function(a,b,c,d,e,g,h){return this.parseComplex(a.style,this.format(aa(a,this.p,f,!1,this.dflt)),this.format(b),e,g)},h.registerSpecialProp=function(a,b,c){za(a,{parser:function(a,d,e,f,g,h,i){
var j=new ua(a,e,0,0,g,2,e,!1,c);return j.plugin=h,j.setRatio=b(a,d,f._tween,e),j},priority:c})},h.useSVGTransformAttr=!0;var Ba,Ca="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),Da=$("transform"),Ea=Y+"transform",Fa=$("transformOrigin"),Ga=null!==$("perspective"),Ha=T.Transform=function(){this.perspective=parseFloat(h.defaultTransformPerspective)||0,this.force3D=!(!1===h.defaultForce3D||!Ga)&&(h.defaultForce3D||"auto")},Ia=c.SVGElement,Ja=function(a,b,c){var d,e=P.createElementNS("http://www.w3.org/2000/svg",a),f=/([a-z])([A-Z])/g;for(d in c)e.setAttributeNS(null,d.replace(f,"$1-$2").toLowerCase(),c[d]);return b.appendChild(e),e},Ka=P.documentElement||{},La=function(){var a,b,d,e=q||/Android/i.test(U)&&!c.chrome;return P.createElementNS&&!e&&(a=Ja("svg",Ka),b=Ja("rect",a,{width:100,height:50,x:100}),d=b.getBoundingClientRect().width,b.style[Fa]="50% 50%",b.style[Da]="scaleX(0.5)",e=d===b.getBoundingClientRect().width&&!(o&&Ga),Ka.removeChild(a)),e}(),Ma=function(a,b,c,d,e,f){var g,i,j,k,l,m,n,o,p,q,r,s,t,u,v=a._gsTransform,w=Ra(a,!0);v&&(t=v.xOrigin,u=v.yOrigin),(!d||(g=d.split(" ")).length<2)&&(n=a.getBBox(),0===n.x&&0===n.y&&n.width+n.height===0&&(n={x:parseFloat(a.hasAttribute("x")?a.getAttribute("x"):a.hasAttribute("cx")?a.getAttribute("cx"):0)||0,y:parseFloat(a.hasAttribute("y")?a.getAttribute("y"):a.hasAttribute("cy")?a.getAttribute("cy"):0)||0,width:0,height:0}),b=ia(b).split(" "),g=[(-1!==b[0].indexOf("%")?parseFloat(b[0])/100*n.width:parseFloat(b[0]))+n.x,(-1!==b[1].indexOf("%")?parseFloat(b[1])/100*n.height:parseFloat(b[1]))+n.y]),c.xOrigin=k=parseFloat(g[0]),c.yOrigin=l=parseFloat(g[1]),d&&w!==Qa&&(m=w[0],n=w[1],o=w[2],p=w[3],q=w[4],r=w[5],(s=m*p-n*o)&&(i=k*(p/s)+l*(-o/s)+(o*r-p*q)/s,j=k*(-n/s)+l*(m/s)-(m*r-n*q)/s,k=c.xOrigin=g[0]=i,l=c.yOrigin=g[1]=j)),v&&(f&&(c.xOffset=v.xOffset,c.yOffset=v.yOffset,v=c),e||!1!==e&&!1!==h.defaultSmoothOrigin?(i=k-t,j=l-u,v.xOffset+=i*w[0]+j*w[2]-i,v.yOffset+=i*w[1]+j*w[3]-j):v.xOffset=v.yOffset=0),f||a.setAttribute("data-svg-origin",g.join(" "))},Na=function(a){var b,c=Q("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),d=this.parentNode,e=this.nextSibling,f=this.style.cssText;if(Ka.appendChild(c),c.appendChild(this),this.style.display="block",a)try{b=this.getBBox(),this._originalGetBBox=this.getBBox,this.getBBox=Na}catch(a){}else this._originalGetBBox&&(b=this._originalGetBBox());return e?d.insertBefore(this,e):d.appendChild(this),Ka.removeChild(c),this.style.cssText=f,b},Oa=function(a){try{return a.getBBox()}catch(b){return Na.call(a,!0)}},Pa=function(a){return!(!Ia||!a.getCTM||a.parentNode&&!a.ownerSVGElement||!Oa(a))},Qa=[1,0,0,1,0,0],Ra=function(a,b){var c,d,e,f,g,h,i=a._gsTransform||new Ha,j=a.style;if(Da?d=aa(a,Ea,null,!0):a.currentStyle&&(d=a.currentStyle.filter.match(H),d=d&&4===d.length?[d[0].substr(4),Number(d[2].substr(4)),Number(d[1].substr(4)),d[3].substr(4),i.x||0,i.y||0].join(","):""),c=!d||"none"===d||"matrix(1, 0, 0, 1, 0, 0)"===d,!Da||!(h=!_(a)||"none"===_(a).display)&&a.parentNode||(h&&(f=j.display,j.display="block"),a.parentNode||(g=1,Ka.appendChild(a)),d=aa(a,Ea,null,!0),c=!d||"none"===d||"matrix(1, 0, 0, 1, 0, 0)"===d,f?j.display=f:h&&Wa(j,"display"),g&&Ka.removeChild(a)),(i.svg||a.getCTM&&Pa(a))&&(c&&-1!==(j[Da]+"").indexOf("matrix")&&(d=j[Da],c=0),e=a.getAttribute("transform"),c&&e&&(-1!==e.indexOf("matrix")?(d=e,c=0):-1!==e.indexOf("translate")&&(d="matrix(1,0,0,1,"+e.match(/(?:\-|\b)[\d\-\.e]+\b/gi).join(",")+")",c=0))),c)return Qa;for(e=(d||"").match(t)||[],xa=e.length;--xa>-1;)f=Number(e[xa]),e[xa]=(g=f-(f|=0))?(1e5*g+(g<0?-.5:.5)|0)/1e5+f:f;return b&&e.length>6?[e[0],e[1],e[4],e[5],e[12],e[13]]:e},Sa=T.getTransform=function(a,c,d,e){if(a._gsTransform&&d&&!e)return a._gsTransform;var f,g,i,j,k,l,m=d?a._gsTransform||new Ha:new Ha,n=m.scaleX<0,o=Ga?parseFloat(aa(a,Fa,c,!1,"0 0 0").split(" ")[2])||m.zOrigin||0:0,p=parseFloat(h.defaultTransformPerspective)||0;if(m.svg=!(!a.getCTM||!Pa(a)),m.svg&&(Ma(a,aa(a,Fa,c,!1,"50% 50%")+"",m,a.getAttribute("data-svg-origin")),Ba=h.useSVGTransformAttr||La),(f=Ra(a))!==Qa){if(16===f.length){var q,r,s,t,u,v=f[0],w=f[1],x=f[2],y=f[3],z=f[4],A=f[5],B=f[6],C=f[7],D=f[8],E=f[9],F=f[10],G=f[12],H=f[13],I=f[14],J=f[11],K=Math.atan2(B,F);m.zOrigin&&(I=-m.zOrigin,G=D*I-f[12],H=E*I-f[13],I=F*I+m.zOrigin-f[14]),m.rotationX=K*M,K&&(t=Math.cos(-K),u=Math.sin(-K),q=z*t+D*u,r=A*t+E*u,s=B*t+F*u,D=z*-u+D*t,E=A*-u+E*t,F=B*-u+F*t,J=C*-u+J*t,z=q,A=r,B=s),K=Math.atan2(-x,F),m.rotationY=K*M,K&&(t=Math.cos(-K),u=Math.sin(-K),q=v*t-D*u,r=w*t-E*u,s=x*t-F*u,E=w*u+E*t,F=x*u+F*t,J=y*u+J*t,v=q,w=r,x=s),K=Math.atan2(w,v),m.rotation=K*M,K&&(t=Math.cos(K),u=Math.sin(K),q=v*t+w*u,r=z*t+A*u,s=D*t+E*u,w=w*t-v*u,A=A*t-z*u,E=E*t-D*u,v=q,z=r,D=s),m.rotationX&&Math.abs(m.rotationX)+Math.abs(m.rotation)>359.9&&(m.rotationX=m.rotation=0,m.rotationY=180-m.rotationY),K=Math.atan2(z,A),m.scaleX=(1e5*Math.sqrt(v*v+w*w+x*x)+.5|0)/1e5,m.scaleY=(1e5*Math.sqrt(A*A+B*B)+.5|0)/1e5,m.scaleZ=(1e5*Math.sqrt(D*D+E*E+F*F)+.5|0)/1e5,v/=m.scaleX,z/=m.scaleY,w/=m.scaleX,A/=m.scaleY,Math.abs(K)>2e-5?(m.skewX=K*M,z=0,"simple"!==m.skewType&&(m.scaleY*=1/Math.cos(K))):m.skewX=0,m.perspective=J?1/(J<0?-J:J):0,m.x=G,m.y=H,m.z=I,m.svg&&(m.x-=m.xOrigin-(m.xOrigin*v-m.yOrigin*z),m.y-=m.yOrigin-(m.yOrigin*w-m.xOrigin*A))}else if(!Ga||e||!f.length||m.x!==f[4]||m.y!==f[5]||!m.rotationX&&!m.rotationY){var L=f.length>=6,N=L?f[0]:1,O=f[1]||0,P=f[2]||0,Q=L?f[3]:1;m.x=f[4]||0,m.y=f[5]||0,i=Math.sqrt(N*N+O*O),j=Math.sqrt(Q*Q+P*P),k=N||O?Math.atan2(O,N)*M:m.rotation||0,l=P||Q?Math.atan2(P,Q)*M+k:m.skewX||0,m.scaleX=i,m.scaleY=j,m.rotation=k,m.skewX=l,Ga&&(m.rotationX=m.rotationY=m.z=0,m.perspective=p,m.scaleZ=1),m.svg&&(m.x-=m.xOrigin-(m.xOrigin*N+m.yOrigin*P),m.y-=m.yOrigin-(m.xOrigin*O+m.yOrigin*Q))}Math.abs(m.skewX)>90&&Math.abs(m.skewX)<270&&(n?(m.scaleX*=-1,m.skewX+=m.rotation<=0?180:-180,m.rotation+=m.rotation<=0?180:-180):(m.scaleY*=-1,m.skewX+=m.skewX<=0?180:-180)),m.zOrigin=o;for(g in m)m[g]<2e-5&&m[g]>-2e-5&&(m[g]=0)}return d&&(a._gsTransform=m,m.svg&&(Ba&&a.style[Da]?b.delayedCall(.001,function(){Wa(a.style,Da)}):!Ba&&a.getAttribute("transform")&&b.delayedCall(.001,function(){a.removeAttribute("transform")}))),m},Ta=function(a){var b,c,d=this.data,e=-d.rotation*L,f=e+d.skewX*L,g=(Math.cos(e)*d.scaleX*1e5|0)/1e5,h=(Math.sin(e)*d.scaleX*1e5|0)/1e5,i=(Math.sin(f)*-d.scaleY*1e5|0)/1e5,j=(Math.cos(f)*d.scaleY*1e5|0)/1e5,k=this.t.style,l=this.t.currentStyle;if(l){c=h,h=-i,i=-c,b=l.filter,k.filter="";var m,n,o=this.t.offsetWidth,p=this.t.offsetHeight,r="absolute"!==l.position,s="progid:DXImageTransform.Microsoft.Matrix(M11="+g+", M12="+h+", M21="+i+", M22="+j,t=d.x+o*d.xPercent/100,u=d.y+p*d.yPercent/100;if(null!=d.ox&&(m=(d.oxp?o*d.ox*.01:d.ox)-o/2,n=(d.oyp?p*d.oy*.01:d.oy)-p/2,t+=m-(m*g+n*h),u+=n-(m*i+n*j)),r?(m=o/2,n=p/2,s+=", Dx="+(m-(m*g+n*h)+t)+", Dy="+(n-(m*i+n*j)+u)+")"):s+=", sizingMethod='auto expand')",-1!==b.indexOf("DXImageTransform.Microsoft.Matrix(")?k.filter=b.replace(I,s):k.filter=s+" "+b,0!==a&&1!==a||1===g&&0===h&&0===i&&1===j&&(r&&-1===s.indexOf("Dx=0, Dy=0")||y.test(b)&&100!==parseFloat(RegExp.$1)||-1===b.indexOf(b.indexOf("Alpha"))&&k.removeAttribute("filter")),!r){var v,w,z,A=q<8?1:-1;for(m=d.ieOffsetX||0,n=d.ieOffsetY||0,d.ieOffsetX=Math.round((o-((g<0?-g:g)*o+(h<0?-h:h)*p))/2+t),d.ieOffsetY=Math.round((p-((j<0?-j:j)*p+(i<0?-i:i)*o))/2+u),xa=0;xa<4;xa++)w=ga[xa],v=l[w],c=-1!==v.indexOf("px")?parseFloat(v):ba(this.t,w,parseFloat(v),v.replace(x,""))||0,z=c!==d[w]?xa<2?-d.ieOffsetX:-d.ieOffsetY:xa<2?m-d.ieOffsetX:n-d.ieOffsetY,k[w]=(d[w]=Math.round(c-z*(0===xa||2===xa?1:A)))+"px"}}},Ua=T.set3DTransformRatio=T.setTransformRatio=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,p,q,r,s,t,u,v,w,x,y,z=this.data,A=this.t.style,B=z.rotation,C=z.rotationX,D=z.rotationY,E=z.scaleX,F=z.scaleY,G=z.scaleZ,H=z.x,I=z.y,J=z.z,K=z.svg,M=z.perspective,N=z.force3D,O=z.skewY,P=z.skewX;if(O&&(P+=O,B+=O),((1===a||0===a)&&"auto"===N&&(this.tween._totalTime===this.tween._totalDuration||!this.tween._totalTime)||!N)&&!J&&!M&&!D&&!C&&1===G||Ba&&K||!Ga)return void(B||P||K?(B*=L,x=P*L,y=1e5,c=Math.cos(B)*E,f=Math.sin(B)*E,d=Math.sin(B-x)*-F,g=Math.cos(B-x)*F,x&&"simple"===z.skewType&&(b=Math.tan(x-O*L),b=Math.sqrt(1+b*b),d*=b,g*=b,O&&(b=Math.tan(O*L),b=Math.sqrt(1+b*b),c*=b,f*=b)),K&&(H+=z.xOrigin-(z.xOrigin*c+z.yOrigin*d)+z.xOffset,I+=z.yOrigin-(z.xOrigin*f+z.yOrigin*g)+z.yOffset,Ba&&(z.xPercent||z.yPercent)&&(q=this.t.getBBox(),H+=.01*z.xPercent*q.width,I+=.01*z.yPercent*q.height),q=1e-6,H<q&&H>-q&&(H=0),I<q&&I>-q&&(I=0)),u=(c*y|0)/y+","+(f*y|0)/y+","+(d*y|0)/y+","+(g*y|0)/y+","+H+","+I+")",K&&Ba?this.t.setAttribute("transform","matrix("+u):A[Da]=(z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) matrix(":"matrix(")+u):A[Da]=(z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) matrix(":"matrix(")+E+",0,0,"+F+","+H+","+I+")");if(o&&(q=1e-4,E<q&&E>-q&&(E=G=2e-5),F<q&&F>-q&&(F=G=2e-5),!M||z.z||z.rotationX||z.rotationY||(M=0)),B||P)B*=L,r=c=Math.cos(B),s=f=Math.sin(B),P&&(B-=P*L,r=Math.cos(B),s=Math.sin(B),"simple"===z.skewType&&(b=Math.tan((P-O)*L),b=Math.sqrt(1+b*b),r*=b,s*=b,z.skewY&&(b=Math.tan(O*L),b=Math.sqrt(1+b*b),c*=b,f*=b))),d=-s,g=r;else{if(!(D||C||1!==G||M||K))return void(A[Da]=(z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) translate3d(":"translate3d(")+H+"px,"+I+"px,"+J+"px)"+(1!==E||1!==F?" scale("+E+","+F+")":""));c=g=1,d=f=0}k=1,e=h=i=j=l=m=0,n=M?-1/M:0,p=z.zOrigin,q=1e-6,v=",",w="0",B=D*L,B&&(r=Math.cos(B),s=Math.sin(B),i=-s,l=n*-s,e=c*s,h=f*s,k=r,n*=r,c*=r,f*=r),B=C*L,B&&(r=Math.cos(B),s=Math.sin(B),b=d*r+e*s,t=g*r+h*s,j=k*s,m=n*s,e=d*-s+e*r,h=g*-s+h*r,k*=r,n*=r,d=b,g=t),1!==G&&(e*=G,h*=G,k*=G,n*=G),1!==F&&(d*=F,g*=F,j*=F,m*=F),1!==E&&(c*=E,f*=E,i*=E,l*=E),(p||K)&&(p&&(H+=e*-p,I+=h*-p,J+=k*-p+p),K&&(H+=z.xOrigin-(z.xOrigin*c+z.yOrigin*d)+z.xOffset,I+=z.yOrigin-(z.xOrigin*f+z.yOrigin*g)+z.yOffset),H<q&&H>-q&&(H=w),I<q&&I>-q&&(I=w),J<q&&J>-q&&(J=0)),u=z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) matrix3d(":"matrix3d(",u+=(c<q&&c>-q?w:c)+v+(f<q&&f>-q?w:f)+v+(i<q&&i>-q?w:i),u+=v+(l<q&&l>-q?w:l)+v+(d<q&&d>-q?w:d)+v+(g<q&&g>-q?w:g),C||D||1!==G?(u+=v+(j<q&&j>-q?w:j)+v+(m<q&&m>-q?w:m)+v+(e<q&&e>-q?w:e),u+=v+(h<q&&h>-q?w:h)+v+(k<q&&k>-q?w:k)+v+(n<q&&n>-q?w:n)+v):u+=",0,0,0,0,1,0,",u+=H+v+I+v+J+v+(M?1+-J/M:1)+")",A[Da]=u};k=Ha.prototype,k.x=k.y=k.z=k.skewX=k.skewY=k.rotation=k.rotationX=k.rotationY=k.zOrigin=k.xPercent=k.yPercent=k.xOffset=k.yOffset=0,k.scaleX=k.scaleY=k.scaleZ=1,za("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent,smoothOrigin",{parser:function(a,b,c,d,e,g,i){if(d._lastParsedTransform===i)return e;d._lastParsedTransform=i;var j,k=i.scale&&"function"==typeof i.scale?i.scale:0;"function"==typeof i[c]&&(j=i[c],i[c]=b),k&&(i.scale=k(s,a));var l,m,n,o,p,q,t,u,v,w=a._gsTransform,x=a.style,y=Ca.length,z=i,A={},B=Sa(a,f,!0,z.parseTransform),C=z.transform&&("function"==typeof z.transform?z.transform(s,r):z.transform);if(B.skewType=z.skewType||B.skewType||h.defaultSkewType,d._transform=B,C&&"string"==typeof C&&Da)m=R.style,m[Da]=C,m.display="block",m.position="absolute",P.body.appendChild(R),l=Sa(R,null,!1),"simple"===B.skewType&&(l.scaleY*=Math.cos(l.skewX*L)),B.svg&&(q=B.xOrigin,t=B.yOrigin,l.x-=B.xOffset,l.y-=B.yOffset,(z.transformOrigin||z.svgOrigin)&&(C={},Ma(a,ia(z.transformOrigin),C,z.svgOrigin,z.smoothOrigin,!0),q=C.xOrigin,t=C.yOrigin,l.x-=C.xOffset-B.xOffset,l.y-=C.yOffset-B.yOffset),(q||t)&&(u=Ra(R,!0),l.x-=q-(q*u[0]+t*u[2]),l.y-=t-(q*u[1]+t*u[3]))),P.body.removeChild(R),l.perspective||(l.perspective=B.perspective),null!=z.xPercent&&(l.xPercent=ka(z.xPercent,B.xPercent)),null!=z.yPercent&&(l.yPercent=ka(z.yPercent,B.yPercent));else if("object"==typeof z){if(l={scaleX:ka(null!=z.scaleX?z.scaleX:z.scale,B.scaleX),scaleY:ka(null!=z.scaleY?z.scaleY:z.scale,B.scaleY),scaleZ:ka(z.scaleZ,B.scaleZ),x:ka(z.x,B.x),y:ka(z.y,B.y),z:ka(z.z,B.z),xPercent:ka(z.xPercent,B.xPercent),yPercent:ka(z.yPercent,B.yPercent),perspective:ka(z.transformPerspective,B.perspective)},null!=(p=z.directionalRotation))if("object"==typeof p)for(m in p)z[m]=p[m];else z.rotation=p;"string"==typeof z.x&&-1!==z.x.indexOf("%")&&(l.x=0,l.xPercent=ka(z.x,B.xPercent)),"string"==typeof z.y&&-1!==z.y.indexOf("%")&&(l.y=0,l.yPercent=ka(z.y,B.yPercent)),l.rotation=la("rotation"in z?z.rotation:"shortRotation"in z?z.shortRotation+"_short":"rotationZ"in z?z.rotationZ:B.rotation,B.rotation,"rotation",A),Ga&&(l.rotationX=la("rotationX"in z?z.rotationX:"shortRotationX"in z?z.shortRotationX+"_short":B.rotationX||0,B.rotationX,"rotationX",A),l.rotationY=la("rotationY"in z?z.rotationY:"shortRotationY"in z?z.shortRotationY+"_short":B.rotationY||0,B.rotationY,"rotationY",A)),l.skewX=la(z.skewX,B.skewX),l.skewY=la(z.skewY,B.skewY)}for(Ga&&null!=z.force3D&&(B.force3D=z.force3D,o=!0),n=B.force3D||B.z||B.rotationX||B.rotationY||l.z||l.rotationX||l.rotationY||l.perspective,n||null==z.scale||(l.scaleZ=1);--y>-1;)v=Ca[y],((C=l[v]-B[v])>1e-6||C<-1e-6||null!=z[v]||null!=N[v])&&(o=!0,e=new ua(B,v,B[v],C,e),v in A&&(e.e=A[v]),e.xs0=0,e.plugin=g,d._overwriteProps.push(e.n));return C=z.transformOrigin,B.svg&&(C||z.svgOrigin)&&(q=B.xOffset,t=B.yOffset,Ma(a,ia(C),l,z.svgOrigin,z.smoothOrigin),e=va(B,"xOrigin",(w?B:l).xOrigin,l.xOrigin,e,"transformOrigin"),e=va(B,"yOrigin",(w?B:l).yOrigin,l.yOrigin,e,"transformOrigin"),q===B.xOffset&&t===B.yOffset||(e=va(B,"xOffset",w?q:B.xOffset,B.xOffset,e,"transformOrigin"),e=va(B,"yOffset",w?t:B.yOffset,B.yOffset,e,"transformOrigin")),C="0px 0px"),(C||Ga&&n&&B.zOrigin)&&(Da?(o=!0,v=Fa,C=(C||aa(a,v,f,!1,"50% 50%"))+"",e=new ua(x,v,0,0,e,-1,"transformOrigin"),e.b=x[v],e.plugin=g,Ga?(m=B.zOrigin,C=C.split(" "),B.zOrigin=(C.length>2&&(0===m||"0px"!==C[2])?parseFloat(C[2]):m)||0,e.xs0=e.e=C[0]+" "+(C[1]||"50%")+" 0px",e=new ua(B,"zOrigin",0,0,e,-1,e.n),e.b=m,e.xs0=e.e=B.zOrigin):e.xs0=e.e=C):ia(C+"",B)),o&&(d._transformType=B.svg&&Ba||!n&&3!==this._transformType?2:3),j&&(i[c]=j),k&&(i.scale=k),e},prefix:!0}),za("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),za("borderRadius",{defaultValue:"0px",parser:function(a,b,c,d,g,h){b=this.format(b);var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],z=a.style;for(q=parseFloat(a.offsetWidth),r=parseFloat(a.offsetHeight),i=b.split(" "),j=0;j<y.length;j++)this.p.indexOf("border")&&(y[j]=$(y[j])),m=l=aa(a,y[j],f,!1,"0px"),-1!==m.indexOf(" ")&&(l=m.split(" "),m=l[0],l=l[1]),n=k=i[j],o=parseFloat(m),t=m.substr((o+"").length),u="="===n.charAt(1),u?(p=parseInt(n.charAt(0)+"1",10),n=n.substr(2),p*=parseFloat(n),s=n.substr((p+"").length-(p<0?1:0))||""):(p=parseFloat(n),s=n.substr((p+"").length)),""===s&&(s=e[c]||t),s!==t&&(v=ba(a,"borderLeft",o,t),w=ba(a,"borderTop",o,t),"%"===s?(m=v/q*100+"%",l=w/r*100+"%"):"em"===s?(x=ba(a,"borderLeft",1,"em"),m=v/x+"em",l=w/x+"em"):(m=v+"px",l=w+"px"),u&&(n=parseFloat(m)+p+s,k=parseFloat(l)+p+s)),g=wa(z,y[j],m+" "+l,n+" "+k,!1,"0px",g);return g},prefix:!0,formatter:ra("0px 0px 0px 0px",!1,!0)}),za("borderBottomLeftRadius,borderBottomRightRadius,borderTopLeftRadius,borderTopRightRadius",{defaultValue:"0px",parser:function(a,b,c,d,e,g){return wa(a.style,c,this.format(aa(a,c,f,!1,"0px 0px")),this.format(b),!1,"0px",e)},prefix:!0,formatter:ra("0px 0px",!1,!0)}),za("backgroundPosition",{defaultValue:"0 0",parser:function(a,b,c,d,e,g){var h,i,j,k,l,m,n="background-position",o=f||_(a,null),p=this.format((o?q?o.getPropertyValue(n+"-x")+" "+o.getPropertyValue(n+"-y"):o.getPropertyValue(n):a.currentStyle.backgroundPositionX+" "+a.currentStyle.backgroundPositionY)||"0 0"),r=this.format(b);if(-1!==p.indexOf("%")!=(-1!==r.indexOf("%"))&&r.split(",").length<2&&(m=aa(a,"backgroundImage").replace(E,""))&&"none"!==m){for(h=p.split(" "),i=r.split(" "),S.setAttribute("src",m),j=2;--j>-1;)p=h[j],(k=-1!==p.indexOf("%"))!==(-1!==i[j].indexOf("%"))&&(l=0===j?a.offsetWidth-S.width:a.offsetHeight-S.height,h[j]=k?parseFloat(p)/100*l+"px":parseFloat(p)/l*100+"%");p=h.join(" ")}return this.parseComplex(a.style,p,r,e,g)},formatter:ia}),za("backgroundSize",{defaultValue:"0 0",formatter:function(a){return a+="",ia(-1===a.indexOf(" ")?a+" "+a:a)}}),za("perspective",{defaultValue:"0px",prefix:!0}),za("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),za("transformStyle",{prefix:!0}),za("backfaceVisibility",{prefix:!0}),za("userSelect",{prefix:!0}),za("margin",{parser:sa("marginTop,marginRight,marginBottom,marginLeft")}),za("padding",{parser:sa("paddingTop,paddingRight,paddingBottom,paddingLeft")}),za("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(a,b,c,d,e,g){var h,i,j;return q<9?(i=a.currentStyle,j=q<8?" ":",",h="rect("+i.clipTop+j+i.clipRight+j+i.clipBottom+j+i.clipLeft+")",b=this.format(b).split(",").join(j)):(h=this.format(aa(a,this.p,f,!1,this.dflt)),b=this.format(b)),this.parseComplex(a.style,h,b,e,g)}}),za("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),za("autoRound,strictUnits",{parser:function(a,b,c,d,e){return e}}),za("border",{defaultValue:"0px solid #000",parser:function(a,b,c,d,e,g){var h=aa(a,"borderTopWidth",f,!1,"0px"),i=this.format(b).split(" "),j=i[0].replace(x,"");return"px"!==j&&(h=parseFloat(h)/ba(a,"borderTopWidth",1,j)+j),this.parseComplex(a.style,this.format(h+" "+aa(a,"borderTopStyle",f,!1,"solid")+" "+aa(a,"borderTopColor",f,!1,"#000")),i.join(" "),e,g)},color:!0,formatter:function(a){var b=a.split(" ");return b[0]+" "+(b[1]||"solid")+" "+(a.match(qa)||["#000"])[0]}}),za("borderWidth",{parser:sa("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),za("float,cssFloat,styleFloat",{parser:function(a,b,c,d,e,f){var g=a.style,h="cssFloat"in g?"cssFloat":"styleFloat";return new ua(g,h,0,0,e,-1,c,!1,0,g[h],b)}});var Va=function(a){var b,c=this.t,d=c.filter||aa(this.data,"filter")||"",e=this.s+this.c*a|0;100===e&&(-1===d.indexOf("atrix(")&&-1===d.indexOf("radient(")&&-1===d.indexOf("oader(")?(c.removeAttribute("filter"),b=!aa(this.data,"filter")):(c.filter=d.replace(A,""),b=!0)),b||(this.xn1&&(c.filter=d=d||"alpha(opacity="+e+")"),-1===d.indexOf("pacity")?0===e&&this.xn1||(c.filter=d+" alpha(opacity="+e+")"):c.filter=d.replace(y,"opacity="+e))};za("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(a,b,c,d,e,g){var h=parseFloat(aa(a,"opacity",f,!1,"1")),i=a.style,j="autoAlpha"===c;return"string"==typeof b&&"="===b.charAt(1)&&(b=("-"===b.charAt(0)?-1:1)*parseFloat(b.substr(2))+h),j&&1===h&&"hidden"===aa(a,"visibility",f)&&0!==b&&(h=0),V?e=new ua(i,"opacity",h,b-h,e):(e=new ua(i,"opacity",100*h,100*(b-h),e),e.xn1=j?1:0,i.zoom=1,e.type=2,e.b="alpha(opacity="+e.s+")",e.e="alpha(opacity="+(e.s+e.c)+")",e.data=a,e.plugin=g,e.setRatio=Va),j&&(e=new ua(i,"visibility",0,0,e,-1,null,!1,0,0!==h?"inherit":"hidden",0===b?"hidden":"inherit"),e.xs0="inherit",d._overwriteProps.push(e.n),d._overwriteProps.push(c)),e}});var Wa=function(a,b){b&&(a.removeProperty?("ms"!==b.substr(0,2)&&"webkit"!==b.substr(0,6)||(b="-"+b),a.removeProperty(b.replace(C,"-$1").toLowerCase())):a.removeAttribute(b))},Xa=function(a){if(this.t._gsClassPT=this,1===a||0===a){this.t.setAttribute("class",0===a?this.b:this.e);for(var b=this.data,c=this.t.style;b;)b.v?c[b.p]=b.v:Wa(c,b.p),b=b._next;1===a&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};za("className",{parser:function(a,b,c,e,g,h,i){var j,k,l,m,n,o=a.getAttribute("class")||"",p=a.style.cssText;if(g=e._classNamePT=new ua(a,c,0,0,g,2),g.setRatio=Xa,g.pr=-11,d=!0,g.b=o,k=da(a,f),l=a._gsClassPT){for(m={},n=l.data;n;)m[n.p]=1,n=n._next;l.setRatio(1)}return a._gsClassPT=g,g.e="="!==b.charAt(1)?b:o.replace(new RegExp("(?:\\s|^)"+b.substr(2)+"(?![\\w-])"),"")+("+"===b.charAt(0)?" "+b.substr(2):""),a.setAttribute("class",g.e),j=ea(a,k,da(a),i,m),a.setAttribute("class",o),g.data=j.firstMPT,a.style.cssText=p,g=g.xfirst=e.parse(a,j.difs,g,h)}});var Ya=function(a){if((1===a||0===a)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var b,c,d,e,f,g=this.t.style,h=j.transform.parse;if("all"===this.e)g.cssText="",e=!0;else for(b=this.e.split(" ").join("").split(","),d=b.length;--d>-1;)c=b[d],j[c]&&(j[c].parse===h?e=!0:c="transformOrigin"===c?Fa:j[c].p),Wa(g,c);e&&(Wa(g,Da),(f=this.t._gsTransform)&&(f.svg&&(this.t.removeAttribute("data-svg-origin"),this.t.removeAttribute("transform")),delete this.t._gsTransform))}};for(za("clearProps",{parser:function(a,b,c,e,f){return f=new ua(a,c,0,0,f,2),f.setRatio=Ya,f.e=b,f.pr=-10,f.data=e._tween,d=!0,f}}),k="bezier,throwProps,physicsProps,physics2D".split(","),xa=k.length;xa--;)Aa(k[xa]);k=h.prototype,k._firstPT=k._lastParsedTransform=k._transform=null,k._onInitTween=function(a,b,c,i){if(!a.nodeType)return!1;this._target=r=a,this._tween=c,this._vars=b,s=i,l=b.autoRound,d=!1,e=b.suffixMap||h.suffixMap,f=_(a,""),g=this._overwriteProps;var k,o,q,t,u,v,w,x,y,A=a.style;if(m&&""===A.zIndex&&("auto"!==(k=aa(a,"zIndex",f))&&""!==k||this._addLazySet(A,"zIndex",0)),"string"==typeof b&&(t=A.cssText,k=da(a,f),A.cssText=t+";"+b,k=ea(a,k,da(a)).difs,!V&&z.test(b)&&(k.opacity=parseFloat(RegExp.$1)),b=k,A.cssText=t),b.className?this._firstPT=o=j.className.parse(a,b.className,"className",this,null,null,b):this._firstPT=o=this.parse(a,b,null),this._transformType){for(y=3===this._transformType,Da?n&&(m=!0,""===A.zIndex&&("auto"!==(w=aa(a,"zIndex",f))&&""!==w||this._addLazySet(A,"zIndex",0)),p&&this._addLazySet(A,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(y?"visible":"hidden"))):A.zoom=1,q=o;q&&q._next;)q=q._next;x=new ua(a,"transform",0,0,null,2),this._linkCSSP(x,null,q),x.setRatio=Da?Ua:Ta,x.data=this._transform||Sa(a,f,!0),x.tween=c,x.pr=-1,g.pop()}if(d){for(;o;){for(v=o._next,q=t;q&&q.pr>o.pr;)q=q._next;(o._prev=q?q._prev:u)?o._prev._next=o:t=o,(o._next=q)?q._prev=o:u=o,o=v}this._firstPT=t}return!0},k.parse=function(a,b,c,d){var g,h,i,k,m,n,o,p,q,t,u=a.style;for(g in b){if(n=b[g],"function"==typeof n&&(n=n(s,r)),h=j[g])c=h.parse(a,n,g,this,c,d,b);else{if("--"===g.substr(0,2)){this._tween._propLookup[g]=this._addTween.call(this._tween,a.style,"setProperty",_(a).getPropertyValue(g)+"",n+"",g,!1,g);continue}m=aa(a,g,f)+"",q="string"==typeof n,"color"===g||"fill"===g||"stroke"===g||-1!==g.indexOf("Color")||q&&B.test(n)?(q||(n=oa(n),n=(n.length>3?"rgba(":"rgb(")+n.join(",")+")"),c=wa(u,g,m,n,!0,"transparent",c,0,d)):q&&K.test(n)?c=wa(u,g,m,n,!0,null,c,0,d):(i=parseFloat(m),o=i||0===i?m.substr((i+"").length):"",""!==m&&"auto"!==m||("width"===g||"height"===g?(i=ha(a,g,f),o="px"):"left"===g||"top"===g?(i=ca(a,g,f),o="px"):(i="opacity"!==g?0:1,o="")),t=q&&"="===n.charAt(1),t?(k=parseInt(n.charAt(0)+"1",10),n=n.substr(2),k*=parseFloat(n),p=n.replace(x,"")):(k=parseFloat(n),p=q?n.replace(x,""):""),""===p&&(p=g in e?e[g]:o),n=k||0===k?(t?k+i:k)+p:b[g],o!==p&&(""===p&&"lineHeight"!==g||(k||0===k)&&i&&(i=ba(a,g,i,o),"%"===p?(i/=ba(a,g,100,"%")/100,!0!==b.strictUnits&&(m=i+"%")):"em"===p||"rem"===p||"vw"===p||"vh"===p?i/=ba(a,g,1,p):"px"!==p&&(k=ba(a,g,k,p),p="px"),t&&(k||0===k)&&(n=k+i+p))),t&&(k+=i),!i&&0!==i||!k&&0!==k?void 0!==u[g]&&(n||n+""!="NaN"&&null!=n)?(c=new ua(u,g,k||i||0,0,c,-1,g,!1,0,m,n),c.xs0="none"!==n||"display"!==g&&-1===g.indexOf("Style")?n:m):X("invalid "+g+" tween value: "+b[g]):(c=new ua(u,g,i,k-i,c,0,g,!1!==l&&("px"===p||"zIndex"===g),0,m,n),c.xs0=p))}d&&c&&!c.plugin&&(c.plugin=d)}return c},k.setRatio=function(a){var b,c,d,e=this._firstPT;if(1!==a||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(a||this._tween._time!==this._tween._duration&&0!==this._tween._time||-1e-6===this._tween._rawPrevTime)for(;e;){if(b=e.c*a+e.s,e.r?b=Math.round(b):b<1e-6&&b>-1e-6&&(b=0),e.type)if(1===e.type)if(2===(d=e.l))e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2;else if(3===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3;else if(4===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3+e.xn3+e.xs4;else if(5===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3+e.xn3+e.xs4+e.xn4+e.xs5;else{for(c=e.xs0+b+e.xs1,d=1;d<e.l;d++)c+=e["xn"+d]+e["xs"+(d+1)];e.t[e.p]=c}else-1===e.type?e.t[e.p]=e.xs0:e.setRatio&&e.setRatio(a);else e.t[e.p]=b+e.xs0;e=e._next}else for(;e;)2!==e.type?e.t[e.p]=e.b:e.setRatio(a),e=e._next;else for(;e;){if(2!==e.type)if(e.r&&-1!==e.type)if(b=Math.round(e.s+e.c),e.type){if(1===e.type){for(d=e.l,c=e.xs0+b+e.xs1,d=1;d<e.l;d++)c+=e["xn"+d]+e["xs"+(d+1)];e.t[e.p]=c}}else e.t[e.p]=b+e.xs0;else e.t[e.p]=e.e;else e.setRatio(a);e=e._next}},k._enableTransforms=function(a){this._transform=this._transform||Sa(this._target,f,!0),this._transformType=this._transform.svg&&Ba||!a&&3!==this._transformType?2:3};var Za=function(a){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};k._addLazySet=function(a,b,c){var d=this._firstPT=new ua(a,b,0,0,this._firstPT,2);d.e=c,d.setRatio=Za,d.data=this},k._linkCSSP=function(a,b,c,d){return a&&(b&&(b._prev=a),a._next&&(a._next._prev=a._prev),a._prev?a._prev._next=a._next:this._firstPT===a&&(this._firstPT=a._next,d=!0),c?c._next=a:d||null!==this._firstPT||(this._firstPT=a),a._next=b,a._prev=c),a},k._mod=function(a){for(var b=this._firstPT;b;)"function"==typeof a[b.p]&&a[b.p]===Math.round&&(b.r=1),b=b._next},k._kill=function(b){var c,d,e,f=b;if(b.autoAlpha||b.alpha){f={};for(d in b)f[d]=b[d];f.opacity=1,f.autoAlpha&&(f.visibility=1)}for(b.className&&(c=this._classNamePT)&&(e=c.xfirst,e&&e._prev?this._linkCSSP(e._prev,c._next,e._prev._prev):e===this._firstPT&&(this._firstPT=c._next),c._next&&this._linkCSSP(c._next,c._next._next,e._prev),this._classNamePT=null),c=this._firstPT;c;)c.plugin&&c.plugin!==d&&c.plugin._kill&&(c.plugin._kill(b),d=c.plugin),c=c._next;return a.prototype._kill.call(this,f)};var $a=function(a,b,c){var d,e,f,g;if(a.slice)for(e=a.length;--e>-1;)$a(a[e],b,c);else for(d=a.childNodes,e=d.length;--e>-1;)f=d[e],g=f.type,f.style&&(b.push(da(f)),c&&c.push(f)),1!==g&&9!==g&&11!==g||!f.childNodes.length||$a(f,b,c)};return h.cascadeTo=function(a,c,d){var e,f,g,h,i=b.to(a,c,d),j=[i],k=[],l=[],m=[],n=b._internals.reservedProps;for(a=i._targets||i.target,$a(a,k,m),i.render(c,!0,!0),$a(a,l),i.render(0,!0,!0),i._enabled(!0),e=m.length;--e>-1;)if(f=ea(m[e],k[e],l[e]),f.firstMPT){f=f.difs;for(g in d)n[g]&&(f[g]=d[g]);h={};for(g in f)h[g]=k[e][g];j.push(b.fromTo(m[e],c,h,f))}return j},a.activate([h]),h},!0),function(){var a=c._gsDefine.plugin({propName:"roundProps",version:"1.6.0",priority:-1,API:2,init:function(a,b,c){return this._tween=c,!0}}),b=function(a){for(;a;)a.f||a.blob||(a.m=Math.round),a=a._next},d=a.prototype;d._onInitAllProps=function(){for(var a,c,d,e=this._tween,f=e.vars.roundProps.join?e.vars.roundProps:e.vars.roundProps.split(","),g=f.length,h={},i=e._propLookup.roundProps;--g>-1;)h[f[g]]=Math.round;for(g=f.length;--g>-1;)for(a=f[g],c=e._firstPT;c;)d=c._next,c.pg?c.t._mod(h):c.n===a&&(2===c.f&&c.t?b(c.t._firstPT):(this._add(c.t,a,c.s,c.c),d&&(d._prev=c._prev),c._prev?c._prev._next=d:e._firstPT===c&&(e._firstPT=d),c._next=c._prev=null,e._propLookup[a]=i)),c=d;return!1},d._add=function(a,b,c,d){this._addTween(a,b,c,c+d,b,Math.round),this._overwriteProps.push(b)}}(),function(){c._gsDefine.plugin({propName:"attr",API:2,version:"0.6.1",init:function(a,b,c,d){var e,f;if("function"!=typeof a.setAttribute)return!1;for(e in b)f=b[e],"function"==typeof f&&(f=f(d,a)),this._addTween(a,"setAttribute",a.getAttribute(e)+"",f+"",e,!1,e),this._overwriteProps.push(e);return!0}})}(),c._gsDefine.plugin({propName:"directionalRotation",version:"0.3.1",API:2,init:function(a,b,c,d){"object"!=typeof b&&(b={rotation:b}),this.finals={};var e,f,g,h,i,j,k=!0===b.useRadians?2*Math.PI:360;for(e in b)"useRadians"!==e&&(h=b[e],"function"==typeof h&&(h=h(d,a)),j=(h+"").split("_"),f=j[0],g=parseFloat("function"!=typeof a[e]?a[e]:a[e.indexOf("set")||"function"!=typeof a["get"+e.substr(3)]?e:"get"+e.substr(3)]()),h=this.finals[e]="string"==typeof f&&"="===f.charAt(1)?g+parseInt(f.charAt(0)+"1",10)*Number(f.substr(2)):Number(f)||0,i=h-g,j.length&&(f=j.join("_"),-1!==f.indexOf("short")&&(i%=k)!==i%(k/2)&&(i=i<0?i+k:i-k),-1!==f.indexOf("_cw")&&i<0?i=(i+9999999999*k)%k-(i/k|0)*k:-1!==f.indexOf("ccw")&&i>0&&(i=(i-9999999999*k)%k-(i/k|0)*k)),(i>1e-6||i<-1e-6)&&(this._addTween(a,e,g,g+i,e),this._overwriteProps.push(e)));return!0},set:function(a){var b;if(1!==a)this._super.setRatio.call(this,a);else for(b=this._firstPT;b;)b.f?b.t[b.p](this.finals[b.p]):b.t[b.p]=this.finals[b.p],b=b._next}})._autoCSS=!0,c._gsDefine("easing.Back",["easing.Ease"],function(a){var b,d,e,f=c.GreenSockGlobals||c,g=f.com.greensock,h=2*Math.PI,i=Math.PI/2,j=g._class,k=function(b,c){var d=j("easing."+b,function(){},!0),e=d.prototype=new a;return e.constructor=d,e.getRatio=c,d},l=a.register||function(){},m=function(a,b,c,d,e){var f=j("easing."+a,{easeOut:new b,easeIn:new c,easeInOut:new d},!0);return l(f,a),f},n=function(a,b,c){this.t=a,this.v=b,c&&(this.next=c,c.prev=this,this.c=c.v-b,this.gap=c.t-a)},o=function(b,c){var d=j("easing."+b,function(a){this._p1=a||0===a?a:1.70158,this._p2=1.525*this._p1},!0),e=d.prototype=new a;return e.constructor=d,e.getRatio=c,e.config=function(a){return new d(a)},d},p=m("Back",o("BackOut",function(a){return(a-=1)*a*((this._p1+1)*a+this._p1)+1}),o("BackIn",function(a){return a*a*((this._p1+1)*a-this._p1)}),o("BackInOut",function(a){return(a*=2)<1?.5*a*a*((this._p2+1)*a-this._p2):.5*((a-=2)*a*((this._p2+1)*a+this._p2)+2)})),q=j("easing.SlowMo",function(a,b,c){b=b||0===b?b:.7,null==a?a=.7:a>1&&(a=1),this._p=1!==a?b:0,this._p1=(1-a)/2,this._p2=a,this._p3=this._p1+this._p2,this._calcEnd=!0===c},!0),r=q.prototype=new a;return r.constructor=q,r.getRatio=function(a){var b=a+(.5-a)*this._p;return a<this._p1?this._calcEnd?1-(a=1-a/this._p1)*a:b-(a=1-a/this._p1)*a*a*a*b:a>this._p3?this._calcEnd?1===a?0:1-(a=(a-this._p3)/this._p1)*a:b+(a-b)*(a=(a-this._p3)/this._p1)*a*a*a:this._calcEnd?1:b},q.ease=new q(.7,.7),r.config=q.config=function(a,b,c){return new q(a,b,c)},b=j("easing.SteppedEase",function(a,b){a=a||1,this._p1=1/a,this._p2=a+(b?0:1),this._p3=b?1:0},!0),r=b.prototype=new a,r.constructor=b,r.getRatio=function(a){return a<0?a=0:a>=1&&(a=.999999999),((this._p2*a|0)+this._p3)*this._p1},r.config=b.config=function(a,c){return new b(a,c)},d=j("easing.RoughEase",function(b){b=b||{};for(var c,d,e,f,g,h,i=b.taper||"none",j=[],k=0,l=0|(b.points||20),m=l,o=!1!==b.randomize,p=!0===b.clamp,q=b.template instanceof a?b.template:null,r="number"==typeof b.strength?.4*b.strength:.4;--m>-1;)c=o?Math.random():1/l*m,d=q?q.getRatio(c):c,"none"===i?e=r:"out"===i?(f=1-c,e=f*f*r):"in"===i?e=c*c*r:c<.5?(f=2*c,e=f*f*.5*r):(f=2*(1-c),e=f*f*.5*r),o?d+=Math.random()*e-.5*e:m%2?d+=.5*e:d-=.5*e,p&&(d>1?d=1:d<0&&(d=0)),j[k++]={x:c,y:d};for(j.sort(function(a,b){return a.x-b.x}),h=new n(1,1,null),m=l;--m>-1;)g=j[m],h=new n(g.x,g.y,h);this._prev=new n(0,0,0!==h.t?h:h.next)},!0),r=d.prototype=new a,r.constructor=d,r.getRatio=function(a){var b=this._prev;if(a>b.t){for(;b.next&&a>=b.t;)b=b.next;b=b.prev}else for(;b.prev&&a<=b.t;)b=b.prev;return this._prev=b,b.v+(a-b.t)/b.gap*b.c},r.config=function(a){return new d(a)},d.ease=new d,m("Bounce",k("BounceOut",function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}),k("BounceIn",function(a){return(a=1-a)<1/2.75?1-7.5625*a*a:a<2/2.75?1-(7.5625*(a-=1.5/2.75)*a+.75):a<2.5/2.75?1-(7.5625*(a-=2.25/2.75)*a+.9375):1-(7.5625*(a-=2.625/2.75)*a+.984375)}),k("BounceInOut",function(a){var b=a<.5;return a=b?1-2*a:2*a-1,a<1/2.75?a*=7.5625*a:a=a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375,
b?.5*(1-a):.5*a+.5})),m("Circ",k("CircOut",function(a){return Math.sqrt(1-(a-=1)*a)}),k("CircIn",function(a){return-(Math.sqrt(1-a*a)-1)}),k("CircInOut",function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)})),e=function(b,c,d){var e=j("easing."+b,function(a,b){this._p1=a>=1?a:1,this._p2=(b||d)/(a<1?a:1),this._p3=this._p2/h*(Math.asin(1/this._p1)||0),this._p2=h/this._p2},!0),f=e.prototype=new a;return f.constructor=e,f.getRatio=c,f.config=function(a,b){return new e(a,b)},e},m("Elastic",e("ElasticOut",function(a){return this._p1*Math.pow(2,-10*a)*Math.sin((a-this._p3)*this._p2)+1},.3),e("ElasticIn",function(a){return-this._p1*Math.pow(2,10*(a-=1))*Math.sin((a-this._p3)*this._p2)},.3),e("ElasticInOut",function(a){return(a*=2)<1?this._p1*Math.pow(2,10*(a-=1))*Math.sin((a-this._p3)*this._p2)*-.5:this._p1*Math.pow(2,-10*(a-=1))*Math.sin((a-this._p3)*this._p2)*.5+1},.45)),m("Expo",k("ExpoOut",function(a){return 1-Math.pow(2,-10*a)}),k("ExpoIn",function(a){return Math.pow(2,10*(a-1))-.001}),k("ExpoInOut",function(a){return(a*=2)<1?.5*Math.pow(2,10*(a-1)):.5*(2-Math.pow(2,-10*(a-1)))})),m("Sine",k("SineOut",function(a){return Math.sin(a*i)}),k("SineIn",function(a){return 1-Math.cos(a*i)}),k("SineInOut",function(a){return-.5*(Math.cos(Math.PI*a)-1)})),j("easing.EaseLookup",{find:function(b){return a.map[b]}},!0),l(f.SlowMo,"SlowMo","ease,"),l(d,"RoughEase","ease,"),l(b,"SteppedEase","ease,"),p},!0)}),c._gsDefine&&c._gsQueue.pop()(),function(a,c){"use strict";var d={},e=a.document,f=a.GreenSockGlobals=a.GreenSockGlobals||a;if(!f.TweenLite){var g,h,i,j,k,l=function(a){var b,c=a.split("."),d=f;for(b=0;b<c.length;b++)d[c[b]]=d=d[c[b]]||{};return d},m=l("com.greensock"),n=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},o=function(){},p=function(){var a=Object.prototype.toString,b=a.call([]);return function(c){return null!=c&&(c instanceof Array||"object"==typeof c&&!!c.push&&a.call(c)===b)}}(),q={},r=function(c,e,g,h){this.sc=q[c]?q[c].sc:[],q[c]=this,this.gsClass=null,this.func=g;var i=[];this.check=function(j){for(var k,m,n,o,p=e.length,s=p;--p>-1;)(k=q[e[p]]||new r(e[p],[])).gsClass?(i[p]=k.gsClass,s--):j&&k.sc.push(this);if(0===s&&g){if(m=("com.greensock."+c).split("."),n=m.pop(),o=l(m.join("."))[n]=this.gsClass=g.apply(g,i),h)if(f[n]=d[n]=o,void 0!==b&&b.exports)if("TweenMax"===c){b.exports=d.TweenMax=o;for(p in d)o[p]=d[p]}else d.TweenMax&&(d.TweenMax[n]=o);else"function"==typeof define&&define.amd&&define((a.GreenSockAMDPath?a.GreenSockAMDPath+"/":"")+c.split(".").pop(),[],function(){return o});for(p=0;p<this.sc.length;p++)this.sc[p].check()}},this.check(!0)},s=a._gsDefine=function(a,b,c,d){return new r(a,b,c,d)},t=m._class=function(a,b,c){return b=b||function(){},s(a,[],function(){return b},c),b};s.globals=f;var u=[0,0,1,1],v=t("easing.Ease",function(a,b,c,d){this._func=a,this._type=c||0,this._power=d||0,this._params=b?u.concat(b):u},!0),w=v.map={},x=v.register=function(a,b,c,d){for(var e,f,g,h,i=b.split(","),j=i.length,k=(c||"easeIn,easeOut,easeInOut").split(",");--j>-1;)for(f=i[j],e=d?t("easing."+f,null,!0):m.easing[f]||{},g=k.length;--g>-1;)h=k[g],w[f+"."+h]=w[h+f]=e[h]=a.getRatio?a:a[h]||new a};for(i=v.prototype,i._calcEnd=!1,i.getRatio=function(a){if(this._func)return this._params[0]=a,this._func.apply(null,this._params);var b=this._type,c=this._power,d=1===b?1-a:2===b?a:a<.5?2*a:2*(1-a);return 1===c?d*=d:2===c?d*=d*d:3===c?d*=d*d*d:4===c&&(d*=d*d*d*d),1===b?1-d:2===b?d:a<.5?d/2:1-d/2},g=["Linear","Quad","Cubic","Quart","Quint,Strong"],h=g.length;--h>-1;)i=g[h]+",Power"+h,x(new v(null,null,1,h),i,"easeOut",!0),x(new v(null,null,2,h),i,"easeIn"+(0===h?",easeNone":"")),x(new v(null,null,3,h),i,"easeInOut");w.linear=m.easing.Linear.easeIn,w.swing=m.easing.Quad.easeInOut;var y=t("events.EventDispatcher",function(a){this._listeners={},this._eventTarget=a||this});i=y.prototype,i.addEventListener=function(a,b,c,d,e){e=e||0;var f,g,h=this._listeners[a],i=0;for(this!==j||k||j.wake(),null==h&&(this._listeners[a]=h=[]),g=h.length;--g>-1;)f=h[g],f.c===b&&f.s===c?h.splice(g,1):0===i&&f.pr<e&&(i=g+1);h.splice(i,0,{c:b,s:c,up:d,pr:e})},i.removeEventListener=function(a,b){var c,d=this._listeners[a];if(d)for(c=d.length;--c>-1;)if(d[c].c===b)return void d.splice(c,1)},i.dispatchEvent=function(a){var b,c,d,e=this._listeners[a];if(e)for(b=e.length,b>1&&(e=e.slice(0)),c=this._eventTarget;--b>-1;)(d=e[b])&&(d.up?d.c.call(d.s||c,{type:a,target:c}):d.c.call(d.s||c))};var z=a.requestAnimationFrame,A=a.cancelAnimationFrame,B=Date.now||function(){return(new Date).getTime()},C=B();for(g=["ms","moz","webkit","o"],h=g.length;--h>-1&&!z;)z=a[g[h]+"RequestAnimationFrame"],A=a[g[h]+"CancelAnimationFrame"]||a[g[h]+"CancelRequestAnimationFrame"];t("Ticker",function(a,b){var c,d,f,g,h,i=this,l=B(),m=!(!1===b||!z)&&"auto",n=500,p=33,q=function(a){var b,e,j=B()-C;j>n&&(l+=j-p),C+=j,i.time=(C-l)/1e3,b=i.time-h,(!c||b>0||!0===a)&&(i.frame++,h+=b+(b>=g?.004:g-b),e=!0),!0!==a&&(f=d(q)),e&&i.dispatchEvent("tick")};y.call(i),i.time=i.frame=0,i.tick=function(){q(!0)},i.lagSmoothing=function(a,b){if(!arguments.length)return n<1e10;n=a||1e10,p=Math.min(b,n,0)},i.sleep=function(){null!=f&&(m&&A?A(f):clearTimeout(f),d=o,f=null,i===j&&(k=!1))},i.wake=function(a){null!==f?i.sleep():a?l+=-C+(C=B()):i.frame>10&&(C=B()-n+5),d=0===c?o:m&&z?z:function(a){return setTimeout(a,1e3*(h-i.time)+1|0)},i===j&&(k=!0),q(2)},i.fps=function(a){if(!arguments.length)return c;c=a,g=1/(c||60),h=this.time+g,i.wake()},i.useRAF=function(a){if(!arguments.length)return m;i.sleep(),m=a,i.fps(c)},i.fps(a),setTimeout(function(){"auto"===m&&i.frame<5&&"hidden"!==e.visibilityState&&i.useRAF(!1)},1500)}),i=m.Ticker.prototype=new m.events.EventDispatcher,i.constructor=m.Ticker;var D=t("core.Animation",function(a,b){if(this.vars=b=b||{},this._duration=this._totalDuration=a||0,this._delay=Number(b.delay)||0,this._timeScale=1,this._active=!0===b.immediateRender,this.data=b.data,this._reversed=!0===b.reversed,X){k||j.wake();var c=this.vars.useFrames?W:X;c.add(this,c._time),this.vars.paused&&this.paused(!0)}});j=D.ticker=new m.Ticker,i=D.prototype,i._dirty=i._gc=i._initted=i._paused=!1,i._totalTime=i._time=0,i._rawPrevTime=-1,i._next=i._last=i._onUpdate=i._timeline=i.timeline=null,i._paused=!1;var E=function(){k&&B()-C>2e3&&("hidden"!==e.visibilityState||!j.lagSmoothing())&&j.wake();var a=setTimeout(E,2e3);a.unref&&a.unref()};E(),i.play=function(a,b){return null!=a&&this.seek(a,b),this.reversed(!1).paused(!1)},i.pause=function(a,b){return null!=a&&this.seek(a,b),this.paused(!0)},i.resume=function(a,b){return null!=a&&this.seek(a,b),this.paused(!1)},i.seek=function(a,b){return this.totalTime(Number(a),!1!==b)},i.restart=function(a,b){return this.reversed(!1).paused(!1).totalTime(a?-this._delay:0,!1!==b,!0)},i.reverse=function(a,b){return null!=a&&this.seek(a||this.totalDuration(),b),this.reversed(!0).paused(!1)},i.render=function(a,b,c){},i.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,!this._gc&&this.timeline||this._enabled(!0),this},i.isActive=function(){var a,b=this._timeline,c=this._startTime;return!b||!this._gc&&!this._paused&&b.isActive()&&(a=b.rawTime(!0))>=c&&a<c+this.totalDuration()/this._timeScale-1e-7},i._enabled=function(a,b){return k||j.wake(),this._gc=!a,this._active=this.isActive(),!0!==b&&(a&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!a&&this.timeline&&this._timeline._remove(this,!0)),!1},i._kill=function(a,b){return this._enabled(!1,!1)},i.kill=function(a,b){return this._kill(a,b),this},i._uncache=function(a){for(var b=a?this:this.timeline;b;)b._dirty=!0,b=b.timeline;return this},i._swapSelfInParams=function(a){for(var b=a.length,c=a.concat();--b>-1;)"{self}"===a[b]&&(c[b]=this);return c},i._callback=function(a){var b=this.vars,c=b[a],d=b[a+"Params"],e=b[a+"Scope"]||b.callbackScope||this;switch(d?d.length:0){case 0:c.call(e);break;case 1:c.call(e,d[0]);break;case 2:c.call(e,d[0],d[1]);break;default:c.apply(e,d)}},i.eventCallback=function(a,b,c,d){if("on"===(a||"").substr(0,2)){var e=this.vars;if(1===arguments.length)return e[a];null==b?delete e[a]:(e[a]=b,e[a+"Params"]=p(c)&&-1!==c.join("").indexOf("{self}")?this._swapSelfInParams(c):c,e[a+"Scope"]=d),"onUpdate"===a&&(this._onUpdate=b)}return this},i.delay=function(a){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+a-this._delay),this._delay=a,this):this._delay},i.duration=function(a){return arguments.length?(this._duration=this._totalDuration=a,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==a&&this.totalTime(this._totalTime*(a/this._duration),!0),this):(this._dirty=!1,this._duration)},i.totalDuration=function(a){return this._dirty=!1,arguments.length?this.duration(a):this._totalDuration},i.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(a>this._duration?this._duration:a,b)):this._time},i.totalTime=function(a,b,c){if(k||j.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(a<0&&!c&&(a+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var d=this._totalDuration,e=this._timeline;if(a>d&&!c&&(a=d),this._startTime=(this._paused?this._pauseTime:e._time)-(this._reversed?d-a:a)/this._timeScale,e._dirty||this._uncache(!1),e._timeline)for(;e._timeline;)e._timeline._time!==(e._startTime+e._totalTime)/e._timeScale&&e.totalTime(e._totalTime,!0),e=e._timeline}this._gc&&this._enabled(!0,!1),this._totalTime===a&&0!==this._duration||(J.length&&Z(),this.render(a,b,!1),J.length&&Z())}return this},i.progress=i.totalProgress=function(a,b){var c=this.duration();return arguments.length?this.totalTime(c*a,b):c?this._time/c:this.ratio},i.startTime=function(a){return arguments.length?(a!==this._startTime&&(this._startTime=a,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,a-this._delay)),this):this._startTime},i.endTime=function(a){return this._startTime+(0!=a?this.totalDuration():this.duration())/this._timeScale},i.timeScale=function(a){if(!arguments.length)return this._timeScale;var b,c;for(a=a||1e-10,this._timeline&&this._timeline.smoothChildTiming&&(b=this._pauseTime,c=b||0===b?b:this._timeline.totalTime(),this._startTime=c-(c-this._startTime)*this._timeScale/a),this._timeScale=a,c=this.timeline;c&&c.timeline;)c._dirty=!0,c.totalDuration(),c=c.timeline;return this},i.reversed=function(a){return arguments.length?(a!=this._reversed&&(this._reversed=a,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},i.paused=function(a){if(!arguments.length)return this._paused;var b,c,d=this._timeline;return a!=this._paused&&d&&(k||a||j.wake(),b=d.rawTime(),c=b-this._pauseTime,!a&&d.smoothChildTiming&&(this._startTime+=c,this._uncache(!1)),this._pauseTime=a?b:null,this._paused=a,this._active=this.isActive(),!a&&0!==c&&this._initted&&this.duration()&&(b=d.smoothChildTiming?this._totalTime:(b-this._startTime)/this._timeScale,this.render(b,b===this._totalTime,!0))),this._gc&&!a&&this._enabled(!0,!1),this};var F=t("core.SimpleTimeline",function(a){D.call(this,0,a),this.autoRemoveChildren=this.smoothChildTiming=!0});i=F.prototype=new D,i.constructor=F,i.kill()._gc=!1,i._first=i._last=i._recent=null,i._sortChildren=!1,i.add=i.insert=function(a,b,c,d){var e,f;if(a._startTime=Number(b||0)+a._delay,a._paused&&this!==a._timeline&&(a._pauseTime=a._startTime+(this.rawTime()-a._startTime)/a._timeScale),a.timeline&&a.timeline._remove(a,!0),a.timeline=a._timeline=this,a._gc&&a._enabled(!0,!0),e=this._last,this._sortChildren)for(f=a._startTime;e&&e._startTime>f;)e=e._prev;return e?(a._next=e._next,e._next=a):(a._next=this._first,this._first=a),a._next?a._next._prev=a:this._last=a,a._prev=e,this._recent=a,this._timeline&&this._uncache(!0),this},i._remove=function(a,b){return a.timeline===this&&(b||a._enabled(!1,!0),a._prev?a._prev._next=a._next:this._first===a&&(this._first=a._next),a._next?a._next._prev=a._prev:this._last===a&&(this._last=a._prev),a._next=a._prev=a.timeline=null,a===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},i.render=function(a,b,c){var d,e=this._first;for(this._totalTime=this._time=this._rawPrevTime=a;e;)d=e._next,(e._active||a>=e._startTime&&!e._paused&&!e._gc)&&(e._reversed?e.render((e._dirty?e.totalDuration():e._totalDuration)-(a-e._startTime)*e._timeScale,b,c):e.render((a-e._startTime)*e._timeScale,b,c)),e=d},i.rawTime=function(){return k||j.wake(),this._totalTime};var G=t("TweenLite",function(b,c,d){if(D.call(this,c,d),this.render=G.prototype.render,null==b)throw"Cannot tween a null target.";this.target=b="string"!=typeof b?b:G.selector(b)||b;var e,f,g,h=b.jquery||b.length&&b!==a&&b[0]&&(b[0]===a||b[0].nodeType&&b[0].style&&!b.nodeType),i=this.vars.overwrite;if(this._overwrite=i=null==i?V[G.defaultOverwrite]:"number"==typeof i?i>>0:V[i],(h||b instanceof Array||b.push&&p(b))&&"number"!=typeof b[0])for(this._targets=g=n(b),this._propLookup=[],this._siblings=[],e=0;e<g.length;e++)f=g[e],f?"string"!=typeof f?f.length&&f!==a&&f[0]&&(f[0]===a||f[0].nodeType&&f[0].style&&!f.nodeType)?(g.splice(e--,1),this._targets=g=g.concat(n(f))):(this._siblings[e]=$(f,this,!1),1===i&&this._siblings[e].length>1&&aa(f,this,null,1,this._siblings[e])):"string"==typeof(f=g[e--]=G.selector(f))&&g.splice(e+1,1):g.splice(e--,1);else this._propLookup={},this._siblings=$(b,this,!1),1===i&&this._siblings.length>1&&aa(b,this,null,1,this._siblings);(this.vars.immediateRender||0===c&&0===this._delay&&!1!==this.vars.immediateRender)&&(this._time=-1e-10,this.render(Math.min(0,-this._delay)))},!0),H=function(b){return b&&b.length&&b!==a&&b[0]&&(b[0]===a||b[0].nodeType&&b[0].style&&!b.nodeType)},I=function(a,b){var c,d={};for(c in a)U[c]||c in b&&"transform"!==c&&"x"!==c&&"y"!==c&&"width"!==c&&"height"!==c&&"className"!==c&&"border"!==c||!(!R[c]||R[c]&&R[c]._autoCSS)||(d[c]=a[c],delete a[c]);a.css=d};i=G.prototype=new D,i.constructor=G,i.kill()._gc=!1,i.ratio=0,i._firstPT=i._targets=i._overwrittenProps=i._startAt=null,i._notifyPluginsOfEnabled=i._lazy=!1,G.version="1.20.3",G.defaultEase=i._ease=new v(null,null,1,1),G.defaultOverwrite="auto",G.ticker=j,G.autoSleep=120,G.lagSmoothing=function(a,b){j.lagSmoothing(a,b)},G.selector=a.$||a.jQuery||function(b){var c=a.$||a.jQuery;return c?(G.selector=c,c(b)):void 0===e?b:e.querySelectorAll?e.querySelectorAll(b):e.getElementById("#"===b.charAt(0)?b.substr(1):b)};var J=[],K={},L=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,M=/[\+-]=-?[\.\d]/,N=function(a){for(var b,c=this._firstPT;c;)b=c.blob?1===a&&null!=this.end?this.end:a?this.join(""):this.start:c.c*a+c.s,c.m?b=c.m(b,this._target||c.t):b<1e-6&&b>-1e-6&&!c.blob&&(b=0),c.f?c.fp?c.t[c.p](c.fp,b):c.t[c.p](b):c.t[c.p]=b,c=c._next},O=function(a,b,c,d){var e,f,g,h,i,j,k,l=[],m=0,n="",o=0;for(l.start=a,l.end=b,a=l[0]=a+"",b=l[1]=b+"",c&&(c(l),a=l[0],b=l[1]),l.length=0,e=a.match(L)||[],f=b.match(L)||[],d&&(d._next=null,d.blob=1,l._firstPT=l._applyPT=d),i=f.length,h=0;h<i;h++)k=f[h],j=b.substr(m,b.indexOf(k,m)-m),n+=j||!h?j:",",m+=j.length,o?o=(o+1)%5:"rgba("===j.substr(-5)&&(o=1),k===e[h]||e.length<=h?n+=k:(n&&(l.push(n),n=""),g=parseFloat(e[h]),l.push(g),l._firstPT={_next:l._firstPT,t:l,p:l.length-1,s:g,c:("="===k.charAt(1)?parseInt(k.charAt(0)+"1",10)*parseFloat(k.substr(2)):parseFloat(k)-g)||0,f:0,m:o&&o<4?Math.round:0}),m+=k.length;return n+=b.substr(m),n&&l.push(n),l.setRatio=N,M.test(b)&&(l.end=null),l},P=function(a,b,c,d,e,f,g,h,i){"function"==typeof d&&(d=d(i||0,a));var j,k=typeof a[b],l="function"!==k?"":b.indexOf("set")||"function"!=typeof a["get"+b.substr(3)]?b:"get"+b.substr(3),m="get"!==c?c:l?g?a[l](g):a[l]():a[b],n="string"==typeof d&&"="===d.charAt(1),o={t:a,p:b,s:m,f:"function"===k,pg:0,n:e||b,m:f?"function"==typeof f?f:Math.round:0,pr:0,c:n?parseInt(d.charAt(0)+"1",10)*parseFloat(d.substr(2)):parseFloat(d)-m||0};if(("number"!=typeof m||"number"!=typeof d&&!n)&&(g||isNaN(m)||!n&&isNaN(d)||"boolean"==typeof m||"boolean"==typeof d?(o.fp=g,j=O(m,n?parseFloat(o.s)+o.c:d,h||G.defaultStringFilter,o),o={t:j,p:"setRatio",s:0,c:1,f:2,pg:0,n:e||b,pr:0,m:0}):(o.s=parseFloat(m),n||(o.c=parseFloat(d)-o.s||0))),o.c)return(o._next=this._firstPT)&&(o._next._prev=o),this._firstPT=o,o},Q=G._internals={isArray:p,isSelector:H,lazyTweens:J,blobDif:O},R=G._plugins={},S=Q.tweenLookup={},T=0,U=Q.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1,stringFilter:1,id:1,yoyoEase:1},V={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,true:1,false:0},W=D._rootFramesTimeline=new F,X=D._rootTimeline=new F,Y=30,Z=Q.lazyRender=function(){var a,b=J.length;for(K={};--b>-1;)(a=J[b])&&!1!==a._lazy&&(a.render(a._lazy[0],a._lazy[1],!0),a._lazy=!1);J.length=0};X._startTime=j.time,W._startTime=j.frame,X._active=W._active=!0,setTimeout(Z,1),D._updateRoot=G.render=function(){var a,b,c;if(J.length&&Z(),X.render((j.time-X._startTime)*X._timeScale,!1,!1),W.render((j.frame-W._startTime)*W._timeScale,!1,!1),J.length&&Z(),j.frame>=Y){Y=j.frame+(parseInt(G.autoSleep,10)||120);for(c in S){for(b=S[c].tweens,a=b.length;--a>-1;)b[a]._gc&&b.splice(a,1);0===b.length&&delete S[c]}if((!(c=X._first)||c._paused)&&G.autoSleep&&!W._first&&1===j._listeners.tick.length){for(;c&&c._paused;)c=c._next;c||j.sleep()}}},j.addEventListener("tick",D._updateRoot);var $=function(a,b,c){var d,e,f=a._gsTweenID;if(S[f||(a._gsTweenID=f="t"+T++)]||(S[f]={target:a,tweens:[]}),b&&(d=S[f].tweens,d[e=d.length]=b,c))for(;--e>-1;)d[e]===b&&d.splice(e,1);return S[f].tweens},_=function(a,b,c,d){var e,f,g=a.vars.onOverwrite;return g&&(e=g(a,b,c,d)),g=G.onOverwrite,g&&(f=g(a,b,c,d)),!1!==e&&!1!==f},aa=function(a,b,c,d,e){var f,g,h,i;if(1===d||d>=4){for(i=e.length,f=0;f<i;f++)if((h=e[f])!==b)h._gc||h._kill(null,a,b)&&(g=!0);else if(5===d)break;return g}var j,k=b._startTime+1e-10,l=[],m=0,n=0===b._duration;for(f=e.length;--f>-1;)(h=e[f])===b||h._gc||h._paused||(h._timeline!==b._timeline?(j=j||ba(b,0,n),0===ba(h,j,n)&&(l[m++]=h)):h._startTime<=k&&h._startTime+h.totalDuration()/h._timeScale>k&&((n||!h._initted)&&k-h._startTime<=2e-10||(l[m++]=h)));for(f=m;--f>-1;)if(h=l[f],2===d&&h._kill(c,a,b)&&(g=!0),2!==d||!h._firstPT&&h._initted){if(2!==d&&!_(h,b))continue;h._enabled(!1,!1)&&(g=!0)}return g},ba=function(a,b,c){for(var d=a._timeline,e=d._timeScale,f=a._startTime;d._timeline;){if(f+=d._startTime,e*=d._timeScale,d._paused)return-100;d=d._timeline}return f/=e,f>b?f-b:c&&f===b||!a._initted&&f-b<2e-10?1e-10:(f+=a.totalDuration()/a._timeScale/e)>b+1e-10?0:f-b-1e-10};i._init=function(){var a,b,c,d,e,f,g=this.vars,h=this._overwrittenProps,i=this._duration,j=!!g.immediateRender,k=g.ease;if(g.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),e={};for(d in g.startAt)e[d]=g.startAt[d];if(e.data="isStart",e.overwrite=!1,e.immediateRender=!0,e.lazy=j&&!1!==g.lazy,e.startAt=e.delay=null,e.onUpdate=g.onUpdate,e.onUpdateParams=g.onUpdateParams,e.onUpdateScope=g.onUpdateScope||g.callbackScope||this,this._startAt=G.to(this.target,0,e),j)if(this._time>0)this._startAt=null;else if(0!==i)return}else if(g.runBackwards&&0!==i)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(j=!1),c={};for(d in g)U[d]&&"autoCSS"!==d||(c[d]=g[d]);if(c.overwrite=0,c.data="isFromStart",c.lazy=j&&!1!==g.lazy,c.immediateRender=j,this._startAt=G.to(this.target,0,c),j){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=k=k?k instanceof v?k:"function"==typeof k?new v(k,g.easeParams):w[k]||G.defaultEase:G.defaultEase,g.easeParams instanceof Array&&k.config&&(this._ease=k.config.apply(k,g.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(f=this._targets.length,a=0;a<f;a++)this._initProps(this._targets[a],this._propLookup[a]={},this._siblings[a],h?h[a]:null,a)&&(b=!0);else b=this._initProps(this.target,this._propLookup,this._siblings,h,0);if(b&&G._onPluginEvent("_onInitAllProps",this),h&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),g.runBackwards)for(c=this._firstPT;c;)c.s+=c.c,c.c=-c.c,c=c._next;this._onUpdate=g.onUpdate,this._initted=!0},i._initProps=function(b,c,d,e,f){var g,h,i,j,k,l;if(null==b)return!1;K[b._gsTweenID]&&Z(),this.vars.css||b.style&&b!==a&&b.nodeType&&R.css&&!1!==this.vars.autoCSS&&I(this.vars,b);for(g in this.vars)if(l=this.vars[g],U[g])l&&(l instanceof Array||l.push&&p(l))&&-1!==l.join("").indexOf("{self}")&&(this.vars[g]=l=this._swapSelfInParams(l,this));else if(R[g]&&(j=new R[g])._onInitTween(b,this.vars[g],this,f)){for(this._firstPT=k={_next:this._firstPT,t:j,p:"setRatio",s:0,c:1,f:1,n:g,pg:1,pr:j._priority,m:0},h=j._overwriteProps.length;--h>-1;)c[j._overwriteProps[h]]=this._firstPT;(j._priority||j._onInitAllProps)&&(i=!0),(j._onDisable||j._onEnable)&&(this._notifyPluginsOfEnabled=!0),k._next&&(k._next._prev=k)}else c[g]=P.call(this,b,g,"get",l,g,0,null,this.vars.stringFilter,f);return e&&this._kill(e,b)?this._initProps(b,c,d,e,f):this._overwrite>1&&this._firstPT&&d.length>1&&aa(b,this,c,this._overwrite,d)?(this._kill(c,b),this._initProps(b,c,d,e,f)):(this._firstPT&&(!1!==this.vars.lazy&&this._duration||this.vars.lazy&&!this._duration)&&(K[b._gsTweenID]=!0),i)},i.render=function(a,b,c){var d,e,f,g,h=this._time,i=this._duration,j=this._rawPrevTime;if(a>=i-1e-7&&a>=0)this._totalTime=this._time=i,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(d=!0,e="onComplete",c=c||this._timeline.autoRemoveChildren),0===i&&(this._initted||!this.vars.lazy||c)&&(this._startTime===this._timeline._duration&&(a=0),(j<0||a<=0&&a>=-1e-7||1e-10===j&&"isPause"!==this.data)&&j!==a&&(c=!0,j>1e-10&&(e="onReverseComplete")),this._rawPrevTime=g=!b||a||j===a?a:1e-10);else if(a<1e-7)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==h||0===i&&j>0)&&(e="onReverseComplete",d=this._reversed),a<0&&(this._active=!1,0===i&&(this._initted||!this.vars.lazy||c)&&(j>=0&&(1e-10!==j||"isPause"!==this.data)&&(c=!0),this._rawPrevTime=g=!b||a||j===a?a:1e-10)),(!this._initted||this._startAt&&this._startAt.progress())&&(c=!0);else if(this._totalTime=this._time=a,this._easeType){var k=a/i,l=this._easeType,m=this._easePower;(1===l||3===l&&k>=.5)&&(k=1-k),3===l&&(k*=2),1===m?k*=k:2===m?k*=k*k:3===m?k*=k*k*k:4===m&&(k*=k*k*k*k),this.ratio=1===l?1-k:2===l?k:a/i<.5?k/2:1-k/2}else this.ratio=this._ease.getRatio(a/i);if(this._time!==h||c){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!c&&this._firstPT&&(!1!==this.vars.lazy&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=h,this._rawPrevTime=j,J.push(this),void(this._lazy=[a,b]);this._time&&!d?this.ratio=this._ease.getRatio(this._time/i):d&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(!1!==this._lazy&&(this._lazy=!1),this._active||!this._paused&&this._time!==h&&a>=0&&(this._active=!0),0===h&&(this._startAt&&(a>=0?this._startAt.render(a,!0,c):e||(e="_dummyGS")),this.vars.onStart&&(0===this._time&&0!==i||b||this._callback("onStart"))),f=this._firstPT;f;)f.f?f.t[f.p](f.c*this.ratio+f.s):f.t[f.p]=f.c*this.ratio+f.s,f=f._next;this._onUpdate&&(a<0&&this._startAt&&-1e-4!==a&&this._startAt.render(a,!0,c),b||(this._time!==h||d||c)&&this._callback("onUpdate")),e&&(this._gc&&!c||(a<0&&this._startAt&&!this._onUpdate&&-1e-4!==a&&this._startAt.render(a,!0,c),d&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[e]&&this._callback(e),0===i&&1e-10===this._rawPrevTime&&1e-10!==g&&(this._rawPrevTime=0)))}},i._kill=function(a,b,c){if("all"===a&&(a=null),null==a&&(null==b||b===this.target))return this._lazy=!1,this._enabled(!1,!1);b="string"!=typeof b?b||this._targets||this.target:G.selector(b)||b;var d,e,f,g,h,i,j,k,l,m=c&&this._time&&c._startTime===this._startTime&&this._timeline===c._timeline;if((p(b)||H(b))&&"number"!=typeof b[0])for(d=b.length;--d>-1;)this._kill(a,b[d],c)&&(i=!0);else{if(this._targets){for(d=this._targets.length;--d>-1;)if(b===this._targets[d]){h=this._propLookup[d]||{},this._overwrittenProps=this._overwrittenProps||[],e=this._overwrittenProps[d]=a?this._overwrittenProps[d]||{}:"all";break}}else{if(b!==this.target)return!1;h=this._propLookup,e=this._overwrittenProps=a?this._overwrittenProps||{}:"all"}if(h){if(j=a||h,k=a!==e&&"all"!==e&&a!==h&&("object"!=typeof a||!a._tempKill),c&&(G.onOverwrite||this.vars.onOverwrite)){for(f in j)h[f]&&(l||(l=[]),l.push(f));if((l||!a)&&!_(this,c,b,l))return!1}for(f in j)(g=h[f])&&(m&&(g.f?g.t[g.p](g.s):g.t[g.p]=g.s,i=!0),g.pg&&g.t._kill(j)&&(i=!0),g.pg&&0!==g.t._overwriteProps.length||(g._prev?g._prev._next=g._next:g===this._firstPT&&(this._firstPT=g._next),g._next&&(g._next._prev=g._prev),g._next=g._prev=null),delete h[f]),k&&(e[f]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return i},i.invalidate=function(){return this._notifyPluginsOfEnabled&&G._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],D.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-1e-10,this.render(Math.min(0,-this._delay))),this},i._enabled=function(a,b){if(k||j.wake(),a&&this._gc){var c,d=this._targets;if(d)for(c=d.length;--c>-1;)this._siblings[c]=$(d[c],this,!0);else this._siblings=$(this.target,this,!0)}return D.prototype._enabled.call(this,a,b),!(!this._notifyPluginsOfEnabled||!this._firstPT)&&G._onPluginEvent(a?"_onEnable":"_onDisable",this)},G.to=function(a,b,c){return new G(a,b,c)},G.from=function(a,b,c){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,new G(a,b,c)},G.fromTo=function(a,b,c,d){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,new G(a,b,d)},G.delayedCall=function(a,b,c,d,e){return new G(b,0,{delay:a,onComplete:b,onCompleteParams:c,callbackScope:d,onReverseComplete:b,onReverseCompleteParams:c,immediateRender:!1,lazy:!1,useFrames:e,overwrite:0})},G.set=function(a,b){return new G(a,0,b)},G.getTweensOf=function(a,b){if(null==a)return[];a="string"!=typeof a?a:G.selector(a)||a;var c,d,e,f;if((p(a)||H(a))&&"number"!=typeof a[0]){for(c=a.length,d=[];--c>-1;)d=d.concat(G.getTweensOf(a[c],b));for(c=d.length;--c>-1;)for(f=d[c],e=c;--e>-1;)f===d[e]&&d.splice(c,1)}else if(a._gsTweenID)for(d=$(a).concat(),c=d.length;--c>-1;)(d[c]._gc||b&&!d[c].isActive())&&d.splice(c,1);return d||[]},G.killTweensOf=G.killDelayedCallsTo=function(a,b,c){"object"==typeof b&&(c=b,b=!1);for(var d=G.getTweensOf(a,b),e=d.length;--e>-1;)d[e]._kill(c,a)};var ca=t("plugins.TweenPlugin",function(a,b){this._overwriteProps=(a||"").split(","),this._propName=this._overwriteProps[0],this._priority=b||0,this._super=ca.prototype},!0);if(i=ca.prototype,ca.version="1.19.0",ca.API=2,i._firstPT=null,i._addTween=P,i.setRatio=N,i._kill=function(a){var b,c=this._overwriteProps,d=this._firstPT;if(null!=a[this._propName])this._overwriteProps=[];else for(b=c.length;--b>-1;)null!=a[c[b]]&&c.splice(b,1);for(;d;)null!=a[d.n]&&(d._next&&(d._next._prev=d._prev),d._prev?(d._prev._next=d._next,d._prev=null):this._firstPT===d&&(this._firstPT=d._next)),d=d._next;return!1},i._mod=i._roundProps=function(a){for(var b,c=this._firstPT;c;)b=a[this._propName]||null!=c.n&&a[c.n.split(this._propName+"_").join("")],b&&"function"==typeof b&&(2===c.f?c.t._applyPT.m=b:c.m=b),c=c._next},G._onPluginEvent=function(a,b){var c,d,e,f,g,h=b._firstPT;if("_onInitAllProps"===a){for(;h;){for(g=h._next,d=e;d&&d.pr>h.pr;)d=d._next;(h._prev=d?d._prev:f)?h._prev._next=h:e=h,(h._next=d)?d._prev=h:f=h,h=g}h=b._firstPT=e}for(;h;)h.pg&&"function"==typeof h.t[a]&&h.t[a]()&&(c=!0),h=h._next;return c},ca.activate=function(a){for(var b=a.length;--b>-1;)a[b].API===ca.API&&(R[(new a[b])._propName]=a[b]);return!0},s.plugin=function(a){if(!(a&&a.propName&&a.init&&a.API))throw"illegal plugin definition.";var b,c=a.propName,d=a.priority||0,e=a.overwriteProps,f={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_mod",mod:"_mod",initAll:"_onInitAllProps"},g=t("plugins."+c.charAt(0).toUpperCase()+c.substr(1)+"Plugin",function(){ca.call(this,c,d),this._overwriteProps=e||[]},!0===a.global),h=g.prototype=new ca(c);h.constructor=g,g.API=a.API;for(b in f)"function"==typeof a[b]&&(h[f[b]]=a[b]);return g.version=a.version,ca.activate([g]),g},g=a._gsQueue){for(h=0;h<g.length;h++)g[h]();for(i in q)q[i].func||a.console.log("GSAP encountered missing dependency: "+i)}k=!1}}(void 0!==b&&b.exports&&void 0!==a?a:this||window)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],363:[function(a,b,c){var d=function(a){var b={addEvent:function(a,b,c,d){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&(a["e"+b+c]=c,a[b+c]=function(){a["e"+b+c](window.event,d)},a.attachEvent("on"+b,a[b+c]))},removeEvent:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.attachEvent&&a.detachEvent(b)},input:"",pattern:"38384040373937396665",keydownHandler:function(a,c){if(c&&(b=c),b.input+=a?a.keyCode:event.keyCode,b.input.length>b.pattern.length&&(b.input=b.input.substr(b.input.length-b.pattern.length)),b.input===b.pattern)return b.code(this._currentLink),b.input="",a.preventDefault(),!1},load:function(a){this.addEvent(document,"keydown",this.keydownHandler,this),this.iphone.load(a)},unload:function(){this.removeEvent(document,"keydown",this.keydownHandler),this.iphone.unload()},code:function(a){window.location=a},iphone:{start_x:0,start_y:0,stop_x:0,stop_y:0,tap:!1,capture:!1,orig_keys:"",keys:["UP","UP","DOWN","DOWN","LEFT","RIGHT","LEFT","RIGHT","TAP","TAP"],input:[],code:function(a){b.code(a)},touchmoveHandler:function(a){if(1===a.touches.length&&!0===b.iphone.capture){var c=a.touches[0];b.iphone.stop_x=c.pageX,b.iphone.stop_y=c.pageY,b.iphone.tap=!1,b.iphone.capture=!1,b.iphone.check_direction()}},touchendHandler:function(){if(b.iphone.input.push(b.iphone.check_direction()),b.iphone.input.length>b.iphone.keys.length&&b.iphone.input.shift(),b.iphone.input.length===b.iphone.keys.length){for(var a=!0,c=0;c<b.iphone.keys.length;c++)b.iphone.input[c]!==b.iphone.keys[c]&&(a=!1);a&&b.iphone.code(this._currentLink)}},touchstartHandler:function(a){b.iphone.start_x=a.changedTouches[0].pageX,b.iphone.start_y=a.changedTouches[0].pageY,b.iphone.tap=!0,b.iphone.capture=!0},load:function(a){this.orig_keys=this.keys,b.addEvent(document,"touchmove",this.touchmoveHandler),b.addEvent(document,"touchend",this.touchendHandler,!1),b.addEvent(document,"touchstart",this.touchstartHandler)},unload:function(){b.removeEvent(document,"touchmove",this.touchmoveHandler),b.removeEvent(document,"touchend",this.touchendHandler),b.removeEvent(document,"touchstart",this.touchstartHandler)},check_direction:function(){return x_magnitude=Math.abs(this.start_x-this.stop_x),y_magnitude=Math.abs(this.start_y-this.stop_y),x=this.start_x-this.stop_x<0?"RIGHT":"LEFT",y=this.start_y-this.stop_y<0?"DOWN":"UP",result=x_magnitude>y_magnitude?x:y,result=!0===this.tap?"TAP":result,result}}};return"string"==typeof a&&b.load(a),"function"==typeof a&&(b.code=a,b.load()),b};void 0!==b&&void 0!==b.exports?b.exports=d:"function"==typeof define&&define.amd?define([],function(){return d}):window.Konami=d},{}],364:[function(a,b,c){function d(a){e.call(this),this.lens=a,this._view=f.create(),
this._viewProj=f.create()}var e=a("nanogl-node"),f=a("gl-matrix/src/gl-matrix/mat4"),g=a("./perspective-lens"),h=a("./ortho-lens"),i=f.create(),j=Object.create(e.prototype);j.modelViewMatrix=function(a,b){f.multiply(a,b,this._view)},j.modelViewProjectionMatrix=function(a,b){f.multiply(a,this._viewProj,b)},j.getMVP=function(a){return f.multiply(i,this._viewProj,a),i},j.unproject=function(a,b){f.invert(IMVP,this._proj),vec3.transformMat4(a,b,IMVP)},j.updateViewProjectionMatrix=function(a,b){this.lens.aspect=a/b,f.multiply(this._viewProj,this.lens.getProjection(),this._view)},j._computeWorldMatrix=function(a){e.prototype._computeWorldMatrix.call(this,a),f.invert(this._view,this._wmatrix)},d.makePerspectiveCamera=function(){return new d(new g)},d.makeOrthoCamera=function(){return new d(new h)},j.constructor=d,d.prototype=j,b.exports=d},{"./ortho-lens":365,"./perspective-lens":366,"gl-matrix/src/gl-matrix/mat4":357,"nanogl-node":368}],365:[function(a,b,c){function d(){this._near=.01,this._far=10,this._xMin=-1,this._xMax=1,this._yMin=-1,this._yMax=1,this._proj=e.create(),this._valid=!1}var e=a("gl-matrix/src/gl-matrix/mat4");d.prototype={getProjection:function(){return this._valid||this._updateProjection(),this._proj},setBound:function(a,b,c,d){this._xMin=a,this._xMax=b,this._yMin=c,this._yMax=d,this._invalidate()},set near(a){this._near!==a&&(this._near=a,this._invalidate())},get near(){return this._near},set far(a){this._far!==a&&(this._far=a,this._invalidate())},get far(){return this._far},set aspect(a){this._aspect!==a&&(this._aspect=a)},get aspect(){return this._aspect},_updateProjection:function(){e.ortho(this._proj,this._xMin,this._xMax,this._yMin,this._yMax,this._near,this._far),this._valid=!0},_invalidate:function(){this._valid=!1}},b.exports=d},{"gl-matrix/src/gl-matrix/mat4":357}],366:[function(a,b,c){function d(){this._near=.01,this._far=10,this._fov=Math.PI/3,this._vfov=0,this._hfov=0,this._aspect=1,this._fovMode=0,this._proj=e.create(),this._valid=!1}var e=a("gl-matrix/src/gl-matrix/mat4");d.prototype={getProjection:function(){return this._valid||this._updateProjection(),this._proj},set fov(a){this.setVerticalFov(a)},get fov(){return this._fov},set near(a){this._near!==a&&(this._near=a,this._invalidate())},get near(){return this._near},set far(a){this._far!==a&&(this._far=a,this._invalidate())},get far(){return this._far},set aspect(a){this._aspect!==a&&(this._aspect=a,this._invalidate())},get aspect(){return this._aspect},setHorizontalFov:function(a){this._fov=a,this._fovMode=2,this._invalidate()},setVerticalFov:function(a){this._fov=a,this._fovMode=1,this._invalidate()},getHorizontalFov:function(){return this.getProjection(),this._hfov},getVerticalFov:function(){return this.getProjection(),this._vfov},setAutoFov:function(a){this._fov=a,this._fovMode=3,this._invalidate()},_updateProjection:function(){var a=this._fovMode,b=this._aspect;1===a||3===a&&b>1?(this._vfov=this._fov,this._hfov=2*Math.atan(Math.tan(this._fov/2)*b)):(this._hfov=this._fov,this._vfov=2*Math.atan(Math.tan(this._fov/2)/b)),e.perspective(this._proj,this._vfov,b,this._near,this._far),this._valid=!0},_invalidate:function(){this._valid=!1}},b.exports=d},{"gl-matrix/src/gl-matrix/mat4":357}],367:[function(a,b,c){function d(a,b,c,d){b[0]=a[12],b[1]=a[13],b[2]=a[14],d[0]=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),d[1]=Math.sqrt(a[4]*a[4]+a[5]*a[5]+a[6]*a[6]),d[2]=Math.sqrt(a[8]*a[8]+a[9]*a[9]+a[10]*a[10]),g[0]=a[0]/d[0],g[1]=a[1]/d[0],g[2]=a[2]/d[0],g[3]=a[4]/d[1],g[4]=a[5]/d[1],g[5]=a[6]/d[1],g[6]=a[8]/d[2],g[7]=a[9]/d[2],g[8]=a[10]/d[2],f.fromMat3(c,g)}var e=a("gl-matrix/src/gl-matrix/mat3"),f=a("gl-matrix/src/gl-matrix/quat"),g=e.create();b.exports={decomposeMat4:d}},{"gl-matrix/src/gl-matrix/mat3":356,"gl-matrix/src/gl-matrix/quat":358}],368:[function(a,b,c){function d(){this.position=h.create(),this.rotation=i.create(),this.scale=h.fromValues(1,1,1),this._matrix=f.create(),this._wmatrix=f.create(),this._wposition=new Float32Array(this._wmatrix.buffer,48,3),this._parent=null,this._children=[],this._invalidM=!0,this._invalidW=!0}var e=a("./math"),f=a("gl-matrix/src/gl-matrix/mat4"),g=a("gl-matrix/src/gl-matrix/mat3"),h=a("gl-matrix/src/gl-matrix/vec3"),i=a("gl-matrix/src/gl-matrix/quat"),j=g.create(),k=new Float32Array(j.buffer,0,3),l=new Float32Array(j.buffer,12,3),m=new Float32Array(j.buffer,24,3);VUP=h.fromValues(0,1,0),d.prototype={rotateX:function(a){i.rotateX(this.rotation,this.rotation,a),this.invalidate()},rotateY:function(a){i.rotateY(this.rotation,this.rotation,a),this.invalidate()},rotateZ:function(a){i.rotateZ(this.rotation,this.rotation,a),this.invalidate()},set x(a){this.position[0]=a,this.invalidate()},set y(a){this.position[1]=a,this.invalidate()},set z(a){this.position[2]=a,this.invalidate()},get x(){return this.position[0]},get y(){return this.position[1]},get z(){return this.position[2]},setScale:function(a){this.scale[0]=this.scale[1]=this.scale[2]=a,this.invalidate()},lookAt:function(a){h.subtract(m,this.position,a),h.normalize(m,m),h.cross(k,VUP,m),h.normalize(k,k),h.cross(l,m,k),i.fromMat3(this.rotation,j),this.invalidate()},setMatrix:function(a){f.copy(this._matrix,a),e.decomposeMat4(a,this.position,this.rotation,this.scale),this._invalidM=!1,this._invalidW=!0},add:function(a){-1===this._children.indexOf(a)&&(null!==a._parent&&a._parent.remove(a),this._children.push(a),a._parent=this)},remove:function(a){var b=this._children.indexOf(a);b>-1&&(this._children.splice(b,1),a._parent=null)},invalidate:function(){this._invalidM=!0,this._invalidW=!0},updateMatrix:function(){this._invalidM&&(f.fromRotationTranslationScale(this._matrix,this.rotation,this.position,this.scale),this._invalidM=!1)},updateWorldMatrix:function(a){a=!!a,this.updateMatrix();var b=this._hasInvalidWorldMatrix(a);b&&this._computeWorldMatrix(a);for(var c=0;c<this._children.length;c++){var d=this._children[c];d._invalidW=d._invalidW||b,d.updateWorldMatrix(!0)}},_computeWorldMatrix:function(a){var b=this._parent;null!==b?(!a&&b._hasInvalidWorldMatrix(!1)&&(b.updateMatrix(),b._computeWorldMatrix(!1)),f.multiply(this._wmatrix,b._wmatrix,this._matrix)):f.copy(this._wmatrix,this._matrix),this._invalidW=!1},_hasInvalidWorldMatrix:function(a){return this._invalidW||!a&&null!==this._parent&&this._parent._hasInvalidWorldMatrix(!1)}},b.exports=d},{"./math":367,"gl-matrix/src/gl-matrix/mat3":356,"gl-matrix/src/gl-matrix/mat4":357,"gl-matrix/src/gl-matrix/quat":358,"gl-matrix/src/gl-matrix/vec3":360}],369:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this.inputs=new h,this.depthFormat=new g("depthFormat",["D_RGB","D_DEPTH"]),this.inputs.add(this.depthFormat),this.config=new e,this._prgcache=f.getCache(b),this._uid="stddepth",this._precision="highp",this._vertSrc=a("./glsl/depthpass.vert")(),this._fragSrc=a("./glsl/depthpass.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("./lib/program-cache"),g=(a("./lib/input"),a("./lib/flag"),a("./lib/enum")),h=a("./lib/chunks-tree"),i=a("gl-matrix").mat4.create();d.prototype={setLightSetup:function(a){this.inputs.remove(this.depthFormat),this.depthFormat=a.depthFormat.createProxy(),this.inputs.add(this.depthFormat)},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),b.modelViewProjectionMatrix(i,a._wmatrix),c.uMVP(i)},_isDirty:function(){return null===this.prg||this.inputs._isDirty},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"./glsl/depthpass.frag":370,"./glsl/depthpass.vert":371,"./lib/chunks-tree":390,"./lib/enum":391,"./lib/flag":392,"./lib/input":393,"./lib/program-cache":398,"gl-matrix":352,"nanogl-state/config":409,"nanogl/program":419}],370:[function(a,b,c){var d=function(a){var b="";return b+="#pragma SLOT pf\n\n\n\n#if depthFormat( D_RGB )\n  varying vec2 fragZW;\n\n  vec3 encodeDepthRGB(float depth){\n    vec4 c = vec4(1.0,255.0,65025.0,16581375.0)*depth;\n    c=fract(c);\n    c.xyz-=c.yzw*(1.0/255.0);\n    return c.xyz;\n  }\n#endif\n\n\n\nvoid main(void){\n\n  #if depthFormat( D_RGB )\n    gl_FragColor.xyz = encodeDepthRGB( ( fragZW.x / fragZW.y ) * 0.5 + 0.5 );\n    gl_FragColor.w=0.0;\n  #endif\n\n  #if depthFormat( D_DEPTH )\n    gl_FragColor = vec4( 0.0 );\n  #endif\n\n}\n"};d.toString=d,b.exports=d},{}],371:[function(a,b,c){var d=function(a){var b="";return b+="#pragma SLOT pv\n\nattribute vec3 aPosition;\n\nuniform mat4 uMVP;\n\n\n\n#if depthFormat( D_RGB )\n  varying vec2 fragZW;\n#endif\n\n\nvoid main(void){\n  gl_Position = uMVP * vec4( aPosition, 1.0 );\n\n  #if depthFormat( D_RGB )\n    fragZW=gl_Position.zw;\n  #endif\n}\n"};d.toString=d,b.exports=d},{}],372:[function(a,b,c){var d=function(a){var b="";return b+="\n#ifndef _H_DECODE_RGBE_\n#define _H_DECODE_RGBE_\n\nvec3 decodeRGBE( vec4 hdr ){\n  return hdr.rgb * exp2( (hdr.a*255.0)-128.0 );\n  // return hdr.rgb * pow( 2.0, (hdr.a*255.0)-128.0 );\n}\n\n#endif"};d.toString=d,b.exports=d},{}],373:[function(a,b,c){var d=function(b){var c="";return c+="\n#ifndef _H_SPECULAR_IBL_\n#define _H_SPECULAR_IBL_\n\n"+a("./octwrap-decode.glsl")()+"\n"+a("./decode-rgbe.glsl")()+"\n\nconst vec2 _IBL_UVM = vec2(\n  0.25*(254.0/256.0),\n  0.125*0.5*(254.0/256.0)\n);\n\nvec3 SpecularIBL( sampler2D tEnv, vec3 skyDir, float roughness)\n{\n\n  vec2 uvA = octwrapDecode( skyDir );\n\n  float r7   = 7.0*roughness;\n  float frac = fract(r7);\n\n  uvA = uvA * _IBL_UVM + vec2(\n      0.5,\n      0.125*0.5 + 0.125 * ( r7 - frac )\n    );\n\n  #if glossNearest\n\n    return decodeRGBE( texture2D(tEnv,uvA) );\n\n  #else\n\n    vec2 uvB=uvA+vec2(0.0,0.125);\n    return  mix(\n      decodeRGBE( texture2D(tEnv,uvA) ),\n      decodeRGBE( texture2D(tEnv,uvB) ),\n      frac\n    );\n\n  #endif\n\n}\n\n#endif"};d.toString=d,b.exports=d},{"./decode-rgbe.glsl":372,"./octwrap-decode.glsl":374}],374:[function(a,b,c){var d=function(a){var b="";return b+="\n#ifndef _H_OCTWRAP_DECODE_\n#define _H_OCTWRAP_DECODE_\n\nvec2 octwrapDecode( vec3 v ) {\n  // Project the sphere onto the octahedron, and then onto the xy plan\n  vec2 p = v.xy / dot(  abs( v ) , vec3(1.0) );\n  p = vec2( p.x+p.y-1.0, p.x-p.y );\n\n  if( v.z < 0.0 )\n    p.x *= -1.0;\n\n  // p.x *= sign( v.z );\n  return p;\n}\n\n#endif"};d.toString=d,b.exports=d},{}],375:[function(a,b,c){var d=function(a){var b="";return b+='\n#ifndef _H_SAMPLE_SH_\n#define _H_SAMPLE_SH_\n// ================================\n// compute Spherical Harmonics\n// ================================\n//\n// "Stupid Spherical Harmonics (SH) Tricks"\n// http://www.ppsloan.org/publications/StupidSH36.pdf\n//\n//\nvec3 SampleSH( vec3 Normal, vec4 shCoefs[7] )\n{\n  Normal.xz = Normal.zx;\n  vec4 NormalVector = vec4(Normal, 1.0);\n\n  // todo transpose coeffs directly\n  // NormalVector.xyz = NormalVector.zyx;\n\n  vec3 X0, X1, X2;\n  X0.x = dot( shCoefs[0].xyz, Normal) + shCoefs[0].w;\n  X0.y = dot( shCoefs[1].xyz, Normal) + shCoefs[1].w;\n  X0.z = dot( shCoefs[2].xyz, Normal) + shCoefs[2].w;\n\n  vec4 vB = NormalVector.zyxx * NormalVector.yxxz;\n  X1.x = dot( shCoefs[3].xyz, vB.xyz) + (shCoefs[3].w * vB.w);\n  X1.y = dot( shCoefs[4].xyz, vB.xyz) + (shCoefs[4].w * vB.w);\n  X1.z = dot( shCoefs[5].xyz, vB.xyz) + (shCoefs[5].w * vB.w);\n\n  float vC = NormalVector.z * NormalVector.z - NormalVector.y * NormalVector.y;\n  X2 =  shCoefs[6].xyz * vC;\n\n  return ( X0 + X1 + X2 );\n//  return max( vec3(0.0) , X0 + X1 + X2 );\n}\n\n#endif\n'};d.toString=d,b.exports=d},{}],376:[function(a,b,c){var d=function(b){var c="";return c+="\n\n\n\n// #pragma Input vec3 normal\n// #pragma Enum ibl_type { NONE, SH7, SH9 }\n\n#if __VERSION__ == 300\n  #define IN in\n  out vec4 FragColor;\n  #define texture2D(a,b) texture( a, b )\n#else\n  #define IN varying\n  #define FragColor gl_FragColor\n#endif\n\n\nuniform vec3 uCameraPosition;\n\nIN vec2 vTexCoord;\nIN vec3 vWorldPosition;\n\nIN mediump vec3 vWorldNormal;\n\n#pragma SLOT pf\n\n#if HAS_normal\n  IN mediump vec3 vWorldTangent;\n  IN mediump vec3 vWorldBitangent;\n#endif\n\n\n\n// IBL\n// ========\nuniform sampler2D tEnv;\n\n#if perVertexIrrad\n  IN vec3 vIrradiance;\n#else\n  uniform vec4 uSHCoeffs[7];\n  "+a("./includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\n// MATH\n// =========\n#define saturate(x) clamp( x, 0.0, 1.0 )\n#define sdot( a, b ) saturate( dot(a,b) )\n\n\n// INCLUDES\n// =========\n\n"+a("./includes/ibl.glsl")()+'\n\n\n\n// Schlick approx\n// [Schlick 1994, "An Inexpensive BRDF Model for Physically-Based Rendering"]\n// https://github.com/EpicGames/UnrealEngine/blob/dff3c48be101bb9f84633a733ef79c91c38d9542/Engine/Shaders/BRDF.usf#L168\nvec3 F_Schlick( float VoH,vec3 spec,float glo )\n{\n  float dot = glo*glo * pow( 1.0-VoH, 5.0 );\n  #if HAS_fresnel\n    return( 1.0 - dot )*spec + dot*fresnel();\n  #else\n    return( 1.0 - dot )*spec + dot;\n  #endif\n}\n\n\n// ------------------------------\n//\n\n#if HAS_normal\nvec3 perturbWorldNormal(vec3 n){\n  n = 2.0*n - 1.0;\n  vec3 nrm = gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n  return normalize(vWorldTangent * n.x + vWorldBitangent*n.y + nrm * n.z );\n}\n#endif\n\n\n//                MAIN\n// ===================\n\nvoid main( void ){\n\n  #pragma SLOT f\n\n\n  // -----------\n  vec3 worldNormal =\n    #if HAS_normal\n      perturbWorldNormal( normal() );\n    #else\n      gl_FrontFacing ? vWorldNormal : -vWorldNormal;\n    #endif\n  worldNormal = normalize( worldNormal );\n\n\n  // SH Irradiance diffuse coeff\n  // -------------\n  #if perVertexIrrad\n    vec3 diffuseCoef = vIrradiance;\n  #else\n    vec3 diffuseCoef = SampleSH(worldNormal, uSHCoeffs );\n  #endif\n\n\n\n  // IBL reflexion\n  // --------------\n\n  vec3 viewDir = normalize( uCameraPosition - vWorldPosition );\n  vec3 worldReflect = reflect( -viewDir, worldNormal );\n  vec3 specularColor = SpecularIBL( tEnv, worldReflect, 1.0-gloss() );\n\n\n  #pragma SLOT lightsf\n\n\n  float NoV = sdot( viewDir, worldNormal );\n  vec3 specularSq = specular()*specular();\n  specularColor *= F_Schlick( NoV, specularSq, gloss() );\n\n\n  vec3 alb = albedo();\n  #if conserveEnergy\n    alb = alb - alb * specular();\n  #endif\n  vec3 albedoSq = alb*alb;\n\n\n\n  #if HAS_occlusion\n    diffuseCoef *= occlusion();\n  #endif\n\n\n  #if HAS_cavity\n    #ifndef cavityStrength\n      #define cavityStrength(k) vec2(1.0)\n    #endif\n    diffuseCoef   *= cavity() * cavityStrength().r + (1.0-cavityStrength().r);\n    specularColor *= cavity() * cavityStrength().g + (1.0-cavityStrength().g);\n  #endif\n\n\n  #if HAS_emissive\n    float e = emissive();\n    #if HAS_emissiveScale\n      e = e * emissiveScale();\n    #endif\n    diffuseCoef += vec3( e ) * albedo();\n  #endif\n\n  \n\n  FragColor.xyz = diffuseCoef*albedoSq + specularColor;\n\n\n  #if HAS_exposure\n    FragColor.xyz *= vec3( exposure() );\n  #endif\n\n  \n  #if gammaMode( GAMMA_STD ) && HAS_gamma\n    FragColor.xyz = pow( FragColor.xyz, vec3( gamma() ) );\n  #endif\n\n  #if gammaMode( GAMMA_2_2 )\n    FragColor.xyz = pow( FragColor.xyz, vec3( 1.0/2.2 ) );\n  #endif\n\n  #if gammaMode( GAMMA_TB )\n    {\n      vec3 c = FragColor.xyz;\n      vec3 sqrtc = sqrt( c );\n      FragColor.xyz = (sqrtc-sqrtc*c) + c*(0.4672*c+vec3(0.5328));\n    }\n  #endif\n\n\n\n\n  FragColor.a = 1.0;\n\n}'};d.toString=d,b.exports=d},{"./includes/ibl.glsl":373,"./includes/spherical-harmonics.glsl":375}],377:[function(a,b,c){var d=function(b){var c="";return c+="#pragma SLOT pv\n\n\n#if __VERSION__ == 300\n  #define IN in\n  #define OUT out\n#else\n  #define IN attribute\n  #define OUT varying\n#endif\n\n\nIN vec3 aPosition;\nIN vec2 aTexCoord;\nIN vec3 aNormal;\nIN vec3 aTangent;\nIN vec3 aBitangent;\n\nuniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\n\nOUT vec2 vTexCoord;\nOUT vec3 vWorldPosition;\n\nOUT mediump vec3 vWorldNormal;\n\n#if HAS_normal\n  OUT mediump vec3 vWorldTangent;\n  OUT mediump vec3 vWorldBitangent;\n#endif\n\n#if perVertexIrrad\n  OUT vec3 vIrradiance;\n  uniform vec4 uSHCoeffs[7];\n  \n"+a("./includes/spherical-harmonics.glsl")()+"\n#endif\n\n\n\nvec3 rotate( mat4 m, vec3 v )\n{\n  return m[0].xyz*v.x + m[1].xyz*v.y + m[2].xyz*v.z;\n}\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  vec4 pos = vec4( aPosition, 1.0 );\n\n  gl_Position    = uMVP         * pos;\n  vWorldPosition = (uWorldMatrix * pos).xyz;\n\n\n  vWorldNormal    = rotate( uWorldMatrix, aNormal );\n  #if HAS_normal\n    vWorldTangent   = rotate( uWorldMatrix, aTangent );\n    vWorldBitangent = rotate( uWorldMatrix, aBitangent );\n  #endif\n\n  #if perVertexIrrad\n    vIrradiance = SampleSH( normalize( vWorldNormal ), uSHCoeffs );\n  #endif\n\n\n  vTexCoord = aTexCoord;\n}"};d.toString=d,b.exports=d},{"./includes/spherical-harmonics.glsl":375}],378:[function(a,b,c){var d=function(a){var b="";return b+="// --------- SPEC\n{\n\n  vec3 H = normalize( uLDirDirections["+a.index+"] + viewDir );\n  float NoH = sdot( H,worldNormal );\n  float sContib = specularMul * pow( NoH, roughness );\n  // -------- DIFFUSE\n  float dContrib = (1.0/3.141592) * sdot( uLDirDirections["+a.index+"] ,worldNormal );\n\n  ",a.shadowIndex>-1&&(b+="\n  {\n    vec3 fragCoord = calcShadowPosition( uShadowTexelBiasVector["+a.shadowIndex+"], uShadowMatrices["+a.shadowIndex+"] , vWorldPosition, worldNormal, uShadowMapSize["+a.shadowIndex+"].y );\n    float shOccl = calcLightOcclusions(tShadowMap"+a.shadowIndex+",fragCoord,uShadowMapSize["+a.shadowIndex+"]);\n    dContrib *= shOccl;\n    sContib  *= shOccl;\n    \n    #if iblShadowing\n      float sDamp = uLDirColors["+a.index+"].a;\n      specularColor *= mix( sDamp, 1.0, shOccl );\n    #endif\n  }\n  "),b+="\n\n  diffuseCoef   += dContrib * uLDirColors["+a.index+"].rgb;\n  LS_SPECULAR   += sContib  * uLDirColors["+a.index+"].rgb;\n\n}"};d.toString=d,b.exports=d},{}],379:[function(a,b,c){arguments[4][81][0].apply(c,arguments)},{dup:81}],380:[function(a,b,c){arguments[4][82][0].apply(c,arguments)},{dup:82}],381:[function(a,b,c){arguments[4][83][0].apply(c,arguments)},{dup:83}],382:[function(a,b,c){arguments[4][84][0].apply(c,arguments)},{dup:84}],383:[function(a,b,c){arguments[4][85][0].apply(c,arguments)},{dup:85}],384:[function(a,b,c){arguments[4][86][0].apply(c,arguments)},{dup:86}],385:[function(a,b,c){arguments[4][87][0].apply(c,arguments)},{dup:87}],386:[function(a,b,c){arguments[4][88][0].apply(c,arguments)},{dup:88}],387:[function(a,b,c){function d(a,b){this.env=a,this.sh=b}a("./lib/input"),a("./lib/flag");d.prototype={setupProgram:function(a){a.tEnv&&a.tEnv(this.env),a.uSHCoeffs&&a.uSHCoeffs(this.sh)}},d.convert=function(a,b){void 0===b&&(b=1);var c=Math.sqrt(Math.PI),d=1/(2*c),e=Math.sqrt(3)/(3*c),f=Math.sqrt(15)/(8*c),g=Math.sqrt(5)/(16*c),h=.5*f,i=new Float32Array(28);return i[0]=b*(e*a[6]),i[1]=b*(-e*a[3]),i[2]=b*(-e*a[9]),i[3]=b*(d*a[0]-g*a[18]),i[4]=b*(e*a[7]),i[5]=b*(-e*a[4]),i[6]=b*(-e*a[10]),i[7]=b*(d*a[1]-g*a[19]),i[8]=b*(e*a[8]),i[9]=b*(-e*a[5]),i[10]=b*(-e*a[11]),i[11]=b*(d*a[2]-g*a[20]),i[12]=b*(f*a[12]),i[13]=b*(-f*a[15]),i[14]=b*(3*g*a[18]),i[15]=b*(-f*a[21]),i[16]=b*(f*a[13]),i[17]=b*(-f*a[16]),i[18]=b*(3*g*a[19]),i[19]=b*(-f*a[22]),i[20]=b*(f*a[14]),i[21]=b*(-f*a[17]),i[22]=b*(3*g*a[20]),i[23]=b*(-f*a[23]),i[24]=b*(h*a[24]),i[25]=b*(h*a[25]),i[26]=b*(h*a[26]),i[27]=1*b,i},b.exports=d},{"./lib/flag":392,"./lib/input":393}],388:[function(a,b,c){function d(){this.min=new Float32Array(3),this.max=new Float32Array(3),this.center=new Float32Array(3),this.radius=new Float32Array(3)}d.prototype={fromMinMax:function(a,b){this.min.set(a),this.max.set(b),this._updateSphere()},addMinMax:function(a,b){for(var c=0;c<3;c++)this.min[c]=Math.min(a[c],a[c]),this.max[c]=Math.max(b[c],b[c]);this._updateSphere()},addBounds:function(a){this.addMinMax(a.min,a.max)},_updateSphere:function(){this.center[0]=.5*(this.min[0]+this.max[0]),this.center[1]=.5*(this.min[1]+this.max[1]),this.center[2]=.5*(this.min[2]+this.max[2]),this.radius[0]=this.max[0]-this.center[0],this.radius[1]=this.max[1]-this.center[1],this.radius[2]=this.max[2]-this.center[2]}},b.exports=d},{}],389:[function(a,b,c){function d(a,b){this.list=null,this.children=[],this.parent=null,this._hasCode=!!a,this._hasSetup=!!b,this._invalid=!0,this._proxies=[]}function e(a){d.call(this,a._hasCode,a._hasSetup),this._ref=a}d.prototype={genCode:function(a){return""},getHash:function(){return""},setup:function(a){},add:function(a){if(!(this.children.indexOf(a)>-1)){this.children.push(a),a.setList(this.list),a.parent=this;for(var b=0;b<this._proxies.length;b++)this._proxies[b].add(a.createProxy());return this.invalidate(),a}},remove:function(a){var b=this.children.indexOf(a);b>-1&&(this.children.splice(b,1),a.parent=null,a.removeProxies()),this.invalidate()},setList:function(a){this.list=a,this.invalidate();for(var b=0;b<this.children.length;b++)this.children[b].setList(a)},traverse:function(a,b,c){if(-1===c.indexOf(this)){for(var d=0;d<this.children.length;d++)this.children[d].traverse(a,b,c);this._hasSetup&&a.push(this),this._hasCode&&b.push(this),c.push(this)}},invalidate:function(){this.list&&(this.list._isDirty=!0);for(var a=0;a<this._proxies.length;a++)this._proxies[a].invalidate()},createProxy:function(){for(var a=new e(this),b=0;b<this.children.length;b++)a.add(this.children[b].createProxy());return this._proxies.push(a),a},releaseProxy:function(a){var b=this._proxies.indexOf(a);b>-1&&this._proxies.splice(b,1)},removeProxies:function(){for(var a=0;a<this._proxies.length;a++){var b=this._proxies[a];null!==b.parent&&b.parent.remove(b)}}},e.prototype=Object.create(d.prototype),e.prototype.constructor=e,e.prototype.genCode=function(a){this._ref.genCode(a)},e.prototype.getHash=function(){return this._ref.getHash()},e.prototype.setup=function(a){this._ref.setup(a)},e.prototype.release=function(){this._ref.releaseProxy(this),this._ref=null},d.Proxy=e,b.exports=d},{}],390:[function(a,b,c){function d(){this.slots=[],this.slotsMap={}}function e(a){this.material=a,this._setups=[],this._codes=[],this._flat=[],this._root=new f,this._root.list=this,this._isDirty=!0}var f=a("./chunk");d.prototype={getSlot:function(a){var b=this.slotsMap[a];return void 0===b&&(b={key:a,code:""},this.slotsMap[a]=b,this.slots.push(b)),b},add:function(a,b){this.getSlot(a).code+=b+"\n"}},e.prototype={add:function(a){return this._root.add(a)},remove:function(a){return this._root.remove(a)},addChunks:function(a){for(var b=0;b<a.length;b++)this._root.add(a[b])},compile:function(){this._flatten()},_flatten:function(){var a=this._setups,b=this._codes,c=this._flat;a.length=0,b.length=0,c.length=0,this._root.traverse(a,b,c),this._isDirty=!1},getHash:function(){for(var a=this._codes,b="",c=0;c<a.length;c++)b+=a[c].getHash();return b},getCode:function(){for(var a=this._codes,b=new d,c=0;c<a.length;c++)a[c].genCode(b);return b}},b.exports=e},{"./chunk":389}],391:[function(a,b,c){function d(a,b){e.call(this,!0,!1),this.name=a,this.values=b,this._val=b[0]}var e=a("./chunk");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.set=function(a){if(this._val!==a){if(null!==a&&-1===this.values.indexOf(a))throw new Error("invalide Enum value :"+a);this._val=a,this.invalidate()}},d.prototype.genCode=function(a){for(var b="",c=0;c<this.values.length;c++)b+="#define "+this.values[c]+" "+(c+1)+"\n";b+="#define VAL_"+this.name+" "+this._val+"\n",b+="#define "+this.name+"(k) VAL_"+this.name+" == k\n",a.add("pf",b),a.add("pv",b)},d.prototype.getHash=function(){return this.values.indexOf(this._val)+"/"+this.name},b.exports=d},{"./chunk":389}],392:[function(a,b,c){function d(a,b){e.call(this,!0,!1),this.name=a,this._val=!!b}var e=a("./chunk");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.enable=function(){this.set(!0)},d.prototype.disable=function(){this.set(!1)},d.prototype.set=function(a){a=!!a,this._val!==a&&(this._val=a,this.invalidate())},d.prototype.genCode=function(a){var b;b="#define "+this.name+" "+~~this._val+"\n",a.add("pf",b),a.add("pv",b)},d.prototype.getHash=function(){return this.name+"-"+~~this._val},b.exports=d},{"./chunk":389}],393:[function(a,b,c){function d(a,b){var c=a.length;if(c===b)return a;if(c>b)return a.substr(0,b);for(var d=a[c-1];a.length<b;)a+=d;return a}function e(a){return a.toPrecision(8)}function f(a,b,c){0!=(b&o)&&a.add("f",c),0!=(b&p)&&a.add("v",c)}function g(a,b,c){0!=(b&o)&&a.add("pf",c),0!=(b&p)&&a.add("pv",c)}function h(a,b,c){m.call(this,!0,!1),this.name=a,this.size=b,this.param=null,this.comps=d("rgba",b),this.shader=c||o}function i(a,b){m.call(this,!0,!0),this._input=null,this.name=a,this.texCoords=b,this._tex=null,this.size=4,this._linkAttrib=b instanceof k,this._linkAttrib?(this.add(b),this.uvsToken=this.texCoords.token):this.uvsToken=this.texCoords,this.token="VAL_"+this.name+this.uvsToken}function j(a,b){m.call(this,!0,!0),this._input=null,this.name=a,this.size=b,this._value=new Float32Array(b),this.token=this.name}function k(a,b){m.call(this,!0,!1),this._input=null,this.name=a,this.size=b,this.token="v_"+this.name}function l(a){m.call(this,!0,!1),this._input=null,this.name="CONST_"+(0|2147483647*Math.random()).toString(16),Array.isArray(a)?this.size=a.length:this.size=1,this.value=a,this.token="VAR_"+this.name}var m=a("./chunk"),n=[null,"float","vec2","vec3","vec4"],o=1,p=2;h.prototype=Object.create(m.prototype),h.prototype.constructor=h,h.prototype.attach=function(a,b){this.param&&this.remove(this.param),a._input=this,this.param=a,this.add(a),void 0===b&&(b="rgba"),this.comps=d(b,this.size)},h.prototype.detach=function(){this.param&&(this.param._input=null,this.remove(this.param)),this.param=null},h.prototype.attachSampler=function(a,b,c){var d=new i(a,b);return this.attach(d,c),d},h.prototype.attachUniform=function(a,b,c){var d=new j(a,b||this.size);return this.attach(d,c),d},h.prototype.attachAttribute=function(a,b,c){var d=new k(a,b||this.size);return this.attach(d,c),d},h.prototype.attachConstant=function(a,b){var c=new l(a);return this.attach(c,b),c},h.prototype.getHash=function(){return this.size+"-"+this.comps+"-"+this.name},h.prototype.genCode=function(a){if(this.genAvailable(a),null!==this.param){var b="#define "+this.name+"(k) "+this.param.token;this.param.size>1&&(b+="."+this.comps),g(a,this.shader,b)}},h.prototype.genAvailable=function(a){var b=null===this.param?"0":"1",c="#define HAS_"+this.name+" "+b+"\n";a.add("pv",c),a.add("pf",c)},i.prototype=Object.create(m.prototype),i.prototype.constructor=i,i.prototype.set=function(a){this._tex=a},i.prototype.genCode=function(a){var b,c=this.name;b="uniform sampler2D "+c+";\n",g(a,this._input.shader,b),b="vec4 "+this.token+" = texture2D( "+c+", "+this.uvsToken+");\n",f(a,this._input.shader,b)},i.prototype.setup=function(a){a[this.name](this._tex)},i.prototype.getHash=function(){return(this._linkAttrib?"":this.texCoords)+"-"+this.name},j.prototype=Object.create(m.prototype),j.prototype.constructor=j,j.prototype.set=function(){for(var a=0;a<arguments.length;a++)this._value[a]=arguments[a];this._invalid=!0},j.prototype.genCode=function(a){var b;b="uniform "+n[this.size]+" "+this.token+";\n",g(a,this._input.shader,b)},j.prototype.setup=function(a){a[this.name](this._value),this._invalid=!1},j.prototype.getHash=function(){return this.size+"-"+this.name},k.prototype=Object.create(m.prototype),k.prototype.constructor=k,k.prototype.genCode=function(a){var b;b="varying "+n[this.size]+" "+this.token+";\n",a.add("pf",b),b="attribute "+n[this.size]+" "+this.name+";\n",b+="varying   "+n[this.size]+" "+this.token+";\n",a.add("pv",b),b=this.token+" = "+this.name+";\n",a.add("v",b)},k.prototype.getHash=function(){return this.size+"-"+this.name},l.prototype=Object.create(m.prototype),l.prototype.constructor=l,l.prototype.genCode=function(a){var b;b="#define "+this.token+" "+n[this.size]+"("+this._stringifyValue()+")\n",g(a,this._input.shader,b)},l.prototype._stringifyValue=function(){return 1===this.size?this.value.toString():this.value.map(e).join(",")},l.prototype.getHash=function(){return this._stringifyValue()+"-"+this.size+"-"},h.Sampler=i,h.Uniform=j,h.Attribute=k,h.Constant=l,h.FRAGMENT=o,h.VERTEX=p,h.ALL=p|o,b.exports=h},{"./chunk":389}],394:[function(a,b,c){function d(a){e.call(this,a),this._type=e.TYPE_DIR,this._shadowmapNearOffset=0}var e=a("./light"),f=a("nanogl-camera"),g=new Float32Array(4);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.projectionFromBounds=function(a){var b=this.boundsInLocalSpace(a);this._camera.lens.near=-b[5]-this._shadowmapNearOffset,this._camera.lens.far=-b[2],this._camera.lens.setBound(b[0],b[3],b[1],b[4])},d.prototype.getTexelBiasVector=function(){var a=this._camera.lens;return g[3]=Math.max(a._xMax-a._xMin,a._yMax-a._yMin),g},d.prototype._createCamera=function(){return f.makeOrthoCamera()},b.exports=d},{"./light":396,"nanogl-camera":400}],395:[function(a,b,c){function d(){this._lights=[],this._models=[],this._modelsMap={},this.depthFormat=new e("depthFormat",["D_RGB","D_DEPTH"]),this.bounds=new f,this.stdModel=new g,this._registerModel("std",this.stdModel)}var e=a("../enum"),f=a("../bounds"),g=a("./standard-model");d.prototype={add:function(a){if(-1===this._lights.indexOf(a)){this._lights.push(a);for(var b=0;b<this._models.length;b++)this._models[b].add(a)}},remove:function(a){var b=this._lights.indexOf(a);if(b>-1)for(this._lights.splice(b,1),b=0;b<this._models.length;b++)this._models[b].remove(a)},update:function(){for(i=0;i<this._models.length;i++)this._models[i].update()},getChunks:function(a){void 0===a&&(a="std");var b=this._modelsMap[a].getChunks();return b.unshift(this.depthFormat.createProxy()),b},_registerModel:function(a,b){if(void 0===this._modelsMap[a]){this._modelsMap[a]=b,this._models.push(b),b._setup=this;for(var c=0;c<this._lights.length;c++)b.add(this._lights[c])}}},b.exports=d},{"../bounds":388,"../enum":391,"./standard-model":397}],396:[function(a,b,c){function d(a){e.call(this),this.gl=a,this._type=0,this._color=new Float32Array([1,1,1]),this._wdir=new Float32Array(this._wmatrix.buffer,32,3),this._castShadows=!1,this._fbo=null,this._camera=null,this._shadowmapSize=512,this.iblShadowing=.5}var e=a("nanogl-node"),f=a("nanogl/texture"),g=a("nanogl/fbo"),h=(a("nanogl/renderbuffer"),a("nanogl-pf")),i=a("gl-matrix/src/gl-matrix/mat4"),j=a("gl-matrix/src/gl-matrix/vec3"),k=new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),l=i.create(),m=new Float32Array(6),n=j.create();d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.getShadowProjection=function(a){return this.projectionFromBounds(a),this._camera.updateViewProjectionMatrix(1,1),i.multiply(l,k,this._camera._viewProj),l},d.prototype.castShadows=function(a){this._castShadows!==a&&(this._castShadows=a,a?this._initShadowMapping():this._releaseShadowMapping())},d.prototype.hasDepthShadowmap=function(){return this._castShadows&&this._fbo.getAttachment(this.gl.DEPTH_ATTACHMENT).isTexture()},d.prototype.getShadowmap=function(){if(this._castShadows){var a=this._fbo.getAttachment(this.gl.DEPTH_ATTACHMENT);return a.isTexture()?a.target:this._fbo.getAttachment(this.gl.COLOR_ATTACHMENT0).target}return null},d.prototype._initShadowMapping=function(a){var b=this._shadowmapSize,c=this.gl;this._fbo=new g(c),this._fbo.bind(),this._fbo.resize(b,b),this._fbo.attach(c.COLOR_ATTACHMENT0,new f(c,c.RGB));var d=h.getInstance(c).hasDepthTexture();this._fbo.attachDepth(!0,!1,d);var e=this.getShadowmap();e.bind();var c=this.gl;c.COMPARE_REF_TO_TEXTURE?(e.setFilter(!0,!1,!1),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_COMPARE_MODE,c.COMPARE_REF_TO_TEXTURE)):e.setFilter(!1,!1,!1),this._camera=this._createCamera(),this.add(this._camera)},d.prototype._releaseShadowMapping=function(a){this._fbo.dispose(),this._fbo=null,this.remove(this._camera),this._camera=null},d.prototype._createCamera=function(){},d.prototype.prepareShadowmap=function(){var a=this._shadowmapSize;this._fbo.resize(a,a),this._fbo.bind(),this._fbo.defaultViewport()},d.prototype.boundsInLocalSpace=function(a){m[0]=m[1]=m[2]=Number.MAX_VALUE,m[3]=m[4]=m[5]=-Number.MAX_VALUE
;for(var b=0;8>b;b++)n[0]=1&b?a.max[0]:a.min[0],n[1]=2&b?a.max[1]:a.min[1],n[2]=4&b?a.max[2]:a.min[2],j.transformMat4(n,n,this._camera._view),m[0]=Math.min(m[0],n[0]),m[1]=Math.min(m[1],n[1]),m[2]=Math.min(m[2],n[2]),m[3]=Math.max(m[3],n[0]),m[4]=Math.max(m[4],n[1]),m[5]=Math.max(m[5],n[2]);return m},d.TYPE_DIR=1,d.TYPE_SPOT=2,d.TYPE_POINT=4,b.exports=d},{"gl-matrix/src/gl-matrix/mat4":357,"gl-matrix/src/gl-matrix/vec3":360,"nanogl-node":368,"nanogl-pf":404,"nanogl/fbo":417,"nanogl/renderbuffer":420,"nanogl/texture":421}],397:[function(a,b,c){function d(){this._datas={},this._dataList=[],this._setup=null;var a;this.preLightsChunk=new e,this.postLightsChunk=new f,this.shadowChunk=new g(this),this.shadowFilter=new n("shadowFilter",["PCFNONE","PCF4x1","PCF4x4","PCF2x2"]),this.iblShadowing=new o("iblShadowing",!1),a=new j,this._datas[l.TYPE_DIR]=a,this._dataList.push(a),a=new i,this._datas[l.TYPE_SPOT]=a,this._dataList.push(a),a=new k,this._datas[l.TYPE_POINT]=a,this._dataList.push(a)}function e(){m.call(this,!0,!1)}function f(){m.call(this,!0,!1)}function g(a){m.call(this,!0,!0),this.lightModel=a,this.shadowCount=0,this.genCount=0,this._matrices=new Float32Array(16*y),this._texelBiasVector=new Float32Array(4*y),this._shadowmapSizes=new Float32Array(2*y),this._umatrices=null,this._utexelBiasVector=null,this._ushadowmapSizes=null}function h(){m.call(this,!0,!0),this.type=0,this.lights=[],this.shadowIndices=[],this.preCodeTemplate=null}function i(){h.call(this),this.type=l.TYPE_SPOT,this._directions=null,this._colors=null,this._positions=null,this._spot=null,this._falloff=null,this.preCodeTemplate=q}function j(){h.call(this),this.type=l.TYPE_DIR,this._directions=null,this._colors=null,this.preCodeTemplate=p}function k(){h.call(this),this.type=l.TYPE_POINT,this._colors=null,this._positions=null,this._falloff=null,this.preCodeTemplate=r}var l=a("./light"),m=a("../chunk"),n=a("../enum"),o=a("../flag"),p=a("../../glsl/templates/standard/directional-lights-pre.frag"),q=a("../../glsl/templates/standard/spot-lights-pre.frag"),r=a("../../glsl/templates/standard/point-lights-pre.frag"),s=a("../../glsl/templates/standard/directional-light.frag"),t=a("../../glsl/templates/standard/spot-light.frag"),u=a("../../glsl/templates/standard/point-light.frag"),v=a("../../glsl/templates/standard/shadow-maps-pre.frag"),w=a("../../glsl/templates/standard/pre-light-setup.frag"),x=a("../../glsl/templates/standard/post-light-setup.frag");d.prototype={add:function(a){this._datas[a._type].addLight(a)},remove:function(a){this._datas[a._type].removeLight(a)},update:function(){this.shadowChunk.shadowCount=0;for(var a=0;a<this._dataList.length;a++)this._dataList[a].update(this);this.shadowChunk.check()},getChunks:function(){var a=[];a.push(this.iblShadowing.createProxy()),a.push(this.shadowFilter.createProxy()),a.push(this.shadowChunk.createProxy()),a.push(this.preLightsChunk.createProxy());for(var b=0;b<this._dataList.length;b++)a.push(this._dataList[b].createProxy());return a.push(this.postLightsChunk.createProxy()),a}},e.prototype=Object.create(m.prototype),e.prototype.constructor=e,e.prototype.genCode=function(a){code=w(this),a.add("lightsf",code)},e.prototype.getHash=function(){return"0"},f.prototype=Object.create(m.prototype),f.prototype.constructor=f,f.prototype.genCode=function(a){code=x(this),a.add("lightsf",code)},f.prototype.getHash=function(){return"0"};var y=4;g.prototype=Object.create(m.prototype),g.prototype.constructor=g;var z=Math.PI/4;g.prototype.genCode=function(a){this.shadowCount>0&&a.add("pf",v(this))},g.prototype.addLight=function(a){var b=this.shadowCount;this.shadowCount++,this._matrices.set(a.getShadowProjection(this.lightModel._setup.bounds),16*b),this._texelBiasVector.set(a.getTexelBiasVector(),4*b);var c=a._shadowmapSize;if(this._shadowmapSizes[2*b+0]=c,this._shadowmapSizes[2*b+1]=1/c,0===b){var d=a.hasDepthShadowmap();this.lightModel._setup.depthFormat.set(d?"D_DEPTH":"D_RGB")}return b},g.prototype.getHash=function(){return this.shadowCount},g.prototype.check=function(){this.genCount!==this.shadowCount&&(this.genCount=this.shadowCount,this._umatrices=new Float32Array(this._matrices.buffer,0,16*this.shadowCount),this._utexelBiasVector=new Float32Array(this._texelBiasVector.buffer,0,4*this.shadowCount),this._ushadowmapSizes=new Float32Array(this._shadowmapSizes.buffer,0,2*this.shadowCount),this.invalidate()),this._invalid=!0},g.prototype.setup=function(a){this.shadowCount>0&&(a.uShadowMatrices(this._umatrices),a.uShadowTexelBiasVector(this._utexelBiasVector),a.uShadowMapSize(this._ushadowmapSizes),void 0!==a.uShadowKernelRotation&&a.uShadowKernelRotation(1*Math.cos(z),1*Math.sin(z)),this._invalid=!1)},h.prototype=Object.create(m.prototype),h.prototype.constructor=h,h.prototype.addLight=function(a){-1===this.lights.indexOf(a)&&(this.lights.push(a),this.shadowIndices.push(-1),this.invalidate())},h.prototype.removeLight=function(a){var b=this.lights.indexOf(a);b>-1&&(this.lights.splice(b,1),this.shadowIndices.splice(b,1),this.invalidate())},h.prototype.genCode=function(a){var b=this.preCodeTemplate({count:this.lights.length});a.add("pf",b),b="";for(var c=0;c<this.lights.length;c++)b+=this.genCodePerLights(this.lights[c],c,this.shadowIndices[c]);a.add("lightsf",b)},h.prototype.genCodePerLights=function(a,b,c){},h.prototype.getHash=function(){for(var a=this.type+""+this.lights.length,b=0;b<this.lights.length;b++)this.lights[b]._castShadows&&(a+=b);return a},h.prototype.setup=function(a){for(var b=0;b<this.shadowIndices.length;b++){var c=this.shadowIndices[b];if(c>-1){var d=this.lights[b].getShadowmap();a["tShadowMap"+c](d)}}},i.prototype=Object.create(h.prototype),i.prototype.constructor=i,i.prototype.genCodePerLights=function(a,b,c){return t({index:b,shadowIndex:c})},i.prototype.allocate=function(a){null!==this._colors&&this._colors.length/4===a||(this._directions=new Float32Array(3*a),this._colors=new Float32Array(4*a),this._positions=new Float32Array(3*a),this._spot=new Float32Array(2*a),this._falloff=new Float32Array(3*a))},i.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._directions.set(d._wdir,3*c),this._colors.set(d._color,4*c),this._positions.set(d._wposition,3*c),this._spot.set(d._spotData,2*c),this._falloff.set(d._falloffData,3*c),this._colors[4*c+3]=d.iblShadowing,d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},i.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLSpotDirections(this._directions),a.uLSpotColors(this._colors),a.uLSpotPositions(this._positions),a.uLSpotSpot(this._spot),a.uLSpotFalloff(this._falloff),this._invalid=!1)},j.prototype=Object.create(h.prototype),j.prototype.constructor=j,j.prototype.genCodePerLights=function(a,b,c){return s({index:b,shadowIndex:c})},j.prototype.allocate=function(a){null!==this._colors&&this._colors.length/4===a||(this._directions=new Float32Array(3*a),this._colors=new Float32Array(4*a))},j.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._directions.set(d._wdir,3*c),this._colors.set(d._color,4*c),this._colors[4*c+3]=d.iblShadowing,d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},j.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLDirDirections(this._directions),a.uLDirColors(this._colors),this._invalid=!1)},k.prototype=Object.create(h.prototype),k.prototype.constructor=k,k.prototype.genCodePerLights=function(a,b,c){return u({index:b,shadowIndex:c})},k.prototype.allocate=function(a){null!==this._colors&&this._colors.length/3===a||(this._colors=new Float32Array(3*a),this._positions=new Float32Array(3*a),this._falloff=new Float32Array(3*a))},k.prototype.update=function(a){var b=this.lights;this.allocate(b.length);for(var c=0;c<b.length;c++){var d=b[c];if(this._colors.set(d._color,3*c),this._positions.set(d._wposition,3*c),this._falloff.set(d._falloffData,3*c),d._castShadows){var e=a.shadowChunk.addLight(d);this.shadowIndices[c]!==e&&this.invalidate(),this.shadowIndices[c]=e}else this.shadowIndices[c]=-1}this._invalid=!0},k.prototype.setup=function(a){this.lights.length>0&&(h.prototype.setup.call(this,a),a.uLPointColors(this._colors),a.uLPointPositions(this._positions),a.uLPointFalloff(this._falloff),this._invalid=!1)},b.exports=d},{"../../glsl/templates/standard/directional-light.frag":378,"../../glsl/templates/standard/directional-lights-pre.frag":379,"../../glsl/templates/standard/point-light.frag":380,"../../glsl/templates/standard/point-lights-pre.frag":381,"../../glsl/templates/standard/post-light-setup.frag":382,"../../glsl/templates/standard/pre-light-setup.frag":383,"../../glsl/templates/standard/shadow-maps-pre.frag":384,"../../glsl/templates/standard/spot-light.frag":385,"../../glsl/templates/standard/spot-lights-pre.frag":386,"../chunk":389,"../enum":391,"../flag":392,"./light":396}],398:[function(a,b,c){function d(a){this.gl=a,this._cache={}}var e=a("./program"),f=/^\s*#pragma SLOT\s\w+\s*$/gm;d.prototype={compile:function(a){var b=a.inputs;b.compile(),hash=b.getHash(),hash+=a._uid+a._precision;var c=this._cache[hash];if(void 0!==c)return c.usage++,c;var d=b.getCode(),f=this.processSlots(a._vertSrc,d),g=this.processSlots(a._fragSrc,d),h="precision "+a._precision+" float;\n";a.version&&(h="#version "+a.version+"\n"+h);var i=new e(this.gl,f,g,h);return i._usage++,this._cache[hash]=i,i},release:function(a){},_addProgram:function(a,b){this._cache[b]=a},processSlots:function(a,b){for(var c=0;c<b.slots.length;c++){var d=b.slots[c].code,e=b.slots[c].key;a=a.replace("#pragma SLOT "+e,d)}return f.lastIndex=0,a=a.replace(f,"")}},d.getCache=function(a){return void 0===a._prgcache&&(a._prgcache=new d(a)),a._prgcache},b.exports=d},{"./program":399}],399:[function(a,b,c){function d(a,b,c,d){e.call(this,a,b,c,d),this._usage=0,this._currentMaterial=null}var e=a("nanogl/program");d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.setupInputs=function(a){for(var b=a.inputs._setups,c=0;c<b.length;c++)b[c]._invalid,b[c].setup(this);this._currentMaterial=a},b.exports=d},{"nanogl/program":419}],400:[function(a,b,c){function d(a){e.call(this),this.lens=a,this._view=f.create(),this._viewProj=f.create()}var e=a("nanogl-node"),f=a("gl-matrix/src/gl-matrix/mat4"),g=a("./perspective-lens"),h=a("./ortho-lens"),i=f.create(),j=Object.create(e.prototype);j.modelViewMatrix=function(a,b){f.multiply(a,b,this._view)},j.modelViewProjectionMatrix=function(a,b){f.multiply(a,this._viewProj,b)},j.unproject=function(a,b){f.invert(i,this._proj),vec3.transformMat4(a,b,i)},j.updateViewProjectionMatrix=function(a,b){this.lens.aspect=a/b,f.multiply(this._viewProj,this.lens.getProjection(),this._view)},j._computeWorldMatrix=function(a){e.prototype._computeWorldMatrix.call(this,a),f.invert(this._view,this._wmatrix)},d.makePerspectiveCamera=function(){return new d(new g)},d.makeOrthoCamera=function(){return new d(new h)},j.constructor=d,d.prototype=j,b.exports=d},{"./ortho-lens":401,"./perspective-lens":402,"gl-matrix/src/gl-matrix/mat4":357,"nanogl-node":368}],401:[function(a,b,c){arguments[4][365][0].apply(c,arguments)},{dup:365,"gl-matrix/src/gl-matrix/mat4":357}],402:[function(a,b,c){function d(){this._near=.01,this._far=10,this._fov=Math.PI/3,this._vfov=0,this._hfov=0,this._aspect=1,this._fovMode=0,this._proj=e.create(),this._valid=!1}var e=a("gl-matrix/src/gl-matrix/mat4");d.prototype={getProjection:function(){return this._valid||this._updateProjection(),this._proj},set fov(a){this.setVerticalFov(a)},get fov(){return this._fov},set near(a){this._near!==a&&(this._near=a,this._invalidate())},get near(){return this._near},set far(a){this._far!==a&&(this._far=a,this._invalidate())},get far(){return this._far},set aspect(a){this._aspect!==a&&(this._aspect=a,this._invalidate())},get aspect(){return this._aspect},setHorizontalFov:function(a){this._fov=a,this._fovMode=2,this._invalidate()},setVerticalFov:function(a){this._fov=a,this._fovMode=1,this._invalidate()},getHorizontalFov:function(){return this.getProjection(),this._hfov},getVerticalFov:function(){return this.getProjection(),this._vfov},setAutoFov:function(a){this._fov=a,this._fovMode=3},_updateProjection:function(){var a=this._fovMode,b=this._aspect;1===a||3===a&&b>1?(this._vfov=this._fov,this._hfov=2*Math.atan(Math.tan(this._fov/2)*b)):(this._hfov=this._fov,this._vfov=2*Math.atan(Math.tan(this._fov/2)/b)),e.perspective(this._proj,this._vfov,b,this._near,this._far),this._valid=!0},_invalidate:function(){this._valid=!1}},b.exports=d},{"gl-matrix/src/gl-matrix/mat4":357}],403:[function(a,b,c){function d(b){this.ibl=null,this.prg=null,this._mask=1,this.inputs=new j,this.iAlbedo=this.inputs.add(new g("albedo",3)),this.iSpecular=this.inputs.add(new g("specular",3)),this.iGloss=this.inputs.add(new g("gloss",1)),this.iNormal=this.inputs.add(new g("normal",3)),this.iOcclusion=this.inputs.add(new g("occlusion",1)),this.iCavity=this.inputs.add(new g("cavity",1)),this.iCavityStrength=this.inputs.add(new g("cavityStrength",2)),this.iEmissive=this.inputs.add(new g("emissive",1)),this.iEmissiveScale=this.inputs.add(new g("emissiveScale",1)),this.iFresnel=this.inputs.add(new g("fresnel",3)),this.conserveEnergy=this.inputs.add(new h("conserveEnergy",!0)),this.perVertexIrrad=this.inputs.add(new h("perVertexIrrad",!1)),this.glossNearest=this.inputs.add(new h("glossNearest",!1)),this.gammaMode=new i("gammaMode",["GAMMA_NONE","GAMMA_STD","GAMMA_2_2","GAMMA_TB"]),this.inputs.add(this.gammaMode),this.iGamma=this.inputs.add(new g("gamma",1)),this.iExposure=this.inputs.add(new g("exposure",1)),this.config=new e,this._prgcache=f.getCache(b),this.version=void 0!==b.texImage3D?"300 es":void 0,this._uid="std",this._precision="highp",this._vertSrc=a("./glsl/pbr.vert")(),this._fragSrc=a("./glsl/pbr.frag")()}var e=(a("nanogl/program"),a("nanogl-state/config")),f=a("./lib/program-cache"),g=a("./lib/input"),h=a("./lib/flag"),i=a("./lib/enum"),j=a("./lib/chunks-tree"),k=a("gl-matrix").mat4.create();d.prototype={setIBL:function(a){this.ibl=a},setLightSetup:function(a){this.inputs.addChunks(a.getChunks())},prepare:function(a,b){this._isDirty()&&this.compile();var c=this.prg;c.use(),c.setupInputs(this),this.ibl.setupProgram(c),b.modelViewProjectionMatrix(k,a._wmatrix),c.uMVP(k),c.uWorldMatrix(a._wmatrix),c.uCameraPosition(b._wposition)},_isDirty:function(){return!(null!==this.prg&&!this.inputs._isDirty)},compile:function(){null!==this.prg&&this._prgcache.release(this.prg),this.prg=this._prgcache.compile(this)}},b.exports=d},{"./glsl/pbr.frag":376,"./glsl/pbr.vert":377,"./lib/chunks-tree":390,"./lib/enum":391,"./lib/flag":392,"./lib/input":393,"./lib/program-cache":398,"gl-matrix":352,"nanogl-state/config":409,"nanogl/program":419}],404:[function(a,b,c){function d(a){this.gl=a,this.EXT_texture_float=a.getExtension("OES_texture_float"),this.EXT_texture_half_float=a.getExtension("OES_texture_half_float"),this.EXT_texture_half_float_linear=a.getExtension("OES_texture_half_float_linear"),this.EXT_texture_float_linear=a.getExtension("OES_texture_float_linear"),this.EXT_color_buffer_float=a.getExtension("EXT_color_buffer_float"),this.EXT_color_buffer_half_float=a.getExtension("EXT_color_buffer_half_float"),this.WEBGL_depth_texture=a.getExtension("WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture"),void 0===a.HALF_FLOAT&&this.EXT_texture_half_float&&(a.HALF_FLOAT=this.EXT_texture_half_float.HALF_FLOAT_OES),void 0===a.UNSIGNED_INT_24_8&&this.WEBGL_depth_texture&&(a.UNSIGNED_INT_24_8=34042),this._availables={},this._renderables={},this.RGB8=e(a.RGB,a.RGB,a.UNSIGNED_BYTE),this.RGBA8=e(a.RGBA,a.RGBA,a.UNSIGNED_BYTE),this.RGB32F=e(a.RGB,a.RGB32F,a.FLOAT),this.RGBA32F=e(a.RGBA,a.RGBA32F,a.FLOAT),this.RGB16F=e(a.RGB,a.RGB16F,a.HALF_FLOAT),this.RGBA16F=e(a.RGBA,a.RGBA16F,a.HALF_FLOAT),this.A2B10G10R10=e(a.RGBA,a.RGB10_A2,a.UNSIGNED_INT_2_10_10_10_REV)}function e(a,b,c){return{format:a,internal:b,type:c}}function f(a,b,c){return a^c<<8^b<<16}d.getInstance=function(a){var b=a.__pf;return void 0===b&&(a.__pf=b=new d(a)),b},d.prototype={dispose:function(){this.EXT_texture_float=null,this.EXT_texture_half_float=null,this.EXT_texture_half_float_linear=null,this.EXT_texture_float_linear=null,this.EXT_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.gl.__pf===this&&delete this.gl.__pf,this.gl=null},hasDepthTexture:function(){return this.isAvailable(this.gl.DEPTH_COMPONENT,this.gl.UNSIGNED_INT,this.gl.DEPTH_COMPONENT24)},isAvailable:function(a,b,c){if(void 0===a||void 0===b)return!1;void 0===c&&(c=a);var d=f(a,b,c);return void 0===this._availables[d]&&(this._availables[d]=this._testAvailable(a,b,c)),this._availables[d]},isRenderable:function(a,b,c){if(void 0===a||void 0===b)return!1;void 0===c&&(c=a);var d=f(a,b,c);if(void 0===this._renderables[d]){var e=this.isAvailable(a,b,c);this._renderables[d]=e&&this._testRenderable(a,b,c)}return this._renderables[d]},getRenderableFormat:function(a){for(var b=0;b<a.length;b++){var c=a[b];if(this.isRenderable(c.format,c.type,c.internal))return c}return null},_testAvailable:function(a,b,c){var d=this.gl;d.getError();var e=d.createTexture();return d.bindTexture(d.TEXTURE_2D,e),d.texImage2D(d.TEXTURE_2D,0,c,4,4,0,a,b,null),d.deleteTexture(e),0===d.getError()},_testRenderable:function(a,b,c){var d=this.gl,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e),d.texImage2D(d.TEXTURE_2D,0,c,4,4,0,a,b,null);var f=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,f),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,e,0);var g=d.checkFramebufferStatus(d.FRAMEBUFFER)===d.FRAMEBUFFER_COMPLETE;return d.bindFramebuffer(d.FRAMEBUFFER,null),d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(e),d.deleteFramebuffer(f),g}},b.exports=d},{}],405:[function(a,b,c){function d(a,b,c){this.gl=a,this.usage=c||a.STATIC_DRAW,this.buffer=a.createBuffer(),this.attribs=[],this.stride=0,this.byteLength=0,this.length=0,b&&this.data(b)}var e=a("./bufferutils"),f=34962;d.prototype={bind:function(){this.gl.bindBuffer(f,this.buffer)},attrib:function(a,b,c,d){return this.attribs.push({name:a,type:0|c,size:0|b,normalize:!!d,offset:this.stride}),this.stride+=e.getComponentSize(c)*b,this._computeLength(),this},data:function(a){var b=this.gl;b.bindBuffer(f,this.buffer),b.bufferData(f,a,this.usage),b.bindBuffer(f,null),this.byteLength=void 0===a.byteLength?a:a.byteLength,this._computeLength()},subData:function(a,b){var c=this.gl;c.bindBuffer(f,this.buffer),c.bufferSubData(f,b,a),c.bindBuffer(f,null)},attribPointer:function(a){var b=this.gl;b.bindBuffer(f,this.buffer);for(var c=0;c<this.attribs.length;c++){var d=this.attribs[c];if(void 0!==a[d.name]){var e=a[d.name]();b.enableVertexAttribArray(e),b.vertexAttribPointer(e,d.size,d.type,d.normalize,this.stride,d.offset)}}},draw:function(a,b,c){b=void 0===b?this.length:b,this.gl.drawArrays(a,c,0|b)},dispose:function(){this.gl.deleteBuffer(this.buffer),this.buffer=null,this.gl=null},_computeLength:function(){this.stride>0&&(this.length=this.byteLength/this.stride)}},e.Drawable(d.prototype),b.exports=d},{"./bufferutils":406}],406:[function(a,b,c){b.exports={getComponentSize:function(a){switch(a){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:return 0}},Drawable:function(a){a.drawPoints=function(a,b){this.draw(0,a,b)},a.drawLines=function(a,b){this.draw(1,a,b)},a.drawLineLoop=function(a,b){this.draw(2,a,b)},a.drawLineStrip=function(a,b){this.draw(3,a,b)},a.drawTriangles=function(a,b){this.draw(4,a,b)},a.drawTriangleStrip=function(a,b){this.draw(5,a,b)},a.drawTriangleFan=function(a,b){this.draw(6,a,b)}}}},{}],407:[function(a,b,c){function d(a,b,c,d,g){b=void 0===b?-1:b,c=void 0===c?-1:c,d=void 0===d?2:d,g=void 0===g?2:g,e.call(this,a);var h=f;h[0]=h[4]=b,h[1]=h[9]=c,h[8]=h[12]=b+d,h[5]=h[13]=c+g,this.data(h),this.attrib("aPosition",2,a.FLOAT),this.attrib("aTexCoord",2,a.FLOAT)}var e=a("nanogl/arraybuffer"),f=new Float32Array([-1,-1,0,0,-1,1,0,1,1,-1,1,0,1,1,1,1]);d.prototype=Object.create(e.prototype),d.prototype.constructor=d,d.prototype.render=function(){this.drawTriangleStrip()},b.exports=d},{"nanogl/arraybuffer":405}],408:[function(a,b,c){var d=a("raf"),e=a("right-now"),f=function(){};b.exports=function(a){var b=void 0!==a.pixelRatio?a.pixelRatio:0,c=void 0===a.hdpi||a.hdpi,g=function(a){var d=this.getContextOptions();this.gl=a.getContext("webgl",d)||a.getContext("experimental-webgl",d)||a.getContext("webgl"),this.canvas=a,this.width=0,this.height=0,this.canvasWidth=0,this.canvasHeight=0,this.pixelRatio=b,this.hdpi=c,this.frame=this._frame.bind(this),this.previousTime=e(),this._rafId=0,this._playing=!1,this.init()},h=g.prototype;return h.getContextOptions=a.getContextOptions||function(){},h.render=a.render||f,h.resize=a.resize||f,h.init=a.init||f,h.dispose=function(){this.stop()},h.play=function(){this._playing||(this._playing=!0,this.frame(),this.previousTime=e(),this._requestFrame())},h.stop=function(){d.cancel(this._rafId),this._playing=!1,this._rafId=0},h.updateSize=function(){var a=1;this.pixelRatio>0?a=this.pixelRatio:this.hdpi&&(a=window.devicePixelRatio),this.canvas.width=a*this.canvasWidth,this.canvas.height=a*this.canvasHeight,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.resize()},h._checkSize=function(){var a=getComputedStyle(this.canvas),b=parseInt(a.getPropertyValue("width")),c=parseInt(a.getPropertyValue("height"));return!isNaN(b)&&!isNaN(c)&&0!==b&&0!==c&&(b===this.canvasWidth&&c===this.canvasHeight||(this.canvasWidth=b,this.canvasHeight=c,this.updateSize()),!0)},h._requestFrame=function(){d.cancel(this._rafId),this._rafId=d(this.frame)},h._frame=function(){if(this._playing){var a=e(),b=(a-this.previousTime)/1e3;this.previousTime=a,(b>.2||b<1/180)&&(b=1/60),this._checkSize()&&this.render(b),this._playing&&this._requestFrame()}},g}},{raf:425,"right-now":426}],409:[function(a,b,c){!function(){function a(a){return a|(4096&a)>>>2|(2048&a)>>>2|(524288&a)>>>3|(1048576&a)>>>3|(2097152&a)>>>3}function c(a){return 0|Math.round(65535*a)}function d(a){return a/65535}function e(a){var b=(31744&a)>>10,c=1023&a;return(a>>15?-1:1)*(b?31===b?c?NaN:1/0:Math.pow(2,b-15)*(1+c/1024):c/1024*6103515625e-14)}function f(a){h[0]=a;var b=i[0],c=b>>31<<5,d=b>>23&255;return d=d-112&112-d>>4>>27,c=(c|d)<<10,c|=b>>13&1023}function g(){this._dat=new Uint16Array(51),this._set=0}var h=new Float32Array(1),i=new Uint32Array(h.buffer),j=[1,512,1024,1024,2048,4096,4096,4,8192,2,16384,32768,256,65536,65536,65536,262144,131072,131072,131072,524288,524288,524288,2097152,1048576,1048576,1048576,128,4194304,4194304,4194304,4194304,8,16,8388608,8388608,32,64,16777216,33554432,67108864,67108864,67108864,67108864,134217728,134217728,134217728,134217728,268435456,268435456,536870912],k=new Uint16Array([0,32774,0,1,0,0,0,0,513,0,1029,2305,0,519,0,65535,65535,7680,7680,7680,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,15,1,0,0,0,0,0,0,0,0,c(0),c(1),f(1)]),l=function(a,b){return a.getParameter(b)};g.DAT_MASKS=j,g.encodeHalf=function(a){return f(a)},g.decodeHalf=function(a){return e(a)},g.prototype={toDefault:function(){this._dat.set(k),this._set=935847839},clone:function(){var a=new g;return a._dat.set(this._dat),a._set=this._set,a},patch:function(b,c){for(var d,e=this._dat,f=this._set,g=b._dat,h=b._set,i=c._dat,k=0,l=0;51>l;l++)d=j[l],0!=(f&d)&&((0==(h&d)||e[l]!==g[l])&&(k|=d),g[l]=e[l]);i.set(g),b._set|=f,c._set=a(k)},setupGL:function(a){var b,c=this._set,f=this._dat;if(0!=(1&c)&&(f[0]?a.enable(3042):a.disable(3042)),b=2560&c,0!==b&&(2560===b?a.blendEquationSeparate(f[1],f[4]):a.blendEquation(f[1])),b=5120&c,0!==b&&(5120===b?a.blendFuncSeparate(f[3],f[2],f[6],f[5]):a.blendFunc(f[3],f[2])),0!=(4&c)&&(f[7]?a.enable(2929):a.disable(2929)),0!=(8192&c)&&a.depthFunc(f[8]),0!=(2&c)&&(f[9]?a.enable(2884):a.disable(2884)),0!=(16384&c)&&a.cullFace(f[10]),0!=(32768&c)&&a.frontFace(f[11]),0!=(536870912&c)&&a.lineWidth(e(f[50])),0!=(256&c)&&(f[12]?a.enable(2960):a.disable(2960)),b=589824&c,0!==b&&(589824===b?(a.stencilFuncSeparate(1028,f[13],f[14],f[15]),a.stencilFuncSeparate(1029,f[20],f[21],f[22])):a.stencilFunc(f[13],f[14],f[15])),b=1179648&c,0!==b&&(1179648===b?(a.stencilOpSeparate(1028,f[17],f[18],f[19]),a.stencilOpSeparate(1029,f[24],f[25],f[26])):a.stencilOp(f[17],f[18],f[19])),b=2359296&c,0!==b&&(2359296===b?(a.stencilMaskSeparate(1028,f[16]),a.stencilMaskSeparate(1029,f[23])):a.stencilMask(f[16])),0!=(16777216&c)){var g=f[38];a.colorMask(1==(1&g),2==(2&g),4==(4&g),8==(8&g))}0!=(33554432&c)&&a.depthMask(1===f[39]),0!=(67108864&c)&&a.blendColor(e(f[40]),e(f[41]),e(f[42]),e(f[43])),0!=(128&c)&&(f[27]?a.enable(3089):a.disable(3089)),0!=(4194304&c)&&a.scissor(f[28],f[29],f[30],f[31]),0!=(134217728&c)&&a.viewport(f[44],f[45],f[46],f[47]),0!=(16&c)&&(f[33]?a.enable(32823):a.disable(32823)),0!=(8388608&c)&&a.polygonOffset(e(f[34]),e(f[35])),0!=(268435456&c)&&a.depthRange(d(f[48]),d(f[49]))},fromGL:function(a){this._set=0;var b=l(a,3042),c=l(a,2884),d=l(a,2929),e=l(a,3024),f=l(a,32823),g=l(a,3089),h=l(a,2960),i=l(a,32969),j=l(a,32968),k=l(a,32971),m=l(a,32970),n=l(a,32777),o=l(a,34877),p=l(a,2962),q=l(a,2967),r=l(a,2963),s=l(a,2968),t=l(a,2964),u=l(a,2965),v=l(a,2966),w=l(a,34816),x=l(a,36003),y=l(a,36004),z=l(a,36005),A=l(a,34817),B=l(a,34818),C=l(a,34819),D=l(a,32824),E=l(a,10752),F=l(a,3088),G=l(a,3107),H=l(a,2930),I=l(a,32773),J=l(a,2978),K=l(a,2928),L=l(a,2849);this.enableBlend(b),i!==k||j!==m?this.blendFuncSeparate(i,j,k,m):this.blendFunc(i,j),n!==o?this.blendEquationSeparate(n,o):this.blendEquation(n),this.enableStencil(h),p!==w||q!==x||r!==y?this.stencilFuncSeparate(p,q,r,w,x,y):this.stencilFunc(p,q,r),t!==A||u!==B||v!==C?this.stencilOpSeparate(t,u,v,A,B,C):this.stencilOp(t,u,v),s!==z?this.stencilMaskSeparate(s,z):this.stencilMask(s),this.depthFunc(a.getParameter(2932)),this.enableDepthTest(d),this.cullFace(a.getParameter(2885)),this.enableCullface(c),this.frontFace(a.getParameter(2886)),this.enablePolygonOffset(f),this.polygonOffset(D,E),this.enableScissor(g),this.scissor(F[0],F[1],F[2],F[3]),this.enableDither(e),this.colorMask(G[0],G[1],G[2],G[3]),this.depthMask(H),this.blendColor(I[0],I[1],I[2],I[3]),this.viewport(J[0],J[1],J[2],J[3]),this.depthRange(K[0],K[1]),this.lineWidth(L)},enableBlend:function(a){return void 0===a&&(a=!0),this._dat[0]=0|a,this._set|=1,this},blendFunc:function(a,b){return this._dat[3]=a,this._dat[2]=b,this._set=-4097&this._set|1024,this},blendFuncSeparate:function(a,b,c,d){return this._dat[3]=a,this._dat[2]=b,this._dat[6]=c,this._dat[5]=d,this._set|=5120,this},blendEquation:function(a){return this._dat[1]=a,this._set=-2049&this._set|512,this},blendEquationSeparate:function(a,b){return this._dat[1]=a,this._dat[4]=b,this._set|=2560,this},blendColor:function(a,b,c,d){return this._dat[40]=f(a),this._dat[41]=f(b),this._dat[42]=f(c),this._dat[43]=f(d),this._set|=67108864,this},depthFunc:function(a){return this._dat[8]=a,this._set|=8192,this},enableDepthTest:function(a){return void 0===a&&(a=!0),this._dat[7]=0|a,this._set|=4,this},depthRange:function(a,b){return this._dat[48]=c(a),this._dat[49]=c(b),this._set|=268435456,this},lineWidth:function(a){return this._dat[50]=f(a),this._set|=536870912,this},cullFace:function(a){return this._dat[10]=a,this._set|=16384,this},enableCullface:function(a){return void 0===a&&(a=!0),this._dat[9]=0|a,this._set|=2,this},polygonOffset:function(a,b){return this._dat[34]=f(a),this._dat[35]=f(b),this._set|=8388608,this},enablePolygonOffset:function(a){return void 0===a&&(a=!0),this._dat[33]=0|a,this._set|=16,this},enableScissor:function(a){return void 0===a&&(a=!0),this._dat[27]=0|a,this._set|=128,this},scissor:function(a,b,c,d){return this._dat[28]=a,this._dat[29]=b,this._dat[30]=c,this._dat[31]=d,this._set|=4194304,this},viewport:function(a,b,c,d){return this._dat[44]=a,this._dat[45]=b,this._dat[46]=c,this._dat[47]=d,this._set|=134217728,this},enableDither:function(a){return void 0===a&&(a=!0),this._dat[32]=0|a,this._set|=8,this},depthMask:function(a){return this._dat[39]=0|a,this._set|=33554432,this},colorMask:function(a,b,c,d){var e=0|a|(0|b)<<1|(0|c)<<2|(0|d)<<3;return this._dat[38]=e,this._set|=16777216,this},frontFace:function(a){return this._dat[11]=a,this._set|=32768,this},enableStencil:function(a){return void 0===a&&(a=!0),this._dat[12]=0|a,this._set|=256,this},stencilFunc:function(a,b,c){return this._dat[13]=a,this._dat[14]=b,this._dat[15]=c,this._set=-524289&this._set|65536,this},stencilOp:function(a,b,c){return this._dat[17]=a,this._dat[18]=b,this._dat[19]=c,this._set=-1048577&this._set|131072,this},stencilMask:function(a){return this._dat[16]=a,this._set=-2097153&this._set|262144,this},stencilFuncSeparate:function(a,b,c,d,e,f){var g=this._dat;return g[13]=a,g[14]=b,g[15]=c,g[20]=d,g[21]=e,g[22]=f,this._set|=589824,this},stencilOpSeparate:function(a,b,c,d,e,f){var g=this._dat;return g[17]=a,g[18]=b,g[19]=c,g[24]=d,g[25]=e,g[26]=f,this._set|=1179648,this},stencilMaskSeparate:function(a,b){return this._dat[16]=a,this._dat[23]=b,this._set|=2359296,this}},b.exports=g}()},{}],410:[function(a,b,c){!function(){function c(){this._stack=new Uint32Array(816),this._sets=new Uint32Array(16),this._tmpDat=new Uint32Array(51),this._size=16,this._ptr=0,this._headPos=0,this._wcfg=new d}var d=a("./config"),e=d.DAT_MASKS;c.prototype={initFromGL:function(a){this._ptr=0,this._wcfg.fromGL(a),this._sets[0]=0,this._stack.set(this._wcfg._dat)},push:function(a){var b,c,d,f,g,h,i,j=this._ptr,k=this._sets[j++],l=a._set;for(j==this._size&&this._grow(),k|=l,this._sets[j]=k,this._ptr=j,b=51*j,c=this._stack,d=a._dat,f=this._tmpDat,g=0;51>g;g++)h=e[g],i=0!=(l&h)?d[g]:c[b+g-51],f[g]=i;c.set(f,b)},pop:function(){var a=--this._ptr;this._headPos>a&&(this._sets[a]|=this._sets[a+1],this._headPos=a)},flush:function(){for(;this._ptr>0;)this.pop()},commit:function(a){var b=this._ptr;this.copyConfig(b,a),this._headPos=b,this._sets[b-1]|=this._sets[b],this._sets[b]=0},patch:function(a,b){this.copyConfig(this._ptr,this._wcfg),this._wcfg.patch(a,b)},copyConfig:function(a,b){var c=new Uint32Array(this._stack.buffer,204*a,51);b._dat.set(c),b._set=this._sets[a]},_grow:function(){var a=this._size<<1,b=new Uint32Array(51*a),c=new Uint32Array(a);b.set(this._stack,0),c.set(this._sets,0),this._stack=b,this._sets=c,this._size=a}},b.exports=c}()},{"./config":409}],411:[function(a,b,c){function d(a){this.gl=a,this.cfgStack=new g,this.cfgStack.initFromGL(a),this._validCfg=!1}function e(a){f.call(this),this.state=a}var f=a("./config"),g=a("./stack"),h=new f;d.prototype={push:function(a){this.cfgStack.push(a),this._validCfg=!1},pop:function(){this.cfgStack.pop(),this._validCfg=!1},apply:function(){this._validCfg||(this.cfgStack.commit(h),h.setupGL(this.gl),this._validCfg=!0)},now:function(a){this.push(a),this.apply(),this.pop()},config:function(){return new e(this)}},e.prototype=Object.create(f.prototype),e.prototype.constructor=e,e.prototype.apply=function(){this.state.now(this)},d.config=function(){return new f},b.exports=d},{"./config":409,"./stack":410}],412:[function(a,b,c){function d(a){this.gl=a,this._sync=null,this._invalidated=!1,this._pooled=!1,this._defer=k.defer(),this.promise=this._defer.promise}function e(a){this.gl=a,this.sync=a.fenceSync(37143,0),a.flush()}function f(){}function g(a){void 0===a&&(a=32),h(),l=setInterval(i,a)}function h(){clearInterval(l)}function i(){for(var a=m.length-1;a>=0;a--)m[a].isSignaled()&&m[a]._complete()}function j(a){return a.fenceSync?new e(a):new f}var k=a("when");d.resolve=i,d.auto=g,d.stop=h,d.prototype={insert:function(){null!==this._sync||this._invalidated||(this._sync=j(this.gl),this._pool())},dispose:function(){this._release(),this._defer=null,this.promise=null},isSignaled:function(){
return null!==this._sync&&this._sync.isSignaled()},then:function(a,b){this.promise.then(a,b)},clientWaitSync:function(a){return null===this._sync?37149:(void 0===a&&(a=1e6),this._sync.clientWaitSync(a))},_release:function(){this._defer.reject(),this._unpool(),this._invalidated=!0,null!==this._sync&&(this._sync.dispose(),this._sync=null)},_complete:function(){this._defer.resolve(),this._release()},_pool:function(){this._pooled||(m.push(this),this._pooled=!0)},_unpool:function(){this._pooled&&(m.splice(m.indexOf(this),1),this._pooled=!1)}},e.prototype={isSignaled:function(){return 37145===this.gl.getSyncParameter(this.sync,37140)},dispose:function(){this.gl.deleteSync(this.sync),this.gl=null,this.sync=null},clientWaitSync:function(a){return this.gl.clientWaitSync(this.sync,this.gl.SYNC_FLUSH_COMMANDS_BIT,a)}},f.prototype={isSignaled:function(){return!0},dispose:function(){},clientWaitSync:function(){return 37146}};var l,m=[];b.exports=d},{when:445}],413:[function(a,b,c){function d(){if(void 0!==g&&g.defer)return g.defer();var a={resolve:null,reject:null};return a.promise=new g(function(b,c){a.resolve=b,a.reject=c}.bind(a)),Object.freeze(a),a}function e(a){var b=h[a._uid];b&&(b.img.onload=b.img.onerror=null,b.img.src="",b.defer.reject(a)),delete h[a._uid]}function f(a){return a.fromImage(h[a._uid].img),e(a),a}var g=a("when/es6-shim/Promise.browserify-es6"),h={},i={};i.load=function(a,b){e(a);var c=d(),g=new Image;return g.onload=function(){c.resolve(a)},g.onerror=function(){c.reject(a),e(a)},g.crossOrigin="anonymous",g.src=b,h[a._uid]={texture:a,img:g,defer:c},c.promise.then(f),c.promise},i.release=function(a){e(a)},b.exports=i},{"when/es6-shim/Promise.browserify-es6":427}],414:[function(a,b,c){function d(a,b){a.bindVertexArray=function(){return b.bindVertexArrayOES.apply(b,arguments)},a.createVertexArray=function(){return b.createVertexArrayOES.apply(b,arguments)},a.deleteVertexArray=function(){return b.deleteVertexArrayOES.apply(b,arguments)},a.isVertexArray=function(){return b.isVertexArrayOES.apply(b,arguments)}}function e(a){if(this.gl=a,void 0!==a.bindVertexArray)this._impl=new f(this);else{var b=a.getExtension("OES_vertex_array_object");b?(d(a,b),this._impl=new f(this)):this._impl=new g(this)}}function f(a){this._vao=a,this._handle=null}function g(a){this._vao=a}e.prototype={dispose:function(){this._impl.dispose(),this._impl=null},setup:function(a,b,c){a.ready||a._grabParameters(),this._impl.setup(a,b,c)},bind:function(){this._impl.bind()},unbind:function(){this._impl.unbind()}},f.prototype={dispose:function(){this.release(),this._vao=null},setup:function(a,b,c){this.release();var d=this._vao.gl;this._handle=d.createVertexArray(),d.bindVertexArray(this._handle);for(var e=0;e<b.length;e++)b[e].attribPointer(a);void 0!==c&&c.bind(),d.bindVertexArray(null)},bind:function(){this._vao.gl.bindVertexArray(this._handle)},unbind:function(){this._vao.gl.bindVertexArray(null)},release:function(){this._handle&&(this._vao.gl.deleteVertexArray(this._handle),this._handle=null)}},g.prototype={dispose:function(){this._vao=null,this.prg=null,this.buffers=null,this.indices=null},setup:function(a,b,c){this.prg=a,this.buffers=b,this.indices=c},bind:function(){for(var a=0;a<this.buffers.length;a++)this.buffers[a].attribPointer(this.prg);void 0!==this.indices&&this.indices.bind()},unbind:function(){}},b.exports=e},{}],415:[function(a,b,c){arguments[4][405][0].apply(c,arguments)},{"./bufferutils":416,dup:405}],416:[function(a,b,c){arguments[4][406][0].apply(c,arguments)},{dup:406}],417:[function(a,b,c){function d(a){this.target=a,this.level=0,this._isTexture=a.id instanceof WebGLTexture}function e(a){this.gl=a,this.width=0,this.height=0,this.fbo=a.createFramebuffer(),this.bind(),this.attachments={},this.attachmentsList=[]}function f(a,b){return a|b<<1}function g(a,b){switch(f(a,b)){case 1:return 36096;case 2:return 36128;case 3:return 33306;default:return 0}}function h(a,b){switch(f(a,b)){case 1:return 33189;case 2:return 36168;case 3:return 34041;default:return 0}}function i(a,b){return b?{format:34041,type:34042,internal:a.DEPTH24_STENCIL8}:{format:6402,type:5125,internal:a.DEPTH_COMPONENT24}}var j=a("./texture"),k=a("./renderbuffer");d.prototype={isTexture:function(){return this._isTexture},_resize:function(a,b){a>0&&b>0&&(this._isTexture?this.target.fromData(a,b,null):(this.target.resize(a,b),this.target.allocate()))},_attach:function(a){var b=this.target.gl;this._isTexture?b.framebufferTexture2D(b.FRAMEBUFFER,a,b.TEXTURE_2D,this.target.id,this.level):b.framebufferRenderbuffer(b.FRAMEBUFFER,a,b.RENDERBUFFER,this.target.id)},_detach:function(a){var b=this.target.gl;this._isTexture?b.framebufferTexture2D(b.FRAMEBUFFER,a,b.TEXTURE_2D,null,this.level):b.framebufferRenderbuffer(b.FRAMEBUFFER,a,b.RENDERBUFFER,null)},dispose:function(){this.target.dispose(),this.target=null}},e.prototype={attach:function(a,b){var c=new d(b);return a|=0,this.detach(a),this.attachments[a.toString()]=c,this.attachmentsList.push(c),c._resize(this.width,this.height),c._attach(a),c},detach:function(a){var b=this.attachments[a.toString()];if(void 0!==b){var c=this.attachmentsList.indexOf(b);this.attachmentsList.splice(c,1),b._detach(a)}delete this.attachments[a.toString()]},getAttachment:function(a){var b=this.attachments[a.toString()];return void 0!==b?b:null},getColor:function(a){a|=0;var b=this.getAttachment(36064+a);return b?b.target:null},getDepth:function(){var a=this.getAttachment(36096)||this.getAttachment(36128)||this.getAttachment(33306);return a?a.target:null},attachColor:function(a,b,c){var d=new j(this.gl,a,b,c);return this.attach(36064,d)},attachDepth:function(a,b,c){a=void 0===a||!!a,b=!!b,c=!!c&&a;var d;if(c){var e=i(this.gl,b);d=new j(this.gl,e.format,e.type,e.internal)}else d=new k(this.gl,h(a,b));return this.attach(g(a,b),d)},resize:function(a,b){this.width===a&&this.height===b||(this.width=0|a,this.height=0|b,this._allocate())},bind:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.fbo)},clear:function(){this.gl.clear(17664)},defaultViewport:function(){this.gl.viewport(0,0,this.width,this.height)},isValid:function(){var a=this.gl;return a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE},dispose:function(){this.gl.deleteFramebuffer(this.fbo);for(var a=0;a<this.attachmentsList.length;a++)this.attachmentsList[a].dispose();this.attachmentsList=null,this.attachments=null,this.valid=!1,this.fbo=null,this.gl=null},_allocate:function(){for(var a=0;a<this.attachmentsList.length;a++)this.attachmentsList[a]._resize(this.width,this.height)}},b.exports=e},{"./renderbuffer":420,"./texture":421}],418:[function(a,b,c){function d(a,b,c,d){this.gl=a,this.buffer=a.createBuffer(),this.usage=d||a.STATIC_DRAW,this.type=0,this.typeSize=0,this.size=0,this.setType(b||a.UNSIGNED_SHORT),c&&this.data(c)}var e=a("./bufferutils"),f=34963;d.prototype={bind:function(){this.gl.bindBuffer(f,this.buffer)},setType:function(a){this.type=a,this.typeSize=e.getComponentSize(a)},data:function(a){var b=this.gl;b.bindBuffer(f,this.buffer),b.bufferData(f,a,this.usage),b.bindBuffer(f,null),this.size=void 0===a.byteLength?a:a.byteLength},subData:function(a,b){var c=this.gl;c.bindBuffer(f,this.buffer),c.bufferSubData(f,b,a),c.bindBuffer(f,null)},dispose:function(){this.gl.deleteBuffer(this.buffer),this.buffer=null,this.gl=null},draw:function(a,b,c){b=void 0===b?this.size/this.typeSize:b,this.gl.drawElements(a,b,this.type,0|c)}},e.Drawable(d.prototype),b.exports=d},{"./bufferutils":416}],419:[function(a,b,c){function d(a,b,c,d){this.gl=a,this.program=a.createProgram(),this.vShader=a.createShader(a.VERTEX_SHADER),this.fShader=a.createShader(a.FRAGMENT_SHADER),this.dyns=[],this.ready=!1,a.attachShader(this.program,this.vShader),a.attachShader(this.program,this.fShader),this._uid=0|p++,this._cuid=0|p++,void 0!==b&&void 0!==c&&this.compile(b,c,d)}function e(a){console.warn(a)}function f(a,b){return q[String(b+1).length]+(b+1)+": "+a}function g(a){return a.split("\n").map(f).join("\n")}function h(a,b,c){return a.shaderSource(b,c),a.compileShader(b),!(d.debug&&!a.getShaderParameter(b,a.COMPILE_STATUS))||(e(a.getShaderInfoLog(b)),e(g(c)),!1)}function i(a){return a=String(a),"uniform"+r[a]}function j(a,b,c,d){switch(a){case c.FLOAT_MAT2:case c.FLOAT_MAT3:case c.FLOAT_MAT4:return l(a,b,c,d);case c.SAMPLER_2D:case c.SAMPLER_CUBE:case 35682:case 35679:return m(a,b,c,d);default:return k(a,b,c,d)}}function k(a,b,c,d){var e=i(a);return function(){return 1===arguments.length&&void 0!==arguments[0].length?c[e+"v"](b,arguments[0]):arguments.length>0&&c[e].apply(c,Array.prototype.concat.apply(b,arguments)),b}}function l(a,b,c,d){var e=i(a);return function(){if(arguments.length>0&&void 0!==arguments[0].length){var a=arguments.length>1&&!!arguments[1];c[e+"v"](b,a,arguments[0])}return b}}function m(a,b,c,d){var e=d.texIndex++;return function(){return 1===arguments.length&&(void 0!==arguments[0].bind?(arguments[0].bind(e),c.uniform1i(b,e)):c.uniform1i(b,arguments[0])),b}}function n(a,b,c){var d=c.ublockIndex++;return function(){return 1===arguments.length&&(arguments[0]instanceof WebGLBuffer?(b.uniformBlockBinding(this.program,a,d),b.bindBufferBase(b.UNIFORM_BUFFER,d,arguments[0])):b.uniformBlockBinding(this.program,a,arguments[0])),a}}function o(a){return function(){return a}}var p=0;d.debug=!0,d.prototype={use:function(){this.ready||this._grabParameters(),this.gl.useProgram(this.program)},compile:function(a,b,c){this.ready=!1,c=void 0===c?"":c+"\n";var f=this.gl;if(!h(f,this.fShader,c+b)||!h(f,this.vShader,c+a))return!1;if(f.linkProgram(this.program),d.debug&&!f.getProgramParameter(this.program,f.LINK_STATUS))return e(f.getProgramInfoLog(this.program)),!1;for(;this.dyns.length>0;)delete this[this.dyns.pop()];return this._cuid=0|p++,!0},dispose:function(){null!==this.gl&&(this.gl.deleteProgram(this.program),this.gl.deleteShader(this.fShader),this.gl.deleteShader(this.vShader),this.gl=null)},_grabParameters:function(){for(var a=this.gl,b=this.program,c={texIndex:0,ublockIndex:0},d=a.getProgramParameter(b,a.ACTIVE_UNIFORMS),e=0;e<d;++e){var f=a.getActiveUniform(b,e);if(null!==f){var g=f.name,h=g.indexOf("[");h>=0&&(g=g.substring(0,h));var i=a.getUniformLocation(b,f.name);null!==i&&(this[g]=j(f.type,i,a,c),this.dyns.push(g))}else a.getError()}for(var k=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES),l=0;l<k;++l){var m=a.getActiveAttrib(b,l).name,p=a.getAttribLocation(b,m);this[m]=o(p),this.dyns.push(m)}if(void 0!==a.ACTIVE_UNIFORM_BLOCKS)for(var q=a.getProgramParameter(b,a.ACTIVE_UNIFORM_BLOCKS),r=0;r<q;++r){var s=a.getActiveUniformBlockName(b,r);this[s]=n(r,a,c),this.dyns.push(s)}this.ready=!0}},d.prototype.bind=d.prototype.use;var q=["","   ","  "," ",""],r={};r[5126]="1f",r[35664]="2f",r[35665]="3f",r[35666]="4f",r[35670]=r[5124]=r[35678]=r[35680]="1i",r[35671]=r[35667]="2i",r[35672]=r[35668]="3i",r[35673]=r[35669]="4i",r[35674]="Matrix2f",r[35675]="Matrix3f",r[35676]="Matrix4f",b.exports=d},{}],420:[function(a,b,c){function d(a,b){this._uid=e++,this.gl=a,this.id=a.createRenderbuffer(),this.width=0,this.height=0,this.format=b||a.DEPTH_COMPONENT16,this._valid=!1,this._storage()}var e=0;d.prototype={resize:function(a,b){this.width===a&&this.height===b||(this.width=a,this.height=b,this._valid=!1)},allocate:function(){!this._valid&&this.width>0&&this.height>0&&(this._storage(),this._valid=!0)},bind:function(){this.gl.bindRenderbuffer(36161,this.id)},dispose:function(){this.gl.deleteRenderbuffer(this.id),this.id=null,this.gl=null},_storage:function(){var a=this.gl;a.bindRenderbuffer(36161,this.id),a.renderbufferStorage(36161,this.format,this.width,this.height),a.bindRenderbuffer(36161,null)}},b.exports=d},{}],421:[function(a,b,c){function d(a,b,c){return 9728|+a|+b<<8|+(b&&c)<<1}function e(a,b,c,d){this._uid=f++,this.gl=a,this.id=a.createTexture(),this.width=0,this.height=0,this.setFormat(b,c,d),a.bindTexture(g,this.id),this.setFilter(!0)}var f=0,g=3553;e.prototype={setFormat:function(a,b,c){this.format=a||this.gl.RGB,this.internal=c||this.format,this.type=b||this.gl.UNSIGNED_BYTE},fromImage:function(a){var b=this.gl;this.width=a.width,this.height=a.height,b.bindTexture(g,this.id),b.texImage2D(g,0,this.internal,this.format,this.type,a)},fromData:function(a,b,c){var d=this.gl;this.width=a,this.height=b,c=c||null,d.bindTexture(g,this.id),d.texImage2D(g,0,this.internal,a,b,0,this.format,this.type,c)},bind:function(a){var b=this.gl;void 0!==a&&b.activeTexture(b.TEXTURE0+(0|a)),b.bindTexture(g,this.id)},dispose:function(){this.gl.deleteTexture(this.id),this.id=null,this.gl=null},setFilter:function(a,b,c){var e=this.gl,f=d(!!a,!!b,!!c);e.texParameteri(g,e.TEXTURE_MAG_FILTER,d(!!a,!1,!1)),e.texParameteri(g,e.TEXTURE_MIN_FILTER,f)},repeat:function(){this.wrap(this.gl.REPEAT)},clamp:function(){this.wrap(this.gl.CLAMP_TO_EDGE)},mirror:function(){this.wrap(this.gl.MIRRORED_REPEAT)},wrap:function(a){var b=this.gl;b.texParameteri(g,b.TEXTURE_WRAP_S,a),b.texParameteri(g,b.TEXTURE_WRAP_T,a)}},b.exports=e},{}],422:[function(a,b,c){(function(a){(function(){var c,d,e,f,g,h;"undefined"!=typeof performance&&null!==performance&&performance.now?b.exports=function(){return performance.now()}:void 0!==a&&null!==a&&a.hrtime?(b.exports=function(){return(c()-g)/1e6},d=a.hrtime,c=function(){var a;return a=d(),1e9*a[0]+a[1]},f=c(),h=1e9*a.uptime(),g=f-h):Date.now?(b.exports=function(){return Date.now()-e},e=Date.now()):(b.exports=function(){return(new Date).getTime()-e},e=(new Date).getTime())}).call(this)}).call(this,a("_process"))},{_process:423}],423:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.prependListener=k,n.prependOnceListener=k,n.listeners=function(a){return[]},n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],424:[function(a,b,c){(function(b){"use strict";var c=a("base-audio-context"),d=b.OfflineAudioContext||b.webkitOfflineAudioContext;if(d){var e=new Uint32Array([1179011410,56,1163280727,544501094,16,65537,44100,88200,1048578,1635017060,20,0,0,0,0,0]).buffer;if(!function(){return new d(1,128,44100).decodeAudioData(e,function(){},function(){})}()){var f=c.prototype.decodeAudioData;c.prototype.decodeAudioData=function(a,b,c){var d=this,e=new Promise(function(b,c){return f.call(d,a,b,c)});return e.then(b,c),e},c.prototype.decodeAudioData.original=f}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"base-audio-context":295}],425:[function(a,b,c){(function(c){for(var d=a("performance-now"),e="undefined"==typeof window?c:window,f=["moz","webkit"],g="AnimationFrame",h=e["request"+g],i=e["cancel"+g]||e["cancelRequest"+g],j=0;!h&&j<f.length;j++)h=e[f[j]+"Request"+g],i=e[f[j]+"Cancel"+g]||e[f[j]+"CancelRequest"+g];if(!h||!i){var k=0,l=0,m=[];h=function(a){if(0===m.length){var b=d(),c=Math.max(0,1e3/60-(b-k));k=c+b,setTimeout(function(){var a=m.slice(0);m.length=0;for(var b=0;b<a.length;b++)if(!a[b].cancelled)try{a[b].callback(k)}catch(a){setTimeout(function(){throw a},0)}},Math.round(c))}return m.push({handle:++l,callback:a,cancelled:!1}),l},i=function(a){for(var b=0;b<m.length;b++)m[b].handle===a&&(m[b].cancelled=!0)}}b.exports=function(a){return h.call(e,a)},b.exports.cancel=function(){i.apply(e,arguments)},b.exports.polyfill=function(a){a||(a=e),a.requestAnimationFrame=h,a.cancelAnimationFrame=i}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"performance-now":422}],426:[function(a,b,c){(function(a){b.exports=a.performance&&a.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],427:[function(a,b,c){(function(c){var d=a("../lib/decorators/unhandledRejection"),e=d(a("../lib/Promise"));b.exports=void 0!==c?c.Promise=e:"undefined"!=typeof self?self.Promise=e:e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../lib/Promise":428,"../lib/decorators/unhandledRejection":439}],428:[function(a,b,c){!function(a){"use strict";a(function(a){return a("./makePromise")({scheduler:new(a("./Scheduler"))(a("./env").asap)})})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"./Scheduler":429,"./env":441,"./makePromise":443}],429:[function(a,b,c){!function(a){"use strict";a(function(){function a(a){this._async=a,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var b=this;this.drain=function(){b._drain()}}return a.prototype.enqueue=function(a){this._queue[this._queueLen++]=a,this.run()},a.prototype.afterQueue=function(a){this._afterQueue[this._afterQueueLen++]=a,this.run()},a.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},a.prototype._drain=function(){for(var a=0;a<this._queueLen;++a)this._queue[a].run(),this._queue[a]=void 0;for(this._queueLen=0,this._running=!1,a=0;a<this._afterQueueLen;++a)this._afterQueue[a].run(),this._afterQueue[a]=void 0;this._afterQueueLen=0},a})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],430:[function(a,b,c){!function(a){"use strict";a(function(){function a(b){Error.call(this),this.message=b,this.name=a.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,a})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],431:[function(a,b,c){!function(a){"use strict";a(function(){function a(a,c){function d(b,d,f){var g=a._defer(),h=f.length;return e({f:b,thisArg:d,args:f,params:new Array(h),i:h-1,call:c},g._handler),g}function e(b,d){if(b.i<0)return c(b.f,b.thisArg,b.params,d);a._handler(b.args[b.i]).fold(f,b,void 0,d)}function f(a,b,c){a.params[a.i]=b,a.i-=1,e(a,c)}return arguments.length<2&&(c=b),d}function b(a,b,c,d){try{d.resolve(a.apply(b,c))}catch(a){d.reject(a)}}return a.tryCatchResolve=b,a})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],432:[function(a,b,c){!function(a){"use strict";a(function(a){var b=a("../state"),c=a("../apply");return function(a){function d(b){function c(a){k=null,this.resolve(a)}function d(a){this.resolved||(k.push(a),0==--j&&this.reject(k))}for(var e,f,g=a._defer(),h=g._handler,i=b.length>>>0,j=i,k=[],l=0;l<i;++l)if(void 0!==(f=b[l])||l in b){if(e=a._handler(f),e.state()>0){h.become(e),a._visitRemaining(b,l,e);break}e.visit(h,c,d)}else--j;return 0===j&&h.reject(new RangeError("any(): array must not be empty")),g}function e(b,c){function d(a){this.resolved||(k.push(a),0==--n&&(l=null,this.resolve(k)))}function e(a){this.resolved||(l.push(a),0==--f&&(k=null,this.reject(l)))}var f,g,h,i=a._defer(),j=i._handler,k=[],l=[],m=b.length>>>0,n=0;for(h=0;h<m;++h)(void 0!==(g=b[h])||h in b)&&++n;for(c=Math.max(c,0),f=n-c+1,n=Math.min(c,n),c>n?j.reject(new RangeError("some(): array must contain at least "+c+" item(s), but had "+n)):0===n&&j.resolve(k),h=0;h<m;++h)(void 0!==(g=b[h])||h in b)&&a._handler(g).visit(j,d,e,j.notify);return i}function f(b,c){return a._traverse(c,b)}function g(b,c){var d=s.call(b);return a._traverse(c,d).then(function(a){return h(d,a)})}function h(b,c){for(var d=c.length,e=new Array(d),f=0,g=0;f<d;++f)c[f]&&(e[g++]=a._handler(b[f]).value);return e.length=g,e}function i(a){return p(a.map(j))}function j(c){var d;return c instanceof a&&(d=c._handler.join()),d&&0===d.state()||!d?o(c).then(b.fulfilled,b.rejected):(d._unreport(),b.inspect(d))}function k(a,b){return arguments.length>2?q.call(a,m(b),arguments[2]):q.call(a,m(b))}function l(a,b){return arguments.length>2?r.call(a,m(b),arguments[2]):r.call(a,m(b))}function m(a){return function(b,c,d){return n(a,void 0,[b,c,d])}}var n=c(a),o=a.resolve,p=a.all,q=Array.prototype.reduce,r=Array.prototype.reduceRight,s=Array.prototype.slice;return a.any=d,a.some=e,a.settle=i,a.map=f,a.filter=g,a.reduce=k,a.reduceRight=l,a.prototype.spread=function(a){return this.then(p).then(function(b){return a.apply(this,b)})},a}})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"../apply":431,"../state":444}],433:[function(a,b,c){!function(a){"use strict";a(function(){function a(){throw new TypeError("catch predicate must be a function")}function b(a,b){return c(b)?a instanceof b:b(a)}function c(a){return a===Error||null!=a&&a.prototype instanceof Error}function d(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function e(a){return a}return function(c){function f(a,c){return function(d){return b(d,c)?a.call(this,d):j(d)}}function g(a,b,c,e){var f=a.call(b);return d(f)?h(f,c,e):c(e)}function h(a,b,c){return i(a).then(function(){return b(c)})}var i=c.resolve,j=c.reject,k=c.prototype.catch;return c.prototype.done=function(a,b){this._handler.visit(this._handler.receiver,a,b)},c.prototype.catch=c.prototype.otherwise=function(b){return arguments.length<2?k.call(this,b):"function"!=typeof b?this.ensure(a):k.call(this,f(arguments[1],b))},c.prototype.finally=c.prototype.ensure=function(a){return"function"!=typeof a?this:this.then(function(b){return g(a,this,e,b)},function(b){return g(a,this,j,b)})},c.prototype.else=c.prototype.orElse=function(a){return this.then(void 0,function(){return a})},c.prototype.yield=function(a){return this.then(function(){return a})},c.prototype.tap=function(a){return this.then(a).yield(this)},c}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],434:[function(a,b,c){!function(a){"use strict";a(function(){return function(a){return a.prototype.fold=function(b,c){var d=this._beget();return this._handler.fold(function(c,d,e){a._handler(c).fold(function(a,c,d){d.resolve(b.call(this,c,a))},d,this,e)},c,d._handler.receiver,d._handler),d},a}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],435:[function(a,b,c){!function(a){"use strict";a(function(a){var b=a("../state").inspect;return function(a){return a.prototype.inspect=function(){return b(a._handler(this))},a}})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"../state":444}],436:[function(a,b,c){!function(a){"use strict";a(function(){return function(a){function b(a,b,d,e){return c(function(b){return[b,a(b)]},b,d,e)}function c(a,b,e,f){function g(f,g){return d(e(f)).then(function(){return c(a,b,e,g)})}return d(f).then(function(c){return d(b(c)).then(function(b){return b?c:d(a(c)).spread(g)})})}var d=a.resolve;return a.iterate=b,a.unfold=c,a}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],437:[function(a,b,c){!function(a){"use strict";a(function(){return function(a){return a.prototype.progress=function(a){return this.then(void 0,void 0,a)},a}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],438:[function(a,b,c){!function(a){"use strict";a(function(a){function b(a,b,d,e){return c.setTimer(function(){a(d,e,b)},b)}var c=a("../env"),d=a("../TimeoutError");return function(a){function e(a,c,d){b(f,a,c,d)}function f(a,b){b.resolve(a)}function g(a,b,c){var e=void 0===a?new d("timed out after "+c+"ms"):a;b.reject(e)}return a.prototype.delay=function(a){var b=this._beget();return this._handler.fold(e,a,void 0,b._handler),b},a.prototype.timeout=function(a,d){var e=this._beget(),f=e._handler,h=b(g,a,d,e._handler);return this._handler.visit(f,function(a){c.clearTimer(h),this.resolve(a)},function(a){c.clearTimer(h),this.reject(a)},f.notify),e},a}})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"../TimeoutError":430,"../env":441}],439:[function(a,b,c){!function(a){"use strict";a(function(a){function b(a){throw a}function c(){}var d=a("../env").setTimer,e=a("../format");return function(a){function f(a){a.handled||(n.push(a),k("Potentially unhandled rejection ["+a.id+"] "+e.formatError(a.value)))}function g(a){var b=n.indexOf(a);b>=0&&(n.splice(b,1),l("Handled previous rejection ["+a.id+"] "+e.formatObject(a.value)))}function h(a,b){m.push(a,b),null===o&&(o=d(i,0))}function i(){for(o=null;m.length>0;)m.shift()(m.shift())}var j,k=c,l=c;"undefined"!=typeof console&&(j=console,k=void 0!==j.error?function(a){j.error(a)}:function(a){j.log(a)},l=void 0!==j.info?function(a){j.info(a)}:function(a){j.log(a)}),a.onPotentiallyUnhandledRejection=function(a){h(f,a)},a.onPotentiallyUnhandledRejectionHandled=function(a){h(g,a)},a.onFatalRejection=function(a){h(b,a.value)};var m=[],n=[],o=null;return a}})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"../env":441,"../format":442}],440:[function(a,b,c){!function(a){"use strict";a(function(){return function(a){return a.prototype.with=a.prototype.withThis=function(a){var b=this._beget(),c=b._handler;return c.receiver=a,this._handler.chain(c,a),b},a}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],441:[function(a,b,c){(function(c){!function(a){"use strict";a(function(a){var b,d="undefined"!=typeof setTimeout&&setTimeout,e=function(a,b){return setTimeout(a,b)},f=function(a){return clearTimeout(a)},g=function(a){return d(a,0)};if(function(){return void 0!==c&&"[object process]"===Object.prototype.toString.call(c)}())g=function(a){return c.nextTick(a)};else if(b=function(){return"undefined"!=typeof MutationObserver&&MutationObserver||"undefined"!=typeof WebKitMutationObserver&&WebKitMutationObserver}())g=function(a){function b(){var a=c;c=void 0,a()}var c,d=document.createTextNode("");new a(b).observe(d,{characterData:!0});var e=0;return function(a){c=a,d.data=e^=1}}(b);else if(!d){var h=a,i=h("vertx");e=function(a,b){return i.setTimer(b,a)},f=i.cancelTimer,g=i.runOnLoop||i.runOnContext}return{setTimer:e,clearTimer:f,asap:g}})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})}).call(this,a("_process"))},{_process:423}],442:[function(a,b,c){!function(a){"use strict";a(function(){function a(a){var c="object"==typeof a&&null!==a&&(a.stack||a.message)?a.stack||a.message:b(a);return a instanceof Error?c:c+" (WARNING: non-Error used)"}function b(a){var b=String(a);return"[object Object]"===b&&"undefined"!=typeof JSON&&(b=c(a,b)),b}function c(a,b){try{return JSON.stringify(a)}catch(a){return b}}return{formatError:a,formatObject:b,tryStringify:c}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],443:[function(a,b,c){(function(a){!function(b){"use strict";b(function(){return function(b){function c(a,b){this._handler=a===u?b:d(a)}function d(a){function b(a){e.resolve(a)}function c(a){e.reject(a)}function d(a){e.notify(a)}var e=new w;try{a(b,c,d)}catch(a){c(a)}return e}function e(a){return J(a)?a:new c(u,new x(r(a)))}function f(a){return new c(u,new x(new A(a)))}function g(){return ba}function h(){return new c(u,new w)}function i(a,b){return new b(u,new w(a.receiver,a.join().context))}function j(a){return l(T,null,a)}function k(a,b){return l(O,a,b)}function l(a,b,d){function e(c,e,g){g.resolved||m(d,f,c,a(b,e,c),g)}function f(a,b,c){k[a]=b,0==--j&&c.become(new z(k))}for(var g,h="function"==typeof b?e:f,i=new w,j=d.length>>>0,k=new Array(j),l=0;l<d.length&&!i.resolved;++l)g=d[l],void 0!==g||l in d?m(d,h,l,g,i):--j;return 0===j&&i.become(new z(k)),new c(u,i)}function m(a,b,c,d,e){if(K(d)){var f=s(d),g=f.state();0===g?f.fold(b,c,void 0,e):g>0?b(c,f.value,e):(e.become(f),n(a,c+1,f))}else b(c,d,e)}function n(a,b,c){for(var d=b;d<a.length;++d)o(r(a[d]),c)}function o(a,b){if(a!==b){var c=a.state();0===c?a.visit(a,void 0,a._unreport):c<0&&a._unreport()}}function p(a){return"object"!=typeof a||null===a?f(new TypeError("non-iterable passed to race()")):0===a.length?g():1===a.length?e(a[0]):q(a)}function q(a){var b,d,e,f=new w;for(b=0;b<a.length;++b)if(void 0!==(d=a[b])||b in a){if(e=r(d),0!==e.state()){f.become(e),n(a,b+1,e);break}e.visit(f,f.resolve,f.reject)}return new c(u,f)}function r(a){return J(a)?a._handler.join():K(a)?t(a):new z(a)}function s(a){return J(a)?a._handler.join():t(a)}function t(a){try{var b=a.then;return"function"==typeof b?new y(b,a):new z(a)}catch(a){return new A(a)}}function u(){}function v(){}function w(a,b){c.createContext(this,b),this.consumers=void 0,this.receiver=a,this.handler=void 0,this.resolved=!1}function x(a){this.handler=a}function y(a,b){w.call(this),X.enqueue(new G(a,b,this))}function z(a){c.createContext(this),this.value=a}function A(a){c.createContext(this),this.id=++_,this.value=a,this.handled=!1,this.reported=!1,this._report()}function B(a,b){this.rejection=a,this.context=b}function C(a){this.rejection=a}function D(){return new A(new TypeError("Promise cycle"))}function E(a,b){this.continuation=a,this.handler=b}function F(a,b){this.handler=b,this.value=a}function G(a,b,c){this._then=a,this.thenable=b,this.resolver=c}function H(a,b,c,d,e){try{a.call(b,c,d,e)}catch(a){d(a)}}function I(a,b,c,d){this.f=a,this.z=b,this.c=c,this.to=d,this.resolver=$,this.receiver=this}function J(a){return a instanceof c}function K(a){return("object"==typeof a||"function"==typeof a)&&null!==a}function L(a,b,d,e){if("function"!=typeof a)return e.become(b);c.enterContext(b),P(a,b.value,d,e),c.exitContext()}function M(a,b,d,e,f){if("function"!=typeof a)return f.become(d);c.enterContext(d),Q(a,b,d.value,e,f),c.exitContext()}function N(a,b,d,e,f){if("function"!=typeof a)return f.notify(b);c.enterContext(d),R(a,b,e,f),c.exitContext()}function O(a,b,c){try{return a(b,c)}catch(a){return f(a)}}function P(a,b,c,d){try{d.become(r(a.call(c,b)))}catch(a){d.become(new A(a))}}function Q(a,b,c,d,e){try{a.call(d,b,c,e)}catch(a){e.become(new A(a))}}function R(a,b,c,d){try{d.notify(a.call(c,b))}catch(a){d.notify(a)}}function S(a,b){b.prototype=Z(a.prototype),b.prototype.constructor=b}function T(a,b){return b}function U(){}function V(){if("function"==typeof CustomEvent)try{return new CustomEvent("unhandledRejection")instanceof CustomEvent}catch(a){}return!1}function W(){if("undefined"!=typeof document&&"function"==typeof document.createEvent)try{return document.createEvent("CustomEvent").initCustomEvent("eventType",!1,!0,{}),!0}catch(a){}return!1}var X=b.scheduler,Y=function(){return void 0!==a&&null!==a&&"function"==typeof a.emit?function(b,c){return"unhandledRejection"===b?a.emit(b,c.value,c):a.emit(b,c)}:"undefined"!=typeof self&&V()?function(a,b){return function(c,d){var e=new b(c,{detail:{reason:d.value,key:d},bubbles:!1,cancelable:!0});return!a.dispatchEvent(e)}}(self,CustomEvent):"undefined"!=typeof self&&W()?function(a,b){return function(c,d){
var e=b.createEvent("CustomEvent");return e.initCustomEvent(c,!1,!0,{reason:d.value,key:d}),!a.dispatchEvent(e)}}(self,document):U}(),Z=Object.create||function(a){function b(){}return b.prototype=a,new b};c.resolve=e,c.reject=f,c.never=g,c._defer=h,c._handler=r,c.prototype.then=function(a,b,c){var d=this._handler,e=d.join().state();if("function"!=typeof a&&e>0||"function"!=typeof b&&e<0)return new this.constructor(u,d);var f=this._beget(),g=f._handler;return d.chain(g,d.receiver,a,b,c),f},c.prototype.catch=function(a){return this.then(void 0,a)},c.prototype._beget=function(){return i(this._handler,this.constructor)},c.all=j,c.race=p,c._traverse=k,c._visitRemaining=n,u.prototype.when=u.prototype.become=u.prototype.notify=u.prototype.fail=u.prototype._unreport=u.prototype._report=U,u.prototype._state=0,u.prototype.state=function(){return this._state},u.prototype.join=function(){for(var a=this;void 0!==a.handler;)a=a.handler;return a},u.prototype.chain=function(a,b,c,d,e){this.when({resolver:a,receiver:b,fulfilled:c,rejected:d,progress:e})},u.prototype.visit=function(a,b,c,d){this.chain($,a,b,c,d)},u.prototype.fold=function(a,b,c,d){this.when(new I(a,b,c,d))},S(u,v),v.prototype.become=function(a){a.fail()};var $=new v;S(u,w),w.prototype._state=0,w.prototype.resolve=function(a){this.become(r(a))},w.prototype.reject=function(a){this.resolved||this.become(new A(a))},w.prototype.join=function(){if(!this.resolved)return this;for(var a=this;void 0!==a.handler;)if((a=a.handler)===this)return this.handler=D();return a},w.prototype.run=function(){var a=this.consumers,b=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var c=0;c<a.length;++c)b.when(a[c])},w.prototype.become=function(a){this.resolved||(this.resolved=!0,this.handler=a,void 0!==this.consumers&&X.enqueue(this),void 0!==this.context&&a._report(this.context))},w.prototype.when=function(a){this.resolved?X.enqueue(new E(a,this.handler)):void 0===this.consumers?this.consumers=[a]:this.consumers.push(a)},w.prototype.notify=function(a){this.resolved||X.enqueue(new F(a,this))},w.prototype.fail=function(a){var b=void 0===a?this.context:a;this.resolved&&this.handler.join().fail(b)},w.prototype._report=function(a){this.resolved&&this.handler.join()._report(a)},w.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},S(u,x),x.prototype.when=function(a){X.enqueue(new E(a,this))},x.prototype._report=function(a){this.join()._report(a)},x.prototype._unreport=function(){this.join()._unreport()},S(w,y),S(u,z),z.prototype._state=1,z.prototype.fold=function(a,b,c,d){M(a,b,this,c,d)},z.prototype.when=function(a){L(a.fulfilled,this,a.receiver,a.resolver)};var _=0;S(u,A),A.prototype._state=-1,A.prototype.fold=function(a,b,c,d){d.become(this)},A.prototype.when=function(a){"function"==typeof a.rejected&&this._unreport(),L(a.rejected,this,a.receiver,a.resolver)},A.prototype._report=function(a){X.afterQueue(new B(this,a))},A.prototype._unreport=function(){this.handled||(this.handled=!0,X.afterQueue(new C(this)))},A.prototype.fail=function(a){this.reported=!0,Y("unhandledRejection",this),c.onFatalRejection(this,void 0===a?this.context:a)},B.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,Y("unhandledRejection",this.rejection)||c.onPotentiallyUnhandledRejection(this.rejection,this.context))},C.prototype.run=function(){this.rejection.reported&&(Y("rejectionHandled",this.rejection)||c.onPotentiallyUnhandledRejectionHandled(this.rejection))},c.createContext=c.enterContext=c.exitContext=c.onPotentiallyUnhandledRejection=c.onPotentiallyUnhandledRejectionHandled=c.onFatalRejection=U;var aa=new u,ba=new c(u,aa);return E.prototype.run=function(){this.handler.join().when(this.continuation)},F.prototype.run=function(){var a=this.handler.consumers;if(void 0!==a)for(var b,c=0;c<a.length;++c)b=a[c],N(b.progress,this.value,this.handler,b.receiver,b.resolver)},G.prototype.run=function(){function a(a){d.resolve(a)}function b(a){d.reject(a)}function c(a){d.notify(a)}var d=this.resolver;H(this._then,this.thenable,a,b,c)},I.prototype.fulfilled=function(a){this.f.call(this.c,this.z,a,this.to)},I.prototype.rejected=function(a){this.to.reject(a)},I.prototype.progress=function(a){this.to.notify(a)},c}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})}).call(this,a("_process"))},{_process:423}],444:[function(a,b,c){!function(a){"use strict";a(function(){function a(){return{state:"pending"}}function b(a){return{state:"rejected",reason:a}}function c(a){return{state:"fulfilled",value:a}}function d(d){var e=d.state();return 0===e?a():e>0?c(d.value):b(d.value)}return{pending:a,fulfilled:c,rejected:b,inspect:d}})}("function"==typeof define&&define.amd?define:function(a){b.exports=a()})},{}],445:[function(a,b,c){!function(a){"use strict";a(function(a){function b(a,b,c,d){var e=x.resolve(a);return arguments.length<2?e:e.then(b,c,d)}function c(a){return new x(a)}function d(a){return function(){for(var b=0,c=arguments.length,d=new Array(c);b<c;++b)d[b]=arguments[b];return y(a,this,d)}}function e(a){for(var b=0,c=arguments.length-1,d=new Array(c);b<c;++b)d[b]=arguments[b+1];return y(a,this,d)}function f(){return new g}function g(){function a(a){d._handler.resolve(a)}function b(a){d._handler.reject(a)}function c(a){d._handler.notify(a)}var d=x._defer();this.promise=d,this.resolve=a,this.reject=b,this.notify=c,this.resolver={resolve:a,reject:b,notify:c}}function h(a){return a&&"function"==typeof a.then}function i(){return x.all(arguments)}function j(a){return b(a,x.all)}function k(a){return b(a,x.settle)}function l(a,c){return b(a,function(a){return x.map(a,c)})}function m(a,c){return b(a,function(a){return x.filter(a,c)})}var n=a("./lib/decorators/timed"),o=a("./lib/decorators/array"),p=a("./lib/decorators/flow"),q=a("./lib/decorators/fold"),r=a("./lib/decorators/inspect"),s=a("./lib/decorators/iterate"),t=a("./lib/decorators/progress"),u=a("./lib/decorators/with"),v=a("./lib/decorators/unhandledRejection"),w=a("./lib/TimeoutError"),x=[o,p,q,s,t,r,u,n,v].reduce(function(a,b){return b(a)},a("./lib/Promise")),y=a("./lib/apply")(x);return b.promise=c,b.resolve=x.resolve,b.reject=x.reject,b.lift=d,b.try=e,b.attempt=e,b.iterate=x.iterate,b.unfold=x.unfold,b.join=i,b.all=j,b.settle=k,b.any=d(x.any),b.some=d(x.some),b.race=d(x.race),b.map=l,b.filter=m,b.reduce=d(x.reduce),b.reduceRight=d(x.reduceRight),b.isPromiseLike=h,b.Promise=x,b.defer=f,b.TimeoutError=w,b})}("function"==typeof define&&define.amd?define:function(c){b.exports=c(a)})},{"./lib/Promise":428,"./lib/TimeoutError":430,"./lib/apply":431,"./lib/decorators/array":432,"./lib/decorators/flow":433,"./lib/decorators/fold":434,"./lib/decorators/inspect":435,"./lib/decorators/iterate":436,"./lib/decorators/progress":437,"./lib/decorators/timed":438,"./lib/decorators/unhandledRejection":439,"./lib/decorators/with":440}]},{},[112]);